Index: vlc-0.8.6.release.e+x264svn20071224+faad2.6.1/modules/access/rtsp/real_sdpplin.c
===================================================================
--- vlc-0.8.6.release.e+x264svn20071224+faad2.6.1.orig/modules/access/rtsp/real_sdpplin.c	2008-06-24 18:16:17.000000000 +1000
+++ vlc-0.8.6.release.e+x264svn20071224+faad2.6.1/modules/access/rtsp/real_sdpplin.c	2008-06-24 18:16:36.000000000 +1000
@@ -138,9 +138,16 @@
     handled=0;
 
     if(filter(*data,"a=control:streamid=",&buf, BUFLEN)) {
-      desc->stream_id=atoi(buf);
-      handled=1;
-      *data=nl(*data);
+        /* This way negative values are mapped to unfeasibly high
+         * values, and will be discarded afterward
+         */
+        unsigned long tmp = strtoul(buf, NULL, 10);
+        if ( tmp > UINT16_MAX )
+            lprintf("stream id out of bound: %lu\n", tmp);
+        else
+            desc->stream_id=tmp;
+        handled=1;
+        *data=nl(*data);
     }
     if(filter(*data,"a=MaxBitRate:integer;",&buf, BUFLEN)) {
       desc->max_bit_rate=atoi(buf);
@@ -254,7 +261,10 @@
         }
         stream=sdpplin_parse_stream(&data);
         lprintf("got data for stream id %u\n", stream->stream_id);
-        desc->stream[stream->stream_id]=stream;
+        if ( stream->stream_id >= desc->stream_count )
+            lprintf("stream id %u is greater than stream count %u\n", stream->stream_id, desc->stream_count);
+        else
+            desc->stream[stream->stream_id]=stream;
         continue;
     }
     if(filter(data,"a=Title:buffer;",&buf, BUFLEN)) {
@@ -290,10 +300,17 @@
       }
     }
     if(filter(data,"a=StreamCount:integer;",&buf, BUFLEN)) {
-      desc->stream_count=atoi(buf);
-      desc->stream = malloc(sizeof(sdpplin_stream_t*)*desc->stream_count);
-      handled=1;
-      data=nl(data);
+        /* This way negative values are mapped to unfeasibly high
+         * values, and will be discarded afterward
+         */
+        unsigned long tmp = strtoul(buf, NULL, 10);
+        if ( tmp > UINT16_MAX )
+            lprintf("stream count out of bound: %lu\n", tmp);
+        else
+            desc->stream_count = tmp;
+        desc->stream = malloc(sizeof(sdpplin_stream_t*)*desc->stream_count);
+        handled=1;
+        data=nl(data);
     }
     if(filter(data,"a=Flags:integer;",&buf, BUFLEN)) {
       desc->flags=atoi(buf);
Index: vlc-0.8.6.release.e+x264svn20071224+faad2.6.1/modules/access/rtsp/real_sdpplin.h
===================================================================
--- vlc-0.8.6.release.e+x264svn20071224+faad2.6.1.orig/modules/access/rtsp/real_sdpplin.h	2008-06-24 18:16:26.000000000 +1000
+++ vlc-0.8.6.release.e+x264svn20071224+faad2.6.1/modules/access/rtsp/real_sdpplin.h	2008-06-24 18:16:36.000000000 +1000
@@ -31,7 +31,7 @@
   char *id;
   char *bandwidth;
 
-  int stream_id;
+  uint16_t stream_id;
   char *range;
   char *length;
   char *rtpmap;
@@ -75,7 +75,7 @@
 
   int flags;
   int is_real_data_type;
-  int stream_count;
+  uint16_t stream_count;
   char *title;
   char *author;
   char *copyright;
