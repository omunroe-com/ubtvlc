From 321fa90d585b9ebcb317cf6e575edf2bb952b687 Mon Sep 17 00:00:00 2001
From: =?utf8?q?R=C3=A9mi=20Denis-Courmont?= <remi@remlab.net>
Date: Thu, 29 Jan 2015 19:15:53 +0200
Subject: [PATCH] stream: handle seek across EOF correctly (hopefully)
MIME-Version: 1.0
Content-Type: text/plain; charset=utf8
Content-Transfer-Encoding: 8bit

(cherry picked from commit 6419254f5bb5ae06b72c93c9b52cd0a3bbbacb94)
Signed-off-by: Felix Paul KÃ¼hne <fkuehne@videolan.org>
---
 src/input/stream.c |   14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

Index: vlc-2.1.6/src/input/stream.c
===================================================================
--- vlc-2.1.6.orig/src/input/stream.c	2016-05-02 20:10:01.757584307 -0400
+++ vlc-2.1.6/src/input/stream.c	2016-05-02 20:10:01.753584272 -0400
@@ -1082,15 +1082,15 @@
             /* Be sure we will read something */
             p_sys->stream.i_used += tk->i_start + p_sys->stream.i_offset + i_read - tk->i_end;
         }
-        if( AStreamRefillStream( s ) ) break;
-    }
-
-    if( tk->i_end < tk->i_start + p_sys->stream.i_offset + i_read )
-    {
-        i_read = tk->i_end - tk->i_start - p_sys->stream.i_offset;
+        if( AStreamRefillStream( s ) )
+        {
+            if( tk->i_end < tk->i_start + p_sys->stream.i_offset )
+                return 0; /* EOF */
+            i_read = tk->i_end - tk->i_start - p_sys->stream.i_offset;
+            break;
+        }
     }
 
-
     /* Now, direct pointer or a copy ? */
     i_off = (tk->i_start + p_sys->stream.i_offset) % STREAM_CACHE_TRACK_SIZE;
     if( i_off + i_read <= STREAM_CACHE_TRACK_SIZE )
