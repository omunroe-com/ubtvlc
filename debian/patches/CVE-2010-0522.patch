From 97e73c5d445f8180287e59e7f1051012f42e380c Mon Sep 17 00:00:00 2001
From: Laurent Aimar <fenrir@videolan.org>
Date: Tue, 23 Feb 2010 23:31:57 +0100
Subject: [PATCH] Fixed invalid accesses in decoder with corrupted subtitles streams.
MIME-Version: 1.0
Content-Type: text/plain; charset=utf8
Content-Transfer-Encoding: 8bit

(cherry picked from commit 4602023991ab63c6b47f091795cd6fa393b41c2c)
Signed-off-by: RÃ©mi Denis-Courmont <remi@remlab.net>
---
 modules/codec/subtitles/subsdec.c |   15 ++++++++++-----
 1 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/modules/codec/subtitles/subsdec.c b/modules/codec/subtitles/subsdec.c
index 6a3612f..8fd5aa2 100644
--- a/modules/codec/subtitles/subsdec.c
+++ vlc-0.8.6.h/modules/codec/subsdec.c
@@ -426,10 +426,11 @@ static subpicture_t *ParseText( decoder_t *p_dec, block_t *p_block )
     }
 
     /* Should be resiliant against bad subtitles */
-    psz_subtitle = strndup( (const char *)p_block->p_buffer,
-                            p_block->i_buffer );
+    psz_subtitle = malloc( p_block->i_buffer + 1 );
     if( psz_subtitle == NULL )
         return NULL;
+    memcpy( psz_subtitle, p_block->p_buffer, p_block->i_buffer );
+    psz_subtitle[p_block->i_buffer] = '\0';
 
     if( p_sys->iconv_handle == (vlc_iconv_t)-1 )
     {
-- 
1.7.2.3

