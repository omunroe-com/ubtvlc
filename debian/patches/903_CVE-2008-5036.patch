#
# Description: fix arbitrary code execution via stack-based buffer overflow via invalid RealText subtitle file.
# Patch: http://git.videolan.org/?p=vlc.git;a=commit;h=4909d939d435d7930f0e05e8b308d735950368f8
#
diff -Nur vlc-0.9.4/modules/demux/subtitle.c vlc-0.9.4.new/modules/demux/subtitle.c
--- vlc-0.9.4/modules/demux/subtitle.c	2008-10-06 14:14:27.000000000 -0400
+++ vlc-0.9.4.new/modules/demux/subtitle.c	2009-06-28 12:11:39.000000000 -0400
@@ -1842,7 +1842,6 @@
     demux_sys_t *p_sys = p_demux->p_sys;
     text_t      *txt = &p_sys->txt;
     char *psz_text = NULL;
-    char psz_end[12]= "", psz_begin[12] = "";
 
     for( ;; )
     {
@@ -1865,13 +1864,14 @@
         char *psz_temp = strcasestr( s, "<time");
         if( psz_temp != NULL )
         {
+            char psz_end[12], psz_begin[12];
             /* Line has begin and end */
             if( ( sscanf( psz_temp,
-                  "<%*[t|T]ime %*[b|B]egin=\"%[^\"]\" %*[e|E]nd=\"%[^\"]%*[^>]%[^\n\r]",
+                  "<%*[t|T]ime %*[b|B]egin=\"%11[^\"]\" %*[e|E]nd=\"%11[^\"]%*[^>]%[^\n\r]",
                             psz_begin, psz_end, psz_text) != 3 ) &&
                     /* Line has begin and no end */
                     ( sscanf( psz_temp,
-                              "<%*[t|T]ime %*[b|B]egin=\"%[^\"]\"%*[^>]%[^\n\r]",
+                              "<%*[t|T]ime %*[b|B]egin=\"%11[^\"]\"%*[^>]%[^\n\r]",
                               psz_begin, psz_text ) != 2) )
                 /* Line is not recognized */
             {
