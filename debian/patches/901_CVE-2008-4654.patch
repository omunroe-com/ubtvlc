#
# Description: fix arbitrary code execution via stack-based overflow in the Ty demux plugin
# Patch: http://git.videolan.org/?p=vlc.git;a=commit;h=26d92b87bba99b5ea2e17b7eaa39c462d65e9133
# Ubuntu: https://bugs.launchpad.net/ubuntu/+source/vlc/+bug/285922
# Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502726
#
diff -Nur vlc-0.9.4/modules/demux/ty.c vlc-0.9.4.new/modules/demux/ty.c
--- vlc-0.9.4/modules/demux/ty.c	2008-09-18 17:03:35.000000000 -0400
+++ vlc-0.9.4.new/modules/demux/ty.c	2009-06-28 12:05:26.000000000 -0400
@@ -1647,12 +1647,14 @@
     /* parse all the entries */
     p_sys->seq_table = malloc(p_sys->i_seq_table_size * sizeof(ty_seq_table_t));
     for (i=0; i<p_sys->i_seq_table_size; i++) {
-        stream_Read(p_demux->s, mst_buf, 8 + i_map_size);
+        stream_Read(p_demux->s, mst_buf, 8);
         p_sys->seq_table[i].l_timestamp = U64_AT(&mst_buf[0]);
         if (i_map_size > 8) {
             msg_Err(p_demux, "Unsupported SEQ bitmap size in master chunk");
+            stream_Read(p_demux->s, NULL, i_map_size);
             memset(p_sys->seq_table[i].chunk_bitmask, i_map_size, 0);
         } else {
+            stream_Read(p_demux->s, mst_buf + 8, i_map_size);
             memcpy(p_sys->seq_table[i].chunk_bitmask, &mst_buf[8], i_map_size);
         }
     }
