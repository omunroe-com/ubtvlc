#
# Description: fix arbitrary code execution via heap-based buffer overflow via malformed RealMedia file.
# Patch: http://git.videolan.org/?p=vlc.git;a=commitdiff;h=d19de4e9f2211cbe5bde00726b66c47a424f4e07
#
diff -Nur vlc-0.9.4/modules/demux/real.c vlc-0.9.4.new/modules/demux/real.c
--- vlc-0.9.4/modules/demux/real.c	2008-10-06 14:14:27.000000000 -0400
+++ vlc-0.9.4.new/modules/demux/real.c	2009-06-28 12:12:41.000000000 -0400
@@ -932,16 +932,13 @@
         msg_Dbg( p_demux, "Real Index: Does next index exist? %d ",
                         GetDWBE( &buffer[16] )  );
 
-    p_sys->p_index = 
-            (rm_index_t *)malloc( sizeof( rm_index_t ) * (i_index_count+1) );
+    p_sys->p_index = calloc( i_index_count + 1, sizeof( rm_index_t ) );
     if( p_sys->p_index == NULL )
     {
         msg_Err( p_demux, "Memory allocation error" ); 
         return;
     }
 
-    memset( p_sys->p_index, 0, sizeof(rm_index_t) * (i_index_count+1) );
-
     for( i=0; i<i_index_count; i++ )
     {
         if( stream_Read( p_demux->s, buffer, 14 ) < 14 )
