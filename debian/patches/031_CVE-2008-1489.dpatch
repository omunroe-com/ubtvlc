#! /bin/sh /usr/share/dpatch/dpatch-run
## 031_CVE-2008-1489.dpatch by Emanuele Gentili <emgent@emanuele-gentili.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad vlc-0.8.4.debian~/modules/demux/mp4/libmp4.c vlc-0.8.4.debian/modules/demux/mp4/libmp4.c
--- vlc-0.8.4.debian~/modules/demux/mp4/libmp4.c	2005-11-26 15:37:47.000000000 +0100
+++ vlc-0.8.4.debian/modules/demux/mp4/libmp4.c	2008-04-01 03:46:54.000000000 +0200
@@ -1940,10 +1940,14 @@
     MP4_GETVERSIONFLAGS( p_box->data.p_rdrf );
     MP4_GETFOURCC( p_box->data.p_rdrf->i_ref_type );
     MP4_GET4BYTES( i_len );
+    i_len++;
+
     if( i_len > 0 )
     {
         uint32_t i;
-        p_box->data.p_rdrf->psz_ref = malloc( i_len  + 1);
+        p_box->data.p_rdrf->psz_ref = malloc( i_len );
+      i_len --;
+
         for( i = 0; i < i_len; i++ )
         {
             MP4_GET1BYTE( p_box->data.p_rdrf->psz_ref[i] );
