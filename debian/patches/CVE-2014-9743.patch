From fe5063ec5ad1873039ea719eb1f137c8f3bda84b Mon Sep 17 00:00:00 2001
From: Jean-Baptiste Kempf <jb@videolan.org>
Date: Tue, 18 Feb 2014 13:38:56 +0100
Subject: [PATCH] Fix possible XSS in httpd_HtmlError

Found by Francesco Perna and Pietro Minniti from Quantum Leap s.r.l
Quantum Leap Advisory: Adivsory #QLA140216
---
 src/network/httpd.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

Index: vlc-2.1.6/src/network/httpd.c
===================================================================
--- vlc-2.1.6.orig/src/network/httpd.c	2016-05-02 20:09:43.085424307 -0400
+++ vlc-2.1.6/src/network/httpd.c	2016-05-02 20:09:43.085424307 -0400
@@ -259,6 +259,8 @@
     const char *errname = httpd_ReasonFromCode (code);
     assert (errname != NULL);
 
+    char *url_Encoded = convert_xml_special_chars (url ? url : "");
+
     int res = asprintf (body,
         "<?xml version=\"1.0\" encoding=\"ascii\" ?>\n"
         "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\""
@@ -273,7 +275,9 @@
         "<a href=\"http://www.videolan.org\">VideoLAN</a>\n"
         "</body>\n"
         "</html>\n", errname, code, errname,
-        (url ? " (" : ""), (url ? url : ""), (url ? ")" : ""));
+        (url_Encoded ? " (" : ""), (url_Encoded ? url_Encoded : ""), (url_Encoded ? ")" : ""));
+
+    free (url_Encoded);
 
     if (res == -1)
     {
