Description: Fix potential heap buffer overflow
 Heap out-of-bound read in ParseJSS in VideoLAN VLC due to missing check of
 string length allows attackers to read heap uninitialized data via a
 crafted subtitles file.
 .
 This fixes CVE-2017-8312.
Author: Hugo Beauz√©e-Luyssen <hugo@beauzee.fr>
Origin: upstream
Applied-Upstream: 611398fc8d32f3fe4331f60b220c52ba3557beaa
Last-Update: 2017-07-07
--- a/modules/demux/subtitle.c
+++ b/modules/demux/subtitle.c
@@ -1601,7 +1601,8 @@ static int ParseJSS( demux_t *p_demux, s
         if( !s )
             return VLC_EGENERIC;
 
-        psz_orig = malloc( strlen( s ) + 1 );
+        size_t line_length = strlen( s );
+        psz_orig = malloc( line_length + 1 );
         if( !psz_orig )
             return VLC_ENOMEM;
         psz_text = psz_orig;
@@ -1641,6 +1642,8 @@ static int ParseJSS( demux_t *p_demux, s
             {
             case 'S':
                  shift = isalpha( (unsigned char)psz_text[2] ) ? 6 : 2 ;
+                 if ( shift > line_length )
+                     continue;
 
                  if( sscanf( &psz_text[shift], "%d", &h ) )
                  {
@@ -1678,6 +1681,8 @@ static int ParseJSS( demux_t *p_demux, s
 
             case 'T':
                 shift = isalpha( (unsigned char)psz_text[2] ) ? 8 : 2 ;
+                if ( shift > line_length )
+                    continue;
 
                 sscanf( &psz_text[shift], "%d", &p_sys->jss.i_time_resolution );
                 break;
