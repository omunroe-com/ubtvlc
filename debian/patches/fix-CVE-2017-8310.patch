Description: Fix potential out of bound reads
 Heap out-of-bound read in CreateHtmlSubtitle in VideoLAN VLC 2.2.x due to
 missing check of string termination allows attackers to read data beyond
 allocated memory and potentially crash the process (causing a denial of
 service) via a crafted subtitles file.
 .
 This fixes CVE-2017-8310.
Author: Yannay Livneh <yannayl@checkpoint.com>
Origin: upstream
Applied-Upstream: 7cac839692ab79dbfe5e4ebd4c4e37d9a8b1b328
Last-Update: 2017-07-07
--- a/modules/codec/subsdec.c
+++ b/modules/codec/subsdec.c
@@ -662,7 +662,7 @@ static char *CreateHtmlSubtitle( int *pi
                 HtmlCopy( &psz_html, &psz_subtitle, "<font " );
                 HtmlPut( &psz_tag, "f" );
 
-                while( *psz_subtitle != '>' )
+                while( *psz_subtitle != '>' && *psz_subtitle)
                 {
                     int  k;
 
@@ -720,7 +720,7 @@ static char *CreateHtmlSubtitle( int *pi
                                 i_len++;
                         }
                         /* Not a tag, something else we do not understand */
-                        if( i_len == 0 )
+                        if( i_len == 0 && *psz_subtitle != '\0' )
                             psz_subtitle++;
 
                         psz_subtitle += i_len;
@@ -729,6 +729,7 @@ static char *CreateHtmlSubtitle( int *pi
                     HtmlNPut( &psz_html, psz_subtitle, strspn(psz_subtitle, " ") );
                 }
                 HtmlPut( &psz_html, ">" );
+                if (*psz_subtitle == '\0') break;
                 psz_subtitle++;
             }
             else if( !strncmp( psz_subtitle, "</", 2 ))
@@ -910,7 +911,7 @@ static char *CreateHtmlSubtitle( int *pi
             }
             psz_subtitle = strchr( psz_subtitle, '}' ) + 1;
         }
-        else if( psz_subtitle[0] == '{' &&  psz_subtitle[2] == ':' && strchr( psz_subtitle, '}' ) )
+        else if( psz_subtitle[0] == '{' &&  psz_subtitle[1] != '\0' && psz_subtitle[2] == ':' && strchr( psz_subtitle, '}' ) )
         {
             // Hide other {x:y} atrocities, like {c:$bbggrr} or {P:x}
             psz_subtitle = strchr( psz_subtitle, '}' ) + 1;
