diff -uNr vlc_0.8.6-svn20060918.debian/aclocal.m4 vlc_0.8.6-svn20060925.debian/aclocal.m4
diff -uNr vlc_0.8.6-svn20060918.debian/activex/Makefile.in vlc_0.8.6-svn20060925.debian/activex/Makefile.in
--- vlc_0.8.6-svn20060918.debian/activex/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/activex/Makefile.in	2006-09-24 13:11:56.000000000 -0400
@@ -119,12 +119,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -156,9 +157,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -250,7 +248,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/activex/utils.cpp vlc_0.8.6-svn20060925.debian/activex/utils.cpp
--- vlc_0.8.6-svn20060918.debian/activex/utils.cpp	2006-09-18 06:28:02.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/activex/utils.cpp	2006-09-21 11:50:21.000000000 -0400
@@ -62,7 +62,7 @@
             ZeroMemory(wideStr, wideLen*sizeof(WCHAR));
             MultiByteToWideChar(codePage, 0, s, -1, wideStr, wideLen);
             bstr = SysAllocStringLen(wideStr, wideLen);
-            free(wideStr);
+            CoTaskMemFree(wideStr);
 
             return bstr;
         }
@@ -105,32 +105,35 @@
 HDC CreateDevDC(DVTARGETDEVICE *ptd)
 {
 	HDC hdc=NULL;
-	LPDEVNAMES lpDevNames;
-	LPDEVMODE lpDevMode;
-	LPTSTR lpszDriverName;
-	LPTSTR lpszDeviceName;
-	LPTSTR lpszPortName;
-
-	if (ptd == NULL) {
+	if( NULL == ptd )
+    {
 		hdc = CreateDC(TEXT("DISPLAY"), NULL, NULL, NULL);
-		goto errReturn;
 	}
+    else
+    {
+        LPDEVNAMES lpDevNames;
+        LPDEVMODE lpDevMode;
+        LPTSTR lpszDriverName;
+        LPTSTR lpszDeviceName;
+        LPTSTR lpszPortName;
 
-	lpDevNames = (LPDEVNAMES) ptd; // offset for size field
-
-	if (ptd->tdExtDevmodeOffset == 0) {
-		lpDevMode = NULL;
-	}else{
-		lpDevMode  = (LPDEVMODE) ((LPTSTR)ptd + ptd->tdExtDevmodeOffset);
-	}
+        lpDevNames = (LPDEVNAMES) ptd; // offset for size field
 
-	lpszDriverName = (LPTSTR) lpDevNames + ptd->tdDriverNameOffset;
-	lpszDeviceName = (LPTSTR) lpDevNames + ptd->tdDeviceNameOffset;
-	lpszPortName   = (LPTSTR) lpDevNames + ptd->tdPortNameOffset;
+        if (ptd->tdExtDevmodeOffset == 0)
+        {
+            lpDevMode = NULL;
+        }
+        else
+        {
+            lpDevMode  = (LPDEVMODE) ((LPTSTR)ptd + ptd->tdExtDevmodeOffset);
+        }
 
-	hdc = CreateDC(lpszDriverName, lpszDeviceName, lpszPortName, lpDevMode);
+        lpszDriverName = (LPTSTR) lpDevNames + ptd->tdDriverNameOffset;
+        lpszDeviceName = (LPTSTR) lpDevNames + ptd->tdDeviceNameOffset;
+        lpszPortName   = (LPTSTR) lpDevNames + ptd->tdPortNameOffset;
 
-errReturn:
+        hdc = CreateDC(lpszDriverName, lpszDeviceName, lpszPortName, lpDevMode);
+    }
 	return hdc;
 };
 
diff -uNr vlc_0.8.6-svn20060918.debian/AUTHORS vlc_0.8.6-svn20060925.debian/AUTHORS
diff -uNr vlc_0.8.6-svn20060918.debian/bindings/java/Makefile.in vlc_0.8.6-svn20060925.debian/bindings/java/Makefile.in
--- vlc_0.8.6-svn20060918.debian/bindings/java/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/bindings/java/Makefile.in	2006-09-24 13:11:56.000000000 -0400
@@ -119,12 +119,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -156,9 +157,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -250,7 +248,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/bindings/Makefile.in vlc_0.8.6-svn20060925.debian/bindings/Makefile.in
--- vlc_0.8.6-svn20060918.debian/bindings/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/bindings/Makefile.in	2006-09-24 13:11:56.000000000 -0400
@@ -115,12 +115,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -152,9 +153,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -246,7 +244,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/bindings/mediacontrol-python/Makefile.in vlc_0.8.6-svn20060925.debian/bindings/mediacontrol-python/Makefile.in
--- vlc_0.8.6-svn20060918.debian/bindings/mediacontrol-python/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/bindings/mediacontrol-python/Makefile.in	2006-09-24 13:11:57.000000000 -0400
@@ -119,12 +119,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -156,9 +157,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -250,7 +248,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/configure vlc_0.8.6-svn20060925.debian/configure
--- vlc_0.8.6-svn20060918.debian/configure	2006-09-18 06:30:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/configure	2006-09-24 13:11:19.000000000 -0400
@@ -959,6 +959,8 @@
 CORBA_LIBS
 ENABLE_CORBA_TRUE
 ENABLE_CORBA_FALSE
+GNUTLS_CFLAGS
+GNUTLS_LIBS
 LOADER_TRUE
 LOADER_FALSE
 MIDL
@@ -975,11 +977,6 @@
 BUILD_MOZILLA_FALSE
 BUILD_PYTHON_TRUE
 BUILD_PYTHON_FALSE
-JAVA_CC
-JAVA_CC_FLAGS
-ac_ct_JAVA_CC
-GCJ_OPTS
-JAVA_CC_OPTS
 JAVAC
 JAVA
 uudecode
@@ -1060,9 +1057,9 @@
 BONJOUR_LIBS
 CORBA_CFLAGS
 CORBA_LIBS
-MIDL
-JAVA_CC
-JAVA_CC_FLAGS'
+GNUTLS_CFLAGS
+GNUTLS_LIBS
+MIDL'
 
 
 # Initialize some variables set by options.
@@ -1797,7 +1794,7 @@
 
 Optimization options:
   --with-tuning=ARCH      enable special tuning for an architecture
-                          (default Pentium 2 on IA-32 and 750 on PPC)
+                          (default Pentium 2 on IA-32 and G4 on PPC)
 Input plugins:
     --with-live555-tree=PATH live.com tree for static linking
     --with-dv-raw1394=PATH   libraw1394 headers and libraries
@@ -1927,10 +1924,10 @@
   CORBA_CFLAGS
               C compiler flags for CORBA, overriding pkg-config
   CORBA_LIBS  linker flags for CORBA, overriding pkg-config
+  GNUTLS_CFLAGS
+              C compiler flags for GNUTLS, overriding pkg-config
+  GNUTLS_LIBS linker flags for GNUTLS, overriding pkg-config
   MIDL        Microsoft IDL compiler (Win32 platform only)
-  JAVA_CC     java compiler command
-  JAVA_CC_FLAGS
-              java compiler flags
 
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
@@ -6660,7 +6657,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 6663 "configure"' > conftest.$ac_ext
+  echo '#line 6660 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -9109,11 +9106,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:9112: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:9109: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:9116: \$? = $ac_status" >&5
+   echo "$as_me:9113: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -9377,11 +9374,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:9380: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:9377: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:9384: \$? = $ac_status" >&5
+   echo "$as_me:9381: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -9481,11 +9478,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:9484: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:9481: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:9488: \$? = $ac_status" >&5
+   echo "$as_me:9485: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -11922,7 +11919,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 11925 "configure"
+#line 11922 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -12022,7 +12019,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 12025 "configure"
+#line 12022 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -14390,11 +14387,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:14393: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:14390: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:14397: \$? = $ac_status" >&5
+   echo "$as_me:14394: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -14494,11 +14491,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:14497: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:14494: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:14501: \$? = $ac_status" >&5
+   echo "$as_me:14498: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -16055,11 +16052,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16058: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:16055: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:16062: \$? = $ac_status" >&5
+   echo "$as_me:16059: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -16159,11 +16156,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16162: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:16159: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:16166: \$? = $ac_status" >&5
+   echo "$as_me:16163: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -18378,11 +18375,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:18381: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:18378: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:18385: \$? = $ac_status" >&5
+   echo "$as_me:18382: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -18646,11 +18643,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:18649: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:18646: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:18653: \$? = $ac_status" >&5
+   echo "$as_me:18650: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -18750,11 +18747,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:18753: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:18750: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:18757: \$? = $ac_status" >&5
+   echo "$as_me:18754: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -21669,13 +21666,29 @@
 fi
 
   if test "${with_contrib}" != "no"; then
-
+    { echo "$as_me:$LINENO: checking for libs in extras/contrib" >&5
+echo $ECHO_N "checking for libs in extras/contrib... $ECHO_C" >&6; }
     topdir="`dirname $0`"
     if test "`echo \"$topdir\" | cut -c 1`" != "/"; then
        topdir="`pwd`/$topdir"
     fi
-
+   if test "`grep HOST ${topdir}/extras/contrib/config.mak 2>/dev/null|awk '{print $3}'`" != "`$CC -dumpmachine`"; then
+      if test "${with_contrib}" = "yes"; then
+        { echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6; }
+	{ { echo "$as_me:$LINENO: error:  not using the libs in extras/contrib as it is not the same host" >&5
+echo "$as_me: error:  not using the libs in extras/contrib as it is not the same host" >&2;}
+   { (exit 1); exit 1; }; }
+      else
+        { echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6; }
+	{ echo "$as_me:$LINENO: WARNING:  not using the libs in extras/contrib as it is not the same host" >&5
+echo "$as_me: WARNING:  not using the libs in extras/contrib as it is not the same host" >&2;}
+      fi
+     else
   if test -d ${topdir}/extras/contrib/lib; then
+    { echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6; }
     export PATH=${topdir}/extras/contrib/bin:$PATH
     CPPFLAGS="${CPPFLAGS} -I${topdir}/extras/contrib/include"
     CPPFLAGS_save="${CPPFLAGS_save} -I${topdir}/extras/contrib/include"
@@ -21708,6 +21721,9 @@
     if test -z $with_cyberlink_tree; then
        with_cyberlink_tree=${topdir}/extras/contrib/src/clinkcc
     fi
+    if test -z $with_libmpeg2_tree; then
+        with_libmpeg2_tree=${topdir}/extras/contrib/src/mpeg2dec
+    fi
 
     if test ".`uname -s`" = ".Darwin"; then
       export LD_LIBRARY_PATH=${topdir}/extras/contrib/lib:$LD_LIBRARY_PATH
@@ -21716,6 +21732,10 @@
       export LIBRARY_PATH=${topdir}/extras/contrib/lib:$LIBRARY_PATH
       export BELIBRARIES=${topdir}/extras/contrib/lib:$BELIBRARIES
     fi
+  else
+    { echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6; }
+  fi
   fi
 fi
 LDFLAGS_vlc="${LDFLAGS}"
@@ -39501,7 +39521,7 @@
     elif test "${target_cpu}" = "x86_64"; then
         CFLAGS_TUNING="-mtune=athlon64"
     elif test "${target_cpu}" = "powerpc"; then
-        CFLAGS_TUNING="-mtune=750";
+        CFLAGS_TUNING="-mtune=G4";
     fi
 fi
 
@@ -39768,13 +39788,13 @@
   PLUGINS="${PLUGINS} access_output_shout"
 
 
-  for element in vlc access_output_shout; do
+  for element in access_output_shout; do
     eval "LDFLAGS_${element}="'"'"$SHOUT_LIBS "'$'"{LDFLAGS_${element}} "'"'
     am_modules_with_ldflags="${am_modules_with_ldflags} ${element}"
   done
 
 
-  for element in vlc access_output_shout; do
+  for element in access_output_shout; do
     eval "CFLAGS_${element}="'"$'"{CFLAGS_${element}} $SHOUT_CFLAGS"'"'
     am_modules_with_cflags="${am_modules_with_cflags} ${element}"
   done
@@ -64311,6 +64331,12 @@
     am_modules_with_ldflags="${am_modules_with_ldflags} ${element}"
   done
 
+
+  for element in macosx; do
+    eval "OBJCFLAGS_${element}="'"$'"{OBJCFLAGS_${element}} -fobjc-exceptions "'"'
+    am_modules_with_objcflags="${am_modules_with_objcflags} ${element}"
+  done
+
    fi
 else
 
@@ -64482,6 +64508,12 @@
   done
 
 
+  for element in macosx; do
+    eval "OBJCFLAGS_${element}="'"$'"{OBJCFLAGS_${element}} -fobjc-exceptions "'"'
+    am_modules_with_objcflags="${am_modules_with_objcflags} ${element}"
+  done
+
+
 fi
 
 done
@@ -66369,510 +66401,78 @@
 
 if test "${enable_gnutls}" != "no"; then
 
-  gcrypt_LIBS="-lgpg-error"
-  if test "${SYS}" = "mingw32"; then
-
-    gcrypt_LIBS="${gcrypt_LIBS} -lws2_32"
-
-  for element in gnutls; do
-    eval "LDFLAGS_${element}="'"'"-lws2_32 "'$'"{LDFLAGS_${element}} "'"'
-    am_modules_with_ldflags="${am_modules_with_ldflags} ${element}"
-  done
-
-
-fi
-
-
-  gnutls_LIBS="-lgcrypt -lz ${gcrypt_LIBS}"
-  if test "${SYS}" = "darwin"; then
-
-    gnutls_LIBS="-lintl ${gnutls_LIBS}"
-
-  for element in gnutls; do
-    eval "LDFLAGS_${element}="'"'"-lintl "'$'"{LDFLAGS_${element}} "'"'
-    am_modules_with_ldflags="${am_modules_with_ldflags} ${element}"
-  done
-
-
-fi
-
-
-  if test "${ac_cv_header_gcrypt_h+set}" = set; then
-  { echo "$as_me:$LINENO: checking for gcrypt.h" >&5
-echo $ECHO_N "checking for gcrypt.h... $ECHO_C" >&6; }
-if test "${ac_cv_header_gcrypt_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_gcrypt_h" >&5
-echo "${ECHO_T}$ac_cv_header_gcrypt_h" >&6; }
-else
-  # Is the header compilable?
-{ echo "$as_me:$LINENO: checking gcrypt.h usability" >&5
-echo $ECHO_N "checking gcrypt.h usability... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <gcrypt.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6; }
 
-# Is the header present?
-{ echo "$as_me:$LINENO: checking gcrypt.h presence" >&5
-echo $ECHO_N "checking gcrypt.h presence... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <gcrypt.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: gcrypt.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: gcrypt.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: gcrypt.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: gcrypt.h:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: gcrypt.h: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: gcrypt.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: gcrypt.h: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gcrypt.h: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: gcrypt.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ echo "$as_me:$LINENO: checking for gcrypt.h" >&5
-echo $ECHO_N "checking for gcrypt.h... $ECHO_C" >&6; }
-if test "${ac_cv_header_gcrypt_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_gcrypt_h=$ac_header_preproc
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_gcrypt_h" >&5
-echo "${ECHO_T}$ac_cv_header_gcrypt_h" >&6; }
-
-fi
-if test $ac_cv_header_gcrypt_h = yes; then
-
-    { echo "$as_me:$LINENO: checking for gcry_control in -lgcrypt" >&5
-echo $ECHO_N "checking for gcry_control in -lgcrypt... $ECHO_C" >&6; }
-if test "${ac_cv_lib_gcrypt_gcry_control+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lgcrypt ${gcrypt_LIBS} $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+pkg_failed=no
+{ echo "$as_me:$LINENO: checking for GNUTLS" >&5
+echo $ECHO_N "checking for GNUTLS... $ECHO_C" >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char gcry_control ();
-int
-main ()
-{
-return gcry_control ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
+if test -n "$PKG_CONFIG"; then
+    if test -n "$GNUTLS_CFLAGS"; then
+        pkg_cv_GNUTLS_CFLAGS="$GNUTLS_CFLAGS"
+    else
+        if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"gnutls >= 1.2.9\"") >&5
+  ($PKG_CONFIG --exists --print-errors "gnutls >= 1.2.9") 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_gcrypt_gcry_control=yes
+  (exit $ac_status); }; then
+  pkg_cv_GNUTLS_CFLAGS=`$PKG_CONFIG --cflags "gnutls >= 1.2.9" 2>/dev/null`
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_gcrypt_gcry_control=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_gcrypt_gcry_control" >&5
-echo "${ECHO_T}$ac_cv_lib_gcrypt_gcry_control" >&6; }
-if test $ac_cv_lib_gcrypt_gcry_control = yes; then
-
-      if test "${ac_cv_header_gnutls_gnutls_h+set}" = set; then
-  { echo "$as_me:$LINENO: checking for gnutls/gnutls.h" >&5
-echo $ECHO_N "checking for gnutls/gnutls.h... $ECHO_C" >&6; }
-if test "${ac_cv_header_gnutls_gnutls_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  pkg_failed=yes
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_gnutls_gnutls_h" >&5
-echo "${ECHO_T}$ac_cv_header_gnutls_gnutls_h" >&6; }
-else
-  # Is the header compilable?
-{ echo "$as_me:$LINENO: checking gnutls/gnutls.h usability" >&5
-echo $ECHO_N "checking gnutls/gnutls.h usability... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <gnutls/gnutls.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+    fi
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
+	pkg_failed=untried
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ echo "$as_me:$LINENO: checking gnutls/gnutls.h presence" >&5
-echo $ECHO_N "checking gnutls/gnutls.h presence... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <gnutls/gnutls.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
+if test -n "$PKG_CONFIG"; then
+    if test -n "$GNUTLS_LIBS"; then
+        pkg_cv_GNUTLS_LIBS="$GNUTLS_LIBS"
+    else
+        if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"gnutls >= 1.2.9\"") >&5
+  ($PKG_CONFIG --exists --print-errors "gnutls >= 1.2.9") 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
+  (exit $ac_status); }; then
+  pkg_cv_GNUTLS_LIBS=`$PKG_CONFIG --libs "gnutls >= 1.2.9" 2>/dev/null`
 else
-  ac_cpp_err=yes
+  pkg_failed=yes
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
+    fi
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
+	pkg_failed=untried
 fi
 
-rm -f conftest.err conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6; }
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: gnutls/gnutls.h: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: gnutls/gnutls.h: in the future, the compiler will take precedence" >&2;}
-
-    ;;
-esac
-{ echo "$as_me:$LINENO: checking for gnutls/gnutls.h" >&5
-echo $ECHO_N "checking for gnutls/gnutls.h... $ECHO_C" >&6; }
-if test "${ac_cv_header_gnutls_gnutls_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_gnutls_gnutls_h=$ac_header_preproc
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_gnutls_gnutls_h" >&5
-echo "${ECHO_T}$ac_cv_header_gnutls_gnutls_h" >&6; }
 
-fi
-if test $ac_cv_header_gnutls_gnutls_h = yes; then
-
-        { echo "$as_me:$LINENO: checking for gnutls_certificate_verify_peers2 in -lgnutls" >&5
-echo $ECHO_N "checking for gnutls_certificate_verify_peers2 in -lgnutls... $ECHO_C" >&6; }
-if test "${ac_cv_lib_gnutls_gnutls_certificate_verify_peers2+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lgnutls ${gnutls_LIBS} $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+if test $pkg_failed = yes; then
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char gnutls_certificate_verify_peers2 ();
-int
-main ()
-{
-return gnutls_certificate_verify_peers2 ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_gnutls_gnutls_certificate_verify_peers2=yes
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_gnutls_gnutls_certificate_verify_peers2=no
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GNUTLS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gnutls >= 1.2.9"`
+        else
+	        GNUTLS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gnutls >= 1.2.9"`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$GNUTLS_PKG_ERRORS" >&5
 
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_gnutls_gnutls_certificate_verify_peers2" >&5
-echo "${ECHO_T}$ac_cv_lib_gnutls_gnutls_certificate_verify_peers2" >&6; }
-if test $ac_cv_lib_gnutls_gnutls_certificate_verify_peers2 = yes; then
-  have_gnutls="yes"
+	{ echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6; }
+                have_gnutls="no"
+elif test $pkg_failed = untried; then
+	have_gnutls="no"
 else
-  old_gnutls="yes"
-fi
-
-
-fi
-
-
-
-fi
-
-
+	GNUTLS_CFLAGS=$pkg_cv_GNUTLS_CFLAGS
+	GNUTLS_LIBS=$pkg_cv_GNUTLS_LIBS
+        { echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6; }
+	have_gnutls="yes"
 fi
 
-
-
   if test "${have_gnutls}" = "yes"; then
 
 
@@ -66880,7 +66480,13 @@
 
 
   for element in gnutls; do
-    eval "LDFLAGS_${element}="'"'"-lgnutls ${gnutls_LIBS} "'$'"{LDFLAGS_${element}} "'"'
+    eval "CFLAGS_${element}="'"$'"{CFLAGS_${element}} $GNUTLS_CFLAGS"'"'
+    am_modules_with_cflags="${am_modules_with_cflags} ${element}"
+  done
+
+
+  for element in gnutls; do
+    eval "LDFLAGS_${element}="'"'"$GNUTLS_LIBS "'$'"{LDFLAGS_${element}} "'"'
     am_modules_with_ldflags="${am_modules_with_ldflags} ${element}"
   done
 
@@ -66889,8 +66495,8 @@
 
     if test "${enable_gnutls}" = "yes"; then
 
-      { { echo "$as_me:$LINENO: error: gnutls not present or too old (version 1.0.17 required)" >&5
-echo "$as_me: error: gnutls not present or too old (version 1.0.17 required)" >&2;}
+      { { echo "$as_me:$LINENO: error: gnutls not present or too old (version 1.2.9 required)" >&5
+echo "$as_me: error: gnutls not present or too old (version 1.2.9 required)" >&2;}
    { (exit 1); exit 1; }; }
 
 fi
@@ -68231,124 +67837,13 @@
   enableval=$enable_java_bindings;
 fi
 
-if test "${enable-java-bindings}" = "yes"
+if test "${enable_java_bindings}" = "yes"
 then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in javac
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_JAVA_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$JAVA_CC"; then
-  ac_cv_prog_JAVA_CC="$JAVA_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_JAVA_CC="$ac_tool_prefix$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-JAVA_CC=$ac_cv_prog_JAVA_CC
-if test -n "$JAVA_CC"; then
-  { echo "$as_me:$LINENO: result: $JAVA_CC" >&5
-echo "${ECHO_T}$JAVA_CC" >&6; }
-else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
-fi
-
-
-    test -n "$JAVA_CC" && break
-  done
-fi
-if test -z "$JAVA_CC"; then
-  ac_ct_JAVA_CC=$JAVA_CC
-  for ac_prog in javac
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_JAVA_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$ac_ct_JAVA_CC"; then
-  ac_cv_prog_ac_ct_JAVA_CC="$ac_ct_JAVA_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_JAVA_CC="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_JAVA_CC=$ac_cv_prog_ac_ct_JAVA_CC
-if test -n "$ac_ct_JAVA_CC"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_JAVA_CC" >&5
-echo "${ECHO_T}$ac_ct_JAVA_CC" >&6; }
-else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
-fi
-
-
-  test -n "$ac_ct_JAVA_CC" && break
-done
-
-  if test "x$ac_ct_JAVA_CC" = x; then
-    JAVA_CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
-ac_tool_warned=yes ;;
-esac
-    JAVA_CC=$ac_ct_JAVA_CC
-  fi
-fi
-
-
-if test "$JAVA_CC" = "gcj"; then
-   if test "$GCJ_OPTS" = ""; then
-      GCJ_OPTS=-C
-
-   fi
-   JAVA_CC_OPTS=@GCJ_OPTS@
-
-fi
-test -z "$JAVA_CC" && { { echo "$as_me:$LINENO: error: no acceptable java compiler found in \$PATH" >&5
-echo "$as_me: error: no acceptable java compiler found in \$PATH" >&2;}
+  if test "x${JAVA_HOME}" == "x"; then
+  { { echo "$as_me:$LINENO: error: Please set the JAVA_HOME variable to your JDK environment" >&5
+echo "$as_me: error: Please set the JAVA_HOME variable to your JDK environment" >&2;}
    { (exit 1); exit 1; }; }
+fi
 
 
 if test "x$JAVAPREFIX" = x; then
@@ -68452,7 +67947,7 @@
 JAVA_TEST=Test.java
 CLASS_TEST=Test.class
 cat << \EOF > $JAVA_TEST
-/* #line 68455 "configure" */
+/* #line 67950 "configure" */
 public class Test {
 }
 EOF
@@ -68628,7 +68123,7 @@
 if uudecode$EXEEXT Test.uue; then
         ac_cv_prog_uudecode_base64=yes
 else
-        echo "configure: 68631: uudecode had trouble decoding base 64 file 'Test.uue'" >&5
+        echo "configure: 68126: uudecode had trouble decoding base 64 file 'Test.uue'" >&5
         echo "configure: failed file was:" >&5
         cat Test.uue >&5
         ac_cv_prog_uudecode_base64=no
@@ -68750,7 +68245,7 @@
 JAVA_TEST=Test.java
 CLASS_TEST=Test.class
 cat << \EOF > $JAVA_TEST
-/* #line 68753 "configure" */
+/* #line 68248 "configure" */
 public class Test {
 }
 EOF
@@ -68787,7 +68282,7 @@
 CLASS_TEST=Test.class
 TEST=Test
 cat << \EOF > $JAVA_TEST
-/* [#]line 68790 "configure" */
+/* [#]line 68285 "configure" */
 public class Test {
 public static void main (String args[]) {
         System.exit (0);
@@ -70797,6 +70292,8 @@
 CORBA_LIBS!$CORBA_LIBS$ac_delim
 ENABLE_CORBA_TRUE!$ENABLE_CORBA_TRUE$ac_delim
 ENABLE_CORBA_FALSE!$ENABLE_CORBA_FALSE$ac_delim
+GNUTLS_CFLAGS!$GNUTLS_CFLAGS$ac_delim
+GNUTLS_LIBS!$GNUTLS_LIBS$ac_delim
 LOADER_TRUE!$LOADER_TRUE$ac_delim
 LOADER_FALSE!$LOADER_FALSE$ac_delim
 MIDL!$MIDL$ac_delim
@@ -70813,11 +70310,6 @@
 BUILD_MOZILLA_FALSE!$BUILD_MOZILLA_FALSE$ac_delim
 BUILD_PYTHON_TRUE!$BUILD_PYTHON_TRUE$ac_delim
 BUILD_PYTHON_FALSE!$BUILD_PYTHON_FALSE$ac_delim
-JAVA_CC!$JAVA_CC$ac_delim
-JAVA_CC_FLAGS!$JAVA_CC_FLAGS$ac_delim
-ac_ct_JAVA_CC!$ac_ct_JAVA_CC$ac_delim
-GCJ_OPTS!$GCJ_OPTS$ac_delim
-JAVA_CC_OPTS!$JAVA_CC_OPTS$ac_delim
 JAVAC!$JAVAC$ac_delim
 JAVA!$JAVA$ac_delim
 uudecode!$uudecode$ac_delim
@@ -70851,7 +70343,7 @@
 LTLIBOBJS!$LTLIBOBJS$ac_delim
 _ACEOF
 
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 65; then
+  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 62; then
     break
   elif $ac_last_try; then
     { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
diff -uNr vlc_0.8.6-svn20060918.debian/configure.ac vlc_0.8.6-svn20060925.debian/configure.ac
diff -uNr vlc_0.8.6-svn20060918.debian/doc/ChangeLog-2005 vlc_0.8.6-svn20060925.debian/doc/ChangeLog-2005
diff -uNr vlc_0.8.6-svn20060918.debian/doc/Makefile.am vlc_0.8.6-svn20060925.debian/doc/Makefile.am
diff -uNr vlc_0.8.6-svn20060918.debian/doc/Makefile.in vlc_0.8.6-svn20060925.debian/doc/Makefile.in
--- vlc_0.8.6-svn20060918.debian/doc/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/doc/Makefile.in	2006-09-24 13:11:58.000000000 -0400
@@ -115,12 +115,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -152,9 +153,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -246,7 +244,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
@@ -314,6 +311,7 @@
 	ChangeLog-2002 \
 	ChangeLog-2003 \
 	ChangeLog-2004 \
+	ChangeLog-2005 \
 	vlc.1 \
 	vlc-config.1 \
 	bugreport-howto.txt \
diff -uNr vlc_0.8.6-svn20060918.debian/extras/MacOSX/Resources/English.lproj/MainMenu.nib/classes.nib vlc_0.8.6-svn20060925.debian/extras/MacOSX/Resources/English.lproj/MainMenu.nib/classes.nib
diff -uNr vlc_0.8.6-svn20060918.debian/include/libvlc_internal.h vlc_0.8.6-svn20060925.debian/include/libvlc_internal.h
--- vlc_0.8.6-svn20060918.debian/include/libvlc_internal.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/libvlc_internal.h	2006-09-22 11:14:32.000000000 -0400
@@ -46,6 +46,9 @@
     struct libvlc_instance_t *p_instance; ///< Parent instance
 };
 
+#define RAISENULL( psz ) { libvlc_exception_raise( p_e, psz ); return NULL; }
+#define RAISEVOID( psz ) { libvlc_exception_raise( p_e, psz ); return; }
+#define RAISEZERO( psz ) { libvlc_exception_raise( p_e, psz ); return 0; }
 
 # ifdef __cplusplus
 }
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc/libvlc.h vlc_0.8.6-svn20060925.debian/include/vlc/libvlc.h
--- vlc_0.8.6-svn20060918.debian/include/vlc/libvlc.h	2006-09-18 06:28:44.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc/libvlc.h	2006-09-21 11:50:22.000000000 -0400
@@ -34,6 +34,10 @@
 
 #include <vlc/vlc.h>
 
+#ifndef WIN32
+#include <X11/Xlib.h>
+#endif
+
 # ifdef __cplusplus
 extern "C" {
 # endif
@@ -114,6 +118,14 @@
 libvlc_instance_t * libvlc_new( int , char **, libvlc_exception_t *);
 
 /**
+ * Returns a libvlc instance identifier for legacy APIs. Use of this
+ * function is discouraged, you should convert your program to use the
+ * new API.
+ * \param p_instance the instance
+ */
+int libvlc_get_vlc_id( libvlc_instance_t *p_instance );
+
+/**
  * Destroy a libvlc instance
  * \param p_instance the instance to destroy
  */
@@ -195,20 +207,6 @@
 void libvlc_playlist_clear( libvlc_instance_t *, libvlc_exception_t * );
 
 /**
- * Go to next playlist item
- * \param p_instance the instance
- * \param p_exception an initialized exception
- */
-void libvlc_playlist_next( libvlc_instance_t *, libvlc_exception_t * );
-
-/**
- * Go to Previous playlist item
- * \param p_instance the instance
- * \param p_exception an initialized exception
- */
-void libvlc_playlist_prev( libvlc_instance_t *, libvlc_exception_t * );
-
-/**
  * Add an item at the end of the playlist
  * If you need more advanced options, \see libvlc_playlist_add_extended
  * \param p_instance the instance
@@ -226,13 +224,20 @@
  * \param psz_name a name that you might want to give or NULL
  * \param i_options the number of options to add
  * \param ppsz_options strings representing the options to add
+ * \param p_exception an initialized exception
  * \return the identifier of the new item
  */
 int libvlc_playlist_add_extended( libvlc_instance_t *, const char *,
                                   const char *, int, const char **,
                                   libvlc_exception_t * );
 
-
+/** 
+ * Delete the playlist item with the given ID.
+ * \param p_instance the instance
+ * \param i_id the id to remove
+ * \param p_exception an initialized exception
+ * \return
+ */
 int libvlc_playlist_delete_item( libvlc_instance_t *, int,
                                  libvlc_exception_t * );
     
@@ -246,8 +251,6 @@
 libvlc_input_t *libvlc_playlist_get_input( libvlc_instance_t *,
                                            libvlc_exception_t * );
 
-
-
 /** @}*/
 
 /*****************************************************************************
@@ -267,10 +270,10 @@
 /// \bug This might go away ... to be replaced by a broader system
 vlc_int64_t libvlc_input_get_length     ( libvlc_input_t *, libvlc_exception_t *);
 vlc_int64_t libvlc_input_get_time       ( libvlc_input_t *, libvlc_exception_t *);
+void        libvlc_input_set_time       ( libvlc_input_t *, vlc_int64_t, libvlc_exception_t *);
 float       libvlc_input_get_position   ( libvlc_input_t *, libvlc_exception_t *);
+void        libvlc_input_set_position   ( libvlc_input_t *, float, libvlc_exception_t *);
 vlc_bool_t  libvlc_input_will_play      ( libvlc_input_t *, libvlc_exception_t *);
-vlc_bool_t  libvlc_input_has_vout       ( libvlc_input_t *, libvlc_exception_t *);
-float       libvlc_input_get_fps        ( libvlc_input_t *, libvlc_exception_t *);
         
 /** @} */
 
@@ -281,6 +284,14 @@
  */
 
 /**
+ * Does this input have a video output ?
+ * \param p_input the input
+ * \param p_exception an initialized exception
+ */
+vlc_bool_t  libvlc_input_has_vout       ( libvlc_input_t *, libvlc_exception_t *);
+float       libvlc_input_get_fps        ( libvlc_input_t *, libvlc_exception_t *);
+
+/**
  * Toggle fullscreen status on video output
  * \param p_input the input
  * \param p_exception an initialized exception
@@ -327,6 +338,35 @@
  */
 void libvlc_video_take_snapshot( libvlc_input_t *, char *, libvlc_exception_t * );
     
+int libvlc_video_destroy( libvlc_input_t *, libvlc_exception_t *);
+
+/**
+ * Resize the video output window
+ * \param p_instance libvlc instance
+ * \param width new width for video output window
+ * \param height new height for video output window
+ * \param p_exception an initialized exception
+ * \return the mute status (boolean)
+ */
+void libvlc_video_resize( libvlc_input_t *, int, int, libvlc_exception_t *);
+    
+/**
+* Downcast to this general type as placeholder for a platform specific one, such as:
+*  Drawable on X11,
+*  CGrafPort on MacOSX,
+*  HWND on win32
+*/
+typedef int libvlc_drawable_t;
+
+/**
+ * Get current mute status
+ * \param p_instance libvlc instance
+ * \param drawable the new parent window (Drawable on X11, CGrafPort on MacOSX, HWND on Win32)
+ * \param p_exception an initialized exception
+ * \return the mute status (boolean)
+ */
+int libvlc_video_reparent( libvlc_input_t *, libvlc_drawable_t, libvlc_exception_t * );
+
 
 /** @} */
 
@@ -436,8 +476,6 @@
 void libvlc_vlm_set_input( libvlc_instance_t *, char *, char*,
                            libvlc_exception_t *);
 
-
-
 /**
  * Set output for a media
  * \param p_instance the instance
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_common.h vlc_0.8.6-svn20060925.debian/include/vlc_common.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_common.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_common.h	2006-09-22 11:14:32.000000000 -0400
@@ -3,7 +3,7 @@
  * Collection of useful common types and macros definitions
  *****************************************************************************
  * Copyright (C) 1998-2005 the VideoLAN team
- * $Id: vlc_common.h 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: vlc_common.h 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Samuel Hocevar <sam@via.ecp.fr>
  *          Vincent Seguin <seguin@via.ecp.fr>
@@ -1138,10 +1138,10 @@
 #   else
 #       define _(String) dgettext(PACKAGE_NAME, String)
 #   endif
-#   define N_(String) ((char*)(String))
+#   define N_(String) (String)
 #else
-#   define _(String) ((char*)(String))
-#   define N_(String) ((char*)(String))
+#   define _(String) (String)
+#   define N_(String) (String)
 #endif
 
 /*****************************************************************************
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_config_cat.h vlc_0.8.6-svn20060925.debian/include/vlc_config_cat.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_config_cat.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_config_cat.h	2006-09-24 13:09:46.000000000 -0400
@@ -2,7 +2,7 @@
  * vlc_help.h: Help strings
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: vlc_config_cat.h 15124 2006-04-06 23:00:24Z adn $
+ * $Id: vlc_config_cat.h 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Clment Stenac <zorglub@videolan.org>
  *          Anil Daoud <anil@videolan.org>
@@ -352,7 +352,7 @@
     {
         if( categories_array[i].i_id == i_value )
         {
-            return categories_array[i].psz_name;
+            return _(categories_array[i].psz_name);
         }
         i++;
     }
@@ -366,7 +366,7 @@
     {
         if( categories_array[i].i_id == i_value )
         {
-            return categories_array[i].psz_help;
+            return _(categories_array[i].psz_help);
         }
         i++;
     }
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_es.h vlc_0.8.6-svn20060925.debian/include/vlc_es.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_es.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_es.h	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * vlc_es.h: Elementary stream formats descriptions
  *****************************************************************************
  * Copyright (C) 1999-2001 the VideoLAN team
- * $Id: vlc_es.h 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: vlc_es.h 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
@@ -201,7 +201,7 @@
     fmt->psz_description        = NULL;
 
     fmt->i_extra_languages      = 0;
-    fmt->p_extra_languages      = NULL;    
+    fmt->p_extra_languages      = NULL;
 
     memset( &fmt->audio, 0, sizeof(audio_format_t) );
     memset( &fmt->video, 0, sizeof(video_format_t) );
@@ -269,7 +269,8 @@
     if( fmt->i_extra > 0 ) free( fmt->p_extra );
     fmt->i_extra = 0; fmt->p_extra = NULL;
 
-    if( fmt->video.p_palette ) free( fmt->video.p_palette );
+    if( fmt->video.p_palette )
+        free( fmt->video.p_palette );
     fmt->video.p_palette = NULL;
 
     if( fmt->subs.psz_encoding ) free( fmt->subs.psz_encoding );
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_spu.h vlc_0.8.6-svn20060925.debian/include/vlc_spu.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_spu.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_spu.h	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * vlc_spu.h : subpicture unit
  *****************************************************************************
  * Copyright (C) 1999, 2000 the VideoLAN team
- * $Id: vlc_spu.h 13905 2006-01-12 23:10:04Z dionoea $
+ * $Id: vlc_spu.h 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *
@@ -104,7 +104,7 @@
 #define spu_DestroyRegion(a,b) __spu_DestroyRegion(VLC_OBJECT(a),b)
 VLC_EXPORT( void, __spu_DestroyRegion, ( vlc_object_t *, subpicture_region_t * ) );
 
-VLC_EXPORT( subpicture_t *, spu_SortSubpictures, ( spu_t *, mtime_t ) );
+VLC_EXPORT( subpicture_t *, spu_SortSubpictures, ( spu_t *, mtime_t, vlc_bool_t ) );
 VLC_EXPORT( void, spu_RenderSubpictures, ( spu_t *,  video_format_t *, picture_t *, picture_t *, subpicture_t *, int, int ) );
 
 /** @}*/
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_symbols.h vlc_0.8.6-svn20060925.debian/include/vlc_symbols.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_symbols.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_symbols.h	2006-09-22 11:14:32.000000000 -0400
@@ -323,7 +323,7 @@
     subpicture_region_t * (*__spu_CreateRegion_inner) (vlc_object_t *, video_format_t *);
     subpicture_region_t * (*__spu_MakeRegion_inner) (vlc_object_t *, video_format_t *, picture_t *);
     void (*__spu_DestroyRegion_inner) (vlc_object_t *, subpicture_region_t *);
-    subpicture_t * (*spu_SortSubpictures_inner) (spu_t *, mtime_t);
+    subpicture_t * (*spu_SortSubpictures_inner) (spu_t *, mtime_t, vlc_bool_t);
     void (*spu_RenderSubpictures_inner) (spu_t *,  video_format_t *, picture_t *, picture_t *, subpicture_t *, int, int);
     char * (*stream_ReadLine_inner) (stream_t *);
     stream_t * (*__stream_DemuxNew_inner) (vlc_object_t *p_obj, char *psz_demux, es_out_t *out);
@@ -495,6 +495,8 @@
     vlc_bool_t (*input_AddSubtitles_inner) (input_thread_t *, char *, vlc_bool_t);
     int (*utf8_fprintf_inner) (FILE *, const char *, ...);
     int (*utf8_vfprintf_inner) (FILE *stream, const char *fmt, va_list ap);
+    void *utf8_fprintf_deprecated;
+    void *utf8_vfprintf_deprecated;
 };
 # if defined (__PLUGIN__)
 #  define aout_FiltersCreatePipeline (p_symbols)->aout_FiltersCreatePipeline_inner
@@ -1451,6 +1453,8 @@
     (p_symbols)->net_ConvertIPv4_deprecated = NULL; \
     (p_symbols)->__stats_CounterGet_deprecated = NULL; \
     (p_symbols)->__stats_TimerDumpAll_deprecated = NULL; \
+    (p_symbols)->utf8_fprintf_deprecated = NULL; \
+    (p_symbols)->utf8_vfprintf_deprecated = NULL; \
 
 # endif /* __PLUGIN__ */
 #endif /* __VLC_SYMBOLS_H */
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_url.h vlc_0.8.6-svn20060925.debian/include/vlc_url.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_url.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_url.h	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * vlc_url.h: URL related macros
  *****************************************************************************
  * Copyright (C) 2002-2006 the VideoLAN team
- * $Id: vlc_url.h 15121 2006-04-06 21:20:33Z courmisch $
+ * $Id: vlc_url.h 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *          Rmi Denis-Courmont <rem # videolan.org>
@@ -217,11 +217,12 @@
  *****************************************************************************
  *
  *****************************************************************************/
-static inline char *vlc_b64_encode( char *src )
+static inline char *vlc_b64_encode( const char *src )
 {
     static const char b64[] =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
     size_t len = strlen( src );
+    const uint8_t *in = (const uint8_t *)src;
 
     char *ret;
     char *dst = (char *)malloc( ( len + 4 ) * 4 / 3 );
@@ -232,38 +233,29 @@
 
     while( len > 0 )
     {
-        /* pops (up to) 3 bytes of input */
-        uint32_t v = *src++ << 24;
+        /* pops (up to) 3 bytes of input, push 4 bytes */
+        uint32_t v = *in++ << 24; // 1/3
+        *dst++ = b64[v >> 26]; // 1/4
+        v = v << 6;
 
         if( len >= 2 )
-        {
-            v |= *src++ << 16;
-            if( len >= 3 )
-                v |= *src++ << 8;
-        }
+            v |= *in++ << 22; // 2/3
+        *dst++ = b64[v >> 26]; // 2/4
+        v = v << 6;
+
+        if( len >= 3 )
+            v |= *in++ << 20; // 3/3
+        *dst++ = ( len >= 2 ) ? b64[v >> 26] : '='; // 3/4
+        v = v << 6;
 
-        /* pushes (up to) 4 bytes of output */
-        while( v )
-        {
-            *dst++ = b64[v >> 26];
-            v = v << 6;
-        }
+        *dst++ = ( len >= 3 ) ? b64[v >> 26] : '='; // 4/4
 
-        switch( len )
+        len--;
+        if( len > 0 )
         {
-            case 1:
-                *dst++ = '=';
-                *dst++ = '=';
+            len--;
+            if( len > 0 )
                 len--;
-                break;
-
-            case 2:
-                *dst++ = '=';
-                len -= 2;
-                break;
-
-            default:
-                len -= 3;
         }
     }
 
diff -uNr vlc_0.8.6-svn20060918.debian/include/vlc_video.h vlc_0.8.6-svn20060925.debian/include/vlc_video.h
--- vlc_0.8.6-svn20060918.debian/include/vlc_video.h	2006-09-18 06:28:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/include/vlc_video.h	2006-09-22 11:14:32.000000000 -0400
@@ -4,7 +4,7 @@
  * includes all common video types and constants.
  *****************************************************************************
  * Copyright (C) 1999 - 2005 the VideoLAN team
- * $Id: vlc_video.h 15328 2006-04-23 13:56:24Z bigben $
+ * $Id: vlc_video.h 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Vincent Seguin <seguin@via.ecp.fr>
  *
@@ -246,6 +246,8 @@
     vlc_bool_t      b_ephemer;    /**< If this flag is set to true the subtitle
                                 will be displayed untill the next one appear */
     vlc_bool_t      b_fade;                               /**< enable fading */
+    vlc_bool_t      b_pausable;               /**< subpicture will be paused if
+                                                            stream is paused */
     /**@}*/
 
     subpicture_region_t *p_region;  /**< region list composing this subtitle */
diff -uNr vlc_0.8.6-svn20060918.debian/intl/plural.c vlc_0.8.6-svn20060925.debian/intl/plural.c
--- vlc_0.8.6-svn20060918.debian/intl/plural.c	2006-09-18 06:32:38.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/intl/plural.c	2006-09-24 13:10:26.000000000 -0400
@@ -1,97 +1,22 @@
-/* A Bison parser, made by GNU Bison 2.3.  */
 
-/* Skeleton implementation for Bison's Yacc-like parsers in C
+/*  A Bison parser, made from plural.y
+    by GNU Bison version 1.28  */
 
-   Copyright (C) 1984, 1989, 1990, 2000, 2001, 2002, 2003, 2004, 2005, 2006
-   Free Software Foundation, Inc.
+#define YYBISON 1  /* Identify Bison output.  */
 
-   This program is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License as published by
-   the Free Software Foundation; either version 2, or (at your option)
-   any later version.
-
-   This program is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-   GNU General Public License for more details.
-
-   You should have received a copy of the GNU General Public License
-   along with this program; if not, write to the Free Software
-   Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.  */
-
-/* As a special exception, you may create a larger work that contains
-   part or all of the Bison parser skeleton and distribute that work
-   under terms of your choice, so long as that work isn't itself a
-   parser generator using the skeleton or a modified version thereof
-   as a parser skeleton.  Alternatively, if you modify or redistribute
-   the parser skeleton itself, you may (at your option) remove this
-   special exception, which will cause the skeleton and the resulting
-   Bison output files to be licensed under the GNU General Public
-   License without this special exception.
-
-   This special exception was added by the Free Software Foundation in
-   version 2.2 of Bison.  */
-
-/* C LALR(1) parser skeleton written by Richard Stallman, by
-   simplifying the original so-called "semantic" parser.  */
-
-/* All symbols defined below should begin with yy or YY, to avoid
-   infringing on user name space.  This should be done even for local
-   variables, as they might otherwise be expanded by user macros.
-   There are some unavoidable exceptions within include files to
-   define necessary library symbols; they are noted "INFRINGES ON
-   USER NAME SPACE" below.  */
-
-/* Identify Bison output.  */
-#define YYBISON 1
-
-/* Bison version.  */
-#define YYBISON_VERSION "2.3"
-
-/* Skeleton name.  */
-#define YYSKELETON_NAME "yacc.c"
-
-/* Pure parsers.  */
-#define YYPURE 1
-
-/* Using locations.  */
-#define YYLSP_NEEDED 0
-
-/* Substitute the variable and function names.  */
 #define yyparse __gettextparse
-#define yylex   __gettextlex
+#define yylex __gettextlex
 #define yyerror __gettexterror
-#define yylval  __gettextlval
-#define yychar  __gettextchar
+#define yylval __gettextlval
+#define yychar __gettextchar
 #define yydebug __gettextdebug
 #define yynerrs __gettextnerrs
+#define	EQUOP2	257
+#define	CMPOP2	258
+#define	ADDOP2	259
+#define	MULOP2	260
+#define	NUMBER	261
 
-
-/* Tokens.  */
-#ifndef YYTOKENTYPE
-# define YYTOKENTYPE
-   /* Put the tokens into the symbol table, so that GDB and other debuggers
-      know about them.  */
-   enum yytokentype {
-     EQUOP2 = 258,
-     CMPOP2 = 259,
-     ADDOP2 = 260,
-     MULOP2 = 261,
-     NUMBER = 262
-   };
-#endif
-/* Tokens.  */
-#define EQUOP2 258
-#define CMPOP2 259
-#define ADDOP2 260
-#define MULOP2 261
-#define NUMBER 262
-
-
-
-
-/* Copy the first part of user declarations.  */
 #line 1 "plural.y"
 
 /* Expression parsing for plural form selection.
@@ -138,44 +63,12 @@
 #define YYLEX_PARAM	&((struct parse_args *) arg)->cp
 #define YYPARSE_PARAM	arg
 
-
-/* Enabling traces.  */
-#ifndef YYDEBUG
-# define YYDEBUG 0
-#endif
-
-/* Enabling verbose error messages.  */
-#ifdef YYERROR_VERBOSE
-# undef YYERROR_VERBOSE
-# define YYERROR_VERBOSE 1
-#else
-# define YYERROR_VERBOSE 0
-#endif
-
-/* Enabling the token table.  */
-#ifndef YYTOKEN_TABLE
-# define YYTOKEN_TABLE 0
-#endif
-
-#if ! defined YYSTYPE && ! defined YYSTYPE_IS_DECLARED
-typedef union YYSTYPE
 #line 49 "plural.y"
-{
+typedef union {
   unsigned long int num;
   enum operator op;
   struct expression *exp;
-}
-/* Line 193 of yacc.c.  */
-#line 170 "plural.c"
-	YYSTYPE;
-# define yystype YYSTYPE /* obsolescent; will be withdrawn */
-# define YYSTYPE_IS_DECLARED 1
-# define YYSTYPE_IS_TRIVIAL 1
-#endif
-
-
-
-/* Copy the second part of user declarations.  */
+} YYSTYPE;
 #line 55 "plural.y"
 
 /* Prototypes for local functions.  */
@@ -274,1019 +167,432 @@
   return new_exp (3, op, args);
 }
 
+#include <stdio.h>
 
-
-/* Line 216 of yacc.c.  */
-#line 281 "plural.c"
-
-#ifdef short
-# undef short
+#ifndef __cplusplus
+#ifndef __STDC__
+#define const
 #endif
-
-#ifdef YYTYPE_UINT8
-typedef YYTYPE_UINT8 yytype_uint8;
-#else
-typedef unsigned char yytype_uint8;
 #endif
 
-#ifdef YYTYPE_INT8
-typedef YYTYPE_INT8 yytype_int8;
-#elif (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-typedef signed char yytype_int8;
-#else
-typedef short int yytype_int8;
-#endif
 
-#ifdef YYTYPE_UINT16
-typedef YYTYPE_UINT16 yytype_uint16;
-#else
-typedef unsigned short int yytype_uint16;
-#endif
 
-#ifdef YYTYPE_INT16
-typedef YYTYPE_INT16 yytype_int16;
-#else
-typedef short int yytype_int16;
-#endif
+#define	YYFINAL		27
+#define	YYFLAG		-32768
+#define	YYNTBASE	16
+
+#define YYTRANSLATE(x) ((unsigned)(x) <= 261 ? yytranslate[x] : 18)
+
+static const char yytranslate[] = {     0,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,    10,     2,     2,     2,     2,     5,     2,    14,
+    15,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,    12,     2,     2,
+     2,     2,     3,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,    13,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     4,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
+     2,     2,     2,     2,     2,     1,     6,     7,     8,     9,
+    11
+};
 
-#ifndef YYSIZE_T
-# ifdef __SIZE_TYPE__
-#  define YYSIZE_T __SIZE_TYPE__
-# elif defined size_t
-#  define YYSIZE_T size_t
-# elif ! defined YYSIZE_T && (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-#  include <stddef.h> /* INFRINGES ON USER NAME SPACE */
-#  define YYSIZE_T size_t
-# else
-#  define YYSIZE_T unsigned int
-# endif
-#endif
-
-#define YYSIZE_MAXIMUM ((YYSIZE_T) -1)
-
-#ifndef YY_
-# if YYENABLE_NLS
-#  if ENABLE_NLS
-#   include <libintl.h> /* INFRINGES ON USER NAME SPACE */
-#   define YY_(msgid) dgettext ("bison-runtime", msgid)
-#  endif
-# endif
-# ifndef YY_
-#  define YY_(msgid) msgid
-# endif
-#endif
-
-/* Suppress unused-variable warnings by "using" E.  */
-#if ! defined lint || defined __GNUC__
-# define YYUSE(e) ((void) (e))
-#else
-# define YYUSE(e) /* empty */
-#endif
+#if YYDEBUG != 0
+static const short yyprhs[] = {     0,
+     0,     2,     8,    12,    16,    20,    24,    28,    32,    35,
+    37,    39
+};
+
+static const short yyrhs[] = {    17,
+     0,    17,     3,    17,    12,    17,     0,    17,     4,    17,
+     0,    17,     5,    17,     0,    17,     6,    17,     0,    17,
+     7,    17,     0,    17,     8,    17,     0,    17,     9,    17,
+     0,    10,    17,     0,    13,     0,    11,     0,    14,    17,
+    15,     0
+};
 
-/* Identity function, used to suppress warnings about constant conditions.  */
-#ifndef lint
-# define YYID(n) (n)
-#else
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static int
-YYID (int i)
-#else
-static int
-YYID (i)
-    int i;
 #endif
-{
-  return i;
-}
+
+#if YYDEBUG != 0
+static const short yyrline[] = { 0,
+   174,   182,   186,   190,   194,   198,   202,   206,   210,   214,
+   218,   223
+};
 #endif
 
-#if ! defined yyoverflow || YYERROR_VERBOSE
 
-/* The parser invokes alloca or malloc; define the necessary symbols.  */
+#if YYDEBUG != 0 || defined (YYERROR_VERBOSE)
 
-# ifdef YYSTACK_USE_ALLOCA
-#  if YYSTACK_USE_ALLOCA
-#   ifdef __GNUC__
-#    define YYSTACK_ALLOC __builtin_alloca
-#   elif defined __BUILTIN_VA_ARG_INCR
-#    include <alloca.h> /* INFRINGES ON USER NAME SPACE */
-#   elif defined _AIX
-#    define YYSTACK_ALLOC __alloca
-#   elif defined _MSC_VER
-#    include <malloc.h> /* INFRINGES ON USER NAME SPACE */
-#    define alloca _alloca
-#   else
-#    define YYSTACK_ALLOC alloca
-#    if ! defined _ALLOCA_H && ! defined _STDLIB_H && (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-#     include <stdlib.h> /* INFRINGES ON USER NAME SPACE */
-#     ifndef _STDLIB_H
-#      define _STDLIB_H 1
-#     endif
-#    endif
-#   endif
-#  endif
-# endif
-
-# ifdef YYSTACK_ALLOC
-   /* Pacify GCC's `empty if-body' warning.  */
-#  define YYSTACK_FREE(Ptr) do { /* empty */; } while (YYID (0))
-#  ifndef YYSTACK_ALLOC_MAXIMUM
-    /* The OS might guarantee only one guard page at the bottom of the stack,
-       and a page size can be as small as 4096 bytes.  So we cannot safely
-       invoke alloca (N) if N exceeds 4096.  Use a slightly smaller number
-       to allow for a few compiler-allocated temporary stack slots.  */
-#   define YYSTACK_ALLOC_MAXIMUM 4032 /* reasonable circa 2006 */
-#  endif
-# else
-#  define YYSTACK_ALLOC YYMALLOC
-#  define YYSTACK_FREE YYFREE
-#  ifndef YYSTACK_ALLOC_MAXIMUM
-#   define YYSTACK_ALLOC_MAXIMUM YYSIZE_MAXIMUM
-#  endif
-#  if (defined __cplusplus && ! defined _STDLIB_H \
-       && ! ((defined YYMALLOC || defined malloc) \
-	     && (defined YYFREE || defined free)))
-#   include <stdlib.h> /* INFRINGES ON USER NAME SPACE */
-#   ifndef _STDLIB_H
-#    define _STDLIB_H 1
-#   endif
-#  endif
-#  ifndef YYMALLOC
-#   define YYMALLOC malloc
-#   if ! defined malloc && ! defined _STDLIB_H && (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-void *malloc (YYSIZE_T); /* INFRINGES ON USER NAME SPACE */
-#   endif
-#  endif
-#  ifndef YYFREE
-#   define YYFREE free
-#   if ! defined free && ! defined _STDLIB_H && (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-void free (void *); /* INFRINGES ON USER NAME SPACE */
-#   endif
-#  endif
-# endif
-#endif /* ! defined yyoverflow || YYERROR_VERBOSE */
-
-
-#if (! defined yyoverflow \
-     && (! defined __cplusplus \
-	 || (defined YYSTYPE_IS_TRIVIAL && YYSTYPE_IS_TRIVIAL)))
-
-/* A type that is properly aligned for any stack member.  */
-union yyalloc
-{
-  yytype_int16 yyss;
-  YYSTYPE yyvs;
-  };
-
-/* The size of the maximum gap between one aligned stack and the next.  */
-# define YYSTACK_GAP_MAXIMUM (sizeof (union yyalloc) - 1)
-
-/* The size of an array large to enough to hold all stacks, each with
-   N elements.  */
-# define YYSTACK_BYTES(N) \
-     ((N) * (sizeof (yytype_int16) + sizeof (YYSTYPE)) \
-      + YYSTACK_GAP_MAXIMUM)
-
-/* Copy COUNT objects from FROM to TO.  The source and destination do
-   not overlap.  */
-# ifndef YYCOPY
-#  if defined __GNUC__ && 1 < __GNUC__
-#   define YYCOPY(To, From, Count) \
-      __builtin_memcpy (To, From, (Count) * sizeof (*(From)))
-#  else
-#   define YYCOPY(To, From, Count)		\
-      do					\
-	{					\
-	  YYSIZE_T yyi;				\
-	  for (yyi = 0; yyi < (Count); yyi++)	\
-	    (To)[yyi] = (From)[yyi];		\
-	}					\
-      while (YYID (0))
-#  endif
-# endif
-
-/* Relocate STACK from its old location to the new one.  The
-   local variables YYSIZE and YYSTACKSIZE give the old and new number of
-   elements in the stack, and YYPTR gives the new location of the
-   stack.  Advance YYPTR to a properly aligned location for the next
-   stack.  */
-# define YYSTACK_RELOCATE(Stack)					\
-    do									\
-      {									\
-	YYSIZE_T yynewbytes;						\
-	YYCOPY (&yyptr->Stack, Stack, yysize);				\
-	Stack = &yyptr->Stack;						\
-	yynewbytes = yystacksize * sizeof (*Stack) + YYSTACK_GAP_MAXIMUM; \
-	yyptr += yynewbytes / sizeof (*yyptr);				\
-      }									\
-    while (YYID (0))
-
-#endif
-
-/* YYFINAL -- State number of the termination state.  */
-#define YYFINAL  9
-/* YYLAST -- Last index in YYTABLE.  */
-#define YYLAST   54
-
-/* YYNTOKENS -- Number of terminals.  */
-#define YYNTOKENS  16
-/* YYNNTS -- Number of nonterminals.  */
-#define YYNNTS  3
-/* YYNRULES -- Number of rules.  */
-#define YYNRULES  13
-/* YYNRULES -- Number of states.  */
-#define YYNSTATES  27
-
-/* YYTRANSLATE(YYLEX) -- Bison symbol number corresponding to YYLEX.  */
-#define YYUNDEFTOK  2
-#define YYMAXUTOK   262
-
-#define YYTRANSLATE(YYX)						\
-  ((unsigned int) (YYX) <= YYMAXUTOK ? yytranslate[YYX] : YYUNDEFTOK)
-
-/* YYTRANSLATE[YYLEX] -- Bison symbol number corresponding to YYLEX.  */
-static const yytype_uint8 yytranslate[] =
-{
-       0,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,    10,     2,     2,     2,     2,     5,     2,
-      14,    15,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,    12,     2,
-       2,     2,     2,     3,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-      13,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     4,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     2,     2,     2,     2,
-       2,     2,     2,     2,     2,     2,     1,     2,     6,     7,
-       8,     9,    11
+static const char * const yytname[] = {   "$","error","$undefined.","'?'","'|'",
+"'&'","EQUOP2","CMPOP2","ADDOP2","MULOP2","'!'","NUMBER","':'","'n'","'('","')'",
+"start","exp", NULL
 };
+#endif
 
-#if YYDEBUG
-/* YYPRHS[YYN] -- Index of the first RHS symbol of rule number YYN in
-   YYRHS.  */
-static const yytype_uint8 yyprhs[] =
-{
-       0,     0,     3,     5,    11,    15,    19,    23,    27,    31,
-      35,    38,    40,    42
+static const short yyr1[] = {     0,
+    16,    17,    17,    17,    17,    17,    17,    17,    17,    17,
+    17,    17
 };
 
-/* YYRHS -- A `-1'-separated list of the rules' RHS.  */
-static const yytype_int8 yyrhs[] =
-{
-      17,     0,    -1,    18,    -1,    18,     3,    18,    12,    18,
-      -1,    18,     4,    18,    -1,    18,     5,    18,    -1,    18,
-       6,    18,    -1,    18,     7,    18,    -1,    18,     8,    18,
-      -1,    18,     9,    18,    -1,    10,    18,    -1,    13,    -1,
-      11,    -1,    14,    18,    15,    -1
+static const short yyr2[] = {     0,
+     1,     5,     3,     3,     3,     3,     3,     3,     2,     1,
+     1,     3
 };
 
-/* YYRLINE[YYN] -- source line where rule number YYN was defined.  */
-static const yytype_uint8 yyrline[] =
-{
-       0,   174,   174,   182,   186,   190,   194,   198,   202,   206,
-     210,   214,   218,   223
+static const short yydefact[] = {     0,
+     0,    11,    10,     0,     1,     9,     0,     0,     0,     0,
+     0,     0,     0,     0,    12,     0,     3,     4,     5,     6,
+     7,     8,     0,     2,     0,     0,     0
 };
-#endif
 
-#if YYDEBUG || YYERROR_VERBOSE || YYTOKEN_TABLE
-/* YYTNAME[SYMBOL-NUM] -- String name of the symbol SYMBOL-NUM.
-   First, the terminals, then, starting at YYNTOKENS, nonterminals.  */
-static const char *const yytname[] =
-{
-  "$end", "error", "$undefined", "'?'", "'|'", "'&'", "EQUOP2", "CMPOP2",
-  "ADDOP2", "MULOP2", "'!'", "NUMBER", "':'", "'n'", "'('", "')'",
-  "$accept", "start", "exp", 0
+static const short yydefgoto[] = {    25,
+     5
 };
-#endif
 
-# ifdef YYPRINT
-/* YYTOKNUM[YYLEX-NUM] -- Internal token number corresponding to
-   token YYLEX-NUM.  */
-static const yytype_uint16 yytoknum[] =
-{
-       0,   256,   257,    63,   124,    38,   258,   259,   260,   261,
-      33,   262,    58,   110,    40,    41
+static const short yypact[] = {    -9,
+    -9,-32768,-32768,    -9,    34,-32768,    11,    -9,    -9,    -9,
+    -9,    -9,    -9,    -9,-32768,    24,    39,    43,    16,    26,
+    -3,-32768,    -9,    34,    21,    53,-32768
 };
-# endif
 
-/* YYR1[YYN] -- Symbol number of symbol that rule YYN derives.  */
-static const yytype_uint8 yyr1[] =
-{
-       0,    16,    17,    18,    18,    18,    18,    18,    18,    18,
-      18,    18,    18,    18
+static const short yypgoto[] = {-32768,
+    -1
 };
 
-/* YYR2[YYN] -- Number of symbols composing right hand side of rule YYN.  */
-static const yytype_uint8 yyr2[] =
-{
-       0,     2,     1,     5,     3,     3,     3,     3,     3,     3,
-       2,     1,     1,     3
-};
 
-/* YYDEFACT[STATE-NAME] -- Default rule to reduce with in state
-   STATE-NUM when YYTABLE doesn't specify something else to do.  Zero
-   means the default is an error.  */
-static const yytype_uint8 yydefact[] =
-{
-       0,     0,    12,    11,     0,     0,     2,    10,     0,     1,
-       0,     0,     0,     0,     0,     0,     0,    13,     0,     4,
-       5,     6,     7,     8,     9,     0,     3
-};
+#define	YYLAST		53
 
-/* YYDEFGOTO[NTERM-NUM].  */
-static const yytype_int8 yydefgoto[] =
-{
-      -1,     5,     6
-};
 
-/* YYPACT[STATE-NUM] -- Index in YYTABLE of the portion describing
-   STATE-NUM.  */
-#define YYPACT_NINF -10
-static const yytype_int8 yypact[] =
-{
-      -9,    -9,   -10,   -10,    -9,     8,    36,   -10,    13,   -10,
-      -9,    -9,    -9,    -9,    -9,    -9,    -9,   -10,    26,    41,
-      45,    18,    -2,    14,   -10,    -9,    36
+static const short yytable[] = {     6,
+     1,     2,     7,     3,     4,    14,    16,    17,    18,    19,
+    20,    21,    22,     8,     9,    10,    11,    12,    13,    14,
+    26,    24,    12,    13,    14,    15,     8,     9,    10,    11,
+    12,    13,    14,    13,    14,    23,     8,     9,    10,    11,
+    12,    13,    14,    10,    11,    12,    13,    14,    11,    12,
+    13,    14,    27
 };
 
-/* YYPGOTO[NTERM-NUM].  */
-static const yytype_int8 yypgoto[] =
-{
-     -10,   -10,    -1
+static const short yycheck[] = {     1,
+    10,    11,     4,    13,    14,     9,     8,     9,    10,    11,
+    12,    13,    14,     3,     4,     5,     6,     7,     8,     9,
+     0,    23,     7,     8,     9,    15,     3,     4,     5,     6,
+     7,     8,     9,     8,     9,    12,     3,     4,     5,     6,
+     7,     8,     9,     5,     6,     7,     8,     9,     6,     7,
+     8,     9,     0
 };
+#define YYPURE 1
 
-/* YYTABLE[YYPACT[STATE-NUM]].  What to do in state STATE-NUM.  If
-   positive, shift that token.  If negative, reduce the rule which
-   number is the opposite.  If zero, do what YYDEFACT says.
-   If YYTABLE_NINF, syntax error.  */
-#define YYTABLE_NINF -1
-static const yytype_uint8 yytable[] =
-{
-       7,     1,     2,     8,     3,     4,    15,    16,     9,    18,
-      19,    20,    21,    22,    23,    24,    10,    11,    12,    13,
-      14,    15,    16,    16,    26,    14,    15,    16,    17,    10,
-      11,    12,    13,    14,    15,    16,     0,     0,    25,    10,
-      11,    12,    13,    14,    15,    16,    12,    13,    14,    15,
-      16,    13,    14,    15,    16
-};
+/* -*-C-*-  Note some compilers choke on comments on `#line' lines.  */
+#line 3 "/usr/local/share/bison.simple"
+/* This file comes from bison-1.28.  */
 
-static const yytype_int8 yycheck[] =
-{
-       1,    10,    11,     4,    13,    14,     8,     9,     0,    10,
-      11,    12,    13,    14,    15,    16,     3,     4,     5,     6,
-       7,     8,     9,     9,    25,     7,     8,     9,    15,     3,
-       4,     5,     6,     7,     8,     9,    -1,    -1,    12,     3,
-       4,     5,     6,     7,     8,     9,     5,     6,     7,     8,
-       9,     6,     7,     8,     9
-};
+/* Skeleton output parser for bison,
+   Copyright (C) 1984, 1989, 1990 Free Software Foundation, Inc.
 
-/* YYSTOS[STATE-NUM] -- The (internal number of the) accessing
-   symbol of state STATE-NUM.  */
-static const yytype_uint8 yystos[] =
-{
-       0,    10,    11,    13,    14,    17,    18,    18,    18,     0,
-       3,     4,     5,     6,     7,     8,     9,    15,    18,    18,
-      18,    18,    18,    18,    18,    12,    18
-};
+   This program is free software; you can redistribute it and/or modify
+   it under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 2, or (at your option)
+   any later version.
+
+   This program is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+   GNU General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with this program; if not, write to the Free Software
+   Foundation, Inc., 59 Temple Place - Suite 330,
+   Boston, MA 02111-1307, USA.  */
+
+/* As a special exception, when this file is copied by Bison into a
+   Bison output file, you may use that output file without restriction.
+   This special exception was added by the Free Software Foundation
+   in version 1.24 of Bison.  */
+
+/* This is the parser code that is written into each bison parser
+  when the %semantic_parser declaration is not specified in the grammar.
+  It was written by Richard Stallman by simplifying the hairy parser
+  used when %semantic_parser is specified.  */
+
+#ifndef YYSTACK_USE_ALLOCA
+#ifdef alloca
+#define YYSTACK_USE_ALLOCA
+#else /* alloca not defined */
+#ifdef __GNUC__
+#define YYSTACK_USE_ALLOCA
+#define alloca __builtin_alloca
+#else /* not GNU C.  */
+#if (!defined (__STDC__) && defined (sparc)) || defined (__sparc__) || defined (__sparc) || defined (__sgi) || (defined (__sun) && defined (__i386))
+#define YYSTACK_USE_ALLOCA
+#include <alloca.h>
+#else /* not sparc */
+/* We think this test detects Watcom and Microsoft C.  */
+/* This used to test MSDOS, but that is a bad idea
+   since that symbol is in the user namespace.  */
+#if (defined (_MSDOS) || defined (_MSDOS_)) && !defined (__TURBOC__)
+#if 0 /* No need for malloc.h, which pollutes the namespace;
+	 instead, just don't use alloca.  */
+#include <malloc.h>
+#endif
+#else /* not MSDOS, or __TURBOC__ */
+#if defined(_AIX)
+/* I don't know what this was needed for, but it pollutes the namespace.
+   So I turned it off.   rms, 2 May 1997.  */
+/* #include <malloc.h>  */
+ #pragma alloca
+#define YYSTACK_USE_ALLOCA
+#else /* not MSDOS, or __TURBOC__, or _AIX */
+#if 0
+#ifdef __hpux /* haible@ilog.fr says this works for HPUX 9.05 and up,
+		 and on HPUX 10.  Eventually we can turn this on.  */
+#define YYSTACK_USE_ALLOCA
+#define alloca __builtin_alloca
+#endif /* __hpux */
+#endif
+#endif /* not _AIX */
+#endif /* not MSDOS, or __TURBOC__ */
+#endif /* not sparc */
+#endif /* not GNU C */
+#endif /* alloca not defined */
+#endif /* YYSTACK_USE_ALLOCA not defined */
+
+#ifdef YYSTACK_USE_ALLOCA
+#define YYSTACK_ALLOC alloca
+#else
+#define YYSTACK_ALLOC malloc
+#endif
+
+/* Note: there must be only one dollar sign in this file.
+   It is replaced by the list of actions, each action
+   as one case of the switch.  */
 
 #define yyerrok		(yyerrstatus = 0)
 #define yyclearin	(yychar = YYEMPTY)
-#define YYEMPTY		(-2)
+#define YYEMPTY		-2
 #define YYEOF		0
-
 #define YYACCEPT	goto yyacceptlab
-#define YYABORT		goto yyabortlab
-#define YYERROR		goto yyerrorlab
-
-
-/* Like YYERROR except do call yyerror.  This remains here temporarily
-   to ease the transition to the new meaning of YYERROR, for GCC.
+#define YYABORT 	goto yyabortlab
+#define YYERROR		goto yyerrlab1
+/* Like YYERROR except do call yyerror.
+   This remains here temporarily to ease the
+   transition to the new meaning of YYERROR, for GCC.
    Once GCC version 2 has supplanted version 1, this can go.  */
-
 #define YYFAIL		goto yyerrlab
-
 #define YYRECOVERING()  (!!yyerrstatus)
-
-#define YYBACKUP(Token, Value)					\
+#define YYBACKUP(token, value) \
 do								\
   if (yychar == YYEMPTY && yylen == 1)				\
-    {								\
-      yychar = (Token);						\
-      yylval = (Value);						\
-      yytoken = YYTRANSLATE (yychar);				\
-      YYPOPSTACK (1);						\
+    { yychar = (token), yylval = (value);			\
+      yychar1 = YYTRANSLATE (yychar);				\
+      YYPOPSTACK;						\
       goto yybackup;						\
     }								\
   else								\
-    {								\
-      yyerror (YY_("syntax error: cannot back up")); \
-      YYERROR;							\
-    }								\
-while (YYID (0))
-
+    { yyerror ("syntax error: cannot back up"); YYERROR; }	\
+while (0)
 
 #define YYTERROR	1
 #define YYERRCODE	256
 
-
-/* YYLLOC_DEFAULT -- Set CURRENT to span from RHS[1] to RHS[N].
-   If N is 0, then set CURRENT to the empty location which ends
-   the previous symbol: RHS[0] (always defined).  */
-
-#define YYRHSLOC(Rhs, K) ((Rhs)[K])
-#ifndef YYLLOC_DEFAULT
-# define YYLLOC_DEFAULT(Current, Rhs, N)				\
-    do									\
-      if (YYID (N))                                                    \
-	{								\
-	  (Current).first_line   = YYRHSLOC (Rhs, 1).first_line;	\
-	  (Current).first_column = YYRHSLOC (Rhs, 1).first_column;	\
-	  (Current).last_line    = YYRHSLOC (Rhs, N).last_line;		\
-	  (Current).last_column  = YYRHSLOC (Rhs, N).last_column;	\
-	}								\
-      else								\
-	{								\
-	  (Current).first_line   = (Current).last_line   =		\
-	    YYRHSLOC (Rhs, 0).last_line;				\
-	  (Current).first_column = (Current).last_column =		\
-	    YYRHSLOC (Rhs, 0).last_column;				\
-	}								\
-    while (YYID (0))
-#endif
-
-
-/* YY_LOCATION_PRINT -- Print the location on the stream.
-   This macro was not mandated originally: define only if we know
-   we won't break user code: when these are the locations we know.  */
-
-#ifndef YY_LOCATION_PRINT
-# if YYLTYPE_IS_TRIVIAL
-#  define YY_LOCATION_PRINT(File, Loc)			\
-     fprintf (File, "%d.%d-%d.%d",			\
-	      (Loc).first_line, (Loc).first_column,	\
-	      (Loc).last_line,  (Loc).last_column)
-# else
-#  define YY_LOCATION_PRINT(File, Loc) ((void) 0)
-# endif
+#ifndef YYPURE
+#define YYLEX		yylex()
 #endif
 
-
-/* YYLEX -- calling `yylex' with the right arguments.  */
-
+#ifdef YYPURE
+#ifdef YYLSP_NEEDED
 #ifdef YYLEX_PARAM
-# define YYLEX yylex (&yylval, YYLEX_PARAM)
+#define YYLEX		yylex(&yylval, &yylloc, YYLEX_PARAM)
 #else
-# define YYLEX yylex (&yylval)
+#define YYLEX		yylex(&yylval, &yylloc)
 #endif
-
-/* Enable debugging if requested.  */
-#if YYDEBUG
-
-# ifndef YYFPRINTF
-#  include <stdio.h> /* INFRINGES ON USER NAME SPACE */
-#  define YYFPRINTF fprintf
-# endif
-
-# define YYDPRINTF(Args)			\
-do {						\
-  if (yydebug)					\
-    YYFPRINTF Args;				\
-} while (YYID (0))
-
-# define YY_SYMBOL_PRINT(Title, Type, Value, Location)			  \
-do {									  \
-  if (yydebug)								  \
-    {									  \
-      YYFPRINTF (stderr, "%s ", Title);					  \
-      yy_symbol_print (stderr,						  \
-		  Type, Value); \
-      YYFPRINTF (stderr, "\n");						  \
-    }									  \
-} while (YYID (0))
-
-
-/*--------------------------------.
-| Print this symbol on YYOUTPUT.  |
-`--------------------------------*/
-
-/*ARGSUSED*/
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static void
-yy_symbol_value_print (FILE *yyoutput, int yytype, YYSTYPE const * const yyvaluep)
+#else /* not YYLSP_NEEDED */
+#ifdef YYLEX_PARAM
+#define YYLEX		yylex(&yylval, YYLEX_PARAM)
 #else
-static void
-yy_symbol_value_print (yyoutput, yytype, yyvaluep)
-    FILE *yyoutput;
-    int yytype;
-    YYSTYPE const * const yyvaluep;
+#define YYLEX		yylex(&yylval)
 #endif
-{
-  if (!yyvaluep)
-    return;
-# ifdef YYPRINT
-  if (yytype < YYNTOKENS)
-    YYPRINT (yyoutput, yytoknum[yytype], *yyvaluep);
-# else
-  YYUSE (yyoutput);
-# endif
-  switch (yytype)
-    {
-      default:
-	break;
-    }
-}
-
-
-/*--------------------------------.
-| Print this symbol on YYOUTPUT.  |
-`--------------------------------*/
-
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static void
-yy_symbol_print (FILE *yyoutput, int yytype, YYSTYPE const * const yyvaluep)
-#else
-static void
-yy_symbol_print (yyoutput, yytype, yyvaluep)
-    FILE *yyoutput;
-    int yytype;
-    YYSTYPE const * const yyvaluep;
+#endif /* not YYLSP_NEEDED */
 #endif
-{
-  if (yytype < YYNTOKENS)
-    YYFPRINTF (yyoutput, "token %s (", yytname[yytype]);
-  else
-    YYFPRINTF (yyoutput, "nterm %s (", yytname[yytype]);
 
-  yy_symbol_value_print (yyoutput, yytype, yyvaluep);
-  YYFPRINTF (yyoutput, ")");
-}
+/* If nonreentrant, generate the variables here */
 
-/*------------------------------------------------------------------.
-| yy_stack_print -- Print the state stack from its BOTTOM up to its |
-| TOP (included).                                                   |
-`------------------------------------------------------------------*/
+#ifndef YYPURE
 
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static void
-yy_stack_print (yytype_int16 *bottom, yytype_int16 *top)
-#else
-static void
-yy_stack_print (bottom, top)
-    yytype_int16 *bottom;
-    yytype_int16 *top;
-#endif
-{
-  YYFPRINTF (stderr, "Stack now");
-  for (; bottom <= top; ++bottom)
-    YYFPRINTF (stderr, " %d", *bottom);
-  YYFPRINTF (stderr, "\n");
-}
-
-# define YY_STACK_PRINT(Bottom, Top)				\
-do {								\
-  if (yydebug)							\
-    yy_stack_print ((Bottom), (Top));				\
-} while (YYID (0))
+int	yychar;			/*  the lookahead symbol		*/
+YYSTYPE	yylval;			/*  the semantic value of the		*/
+				/*  lookahead symbol			*/
 
+#ifdef YYLSP_NEEDED
+YYLTYPE yylloc;			/*  location data for the lookahead	*/
+				/*  symbol				*/
+#endif
 
-/*------------------------------------------------.
-| Report that the YYRULE is going to be reduced.  |
-`------------------------------------------------*/
+int yynerrs;			/*  number of parse errors so far       */
+#endif  /* not YYPURE */
 
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static void
-yy_reduce_print (YYSTYPE *yyvsp, int yyrule)
-#else
-static void
-yy_reduce_print (yyvsp, yyrule)
-    YYSTYPE *yyvsp;
-    int yyrule;
+#if YYDEBUG != 0
+int yydebug;			/*  nonzero means print parse trace	*/
+/* Since this is uninitialized, it does not stop multiple parsers
+   from coexisting.  */
 #endif
-{
-  int yynrhs = yyr2[yyrule];
-  int yyi;
-  unsigned long int yylno = yyrline[yyrule];
-  YYFPRINTF (stderr, "Reducing stack by rule %d (line %lu):\n",
-	     yyrule - 1, yylno);
-  /* The symbols being reduced.  */
-  for (yyi = 0; yyi < yynrhs; yyi++)
-    {
-      fprintf (stderr, "   $%d = ", yyi + 1);
-      yy_symbol_print (stderr, yyrhs[yyprhs[yyrule] + yyi],
-		       &(yyvsp[(yyi + 1) - (yynrhs)])
-		       		       );
-      fprintf (stderr, "\n");
-    }
-}
-
-# define YY_REDUCE_PRINT(Rule)		\
-do {					\
-  if (yydebug)				\
-    yy_reduce_print (yyvsp, Rule); \
-} while (YYID (0))
-
-/* Nonzero means print parse trace.  It is left uninitialized so that
-   multiple parsers can coexist.  */
-int yydebug;
-#else /* !YYDEBUG */
-# define YYDPRINTF(Args)
-# define YY_SYMBOL_PRINT(Title, Type, Value, Location)
-# define YY_STACK_PRINT(Bottom, Top)
-# define YY_REDUCE_PRINT(Rule)
-#endif /* !YYDEBUG */
 
+/*  YYINITDEPTH indicates the initial size of the parser's stacks	*/
 
-/* YYINITDEPTH -- initial size of the parser's stacks.  */
 #ifndef	YYINITDEPTH
-# define YYINITDEPTH 200
+#define YYINITDEPTH 200
 #endif
 
-/* YYMAXDEPTH -- maximum size the stacks can grow to (effective only
-   if the built-in stack extension method is used).
+/*  YYMAXDEPTH is the maximum size the stacks can grow to
+    (effective only if the built-in stack extension method is used).  */
 
-   Do not make this value too large; the results are undefined if
-   YYSTACK_ALLOC_MAXIMUM < YYSTACK_BYTES (YYMAXDEPTH)
-   evaluated with infinite-precision integer arithmetic.  */
+#if YYMAXDEPTH == 0
+#undef YYMAXDEPTH
+#endif
 
 #ifndef YYMAXDEPTH
-# define YYMAXDEPTH 10000
+#define YYMAXDEPTH 10000
 #endif
-
 
+/* Define __yy_memcpy.  Note that the size argument
+   should be passed with type unsigned int, because that is what the non-GCC
+   definitions require.  With GCC, __builtin_memcpy takes an arg
+   of type size_t, but it can handle unsigned int.  */
+
+#if __GNUC__ > 1		/* GNU C and GNU C++ define this.  */
+#define __yy_memcpy(TO,FROM,COUNT)	__builtin_memcpy(TO,FROM,COUNT)
+#else				/* not GNU C or C++ */
+#ifndef __cplusplus
 
-#if YYERROR_VERBOSE
-
-# ifndef yystrlen
-#  if defined __GLIBC__ && defined _STRING_H
-#   define yystrlen strlen
-#  else
-/* Return the length of YYSTR.  */
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static YYSIZE_T
-yystrlen (const char *yystr)
-#else
-static YYSIZE_T
-yystrlen (yystr)
-    const char *yystr;
-#endif
-{
-  YYSIZE_T yylen;
-  for (yylen = 0; yystr[yylen]; yylen++)
-    continue;
-  return yylen;
-}
-#  endif
-# endif
-
-# ifndef yystpcpy
-#  if defined __GLIBC__ && defined _STRING_H && defined _GNU_SOURCE
-#   define yystpcpy stpcpy
-#  else
-/* Copy YYSRC to YYDEST, returning the address of the terminating '\0' in
-   YYDEST.  */
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static char *
-yystpcpy (char *yydest, const char *yysrc)
-#else
-static char *
-yystpcpy (yydest, yysrc)
-    char *yydest;
-    const char *yysrc;
-#endif
-{
-  char *yyd = yydest;
-  const char *yys = yysrc;
-
-  while ((*yyd++ = *yys++) != '\0')
-    continue;
+/* This is the most reliable way to avoid incompatibilities
+   in available built-in functions on various systems.  */
+static void
+__yy_memcpy (to, from, count)
+     char *to;
+     char *from;
+     unsigned int count;
+{
+  register char *f = from;
+  register char *t = to;
+  register int i = count;
 
-  return yyd - 1;
+  while (i-- > 0)
+    *t++ = *f++;
 }
-#  endif
-# endif
-
-# ifndef yytnamerr
-/* Copy to YYRES the contents of YYSTR after stripping away unnecessary
-   quotes and backslashes, so that it's suitable for yyerror.  The
-   heuristic is that double-quoting is unnecessary unless the string
-   contains an apostrophe, a comma, or backslash (other than
-   backslash-backslash).  YYSTR is taken from yytname.  If YYRES is
-   null, do not copy; instead, return the length of what the result
-   would have been.  */
-static YYSIZE_T
-yytnamerr (char *yyres, const char *yystr)
-{
-  if (*yystr == '"')
-    {
-      YYSIZE_T yyn = 0;
-      char const *yyp = yystr;
 
-      for (;;)
-	switch (*++yyp)
-	  {
-	  case '\'':
-	  case ',':
-	    goto do_not_strip_quotes;
-
-	  case '\\':
-	    if (*++yyp != '\\')
-	      goto do_not_strip_quotes;
-	    /* Fall through.  */
-	  default:
-	    if (yyres)
-	      yyres[yyn] = *yyp;
-	    yyn++;
-	    break;
-
-	  case '"':
-	    if (yyres)
-	      yyres[yyn] = '\0';
-	    return yyn;
-	  }
-    do_not_strip_quotes: ;
-    }
-
-  if (! yyres)
-    return yystrlen (yystr);
+#else /* __cplusplus */
 
-  return yystpcpy (yyres, yystr) - yyres;
-}
-# endif
-
-/* Copy into YYRESULT an error message about the unexpected token
-   YYCHAR while in state YYSTATE.  Return the number of bytes copied,
-   including the terminating null byte.  If YYRESULT is null, do not
-   copy anything; just return the number of bytes that would be
-   copied.  As a special case, return 0 if an ordinary "syntax error"
-   message will do.  Return YYSIZE_MAXIMUM if overflow occurs during
-   size calculation.  */
-static YYSIZE_T
-yysyntax_error (char *yyresult, int yystate, int yychar)
+/* This is the most reliable way to avoid incompatibilities
+   in available built-in functions on various systems.  */
+static void
+__yy_memcpy (char *to, char *from, unsigned int count)
 {
-  int yyn = yypact[yystate];
+  register char *t = to;
+  register char *f = from;
+  register int i = count;
 
-  if (! (YYPACT_NINF < yyn && yyn <= YYLAST))
-    return 0;
-  else
-    {
-      int yytype = YYTRANSLATE (yychar);
-      YYSIZE_T yysize0 = yytnamerr (0, yytname[yytype]);
-      YYSIZE_T yysize = yysize0;
-      YYSIZE_T yysize1;
-      int yysize_overflow = 0;
-      enum { YYERROR_VERBOSE_ARGS_MAXIMUM = 5 };
-      char const *yyarg[YYERROR_VERBOSE_ARGS_MAXIMUM];
-      int yyx;
-
-# if 0
-      /* This is so xgettext sees the translatable formats that are
-	 constructed on the fly.  */
-      YY_("syntax error, unexpected %s");
-      YY_("syntax error, unexpected %s, expecting %s");
-      YY_("syntax error, unexpected %s, expecting %s or %s");
-      YY_("syntax error, unexpected %s, expecting %s or %s or %s");
-      YY_("syntax error, unexpected %s, expecting %s or %s or %s or %s");
-# endif
-      char *yyfmt;
-      char const *yyf;
-      static char const yyunexpected[] = "syntax error, unexpected %s";
-      static char const yyexpecting[] = ", expecting %s";
-      static char const yyor[] = " or %s";
-      char yyformat[sizeof yyunexpected
-		    + sizeof yyexpecting - 1
-		    + ((YYERROR_VERBOSE_ARGS_MAXIMUM - 2)
-		       * (sizeof yyor - 1))];
-      char const *yyprefix = yyexpecting;
-
-      /* Start YYX at -YYN if negative to avoid negative indexes in
-	 YYCHECK.  */
-      int yyxbegin = yyn < 0 ? -yyn : 0;
-
-      /* Stay within bounds of both yycheck and yytname.  */
-      int yychecklim = YYLAST - yyn + 1;
-      int yyxend = yychecklim < YYNTOKENS ? yychecklim : YYNTOKENS;
-      int yycount = 1;
-
-      yyarg[0] = yytname[yytype];
-      yyfmt = yystpcpy (yyformat, yyunexpected);
-
-      for (yyx = yyxbegin; yyx < yyxend; ++yyx)
-	if (yycheck[yyx + yyn] == yyx && yyx != YYTERROR)
-	  {
-	    if (yycount == YYERROR_VERBOSE_ARGS_MAXIMUM)
-	      {
-		yycount = 1;
-		yysize = yysize0;
-		yyformat[sizeof yyunexpected - 1] = '\0';
-		break;
-	      }
-	    yyarg[yycount++] = yytname[yyx];
-	    yysize1 = yysize + yytnamerr (0, yytname[yyx]);
-	    yysize_overflow |= (yysize1 < yysize);
-	    yysize = yysize1;
-	    yyfmt = yystpcpy (yyfmt, yyprefix);
-	    yyprefix = yyor;
-	  }
-
-      yyf = YY_(yyformat);
-      yysize1 = yysize + yystrlen (yyf);
-      yysize_overflow |= (yysize1 < yysize);
-      yysize = yysize1;
-
-      if (yysize_overflow)
-	return YYSIZE_MAXIMUM;
-
-      if (yyresult)
-	{
-	  /* Avoid sprintf, as that infringes on the user's name space.
-	     Don't have undefined behavior even if the translation
-	     produced a string with the wrong number of "%s"s.  */
-	  char *yyp = yyresult;
-	  int yyi = 0;
-	  while ((*yyp = *yyf) != '\0')
-	    {
-	      if (*yyp == '%' && yyf[1] == 's' && yyi < yycount)
-		{
-		  yyp += yytnamerr (yyp, yyarg[yyi++]);
-		  yyf += 2;
-		}
-	      else
-		{
-		  yyp++;
-		  yyf++;
-		}
-	    }
-	}
-      return yysize;
-    }
+  while (i-- > 0)
+    *t++ = *f++;
 }
-#endif /* YYERROR_VERBOSE */
-
 
-/*-----------------------------------------------.
-| Release the memory associated to this symbol.  |
-`-----------------------------------------------*/
-
-/*ARGSUSED*/
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-static void
-yydestruct (const char *yymsg, int yytype, YYSTYPE *yyvaluep)
-#else
-static void
-yydestruct (yymsg, yytype, yyvaluep)
-    const char *yymsg;
-    int yytype;
-    YYSTYPE *yyvaluep;
 #endif
-{
-  YYUSE (yyvaluep);
-
-  if (!yymsg)
-    yymsg = "Deleting";
-  YY_SYMBOL_PRINT (yymsg, yytype, yyvaluep, yylocationp);
-
-  switch (yytype)
-    {
-
-      default:
-	break;
-    }
-}
+#endif
 
+#line 217 "/usr/local/share/bison.simple"
 
-/* Prevent warnings from -Wmissing-prototypes.  */
+/* The user can define YYPARSE_PARAM as the name of an argument to be passed
+   into yyparse.  The argument should have type void *.
+   It should actually point to an object.
+   Grammar actions can access the variable by casting it
+   to the proper pointer type.  */
 
 #ifdef YYPARSE_PARAM
-#if defined __STDC__ || defined __cplusplus
-int yyparse (void *YYPARSE_PARAM);
+#ifdef __cplusplus
+#define YYPARSE_PARAM_ARG void *YYPARSE_PARAM
+#define YYPARSE_PARAM_DECL
+#else /* not __cplusplus */
+#define YYPARSE_PARAM_ARG YYPARSE_PARAM
+#define YYPARSE_PARAM_DECL void *YYPARSE_PARAM;
+#endif /* not __cplusplus */
+#else /* not YYPARSE_PARAM */
+#define YYPARSE_PARAM_ARG
+#define YYPARSE_PARAM_DECL
+#endif /* not YYPARSE_PARAM */
+
+/* Prevent warning if -Wstrict-prototypes.  */
+#ifdef __GNUC__
+#ifdef YYPARSE_PARAM
+int yyparse (void *);
 #else
-int yyparse ();
-#endif
-#else /* ! YYPARSE_PARAM */
-#if defined __STDC__ || defined __cplusplus
 int yyparse (void);
-#else
-int yyparse ();
 #endif
-#endif /* ! YYPARSE_PARAM */
-
-
+#endif
 
+int
+yyparse(YYPARSE_PARAM_ARG)
+     YYPARSE_PARAM_DECL
+{
+  register int yystate;
+  register int yyn;
+  register short *yyssp;
+  register YYSTYPE *yyvsp;
+  int yyerrstatus;	/*  number of tokens to shift before error messages enabled */
+  int yychar1 = 0;		/*  lookahead token as an internal (translated) token number */
 
+  short	yyssa[YYINITDEPTH];	/*  the state stack			*/
+  YYSTYPE yyvsa[YYINITDEPTH];	/*  the semantic value stack		*/
 
+  short *yyss = yyssa;		/*  refer to the stacks thru separate pointers */
+  YYSTYPE *yyvs = yyvsa;	/*  to allow yyoverflow to reallocate them elsewhere */
 
-/*----------.
-| yyparse.  |
-`----------*/
+#ifdef YYLSP_NEEDED
+  YYLTYPE yylsa[YYINITDEPTH];	/*  the location stack			*/
+  YYLTYPE *yyls = yylsa;
+  YYLTYPE *yylsp;
 
-#ifdef YYPARSE_PARAM
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-int
-yyparse (void *YYPARSE_PARAM)
+#define YYPOPSTACK   (yyvsp--, yyssp--, yylsp--)
 #else
-int
-yyparse (YYPARSE_PARAM)
-    void *YYPARSE_PARAM;
+#define YYPOPSTACK   (yyvsp--, yyssp--)
 #endif
-#else /* ! YYPARSE_PARAM */
-#if (defined __STDC__ || defined __C99__FUNC__ \
-     || defined __cplusplus || defined _MSC_VER)
-int
-yyparse (void)
-#else
-int
-yyparse ()
 
+  int yystacksize = YYINITDEPTH;
+  int yyfree_stacks = 0;
+
+#ifdef YYPURE
+  int yychar;
+  YYSTYPE yylval;
+  int yynerrs;
+#ifdef YYLSP_NEEDED
+  YYLTYPE yylloc;
 #endif
 #endif
-{
-  /* The look-ahead symbol.  */
-int yychar;
 
-/* The semantic value of the look-ahead symbol.  */
-YYSTYPE yylval;
+  YYSTYPE yyval;		/*  the variable used to return		*/
+				/*  semantic values from the action	*/
+				/*  routines				*/
 
-/* Number of syntax errors so far.  */
-int yynerrs;
+  int yylen;
 
-  int yystate;
-  int yyn;
-  int yyresult;
-  /* Number of tokens to shift before error messages enabled.  */
-  int yyerrstatus;
-  /* Look-ahead token as an internal (translated) token number.  */
-  int yytoken = 0;
-#if YYERROR_VERBOSE
-  /* Buffer for error messages, and its allocated size.  */
-  char yymsgbuf[128];
-  char *yymsg = yymsgbuf;
-  YYSIZE_T yymsg_alloc = sizeof yymsgbuf;
+#if YYDEBUG != 0
+  if (yydebug)
+    fprintf(stderr, "Starting parse\n");
 #endif
 
-  /* Three stacks and their tools:
-     `yyss': related to states,
-     `yyvs': related to semantic values,
-     `yyls': related to locations.
-
-     Refer to the stacks thru separate pointers, to allow yyoverflow
-     to reallocate them elsewhere.  */
-
-  /* The state stack.  */
-  yytype_int16 yyssa[YYINITDEPTH];
-  yytype_int16 *yyss = yyssa;
-  yytype_int16 *yyssp;
-
-  /* The semantic value stack.  */
-  YYSTYPE yyvsa[YYINITDEPTH];
-  YYSTYPE *yyvs = yyvsa;
-  YYSTYPE *yyvsp;
-
-
-
-#define YYPOPSTACK(N)   (yyvsp -= (N), yyssp -= (N))
-
-  YYSIZE_T yystacksize = YYINITDEPTH;
-
-  /* The variables used to return semantic value and location from the
-     action routines.  */
-  YYSTYPE yyval;
-
-
-  /* The number of symbols on the RHS of the reduced rule.
-     Keep to zero when no symbol should be popped.  */
-  int yylen = 0;
-
-  YYDPRINTF ((stderr, "Starting parse\n"));
-
   yystate = 0;
   yyerrstatus = 0;
   yynerrs = 0;
@@ -1297,493 +603,541 @@
      so that they stay on the same level as the state stack.
      The wasted elements are never initialized.  */
 
-  yyssp = yyss;
+  yyssp = yyss - 1;
   yyvsp = yyvs;
+#ifdef YYLSP_NEEDED
+  yylsp = yyls;
+#endif
 
-  goto yysetstate;
-
-/*------------------------------------------------------------.
-| yynewstate -- Push a new state, which is found in yystate.  |
-`------------------------------------------------------------*/
- yynewstate:
-  /* In all cases, when you get here, the value and location stacks
-     have just been pushed.  So pushing a state here evens the stacks.  */
-  yyssp++;
+/* Push a new state, which is found in  yystate  .  */
+/* In all cases, when you get here, the value and location stacks
+   have just been pushed. so pushing a state here evens the stacks.  */
+yynewstate:
 
- yysetstate:
-  *yyssp = yystate;
+  *++yyssp = yystate;
 
-  if (yyss + yystacksize - 1 <= yyssp)
+  if (yyssp >= yyss + yystacksize - 1)
     {
+      /* Give user a chance to reallocate the stack */
+      /* Use copies of these so that the &'s don't force the real ones into memory. */
+      YYSTYPE *yyvs1 = yyvs;
+      short *yyss1 = yyss;
+#ifdef YYLSP_NEEDED
+      YYLTYPE *yyls1 = yyls;
+#endif
+
       /* Get the current used size of the three stacks, in elements.  */
-      YYSIZE_T yysize = yyssp - yyss + 1;
+      int size = yyssp - yyss + 1;
 
 #ifdef yyoverflow
-      {
-	/* Give user a chance to reallocate the stack.  Use copies of
-	   these so that the &'s don't force the real ones into
-	   memory.  */
-	YYSTYPE *yyvs1 = yyvs;
-	yytype_int16 *yyss1 = yyss;
-
-
-	/* Each stack pointer address is followed by the size of the
-	   data in use in that stack, in bytes.  This used to be a
-	   conditional around just the two extra args, but that might
-	   be undefined if yyoverflow is a macro.  */
-	yyoverflow (YY_("memory exhausted"),
-		    &yyss1, yysize * sizeof (*yyssp),
-		    &yyvs1, yysize * sizeof (*yyvsp),
-
-		    &yystacksize);
-
-	yyss = yyss1;
-	yyvs = yyvs1;
-      }
+      /* Each stack pointer address is followed by the size of
+	 the data in use in that stack, in bytes.  */
+#ifdef YYLSP_NEEDED
+      /* This used to be a conditional around just the two extra args,
+	 but that might be undefined if yyoverflow is a macro.  */
+      yyoverflow("parser stack overflow",
+		 &yyss1, size * sizeof (*yyssp),
+		 &yyvs1, size * sizeof (*yyvsp),
+		 &yyls1, size * sizeof (*yylsp),
+		 &yystacksize);
+#else
+      yyoverflow("parser stack overflow",
+		 &yyss1, size * sizeof (*yyssp),
+		 &yyvs1, size * sizeof (*yyvsp),
+		 &yystacksize);
+#endif
+
+      yyss = yyss1; yyvs = yyvs1;
+#ifdef YYLSP_NEEDED
+      yyls = yyls1;
+#endif
 #else /* no yyoverflow */
-# ifndef YYSTACK_RELOCATE
-      goto yyexhaustedlab;
-# else
       /* Extend the stack our own way.  */
-      if (YYMAXDEPTH <= yystacksize)
-	goto yyexhaustedlab;
+      if (yystacksize >= YYMAXDEPTH)
+	{
+	  yyerror("parser stack overflow");
+	  if (yyfree_stacks)
+	    {
+	      free (yyss);
+	      free (yyvs);
+#ifdef YYLSP_NEEDED
+	      free (yyls);
+#endif
+	    }
+	  return 2;
+	}
       yystacksize *= 2;
-      if (YYMAXDEPTH < yystacksize)
+      if (yystacksize > YYMAXDEPTH)
 	yystacksize = YYMAXDEPTH;
-
-      {
-	yytype_int16 *yyss1 = yyss;
-	union yyalloc *yyptr =
-	  (union yyalloc *) YYSTACK_ALLOC (YYSTACK_BYTES (yystacksize));
-	if (! yyptr)
-	  goto yyexhaustedlab;
-	YYSTACK_RELOCATE (yyss);
-	YYSTACK_RELOCATE (yyvs);
-
-#  undef YYSTACK_RELOCATE
-	if (yyss1 != yyssa)
-	  YYSTACK_FREE (yyss1);
-      }
-# endif
+#ifndef YYSTACK_USE_ALLOCA
+      yyfree_stacks = 1;
+#endif
+      yyss = (short *) YYSTACK_ALLOC (yystacksize * sizeof (*yyssp));
+      __yy_memcpy ((char *)yyss, (char *)yyss1,
+		   size * (unsigned int) sizeof (*yyssp));
+      yyvs = (YYSTYPE *) YYSTACK_ALLOC (yystacksize * sizeof (*yyvsp));
+      __yy_memcpy ((char *)yyvs, (char *)yyvs1,
+		   size * (unsigned int) sizeof (*yyvsp));
+#ifdef YYLSP_NEEDED
+      yyls = (YYLTYPE *) YYSTACK_ALLOC (yystacksize * sizeof (*yylsp));
+      __yy_memcpy ((char *)yyls, (char *)yyls1,
+		   size * (unsigned int) sizeof (*yylsp));
+#endif
 #endif /* no yyoverflow */
 
-      yyssp = yyss + yysize - 1;
-      yyvsp = yyvs + yysize - 1;
-
+      yyssp = yyss + size - 1;
+      yyvsp = yyvs + size - 1;
+#ifdef YYLSP_NEEDED
+      yylsp = yyls + size - 1;
+#endif
 
-      YYDPRINTF ((stderr, "Stack size increased to %lu\n",
-		  (unsigned long int) yystacksize));
+#if YYDEBUG != 0
+      if (yydebug)
+	fprintf(stderr, "Stack size increased to %d\n", yystacksize);
+#endif
 
-      if (yyss + yystacksize - 1 <= yyssp)
+      if (yyssp >= yyss + yystacksize - 1)
 	YYABORT;
     }
 
-  YYDPRINTF ((stderr, "Entering state %d\n", yystate));
+#if YYDEBUG != 0
+  if (yydebug)
+    fprintf(stderr, "Entering state %d\n", yystate);
+#endif
 
   goto yybackup;
+ yybackup:
 
-/*-----------.
-| yybackup.  |
-`-----------*/
-yybackup:
+/* Do appropriate processing given the current state.  */
+/* Read a lookahead token if we need one and don't already have one.  */
+/* yyresume: */
 
-  /* Do appropriate processing given the current state.  Read a
-     look-ahead token if we need one and don't already have one.  */
+  /* First try to decide what to do without reference to lookahead token.  */
 
-  /* First try to decide what to do without reference to look-ahead token.  */
   yyn = yypact[yystate];
-  if (yyn == YYPACT_NINF)
+  if (yyn == YYFLAG)
     goto yydefault;
 
-  /* Not known => get a look-ahead token if don't already have one.  */
+  /* Not known => get a lookahead token if don't already have one.  */
+
+  /* yychar is either YYEMPTY or YYEOF
+     or a valid token in external form.  */
 
-  /* YYCHAR is either YYEMPTY or YYEOF or a valid look-ahead symbol.  */
   if (yychar == YYEMPTY)
     {
-      YYDPRINTF ((stderr, "Reading a token: "));
+#if YYDEBUG != 0
+      if (yydebug)
+	fprintf(stderr, "Reading a token: ");
+#endif
       yychar = YYLEX;
     }
 
-  if (yychar <= YYEOF)
+  /* Convert token to internal form (in yychar1) for indexing tables with */
+
+  if (yychar <= 0)		/* This means end of input. */
     {
-      yychar = yytoken = YYEOF;
-      YYDPRINTF ((stderr, "Now at end of input.\n"));
+      yychar1 = 0;
+      yychar = YYEOF;		/* Don't call YYLEX any more */
+
+#if YYDEBUG != 0
+      if (yydebug)
+	fprintf(stderr, "Now at end of input.\n");
+#endif
     }
   else
     {
-      yytoken = YYTRANSLATE (yychar);
-      YY_SYMBOL_PRINT ("Next token is", yytoken, &yylval, &yylloc);
+      yychar1 = YYTRANSLATE(yychar);
+
+#if YYDEBUG != 0
+      if (yydebug)
+	{
+	  fprintf (stderr, "Next token is %d (%s", yychar, yytname[yychar1]);
+	  /* Give the individual parser a way to print the precise meaning
+	     of a token, for further debugging info.  */
+#ifdef YYPRINT
+	  YYPRINT (stderr, yychar, yylval);
+#endif
+	  fprintf (stderr, ")\n");
+	}
+#endif
     }
 
-  /* If the proper action on seeing token YYTOKEN is to reduce or to
-     detect an error, take that action.  */
-  yyn += yytoken;
-  if (yyn < 0 || YYLAST < yyn || yycheck[yyn] != yytoken)
+  yyn += yychar1;
+  if (yyn < 0 || yyn > YYLAST || yycheck[yyn] != yychar1)
     goto yydefault;
+
   yyn = yytable[yyn];
-  if (yyn <= 0)
+
+  /* yyn is what to do for this token type in this state.
+     Negative => reduce, -yyn is rule number.
+     Positive => shift, yyn is new state.
+       New state is final state => don't bother to shift,
+       just return success.
+     0, or most negative number => error.  */
+
+  if (yyn < 0)
     {
-      if (yyn == 0 || yyn == YYTABLE_NINF)
+      if (yyn == YYFLAG)
 	goto yyerrlab;
       yyn = -yyn;
       goto yyreduce;
     }
+  else if (yyn == 0)
+    goto yyerrlab;
 
   if (yyn == YYFINAL)
     YYACCEPT;
 
-  /* Count tokens shifted since error; after three, turn off error
-     status.  */
-  if (yyerrstatus)
-    yyerrstatus--;
+  /* Shift the lookahead token.  */
 
-  /* Shift the look-ahead token.  */
-  YY_SYMBOL_PRINT ("Shifting", yytoken, &yylval, &yylloc);
+#if YYDEBUG != 0
+  if (yydebug)
+    fprintf(stderr, "Shifting token %d (%s), ", yychar, yytname[yychar1]);
+#endif
 
-  /* Discard the shifted token unless it is eof.  */
+  /* Discard the token being shifted unless it is eof.  */
   if (yychar != YYEOF)
     yychar = YYEMPTY;
 
-  yystate = yyn;
   *++yyvsp = yylval;
+#ifdef YYLSP_NEEDED
+  *++yylsp = yylloc;
+#endif
 
-  goto yynewstate;
+  /* count tokens shifted since error; after three, turn off error status.  */
+  if (yyerrstatus) yyerrstatus--;
 
+  yystate = yyn;
+  goto yynewstate;
 
-/*-----------------------------------------------------------.
-| yydefault -- do the default action for the current state.  |
-`-----------------------------------------------------------*/
+/* Do the default action for the current state.  */
 yydefault:
+
   yyn = yydefact[yystate];
   if (yyn == 0)
     goto yyerrlab;
-  goto yyreduce;
-
 
-/*-----------------------------.
-| yyreduce -- Do a reduction.  |
-`-----------------------------*/
+/* Do a reduction.  yyn is the number of a rule to reduce with.  */
 yyreduce:
-  /* yyn is the number of a rule to reduce with.  */
   yylen = yyr2[yyn];
+  if (yylen > 0)
+    yyval = yyvsp[1-yylen]; /* implement default value of the action */
 
-  /* If YYLEN is nonzero, implement the default value of the action:
-     `$$ = $1'.
+#if YYDEBUG != 0
+  if (yydebug)
+    {
+      int i;
+
+      fprintf (stderr, "Reducing via rule %d (line %d), ",
+	       yyn, yyrline[yyn]);
 
-     Otherwise, the following line sets YYVAL to garbage.
-     This behavior is undocumented and Bison
-     users should not rely upon it.  Assigning to YYVAL
-     unconditionally makes the parser a bit smaller, and it avoids a
-     GCC warning that YYVAL may be used uninitialized.  */
-  yyval = yyvsp[1-yylen];
+      /* Print the symbols being reduced, and their result.  */
+      for (i = yyprhs[yyn]; yyrhs[i] > 0; i++)
+	fprintf (stderr, "%s ", yytname[yyrhs[i]]);
+      fprintf (stderr, " -> %s\n", yytname[yyr1[yyn]]);
+    }
+#endif
 
 
-  YY_REDUCE_PRINT (yyn);
-  switch (yyn)
-    {
-        case 2:
+  switch (yyn) {
+
+case 1:
 #line 175 "plural.y"
-    {
-	    if ((yyvsp[(1) - (1)].exp) == NULL)
+{
+	    if (yyvsp[0].exp == NULL)
 	      YYABORT;
-	    ((struct parse_args *) arg)->res = (yyvsp[(1) - (1)].exp);
-	  }
-    break;
-
-  case 3:
+	    ((struct parse_args *) arg)->res = yyvsp[0].exp;
+	  ;
+    break;}
+case 2:
 #line 183 "plural.y"
-    {
-	    (yyval.exp) = new_exp_3 (qmop, (yyvsp[(1) - (5)].exp), (yyvsp[(3) - (5)].exp), (yyvsp[(5) - (5)].exp));
-	  }
-    break;
-
-  case 4:
+{
+	    yyval.exp = new_exp_3 (qmop, yyvsp[-4].exp, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 3:
 #line 187 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 (lor, (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 5:
+{
+	    yyval.exp = new_exp_2 (lor, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 4:
 #line 191 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 (land, (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 6:
+{
+	    yyval.exp = new_exp_2 (land, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 5:
 #line 195 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 ((yyvsp[(2) - (3)].op), (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 7:
+{
+	    yyval.exp = new_exp_2 (yyvsp[-1].op, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 6:
 #line 199 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 ((yyvsp[(2) - (3)].op), (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 8:
+{
+	    yyval.exp = new_exp_2 (yyvsp[-1].op, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 7:
 #line 203 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 ((yyvsp[(2) - (3)].op), (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 9:
+{
+	    yyval.exp = new_exp_2 (yyvsp[-1].op, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 8:
 #line 207 "plural.y"
-    {
-	    (yyval.exp) = new_exp_2 ((yyvsp[(2) - (3)].op), (yyvsp[(1) - (3)].exp), (yyvsp[(3) - (3)].exp));
-	  }
-    break;
-
-  case 10:
+{
+	    yyval.exp = new_exp_2 (yyvsp[-1].op, yyvsp[-2].exp, yyvsp[0].exp);
+	  ;
+    break;}
+case 9:
 #line 211 "plural.y"
-    {
-	    (yyval.exp) = new_exp_1 (lnot, (yyvsp[(2) - (2)].exp));
-	  }
-    break;
-
-  case 11:
+{
+	    yyval.exp = new_exp_1 (lnot, yyvsp[0].exp);
+	  ;
+    break;}
+case 10:
 #line 215 "plural.y"
-    {
-	    (yyval.exp) = new_exp_0 (var);
-	  }
-    break;
-
-  case 12:
+{
+	    yyval.exp = new_exp_0 (var);
+	  ;
+    break;}
+case 11:
 #line 219 "plural.y"
-    {
-	    if (((yyval.exp) = new_exp_0 (num)) != NULL)
-	      (yyval.exp)->val.num = (yyvsp[(1) - (1)].num);
-	  }
-    break;
-
-  case 13:
+{
+	    if ((yyval.exp = new_exp_0 (num)) != NULL)
+	      yyval.exp->val.num = yyvsp[0].num;
+	  ;
+    break;}
+case 12:
 #line 224 "plural.y"
-    {
-	    (yyval.exp) = (yyvsp[(2) - (3)].exp);
-	  }
-    break;
-
+{
+	    yyval.exp = yyvsp[-1].exp;
+	  ;
+    break;}
+}
+   /* the action file gets copied in in place of this dollarsign */
+#line 543 "/usr/local/share/bison.simple"
+
+  yyvsp -= yylen;
+  yyssp -= yylen;
+#ifdef YYLSP_NEEDED
+  yylsp -= yylen;
+#endif
 
-/* Line 1267 of yacc.c.  */
-#line 1574 "plural.c"
-      default: break;
+#if YYDEBUG != 0
+  if (yydebug)
+    {
+      short *ssp1 = yyss - 1;
+      fprintf (stderr, "state stack now");
+      while (ssp1 != yyssp)
+	fprintf (stderr, " %d", *++ssp1);
+      fprintf (stderr, "\n");
     }
-  YY_SYMBOL_PRINT ("-> $$ =", yyr1[yyn], &yyval, &yyloc);
-
-  YYPOPSTACK (yylen);
-  yylen = 0;
-  YY_STACK_PRINT (yyss, yyssp);
+#endif
 
   *++yyvsp = yyval;
 
+#ifdef YYLSP_NEEDED
+  yylsp++;
+  if (yylen == 0)
+    {
+      yylsp->first_line = yylloc.first_line;
+      yylsp->first_column = yylloc.first_column;
+      yylsp->last_line = (yylsp-1)->last_line;
+      yylsp->last_column = (yylsp-1)->last_column;
+      yylsp->text = 0;
+    }
+  else
+    {
+      yylsp->last_line = (yylsp+yylen-1)->last_line;
+      yylsp->last_column = (yylsp+yylen-1)->last_column;
+    }
+#endif
 
-  /* Now `shift' the result of the reduction.  Determine what state
-     that goes to, based on the state we popped back to and the rule
-     number reduced by.  */
+  /* Now "shift" the result of the reduction.
+     Determine what state that goes to,
+     based on the state we popped back to
+     and the rule number reduced by.  */
 
   yyn = yyr1[yyn];
 
-  yystate = yypgoto[yyn - YYNTOKENS] + *yyssp;
-  if (0 <= yystate && yystate <= YYLAST && yycheck[yystate] == *yyssp)
+  yystate = yypgoto[yyn - YYNTBASE] + *yyssp;
+  if (yystate >= 0 && yystate <= YYLAST && yycheck[yystate] == *yyssp)
     yystate = yytable[yystate];
   else
-    yystate = yydefgoto[yyn - YYNTOKENS];
+    yystate = yydefgoto[yyn - YYNTBASE];
 
   goto yynewstate;
 
+yyerrlab:   /* here on detecting error */
 
-/*------------------------------------.
-| yyerrlab -- here on detecting error |
-`------------------------------------*/
-yyerrlab:
-  /* If not already recovering from an error, report this error.  */
-  if (!yyerrstatus)
+  if (! yyerrstatus)
+    /* If not already recovering from an error, report this error.  */
     {
       ++yynerrs;
-#if ! YYERROR_VERBOSE
-      yyerror (YY_("syntax error"));
-#else
-      {
-	YYSIZE_T yysize = yysyntax_error (0, yystate, yychar);
-	if (yymsg_alloc < yysize && yymsg_alloc < YYSTACK_ALLOC_MAXIMUM)
-	  {
-	    YYSIZE_T yyalloc = 2 * yysize;
-	    if (! (yysize <= yyalloc && yyalloc <= YYSTACK_ALLOC_MAXIMUM))
-	      yyalloc = YYSTACK_ALLOC_MAXIMUM;
-	    if (yymsg != yymsgbuf)
-	      YYSTACK_FREE (yymsg);
-	    yymsg = (char *) YYSTACK_ALLOC (yyalloc);
-	    if (yymsg)
-	      yymsg_alloc = yyalloc;
-	    else
-	      {
-		yymsg = yymsgbuf;
-		yymsg_alloc = sizeof yymsgbuf;
-	      }
-	  }
 
-	if (0 < yysize && yysize <= yymsg_alloc)
-	  {
-	    (void) yysyntax_error (yymsg, yystate, yychar);
-	    yyerror (yymsg);
-	  }
-	else
-	  {
-	    yyerror (YY_("syntax error"));
-	    if (yysize != 0)
-	      goto yyexhaustedlab;
-	  }
-      }
-#endif
-    }
+#ifdef YYERROR_VERBOSE
+      yyn = yypact[yystate];
+
+      if (yyn > YYFLAG && yyn < YYLAST)
+	{
+	  int size = 0;
+	  char *msg;
+	  int x, count;
+
+	  count = 0;
+	  /* Start X at -yyn if nec to avoid negative indexes in yycheck.  */
+	  for (x = (yyn < 0 ? -yyn : 0);
+	       x < (sizeof(yytname) / sizeof(char *)); x++)
+	    if (yycheck[x + yyn] == x)
+	      size += strlen(yytname[x]) + 15, count++;
+	  msg = (char *) malloc(size + 15);
+	  if (msg != 0)
+	    {
+	      strcpy(msg, "parse error");
 
+	      if (count < 5)
+		{
+		  count = 0;
+		  for (x = (yyn < 0 ? -yyn : 0);
+		       x < (sizeof(yytname) / sizeof(char *)); x++)
+		    if (yycheck[x + yyn] == x)
+		      {
+			strcat(msg, count == 0 ? ", expecting `" : " or `");
+			strcat(msg, yytname[x]);
+			strcat(msg, "'");
+			count++;
+		      }
+		}
+	      yyerror(msg);
+	      free(msg);
+	    }
+	  else
+	    yyerror ("parse error; also virtual memory exceeded");
+	}
+      else
+#endif /* YYERROR_VERBOSE */
+	yyerror("parse error");
+    }
 
+  goto yyerrlab1;
+yyerrlab1:   /* here on error raised explicitly by an action */
 
   if (yyerrstatus == 3)
     {
-      /* If just tried and failed to reuse look-ahead token after an
-	 error, discard it.  */
+      /* if just tried and failed to reuse lookahead token after an error, discard it.  */
 
-      if (yychar <= YYEOF)
-	{
-	  /* Return failure if at end of input.  */
-	  if (yychar == YYEOF)
-	    YYABORT;
-	}
-      else
-	{
-	  yydestruct ("Error: discarding",
-		      yytoken, &yylval);
-	  yychar = YYEMPTY;
-	}
+      /* return failure if at end of input */
+      if (yychar == YYEOF)
+	YYABORT;
+
+#if YYDEBUG != 0
+      if (yydebug)
+	fprintf(stderr, "Discarding token %d (%s).\n", yychar, yytname[yychar1]);
+#endif
+
+      yychar = YYEMPTY;
     }
 
-  /* Else will try to reuse look-ahead token after shifting the error
-     token.  */
-  goto yyerrlab1;
+  /* Else will try to reuse lookahead token
+     after shifting the error token.  */
 
+  yyerrstatus = 3;		/* Each real token shifted decrements this */
 
-/*---------------------------------------------------.
-| yyerrorlab -- error raised explicitly by YYERROR.  |
-`---------------------------------------------------*/
-yyerrorlab:
-
-  /* Pacify compilers like GCC when the user code never invokes
-     YYERROR and the label yyerrorlab therefore never appears in user
-     code.  */
-  if (/*CONSTCOND*/ 0)
-     goto yyerrorlab;
-
-  /* Do not reclaim the symbols of the rule which action triggered
-     this YYERROR.  */
-  YYPOPSTACK (yylen);
-  yylen = 0;
-  YY_STACK_PRINT (yyss, yyssp);
-  yystate = *yyssp;
-  goto yyerrlab1;
+  goto yyerrhandle;
+
+yyerrdefault:  /* current state does not do anything special for the error token. */
 
+#if 0
+  /* This is wrong; only states that explicitly want error tokens
+     should shift them.  */
+  yyn = yydefact[yystate];  /* If its default is to accept any token, ok.  Otherwise pop it.*/
+  if (yyn) goto yydefault;
+#endif
 
-/*-------------------------------------------------------------.
-| yyerrlab1 -- common code for both syntax error and YYERROR.  |
-`-------------------------------------------------------------*/
-yyerrlab1:
-  yyerrstatus = 3;	/* Each real token shifted decrements this.  */
+yyerrpop:   /* pop the current state because it cannot handle the error token */
 
-  for (;;)
+  if (yyssp == yyss) YYABORT;
+  yyvsp--;
+  yystate = *--yyssp;
+#ifdef YYLSP_NEEDED
+  yylsp--;
+#endif
+
+#if YYDEBUG != 0
+  if (yydebug)
     {
-      yyn = yypact[yystate];
-      if (yyn != YYPACT_NINF)
-	{
-	  yyn += YYTERROR;
-	  if (0 <= yyn && yyn <= YYLAST && yycheck[yyn] == YYTERROR)
-	    {
-	      yyn = yytable[yyn];
-	      if (0 < yyn)
-		break;
-	    }
-	}
+      short *ssp1 = yyss - 1;
+      fprintf (stderr, "Error: state stack now");
+      while (ssp1 != yyssp)
+	fprintf (stderr, " %d", *++ssp1);
+      fprintf (stderr, "\n");
+    }
+#endif
 
-      /* Pop the current state because it cannot handle the error token.  */
-      if (yyssp == yyss)
-	YYABORT;
+yyerrhandle:
 
+  yyn = yypact[yystate];
+  if (yyn == YYFLAG)
+    goto yyerrdefault;
 
-      yydestruct ("Error: popping",
-		  yystos[yystate], yyvsp);
-      YYPOPSTACK (1);
-      yystate = *yyssp;
-      YY_STACK_PRINT (yyss, yyssp);
+  yyn += YYTERROR;
+  if (yyn < 0 || yyn > YYLAST || yycheck[yyn] != YYTERROR)
+    goto yyerrdefault;
+
+  yyn = yytable[yyn];
+  if (yyn < 0)
+    {
+      if (yyn == YYFLAG)
+	goto yyerrpop;
+      yyn = -yyn;
+      goto yyreduce;
     }
+  else if (yyn == 0)
+    goto yyerrpop;
 
   if (yyn == YYFINAL)
     YYACCEPT;
 
-  *++yyvsp = yylval;
-
+#if YYDEBUG != 0
+  if (yydebug)
+    fprintf(stderr, "Shifting error token, ");
+#endif
 
-  /* Shift the error token.  */
-  YY_SYMBOL_PRINT ("Shifting", yystos[yyn], yyvsp, yylsp);
+  *++yyvsp = yylval;
+#ifdef YYLSP_NEEDED
+  *++yylsp = yylloc;
+#endif
 
   yystate = yyn;
   goto yynewstate;
 
-
-/*-------------------------------------.
-| yyacceptlab -- YYACCEPT comes here.  |
-`-------------------------------------*/
-yyacceptlab:
-  yyresult = 0;
-  goto yyreturn;
-
-/*-----------------------------------.
-| yyabortlab -- YYABORT comes here.  |
-`-----------------------------------*/
-yyabortlab:
-  yyresult = 1;
-  goto yyreturn;
-
-#ifndef yyoverflow
-/*-------------------------------------------------.
-| yyexhaustedlab -- memory exhaustion comes here.  |
-`-------------------------------------------------*/
-yyexhaustedlab:
-  yyerror (YY_("memory exhausted"));
-  yyresult = 2;
-  /* Fall through.  */
-#endif
-
-yyreturn:
-  if (yychar != YYEOF && yychar != YYEMPTY)
-     yydestruct ("Cleanup: discarding lookahead",
-		 yytoken, &yylval);
-  /* Do not reclaim the symbols of the rule which action triggered
-     this YYABORT or YYACCEPT.  */
-  YYPOPSTACK (yylen);
-  YY_STACK_PRINT (yyss, yyssp);
-  while (yyssp != yyss)
-    {
-      yydestruct ("Cleanup: popping",
-		  yystos[*yyssp], yyvsp);
-      YYPOPSTACK (1);
+ yyacceptlab:
+  /* YYACCEPT comes here.  */
+  if (yyfree_stacks)
+    {
+      free (yyss);
+      free (yyvs);
+#ifdef YYLSP_NEEDED
+      free (yyls);
+#endif
     }
-#ifndef yyoverflow
-  if (yyss != yyssa)
-    YYSTACK_FREE (yyss);
-#endif
-#if YYERROR_VERBOSE
-  if (yymsg != yymsgbuf)
-    YYSTACK_FREE (yymsg);
+  return 0;
+
+ yyabortlab:
+  /* YYABORT comes here.  */
+  if (yyfree_stacks)
+    {
+      free (yyss);
+      free (yyvs);
+#ifdef YYLSP_NEEDED
+      free (yyls);
 #endif
-  /* Make sure YYID is used.  */
-  return YYID (yyresult);
+    }
+  return 1;
 }
-
-
 #line 229 "plural.y"
 
 
@@ -1966,4 +1320,3 @@
 {
   /* Do nothing.  We don't print error messages here.  */
 }
-
diff -uNr vlc_0.8.6-svn20060918.debian/ipkg/Makefile.in vlc_0.8.6-svn20060925.debian/ipkg/Makefile.in
--- vlc_0.8.6-svn20060918.debian/ipkg/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/ipkg/Makefile.in	2006-09-24 13:11:58.000000000 -0400
@@ -115,12 +115,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -152,9 +153,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -246,7 +244,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/loader/Makefile.in vlc_0.8.6-svn20060925.debian/loader/Makefile.in
--- vlc_0.8.6-svn20060918.debian/loader/Makefile.in	2006-09-18 06:30:32.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/loader/Makefile.in	2006-09-24 13:11:58.000000000 -0400
@@ -129,12 +129,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -166,9 +167,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -260,7 +258,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/m4/Makefile.in vlc_0.8.6-svn20060925.debian/m4/Makefile.in
--- vlc_0.8.6-svn20060918.debian/m4/Makefile.in	2006-09-18 06:30:32.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/m4/Makefile.in	2006-09-24 13:11:58.000000000 -0400
@@ -115,12 +115,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -152,9 +153,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -246,7 +244,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/Makefile.in vlc_0.8.6-svn20060925.debian/Makefile.in
--- vlc_0.8.6-svn20060918.debian/Makefile.in	2006-09-18 06:30:31.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/Makefile.in	2006-09-24 13:11:55.000000000 -0400
@@ -122,12 +122,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -159,9 +160,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -253,7 +251,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/cdda/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/cdda/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/cdda/Makefile.in	2006-09-18 06:30:33.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/cdda/Makefile.in	2006-09-24 13:12:01.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/directory.c vlc_0.8.6-svn20060925.debian/modules/access/directory.c
--- vlc_0.8.6-svn20060918.debian/modules/access/directory.c	2006-09-18 06:28:26.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/directory.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * directory.c: expands a directory (directory: access plug-in)
  *****************************************************************************
  * Copyright (C) 2002-2004 the VideoLAN team
- * $Id: directory.c 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: directory.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Derk-Jan Hartman <hartman at videolan dot org>
  *
@@ -28,6 +28,7 @@
 #include <vlc/vlc.h>
 #include <vlc/input.h>
 #include <vlc_playlist.h>
+#include <vlc_input.h>
 
 #include <stdlib.h>
 #include <string.h>
@@ -389,14 +390,30 @@
 static int ReadDir( playlist_t *p_playlist, const char *psz_name,
                     int i_mode, playlist_item_t *p_parent )
 {
-    struct dirent   **pp_dir_content;
-    int             i_dir_content, i;
+    struct dirent   **pp_dir_content = 0;
+    int             i_dir_content, i, i_return = VLC_SUCCESS;
     playlist_item_t *p_node;
 
-    /* Build array with ignores */
     char **ppsz_extensions = 0;
     int i_extensions = 0;
-    char *psz_ignore = var_CreateGetString( p_playlist, "ignore-filetypes" );
+    char *psz_ignore;
+
+    /* Get the first directory entry */
+    i_dir_content = scandir( psz_name, &pp_dir_content, Filter, alphasort );
+    if( i_dir_content == -1 )
+    {
+        msg_Warn( p_playlist, "failed to read directory" );
+        return VLC_EGENERIC;
+    }
+    else if( i_dir_content <= 0 )
+    {
+        /* directory is empty */
+        if( pp_dir_content ) free( pp_dir_content );
+        return VLC_SUCCESS;
+    }
+
+    /* Build array with ignores */
+    psz_ignore = var_CreateGetString( p_playlist, "ignore-filetypes" );
     if( psz_ignore && *psz_ignore )
     {
         char *psz_parser = psz_ignore;
@@ -430,19 +447,6 @@
         playlist_LockItemToNode( p_playlist,p_parent );
     }
 
-    /* get the first directory entry */
-    i_dir_content = scandir( psz_name, &pp_dir_content, Filter, alphasort );
-    if( i_dir_content == -1 )
-    {
-        msg_Warn( p_playlist, "failed to read directory" );
-        return VLC_EGENERIC;
-    }
-    else if( i_dir_content <= 0 )
-    {
-        /* directory is empty */
-        return VLC_SUCCESS;
-    }
-
     /* While we still have entries in the directory */
     for( i = 0; i < i_dir_content; i++ )
     {
@@ -506,14 +510,17 @@
 
                     p_node->input.i_type = ITEM_TYPE_DIRECTORY;
 
+                    /* an strdup() just because of Mac OS X */
+                    free( psz_newname );
+
+                    /* If we had the parent in category, the it is now node.
+                     * Else, we still don't have  */
                     if( ReadDir( p_playlist, psz_uri , MODE_EXPAND,
                                  p_node ) != VLC_SUCCESS )
                     {
-                        return VLC_EGENERIC;
+                        i_return = VLC_EGENERIC;
+                        break;
                     }
-
-                    /* an strdup() just because of Mac OS X */
-                    free( psz_newname );
                 }
             }
             else
@@ -566,15 +573,14 @@
     }
 
     for( i = 0; i < i_extensions; i++ )
-    {
-        if( ppsz_extensions[i] )
-            free( ppsz_extensions[i] );
-    }
+        if( ppsz_extensions[i] ) free( ppsz_extensions[i] );
     if( ppsz_extensions ) free( ppsz_extensions );
+
     if( psz_ignore ) free( psz_ignore );
 
     for( i = 0; i < i_dir_content; i++ )
         if( pp_dir_content[i] ) free( pp_dir_content[i] );
     if( pp_dir_content ) free( pp_dir_content );
-    return VLC_SUCCESS;
+
+    return i_return;
 }
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/dshow/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/dshow/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/dshow/Makefile.in	2006-09-18 06:30:33.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/dshow/Makefile.in	2006-09-24 13:12:02.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/dvb/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/dvb/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/dvb/Makefile.in	2006-09-18 06:30:33.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/dvb/Makefile.in	2006-09-24 13:12:03.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/file.c vlc_0.8.6-svn20060925.debian/modules/access/file.c
--- vlc_0.8.6-svn20060918.debian/modules/access/file.c	2006-09-18 06:28:26.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/file.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * file.c: file input (file: access plug-in)
  *****************************************************************************
  * Copyright (C) 2001-2006 the VideoLAN team
- * $Id: file.c 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: file.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *          Rmi Denis-Courmont <rem # videolan # org>
@@ -178,7 +178,7 @@
             ** explorer can open path such as file:/C:/ or file:///C:/...
             ** hence remove leading / if found
             */
-            ++psz_name;
+            strcpy( psz_name, p_access->psz_path + 1 );
         }
 #endif
 
@@ -257,6 +257,7 @@
         else
         {
             msg_Err( p_access, "unknown file type for `%s'", psz_name );
+            free( psz_name );
             return VLC_EGENERIC;
         }
     }
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/ftp.c vlc_0.8.6-svn20060925.debian/modules/access/ftp.c
--- vlc_0.8.6-svn20060918.debian/modules/access/ftp.c	2006-09-18 06:28:26.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/ftp.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * ftp.c: FTP input module
  *****************************************************************************
  * Copyright (C) 2001-2006 the VideoLAN team
- * $Id: ftp.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: ftp.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr> - original code
  *          Rmi Denis-Courmont <rem # videolan.org> - EPSV support
@@ -63,7 +63,7 @@
                  CACHING_TEXT, CACHING_LONGTEXT, VLC_TRUE );
     add_string( "ftp-user", "anonymous", NULL, USER_TEXT, USER_LONGTEXT,
                 VLC_FALSE );
-    add_string( "ftp-pwd", "anonymous@dummy.org", NULL, PASS_TEXT,
+    add_string( "ftp-pwd", "anonymous@example.com", NULL, PASS_TEXT,
                 PASS_LONGTEXT, VLC_FALSE );
     add_string( "ftp-account", "anonymous", NULL, ACCOUNT_TEXT,
                 ACCOUNT_LONGTEXT, VLC_FALSE );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/http.c vlc_0.8.6-svn20060925.debian/modules/access/http.c
--- vlc_0.8.6-svn20060918.debian/modules/access/http.c	2006-09-18 06:28:26.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/http.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * http.c: HTTP input module
  *****************************************************************************
  * Copyright (C) 2001-2005 the VideoLAN team
- * $Id: http.c 16460 2006-08-31 22:01:13Z hartman $
+ * $Id: http.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Christophe Massiot <massiot@via.ecp.fr>
@@ -497,8 +497,9 @@
             /* read the chunk header */
             if( psz == NULL )
             {
+                /* fatal error - end of file */
                 msg_Dbg( p_access, "failed reading chunk-header line" );
-                return -1;
+                return 0;
             }
             p_sys->i_chunk = strtoll( psz, NULL, 16 );
             free( psz );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/Makefile.in	2006-09-18 06:30:32.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/Makefile.in	2006-09-24 13:12:01.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/mms/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/mms/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/mms/Makefile.in	2006-09-18 06:30:33.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/mms/Makefile.in	2006-09-24 13:12:03.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/pvr/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/pvr/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/pvr/Makefile.in	2006-09-18 06:30:34.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/pvr/Makefile.in	2006-09-24 13:12:04.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/rtsp/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/rtsp/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/rtsp/Makefile.in	2006-09-18 06:30:34.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/rtsp/Makefile.in	2006-09-24 13:12:05.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/screen/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/screen/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/screen/Makefile.in	2006-09-18 06:30:34.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/screen/Makefile.in	2006-09-24 13:12:06.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/v4l/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/v4l/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/v4l/Makefile.in	2006-09-18 06:30:34.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/v4l/Makefile.in	2006-09-24 13:12:06.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/vcd/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/vcd/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/vcd/Makefile.in	2006-09-18 06:30:35.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/vcd/Makefile.in	2006-09-24 13:12:07.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access/vcdx/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access/vcdx/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access/vcdx/Makefile.in	2006-09-18 06:30:36.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access/vcdx/Makefile.in	2006-09-24 13:12:07.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access_filter/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access_filter/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access_filter/Makefile.in	2006-09-18 06:30:36.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access_filter/Makefile.in	2006-09-24 13:12:08.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/access_output/Makefile.in vlc_0.8.6-svn20060925.debian/modules/access_output/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/access_output/Makefile.in	2006-09-18 06:30:36.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/access_output/Makefile.in	2006-09-24 13:12:09.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_filter/channel_mixer/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_filter/channel_mixer/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_filter/channel_mixer/Makefile.in	2006-09-18 06:30:37.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_filter/channel_mixer/Makefile.in	2006-09-24 13:12:11.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_filter/converter/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_filter/converter/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_filter/converter/Makefile.in	2006-09-18 06:30:38.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_filter/converter/Makefile.in	2006-09-24 13:12:13.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_filter/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_filter/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_filter/Makefile.in	2006-09-18 06:30:37.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_filter/Makefile.in	2006-09-24 13:12:10.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_filter/resampler/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_filter/resampler/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_filter/resampler/Makefile.in	2006-09-18 06:30:38.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_filter/resampler/Makefile.in	2006-09-24 13:12:14.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_mixer/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_mixer/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_mixer/Makefile.in	2006-09-18 06:30:39.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_mixer/Makefile.in	2006-09-24 13:12:15.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/audio_output/Makefile.in vlc_0.8.6-svn20060925.debian/modules/audio_output/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/audio_output/Makefile.in	2006-09-18 06:30:39.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/audio_output/Makefile.in	2006-09-24 13:12:17.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/cmml/Makefile.in vlc_0.8.6-svn20060925.debian/modules/codec/cmml/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/codec/cmml/Makefile.in	2006-09-18 06:30:41.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/cmml/Makefile.in	2006-09-24 13:12:22.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/cvdsub.c vlc_0.8.6-svn20060925.debian/modules/codec/cvdsub.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/cvdsub.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/cvdsub.c	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * cvd.c : CVD Subtitle decoder
  *****************************************************************************
  * Copyright (C) 2003, 2004 the VideoLAN team
- * $Id: cvdsub.c 13905 2006-01-12 23:10:04Z dionoea $
+ * $Id: cvdsub.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Rocky Bernstein
  *          Gildas Bazin <gbazin@videolan.org>
@@ -496,6 +496,8 @@
     p_spu = p_dec->pf_spu_buffer_new( p_dec );
     if( !p_spu ) return NULL;
 
+    p_spu->b_pausable = VLC_TRUE;
+
     p_spu->i_x = p_sys->i_x_start;
     p_spu->i_x = p_spu->i_x * 3 / 4; /* FIXME: use aspect ratio for x? */
     p_spu->i_y = p_sys->i_y_start;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/dmo/Makefile.in vlc_0.8.6-svn20060925.debian/modules/codec/dmo/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/codec/dmo/Makefile.in	2006-09-18 06:30:41.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/dmo/Makefile.in	2006-09-24 13:12:22.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/encoder.c vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/encoder.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/encoder.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/encoder.c	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * encoder.c: video and audio encoder using the ffmpeg library
  *****************************************************************************
  * Copyright (C) 1999-2004 the VideoLAN team
- * $Id: encoder.c 16603 2006-09-10 20:40:21Z sam $
+ * $Id: encoder.c 16775 2006-09-21 20:35:23Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/ffmpeg.c vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/ffmpeg.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/ffmpeg.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/ffmpeg.c	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * ffmpeg.c: video decoder using ffmpeg library
  *****************************************************************************
  * Copyright (C) 1999-2001 the VideoLAN team
- * $Id: ffmpeg.c 16603 2006-09-10 20:40:21Z sam $
+ * $Id: ffmpeg.c 16801 2006-09-23 11:13:16Z thresh $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
@@ -641,6 +641,8 @@
       VIDEO_ES, "h264" },
     { VLC_FOURCC('x','2','6','4'), CODEC_ID_H264,
       VIDEO_ES, "h264" },
+    { VLC_FOURCC('X','2','6','4'), CODEC_ID_H264,
+      VIDEO_ES, "h264" },
     /* avc1: special case h264 */
     { VLC_FOURCC('a','v','c','1'), CODEC_ID_H264,
       VIDEO_ES, "h264" },
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/ffmpeg.h vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/ffmpeg.h
--- vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/ffmpeg.h	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/ffmpeg.h	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * ffmpeg.h: decoder using the ffmpeg library
  *****************************************************************************
  * Copyright (C) 2001 the VideoLAN team
- * $Id: ffmpeg.h 16603 2006-09-10 20:40:21Z sam $
+ * $Id: ffmpeg.h 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
@@ -149,7 +149,7 @@
 #define LIBAVCODEC_PP_TEXT N_("FFmpeg post processing filter chains")
 /* FIXME (cut/past from ffmpeg */
 #define LIBAVCODEC_PP_LONGTEXT \
-"<filterName>[:<option>[:<option>...]][[,|/][-]<filterName>[:<option>...]]...\n" \
+N_("<filterName>[:<option>[:<option>...]][[,|/][-]<filterName>[:<option>...]]...\n" \
 "long form example:\n" \
 "vdeblock:autoq/hdeblock:autoq/linblenddeint    default,-vdeblock\n" \
 "short form example:\n" \
@@ -181,7 +181,7 @@
 "fa     fast                                    h1:a,v1:a,dr:a,al\n" \
 "tn     tmpnoise        (3 Thresholds)          Temporal Noise Reducer\n" \
 "                       1. <= 2. <= 3.          larger -> stronger filtering\n" \
-"fq     forceQuant      <quantizer>             Force quantizer\n"
+"fq     forceQuant      <quantizer>             Force quantizer\n")
 
 /*
  * Encoder options
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/Makefile.in vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/codec/ffmpeg/Makefile.in	2006-09-18 06:30:42.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/ffmpeg/Makefile.in	2006-09-24 13:12:24.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/Makefile.in vlc_0.8.6-svn20060925.debian/modules/codec/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/codec/Makefile.in	2006-09-18 06:30:41.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/Makefile.in	2006-09-24 13:12:21.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/spudec/Makefile.in vlc_0.8.6-svn20060925.debian/modules/codec/spudec/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/codec/spudec/Makefile.in	2006-09-18 06:30:42.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/spudec/Makefile.in	2006-09-24 13:12:25.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/spudec/parse.c vlc_0.8.6-svn20060925.debian/modules/codec/spudec/parse.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/spudec/parse.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/spudec/parse.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * parse.c: SPU parser
  *****************************************************************************
  * Copyright (C) 2000-2001, 2005, 2006 the VideoLAN team
- * $Id: parse.c 16441 2006-08-30 21:36:35Z hartman $
+ * $Id: parse.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Sam Hocevar <sam@zoy.org>
  *          Laurent Aimar <fenrir@via.ecp.fr>
@@ -71,6 +71,8 @@
     p_spu = p_dec->pf_spu_buffer_new( p_dec );
     if( !p_spu ) return NULL;
 
+    p_spu->b_pausable = VLC_TRUE;
+
     /* Rationale for the "p_spudec->i_rle_size * 4": we are going to
      * expand the RLE stuff so that we won't need to read nibbles later
      * on. This will speed things up a lot. Plus, we'll only need to do
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/subsdec.c vlc_0.8.6-svn20060925.debian/modules/codec/subsdec.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/subsdec.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/subsdec.c	2006-09-22 11:14:32.000000000 -0400
@@ -2,7 +2,7 @@
  * subsdec.c : text subtitles decoder
  *****************************************************************************
  * Copyright (C) 2000-2006 the VideoLAN team
- * $Id: subsdec.c 15081 2006-04-03 01:39:59Z hartman $
+ * $Id: subsdec.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *          Samuel Hocevar <sam@zoy.org>
@@ -381,6 +381,8 @@
         return NULL;
     }
 
+    p_spu->b_pausable = VLC_TRUE;
+
     /* Create a new subpicture region */
     memset( &fmt, 0, sizeof(video_format_t) );
     fmt.i_chroma = VLC_FOURCC('T','E','X','T');
diff -uNr vlc_0.8.6-svn20060918.debian/modules/codec/svcdsub.c vlc_0.8.6-svn20060925.debian/modules/codec/svcdsub.c
--- vlc_0.8.6-svn20060918.debian/modules/codec/svcdsub.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/codec/svcdsub.c	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * svcdsub.c : Overlay Graphics Text (SVCD subtitles) decoder
  *****************************************************************************
  * Copyright (C) 2003, 2004 the VideoLAN team
- * $Id: svcdsub.c 14993 2006-03-31 13:46:39Z zorglub $
+ * $Id: svcdsub.c 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Rocky Bernstein
  *          Gildas Bazin <gbazin@videolan.org>
@@ -42,10 +42,10 @@
 #define DEBUG_TEXT \
      "Enable debug"
 
-#define DEBUG_LONGTEXT \
+#define DEBUG_LONGTEXT N_( \
     "This integer when viewed in binary is a debugging mask\n" \
     "calls                 1\n" \
-    "packet assembly info  2\n"
+    "packet assembly info  2\n")
 
 vlc_module_begin();
     set_description( _("Philips OGT (SVCD subtitle) decoder") );
@@ -466,6 +466,8 @@
     p_spu = p_dec->pf_spu_buffer_new( p_dec );
     if( !p_spu ) return NULL;
 
+    p_spu->b_pausable = VLC_TRUE;
+
     p_spu->i_x = p_sys->i_x_start;
     p_spu->i_y = p_sys->i_y_start;
     p_spu->i_start = p_data->i_pts;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/control/corba/Makefile.in vlc_0.8.6-svn20060925.debian/modules/control/corba/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/control/corba/Makefile.in	2006-09-18 06:30:43.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/control/corba/Makefile.in	2006-09-24 13:12:27.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
@@ -344,7 +341,7 @@
 @ENABLE_CORBA_TRUE@orbittypelib_CFLAGS = `$(VLC_CONFIG) --cflags plugin corba`
 @ENABLE_CORBA_TRUE@orbittypelib_LIBS = `$(VLC_CONFIG) --libs plugin corba`
 
-@ENABLE_CORBA_TRUE@ORBIT_IDL = $(shell pkg-config --variable=orbit_idl ORBit-2.0)
+@ENABLE_CORBA_TRUE@ORBIT_IDL = `$(PKG_CONFIG) --variable=orbit_idl ORBit-2.0`
 
 LTLIBVLC = $(top_builddir)/src/libvlc.la
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/control/http/http.c vlc_0.8.6-svn20060925.debian/modules/control/http/http.c
--- vlc_0.8.6-svn20060918.debian/modules/control/http/http.c	2006-09-18 06:28:16.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/control/http/http.c	2006-09-22 11:14:27.000000000 -0400
@@ -2,7 +2,7 @@
  * http.c : HTTP/HTTPS Remote control interface
  *****************************************************************************
  * Copyright (C) 2001-2006 the VideoLAN team
- * $Id: http.c 16439 2006-08-30 19:33:55Z hartman $
+ * $Id: http.c 16776 2006-09-21 21:56:22Z xtophe $
  *
  * Authors: Gildas Bazin <gbazin@netcourrier.com>
  *          Laurent Aimar <fenrir@via.ecp.fr>
@@ -126,7 +126,12 @@
     char          *psz_src;
     char          psz_tmp[10];
 
-    psz_address = config_GetPsz( p_intf, "http-host" );
+    var_Create(p_intf->p_libvlc, "http-host", VLC_VAR_STRING );
+    psz_address=var_GetString(p_intf->p_libvlc, "http-host");
+    if( !psz_address || !*psz_address )
+    {
+        psz_address = config_GetPsz( p_intf, "http-host" );
+    }
     if( psz_address != NULL )
     {
         char *psz_parser = strchr( psz_address, ':' );
@@ -259,8 +264,8 @@
     }
 
     /* Ugly hack to allow to run several HTTP servers on different ports. */
-    sprintf( psz_tmp, ":%d", i_port + 1 );
-    config_PutPsz( p_intf, "http-host", psz_tmp );
+    sprintf( psz_tmp, "%s:%d", psz_address, i_port + 1 );
+    var_SetString( p_intf->p_libvlc, "http-host", psz_tmp );
 
     msg_Dbg( p_intf, "base %s:%d", psz_address, i_port );
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/control/http/Makefile.in vlc_0.8.6-svn20060925.debian/modules/control/http/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/control/http/Makefile.in	2006-09-18 06:30:44.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/control/http/Makefile.in	2006-09-24 13:12:28.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/control/Makefile.in vlc_0.8.6-svn20060925.debian/modules/control/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/control/Makefile.in	2006-09-18 06:30:43.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/control/Makefile.in	2006-09-24 13:12:27.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/control/rc.c vlc_0.8.6-svn20060925.debian/modules/control/rc.c
--- vlc_0.8.6-svn20060918.debian/modules/control/rc.c	2006-09-18 06:28:16.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/control/rc.c	2006-09-22 11:14:28.000000000 -0400
@@ -2,7 +2,7 @@
  * rc.c : remote control stdin/stdout module for vlc
  *****************************************************************************
  * Copyright (C) 2004 - 2005 the VideoLAN team
- * $Id: rc.c 16669 2006-09-16 10:31:26Z thresh $
+ * $Id: rc.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Author: Peter Surda <shurdeek@panorama.sth.ac.at>
  *         Jean-Paul Saman <jpsaman #_at_# m2x _replaceWith#dot_ nl>
@@ -95,6 +95,8 @@
                            vlc_value_t, vlc_value_t, void * );
 static int  VolumeMove   ( vlc_object_t *, char const *,
                            vlc_value_t, vlc_value_t, void * );
+static int  VideoConfig  ( vlc_object_t *, char const *,
+                           vlc_value_t, vlc_value_t, void * );
 static int  AudioConfig  ( vlc_object_t *, char const *,
                            vlc_value_t, vlc_value_t, void * );
 static int  Menu         ( vlc_object_t *, char const *,
@@ -372,6 +374,8 @@
 
     var_Create( p_intf, "add", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
     var_AddCallback( p_intf, "add", Playlist, NULL );
+    var_Create( p_intf, "enqueue", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "enqueue", Playlist, NULL );
     var_Create( p_intf, "playlist", VLC_VAR_VOID | VLC_VAR_ISCOMMAND );
     var_AddCallback( p_intf, "playlist", Playlist, NULL );
     var_Create( p_intf, "play", VLC_VAR_VOID | VLC_VAR_ISCOMMAND );
@@ -495,6 +499,21 @@
     var_Create( p_intf, "normal", VLC_VAR_VOID | VLC_VAR_ISCOMMAND );
     var_AddCallback( p_intf, "normal", Input, NULL );
 
+    var_Create( p_intf, "atrack", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "atrack", Input, NULL );
+    var_Create( p_intf, "vtrack", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "vtrack", Input, NULL );
+    var_Create( p_intf, "strack", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "strack", Input, NULL );
+
+    /* video commands */
+    var_Create( p_intf, "vratio", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "vratio", VideoConfig, NULL );
+    var_Create( p_intf, "vcrop", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "vcrop", VideoConfig, NULL );
+    var_Create( p_intf, "vzoom", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
+    var_AddCallback( p_intf, "vzoom", VideoConfig, NULL );
+
     /* audio commands */
     var_Create( p_intf, "volume", VLC_VAR_STRING | VLC_VAR_ISCOMMAND );
     var_AddCallback( p_intf, "volume", Volume, NULL );
@@ -882,6 +901,7 @@
     msg_rc(_("+----[ Remote control commands ]"));
     msg_rc(  "| ");
     msg_rc(_("| add XYZ  . . . . . . . . . . add XYZ to playlist"));
+    msg_rc(_("| enqueue XYZ  . . . . . . . queue XYZ to playlist"));
     msg_rc(_("| playlist . . .  show items currently in playlist"));
     msg_rc(_("| play . . . . . . . . . . . . . . . . play stream"));
     msg_rc(_("| stop . . . . . . . . . . . . . . . . stop stream"));
@@ -916,6 +936,12 @@
     msg_rc(_("| voldown [X]  . . . .  lower audio volume X steps"));
     msg_rc(_("| adev [X] . . . . . . . . .  set/get audio device"));
     msg_rc(_("| achan [X]. . . . . . . .  set/get audio channels"));
+    msg_rc(_("| atrack [X] . . . . . . . . . set/get audio track"));
+    msg_rc(_("| vtrack [X] . . . . . . . . . set/get video track"));
+    msg_rc(_("| vratio [X]  . . . . . set/get video aspect ratio"));
+    msg_rc(_("| vcrop [X]  . . . . . . . . .  set/get video crop"));
+    msg_rc(_("| vzoom [X]  . . . . . . . . .  set/get video zoom"));
+    msg_rc(_("| strack [X] . . . . . . . set/get subtitles track"));
     msg_rc(_("| menu [on|off|up|down|left|right|select] use menu"));
     msg_rc(  "| ");
 
@@ -1216,6 +1242,81 @@
         vlc_object_release( p_input );
         return VLC_SUCCESS;
     }
+    else if(    !strcmp( psz_cmd, "atrack" )
+             || !strcmp( psz_cmd, "vtrack" )
+             || !strcmp( psz_cmd, "strack" ) )
+    {
+        char *psz_variable;
+        vlc_value_t val_name;
+        int i_error;
+
+        if( !strcmp( psz_cmd, "atrack" ) )
+        {
+            psz_variable = "audio-es";
+        }
+        else if( !strcmp( psz_cmd, "vtrack" ) )
+        {
+            psz_variable = "video-es";
+        }
+        else
+        {
+            psz_variable = "spu-es";
+        }
+
+        /* Get the descriptive name of the variable */
+        var_Change( p_input, psz_variable, VLC_VAR_GETTEXT,
+                     &val_name, NULL );
+        if( !val_name.psz_string ) val_name.psz_string = strdup(psz_variable);
+
+        if( newval.psz_string && *newval.psz_string )
+        {
+            /* set */
+            vlc_value_t val;
+            val.i_int = atoi( newval.psz_string );
+
+            i_error = var_Set( p_input, psz_variable, val );
+        }
+        else
+        {
+            /* get */
+            vlc_value_t val, text;
+            int i, i_value;
+
+            if ( var_Get( p_input, psz_variable, &val ) < 0 )
+            {
+                vlc_object_release( p_input );
+                return VLC_EGENERIC;
+            }
+            i_value = val.i_int;
+
+            if ( var_Change( p_input, psz_variable,
+                             VLC_VAR_GETLIST, &val, &text ) < 0 )
+            {
+                vlc_object_release( p_input );
+                return VLC_EGENERIC;
+            }
+
+            msg_rc( "+----[ %s ]", val_name.psz_string );
+            for ( i = 0; i < val.p_list->i_count; i++ )
+            {
+                if ( i_value == val.p_list->p_values[i].i_int )
+                    msg_rc( "| %i - %s *", val.p_list->p_values[i].i_int,
+                            text.p_list->p_values[i].psz_string );
+                else
+                    msg_rc( "| %i - %s", val.p_list->p_values[i].i_int,
+                            text.p_list->p_values[i].psz_string );
+            }
+            var_Change( p_input, psz_variable, VLC_VAR_FREELIST,
+                        &val, &text );
+            msg_rc( "+----[ end of %s ]", val_name.psz_string );
+
+            if( val_name.psz_string ) free( val_name.psz_string );
+
+            i_error = VLC_SUCCESS;
+        }
+        vlc_object_release( p_input );
+        return i_error;
+    }
 
     /* Never reached. */
     vlc_object_release( p_input );
@@ -1305,6 +1406,18 @@
                               PLAYLIST_GO|PLAYLIST_APPEND, PLAYLIST_END );
         }
     }
+    else if( !strcmp( psz_cmd, "enqueue" ) &&
+             newval.psz_string && *newval.psz_string )
+    {
+        playlist_item_t *p_item = parse_MRL( p_intf, newval.psz_string );
+
+        if( p_item )
+        {
+            msg_rc( "trying to enqueue %s to playlist", newval.psz_string );
+            playlist_AddItem( p_playlist, p_item,
+                              PLAYLIST_APPEND, PLAYLIST_END );
+        }
+    }
     else if( !strcmp( psz_cmd, "playlist" ) )
     {
         int i;
@@ -1827,6 +1940,126 @@
     return i_error;
 }
 
+
+static int VideoConfig( vlc_object_t *p_this, char const *psz_cmd,
+                        vlc_value_t oldval, vlc_value_t newval, void *p_data )
+{
+    intf_thread_t *p_intf = (intf_thread_t*)p_this;
+    input_thread_t *p_input = NULL;
+    vout_thread_t * p_vout;
+    const char * psz_variable;
+    vlc_value_t val_name;
+    int i_error;
+
+    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_ANYWHERE );
+    if( !p_input )
+        return VLC_ENOOBJ;
+
+    p_vout = vlc_object_find( p_input, VLC_OBJECT_VOUT, FIND_CHILD );
+    vlc_object_release( p_input );
+    if( !p_vout )
+        return VLC_ENOOBJ;
+
+    if( !strcmp( psz_cmd, "vcrop" ) )
+    {
+        psz_variable = "crop";
+    }
+    else if( !strcmp( psz_cmd, "vratio" ) )
+    {
+        psz_variable = "aspect-ratio";
+    }
+    else /* if( !strcmp( psz_cmd, "vzoom" ) ) */
+    {
+        psz_variable = "zoom";
+    }
+
+
+    /* Get the descriptive name of the variable */
+    var_Change( p_vout, psz_variable, VLC_VAR_GETTEXT,
+                 &val_name, NULL );
+    if( !val_name.psz_string ) val_name.psz_string = strdup(psz_variable);
+
+    if( newval.psz_string && *newval.psz_string )
+    {
+        /* set */
+        if( !strcmp( psz_variable, "zoom" ) )
+        {
+            vlc_value_t val;
+            val.f_float = atof( newval.psz_string );
+            i_error = var_Set( p_vout, psz_variable, val );
+        }
+        else
+        {
+            i_error = var_Set( p_vout, psz_variable, newval );
+        }
+    }
+    else
+    {
+        /* get */
+        vlc_value_t val, text;
+        int i;
+        float f_value;
+        char *psz_value = NULL;
+
+        if ( var_Get( p_vout, psz_variable, &val ) < 0 )
+        {
+            vlc_object_release( p_vout );
+            return VLC_EGENERIC;
+        }
+        if( !strcmp( psz_variable, "zoom" ) )
+        {
+            f_value = val.f_float;
+        }
+        else
+        {
+            psz_value = strdup( val.psz_string );
+        }
+
+        if ( var_Change( p_vout, psz_variable,
+                         VLC_VAR_GETLIST, &val, &text ) < 0 )
+        {
+            vlc_object_release( p_vout );
+            return VLC_EGENERIC;
+        }
+
+        msg_rc( "+----[ %s ]", val_name.psz_string );
+        if( !strcmp( psz_variable, "zoom" ) )
+        {
+            for ( i = 0; i < val.p_list->i_count; i++ )
+            {
+                if ( f_value == val.p_list->p_values[i].f_float )
+                    msg_rc( "| %f - %s *", val.p_list->p_values[i].f_float,
+                            text.p_list->p_values[i].psz_string );
+                else
+                    msg_rc( "| %f - %s", val.p_list->p_values[i].f_float,
+                            text.p_list->p_values[i].psz_string );
+            }
+        }
+        else
+        {
+            for ( i = 0; i < val.p_list->i_count; i++ )
+            {
+                if ( !strcmp( psz_value, val.p_list->p_values[i].psz_string ) )
+                    msg_rc( "| %s - %s *", val.p_list->p_values[i].psz_string,
+                            text.p_list->p_values[i].psz_string );
+                else
+                    msg_rc( "| %s - %s", val.p_list->p_values[i].psz_string,
+                            text.p_list->p_values[i].psz_string );
+            }
+            free( psz_value );
+        }
+        var_Change( p_vout, psz_variable, VLC_VAR_FREELIST,
+                    &val, &text );
+        msg_rc( "+----[ end of %s ]", val_name.psz_string );
+
+        if( val_name.psz_string ) free( val_name.psz_string );
+
+        i_error = VLC_SUCCESS;
+    }
+    vlc_object_release( p_vout );
+    return i_error;
+}
+
 static int AudioConfig( vlc_object_t *p_this, char const *psz_cmd,
                         vlc_value_t oldval, vlc_value_t newval, void *p_data )
 {
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/asf/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/asf/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/asf/Makefile.in	2006-09-18 06:30:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/asf/Makefile.in	2006-09-24 13:12:33.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/avi/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/avi/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/avi/Makefile.in	2006-09-18 06:30:46.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/avi/Makefile.in	2006-09-24 13:12:34.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/live555.cpp vlc_0.8.6-svn20060925.debian/modules/demux/live555.cpp
--- vlc_0.8.6-svn20060918.debian/modules/demux/live555.cpp	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/live555.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * live555.cpp : LIVE555 Streaming Media support.
  *****************************************************************************
  * Copyright (C) 2003-2006 the VideoLAN team
- * $Id: live555.cpp 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: live555.cpp 16768 2006-09-21 14:34:11Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
@@ -28,6 +28,7 @@
 
 #include <vlc/vlc.h>
 #include <vlc/input.h>
+
 #include "network.h"
 
 #include <iostream>
@@ -106,24 +107,16 @@
                   N_("Port to use for tunneling the RTSP/RTP over HTTP."),
                   VLC_TRUE );
 #endif
-        add_integer( "rtsp-caching", 4 * DEFAULT_PTS_DELAY / 1000, NULL,
-                  CACHING_TEXT, CACHING_LONGTEXT, VLC_TRUE );
-        add_bool( "rtsp-kasenna", VLC_FALSE, NULL, KASENNA_TEXT,
-                  KASENNA_LONGTEXT, VLC_TRUE );
+        add_integer("rtsp-caching", 4 * DEFAULT_PTS_DELAY / 1000, NULL,
+                    CACHING_TEXT, CACHING_LONGTEXT, VLC_TRUE );
+        add_bool(   "rtsp-kasenna", VLC_FALSE, NULL, KASENNA_TEXT,
+                    KASENNA_LONGTEXT, VLC_TRUE );
         add_string( "rtsp-user", NULL, NULL, USER_TEXT,
-                USER_LONGTEXT, VLC_TRUE );
+                    USER_LONGTEXT, VLC_TRUE );
         add_string( "rtsp-pwd", NULL, NULL, PASS_TEXT,
-                PASS_LONGTEXT, VLC_TRUE );
+                    PASS_LONGTEXT, VLC_TRUE );
 vlc_module_end();
 
-/* TODO:
- *  - Improve support of PS/TS
- *  - Support X-QT/X-QUICKTIME generic codec for audio.
- *
- *  - Check memory leak, delete/free -> still one when using rtsp-tcp but I'm
- *  not sure if it comes from me.
- *
- */
 
 /*****************************************************************************
  * Local prototypes
@@ -151,7 +144,7 @@
 
     char         waiting;
 
-    mtime_t      i_pts;
+    int64_t      i_pts;
 
 } live_track_t;
 
@@ -165,8 +158,8 @@
 
 struct demux_sys_t
 {
-    char         *p_sdp;    /* XXX mallocated */
-    char         *psz_path; /* URL-encoded path */
+    char            *p_sdp;    /* XXX mallocated */
+    char            *psz_path; /* URL-encoded path */
 
     MediaSession     *ms;
     TaskScheduler    *scheduler;
@@ -176,10 +169,10 @@
     /* */
     int              i_track;
     live_track_t     **track;   /* XXX mallocated */
-    mtime_t          i_pcr;
-    mtime_t          i_pcr_start;
-    mtime_t          i_pcr_previous;
-    mtime_t          i_pcr_repeatdate;
+    int64_t          i_pcr;
+    int64_t          i_pcr_start;
+    int64_t          i_pcr_previous;
+    int64_t          i_pcr_repeatdate;
     int              i_pcr_repeats;
 
     /* Asf */
@@ -187,8 +180,8 @@
     stream_t         *p_out_asf;
 
     /* */
-    mtime_t          i_length;
-    mtime_t          i_start;
+    int64_t          i_length;
+    int64_t          i_start;
 
     /* timeout thread information */
     int              i_timeout;     /* session timeout value in seconds */
@@ -206,12 +199,15 @@
 static int Demux  ( demux_t * );
 static int Control( demux_t *, int, va_list );
 
-static int ParseASF( demux_t * );
-static int RollOverTcp( demux_t * );
-
-static void StreamRead( void *, unsigned int, unsigned int,
-                        struct timeval, unsigned int );
-static void StreamClose( void * );
+static int Connect      ( demux_t * );
+static int SessionsSetup( demux_t * );
+static int Play         ( demux_t *);
+static int ParseASF     ( demux_t * );
+static int RollOverTcp  ( demux_t * );
+
+static void StreamRead  ( void *, unsigned int, unsigned int,
+                          struct timeval, unsigned int );
+static void StreamClose ( void * );
 static void TaskInterrupt( void * );
 
 static void TimeoutPrevention( timeout_thread_t * );
@@ -228,24 +224,16 @@
 {
     demux_t     *p_demux = (demux_t*)p_this;
     demux_sys_t *p_sys = NULL;
-
-    MediaSubsessionIterator *iter;
-    MediaSubsession *sub;
-
-    vlc_bool_t b_rtsp_tcp;
-    uint8_t *p_peek;
-
-    char    *psz_user = NULL;
-    char    *psz_pwd  = NULL;
-
-    int     i_sdp;
-    int     i_sdp_max;
-    uint8_t *p_sdp;
+    
+    MediaSubsessionIterator *iter   = NULL;
+    MediaSubsession         *sub    = NULL;
+    int i_return;
 
     if( p_demux->s )
     {
         /* See if it looks like a SDP
            v, o, s fields are mandatory and in this order */
+        uint8_t *p_peek;
         if( stream_Peek( p_demux->s, &p_peek, 7 ) < 7 ) return VLC_EGENERIC;
 
         if( memcmp( (char*)p_peek, "v=0\r\n", 5 ) &&
@@ -286,8 +274,7 @@
     p_sys->i_timeout = 0;
     p_sys->b_timeout_call = VLC_FALSE;
     p_sys->b_multicast = VLC_FALSE;
-    p_sys->psz_path = strdup(p_demux->psz_path);
-
+    p_sys->psz_path = strdup( p_demux->psz_path );
 
     if( ( p_sys->scheduler = BasicTaskScheduler::createNew() ) == NULL )
     {
@@ -306,68 +293,13 @@
         while( (p = strchr( p, ' ' )) != NULL ) *p = '+';
     }
 
-    if( p_demux->s == NULL && !strcasecmp( p_demux->psz_access, "rtsp" ) )
-    {
-        char *psz_url;
-        char *psz_options;
-#if LIVEMEDIA_LIBRARY_VERSION_INT > 1130457500
-        int i_http_port = 0;
-
-        if( var_CreateGetBool( p_demux, "rtsp-http" ) )
-            i_http_port = var_CreateGetInteger( p_demux, "rtsp-http-port" );
-
-        if( ( p_sys->rtsp = RTSPClient::createNew(*p_sys->env, 1/*verbose*/,
-              "VLC media player", i_http_port ) ) == NULL )
-#else
-        if( ( p_sys->rtsp = RTSPClient::createNew(*p_sys->env, 1/*verbose*/,
-              "VLC media player" ) ) == NULL )
-#endif
-        {
-            msg_Err( p_demux, "RTSPClient::createNew failed (%s)",
-                     p_sys->env->getResultMsg() );
-            goto error;
-        }
-        psz_url = (char*)malloc( strlen( p_sys->psz_path ) + 8 );
-        sprintf( psz_url, "rtsp://%s", p_sys->psz_path );
-
-        psz_options = p_sys->rtsp->sendOptionsCmd( psz_url );
-        if( psz_options ) delete [] psz_options;
-
-        psz_user = var_CreateGetString( p_demux, "rtsp-user" );
-        psz_pwd  = var_CreateGetString( p_demux, "rtsp-pwd" );
-
-        if ((*psz_user) && (*psz_pwd))
-            p_sdp = (uint8_t*)p_sys->rtsp->describeWithPassword( psz_url,
-                               psz_user, psz_pwd);
-        else
-            p_sdp = (uint8_t*)p_sys->rtsp->describeURL( psz_url,
-                               NULL, var_CreateGetBool( p_demux, "rtsp-kasenna" ) );
-        if( p_sdp == NULL )
-        {
-            msg_Err( p_demux, "describeURL failed (%s)",
-                     p_sys->env->getResultMsg() );
-            free( psz_url );
-            goto error;
-        }
-        free( psz_url );
-        free( psz_user );
-        free( psz_pwd );
-
-        /* malloc-ated copy */
-        p_sys->p_sdp = strdup( (char*)p_sdp );
-        delete[] p_sdp;
-        msg_Dbg( p_demux, "sdp=%s\n", p_sys->p_sdp );
-    }
-    else if( p_demux->s == NULL && !strcasecmp( p_demux->psz_access, "sdp" ) )
-    {
-        p_sys->p_sdp = strdup( p_sys->psz_path );
-    }
-    else
+    if( p_demux->s != NULL )
     {
         /* Gather the complete sdp file */
-        i_sdp = 0;
-        i_sdp_max = 1000;
-        p_sdp = (uint8_t*)malloc( i_sdp_max );
+        int     i_sdp       = 0;
+        int     i_sdp_max   = 1000;
+        uint8_t *p_sdp      = (uint8_t*) malloc( i_sdp_max );
+        
         for( ;; )
         {
             int i_read = stream_Read( p_demux->s, &p_sdp[i_sdp],
@@ -392,119 +324,53 @@
             p_sdp = (uint8_t*)realloc( p_sdp, i_sdp_max );
         }
         p_sys->p_sdp = (char*)p_sdp;
-
-        msg_Dbg( p_demux, "sdp=%s\n", p_sys->p_sdp );
     }
-    if( !( p_sys->ms = MediaSession::createNew( *p_sys->env, p_sys->p_sdp ) ) )
+    else if( p_demux->s == NULL && !strcasecmp( p_demux->psz_access, "sdp" ) )
+    {
+        /* sdp:// link from SAP */
+        p_sys->p_sdp = strdup( p_sys->psz_path );
+    }
+    else if( ( i_return = Connect( p_demux ) ) != VLC_SUCCESS )
     {
-        msg_Err( p_demux, "MediaSession::createNew failed" );
+        msg_Err( p_demux, "Failed to connect with rtsp://%s", p_sys->psz_path );
         goto error;
     }
-
-    b_rtsp_tcp = var_CreateGetBool( p_demux, "rtsp-tcp" );
-
-    /* Initialise each media subsession */
-    iter = new MediaSubsessionIterator( *p_sys->ms );
-    while( ( sub = iter->next() ) != NULL )
+    
+    if( p_sys->p_sdp == NULL )
     {
-        unsigned int i_buffer = 0;
-        Boolean bInit;
-        int i_client_port;
-
-        i_client_port = var_CreateGetInteger( p_demux, "rtp-client-port" );
-        if( i_client_port != -1 )
-            sub->setClientPortNum( i_client_port );
-
-        /* Value taken from mplayer */
-        if( !strcmp( sub->mediumName(), "audio" ) )
-            i_buffer = 100000;
-        else if( !strcmp( sub->mediumName(), "video" ) )
-            i_buffer = 2000000;
-        else
-            continue;
-
-        if( !strcmp( sub->codecName(), "X-ASF-PF" ) )
-            bInit = sub->initiate( 4 ); /* Constant ? */
-        else
-            bInit = sub->initiate();
-
-        if( strcasestr( sub->codecName(), "REAL" ) )
-        {
-            msg_Info( p_demux, "real codec detected, using real-RTSP instead" );
-            delete iter;
-            goto error; 
-        }
-
-        if( !bInit )
-        {
-            msg_Warn( p_demux, "RTP subsession '%s/%s' failed (%s)",
-                      sub->mediumName(), sub->codecName(),
-                      p_sys->env->getResultMsg() );
-        }
-        else
-        {
-            if( sub->rtpSource() )
-            {
-                int fd = sub->rtpSource()->RTPgs()->socketNum();
-                /* Increase the buffer size */
-                increaseReceiveBufferTo( *p_sys->env, fd, i_buffer );
-            }
-
-            msg_Dbg( p_demux, "RTP subsession '%s/%s'", sub->mediumName(),
-                     sub->codecName() );
-
-            /* Issue the SETUP */
-            if( p_sys->rtsp )
-            {
-                p_sys->rtsp->setupMediaSubsession( *sub, False,
-                                                   b_rtsp_tcp ? True : False );
-            }
-            if( !p_sys->b_multicast )
-            {
-                /* Check, because we need diff. rollover behaviour for multicast */
-                p_sys->b_multicast = IsMulticastAddress( sub->connectionEndpointAddress() );
-            }
-        }
+        msg_Err( p_demux, "Failed to retrieve the RTSP Session Description" );
+        goto error;
     }
 
-    if( p_sys->rtsp )
+    /* Create the session from the SDP */
+    if( !( p_sys->ms = MediaSession::createNew( *p_sys->env, p_sys->p_sdp ) ) )
     {
-        /* The PLAY */
-        if( !p_sys->rtsp->playMediaSession( *p_sys->ms ) )
-        {
-            msg_Err( p_demux, "PLAY failed %s", p_sys->env->getResultMsg() );
-            delete iter;
-            goto error;
-        }
-
-        /* Retrieve the timeout value and set up a timeout prevention thread */
-#if LIVEMEDIA_LIBRARY_VERSION_INT >= 1138089600
-        p_sys->i_timeout = p_sys->rtsp->sessionTimeoutParameter();
-#endif
-        if( p_sys->i_timeout > 0 )
-        {
-            msg_Dbg( p_demux, "We have a timeout of %d seconds",  p_sys->i_timeout );
-            p_sys->p_timeout = (timeout_thread_t *)vlc_object_create( p_demux, sizeof(timeout_thread_t) );
-            p_sys->p_timeout->p_sys = p_demux->p_sys; /* lol, object recursion :D */
-            if( vlc_thread_create( p_sys->p_timeout, "liveMedia-timeout", TimeoutPrevention,
-                                   VLC_THREAD_PRIORITY_LOW, VLC_TRUE ) )
-            {
-                msg_Err( p_demux, "cannot spawn liveMedia timeout thread" );
-                delete iter;
-                vlc_object_destroy( p_sys->p_timeout );
-                goto error;
-            }
-            msg_Dbg( p_demux, "spawned timeout thread" );
-            vlc_object_attach( p_sys->p_timeout, p_demux );
-        }
+        msg_Err( p_demux, "Could not create the RTSP Session: %s",
+            p_sys->env->getResultMsg() );
+        goto error;
     }
+    
+    if( ( i_return = SessionsSetup( p_demux ) ) != VLC_SUCCESS )
+    {
+        msg_Err( p_demux, "Nothing to play for rtsp://%s", p_sys->psz_path );
+        goto error;
+    }
+
+    /* Retrieve the duration if possible */
+    p_sys->i_length = (int64_t)( p_sys->ms->playEndTime() * 1000000.0 );
+    if( p_sys->i_length < 0 )
+        p_sys->i_length = -1;
 
+    if( ( i_return = Play( p_demux ) ) != VLC_SUCCESS )
+        goto error;
+    
     /* Create all es struct */
-    iter->reset();
+    iter = new MediaSubsessionIterator( *p_sys->ms );
     while( ( sub = iter->next() ) != NULL )
     {
         live_track_t *tk;
 
+        /* Check if we will receive data from this subsession for this track */
         if( sub->readSource() == NULL ) continue;
 
         tk = (live_track_t*)malloc( sizeof( live_track_t ) );
@@ -648,7 +514,7 @@
                 unsigned int i_extra = 0;
                 uint8_t      *p_extra = NULL;
 #endif
-                tk->fmt.i_codec = VLC_FOURCC( 'H', '2', '6', '4' );
+                tk->fmt.i_codec = VLC_FOURCC( 'h', '2', '6', '4' );
                 tk->fmt.b_packetized = VLC_FALSE;
 
                 /* XXX not the right minimal version I fear */
@@ -713,7 +579,10 @@
             }
         }
 
-        tk->p_es = es_out_Add( p_demux->out, &tk->fmt );
+        if( !tk->b_quicktime && !tk->b_muxed && !tk->b_asf )
+        {
+            tk->p_es = es_out_Add( p_demux->out, &tk->fmt );
+        }
 
         if( sub->rtcpInstance() != NULL )
         {
@@ -724,13 +593,15 @@
         {
             tk->readSource = sub->readSource();
             tk->rtpSource  = sub->rtpSource();
-
+            
             /* Append */
             p_sys->track = (live_track_t**)realloc( p_sys->track, sizeof( live_track_t ) * ( p_sys->i_track + 1 ) );
             p_sys->track[p_sys->i_track++] = tk;
         }
         else
         {
+            /* BUG ??? */
+            msg_Err( p_demux, "unusable RTSP track. this should not happen" );
             free( tk );
         }
     }
@@ -744,29 +615,15 @@
         goto error;
     }
 
-    p_sys->i_length = (mtime_t)(p_sys->ms->playEndTime() * 1000000.0);
-    if( p_sys->i_length < 0 )
-    {
-        p_sys->i_length = 0;
-    }
-    else if( p_sys->i_length > 0 )
-    {
-        /* FIXME */
-        /* p_input->stream.p_selected_area->i_size = 1000;*/ /* needed for now */
-    }
-
     if( p_sys->i_track <= 0 )
-    {
-        msg_Err( p_demux, "no codec supported, aborting" );
         goto error;
-    }
 
     return VLC_SUCCESS;
 
 error:
     if( p_sys->p_out_asf ) stream_DemuxDelete( p_sys->p_out_asf );
     if( p_sys->ms ) Medium::close( p_sys->ms );
-    if( p_sys->rtsp ) Medium::close( p_sys->rtsp );
+    if( p_sys->rtsp ) RTSPClient::close( p_sys->rtsp );
     if( p_sys->env ) RECLAIM_ENV(p_sys->env);
     if( p_sys->p_timeout )
     {
@@ -820,8 +677,8 @@
         vlc_object_destroy( p_sys->p_timeout );
     }
 
-    if( p_sys->rtsp ) Medium::close( p_sys->rtsp );
-    if( p_sys->env ) RECLAIM_ENV(p_sys->env);
+    if( p_sys->rtsp ) RTSPClient::close( p_sys->rtsp );
+    if( p_sys->env ) RECLAIM_ENV( p_sys->env );
     if( p_sys->scheduler ) delete p_sys->scheduler;
     if( p_sys->p_sdp ) free( p_sys->p_sdp );
     if( p_sys->psz_path ) free( p_sys->psz_path );
@@ -829,6 +686,227 @@
 }
 
 /*****************************************************************************
+ * Connect: connects to the RTSP server to setup the session DESCRIBE
+ *****************************************************************************/
+static int Connect( demux_t *p_demux )
+{
+    demux_sys_t *p_sys = p_demux->p_sys;
+    Authenticator authenticator;
+
+    char *psz_user    = NULL;
+    char *psz_pwd     = NULL;
+    char *psz_url     = NULL;
+    char *psz_options = NULL;
+    char *p_sdp       = NULL;
+    int  i_http_port  = 0;
+    int  i_ret        = VLC_SUCCESS;
+
+createnew:
+    if( var_CreateGetBool( p_demux, "rtsp-http" ) )
+        i_http_port = var_CreateGetInteger( p_demux, "rtsp-http-port" );
+
+#if LIVEMEDIA_LIBRARY_VERSION_INT > 1130457500
+    if( ( p_sys->rtsp = RTSPClient::createNew(*p_sys->env, 1 /*verbose*/,
+          "VLC media player", i_http_port ) ) == NULL )
+#else
+    if( ( p_sys->rtsp = RTSPClient::createNew(*p_sys->env, 1 /*verbose*/,
+          "VLC media player" ) ) == NULL )
+#endif
+    {
+        msg_Err( p_demux, "RTSPClient::createNew failed (%s)",
+                 p_sys->env->getResultMsg() );
+        return VLC_EGENERIC;
+    }
+    psz_url = (char*)malloc( strlen( p_sys->psz_path ) + 8 );
+    sprintf( psz_url, "rtsp://%s", p_sys->psz_path );
+
+    psz_options = p_sys->rtsp->sendOptionsCmd( psz_url );
+    if( psz_options ) delete [] psz_options;
+
+    psz_user = var_CreateGetString( p_demux, "rtsp-user" );
+    psz_pwd  = var_CreateGetString( p_demux, "rtsp-pwd" );
+
+describe:
+    authenticator.setUsernameAndPassword( (const char*)psz_user, (const char*)psz_pwd );
+    p_sdp = p_sys->rtsp->describeURL( psz_url,
+                &authenticator, var_CreateGetBool( p_demux, "rtsp-kasenna" ) );
+
+    if( psz_user ) free( psz_user );
+    if( psz_pwd ) free( psz_pwd );                
+    
+    if( p_sdp == NULL )
+    {
+        /* failure occured */
+        int i_code = 0;
+        const char *psz_error = p_sys->env->getResultMsg();
+                
+        msg_Dbg( p_demux, "DESCRIBE failed with %d: %s", i_code, psz_error );
+        sscanf( psz_error, "%*sRTSP/%*s%3u", &i_code );
+        
+        if( i_code == 401 )
+        {
+            msg_Err( p_demux, "RTSP authentication failed" );
+        }
+        else if( !var_CreateGetBool( p_demux, "rtsp-http" ) )
+        {
+            /* Perhaps a firewall is being annoying. Try HTTP tunneling mode */
+            vlc_value_t val;
+            val.b_bool = VLC_TRUE;
+            msg_Dbg( p_demux, "we will now try HTTP tunneling mode" );
+            var_Set( p_demux, "rtsp-http", val );
+            if( psz_url ) free( psz_url );
+            if( p_sys->rtsp ) RTSPClient::close( p_sys->rtsp );
+            goto createnew;
+        }
+        i_ret = VLC_EGENERIC;
+    }
+    if( psz_url ) free( psz_url );
+
+    /* malloc-ated copy */
+    if( p_sys->p_sdp ) free( p_sys->p_sdp );
+    if( p_sdp ) p_sys->p_sdp = strdup( (char*)p_sdp );
+    delete[] p_sdp;
+
+    return i_ret;
+}
+
+/*****************************************************************************
+ * Connect: prepares the subsessions and does the SETUP
+ *****************************************************************************/
+static int SessionsSetup( demux_t *p_demux )
+{
+    demux_sys_t             *p_sys  = p_demux->p_sys;
+    MediaSubsessionIterator *iter   = NULL;
+    MediaSubsession         *sub    = NULL;
+
+    vlc_bool_t     b_rtsp_tcp = VLC_FALSE;
+    int            i_client_port;
+    int            i_active_sessions = 0;
+    int            i_return = VLC_SUCCESS;
+    unsigned int   i_buffer = 0;
+    unsigned const thresh = 200000; /* RTP reorder threshold .2 second (default .1) */
+
+    b_rtsp_tcp    = var_CreateGetBool( p_demux, "rtsp-tcp" );
+    i_client_port = var_CreateGetInteger( p_demux, "rtp-client-port" );
+
+    /* Initialise each media subsession */
+    iter = new MediaSubsessionIterator( *p_sys->ms );
+    while( ( sub = iter->next() ) != NULL )
+    {
+        Boolean bInit;
+
+        /* Value taken from mplayer */
+        if( !strcmp( sub->mediumName(), "audio" ) )
+            i_buffer = 100000;
+        else if( !strcmp( sub->mediumName(), "video" ) )
+            i_buffer = 2000000;
+        else continue;
+
+        if( i_client_port != -1 )
+        {
+            sub->setClientPortNum( i_client_port );
+            i_client_port += 2;
+        }
+
+        if( strcasestr( sub->codecName(), "REAL" ) )
+        {
+            msg_Info( p_demux, "real codec detected, using real-RTSP instead" );
+            i_return = VLC_EGENERIC;
+            break;
+        }
+
+        if( !strcmp( sub->codecName(), "X-ASF-PF" ) )
+            bInit = sub->initiate( 4 ); /* Constant ? */
+        else
+            bInit = sub->initiate();
+        
+        if( !bInit )
+        {
+            msg_Warn( p_demux, "RTP subsession '%s/%s' failed (%s)",
+                      sub->mediumName(), sub->codecName(),
+                      p_sys->env->getResultMsg() );
+        }
+        else
+        {
+            if( sub->rtpSource() != NULL )
+            {
+                int fd = sub->rtpSource()->RTPgs()->socketNum();
+          
+                /* Increase the buffer size */
+                if( i_buffer > 0 )
+                    increaseReceiveBufferTo( *p_sys->env, fd, i_buffer );
+                
+                /* Increase the RTP reorder timebuffer just a bit */
+                sub->rtpSource()->setPacketReorderingThresholdTime(thresh);
+            }
+
+            msg_Dbg( p_demux, "RTP subsession '%s/%s'", sub->mediumName(),
+                     sub->codecName() );
+
+            /* Issue the SETUP */
+            if( p_sys->rtsp )
+            {
+                if( !( p_sys->rtsp->setupMediaSubsession( *sub, False,
+                                                   b_rtsp_tcp ? True : False ) ) )
+                {
+                    msg_Err( p_demux, "SETUP of'%s/%s' failed %s", sub->mediumName(),
+                             sub->codecName(), p_sys->env->getResultMsg() );
+                }
+                else i_active_sessions++;
+            } else i_active_sessions++; /* we don't really know, let's just hope it's there */
+
+            if( !p_sys->b_multicast )
+            {
+                /* Check, because we need diff. rollover behaviour for multicast */
+                p_sys->b_multicast = IsMulticastAddress( sub->connectionEndpointAddress() );
+            }
+        }
+    }
+    delete iter;
+    if( i_active_sessions <= 0 ) i_return = VLC_EGENERIC;
+    return i_return;
+}
+
+/*****************************************************************************
+ * Play: starts the actual playback of the stream
+ *****************************************************************************/
+static int Play( demux_t *p_demux )
+{
+    demux_sys_t *p_sys = p_demux->p_sys;
+    
+    if( p_sys->rtsp )
+    {
+        /* The PLAY */
+        if( !p_sys->rtsp->playMediaSession( *p_sys->ms ) )
+        {
+            msg_Err( p_demux, "RTSP PLAY failed %s", p_sys->env->getResultMsg() );
+            return VLC_EGENERIC;
+        }
+
+        /* Retrieve the timeout value and set up a timeout prevention thread */
+#if LIVEMEDIA_LIBRARY_VERSION_INT >= 1138089600
+        p_sys->i_timeout = p_sys->rtsp->sessionTimeoutParameter();
+#endif
+        if( p_sys->i_timeout > 0 && !p_sys->p_timeout )
+        {
+            msg_Dbg( p_demux, "We have a timeout of %d seconds",  p_sys->i_timeout );
+            p_sys->p_timeout = (timeout_thread_t *)vlc_object_create( p_demux, sizeof(timeout_thread_t) );
+            p_sys->p_timeout->p_sys = p_demux->p_sys; /* lol, object recursion :D */
+            if( vlc_thread_create( p_sys->p_timeout, "liveMedia-timeout", TimeoutPrevention,
+                                   VLC_THREAD_PRIORITY_LOW, VLC_TRUE ) )
+            {
+                msg_Err( p_demux, "cannot spawn liveMedia timeout thread" );
+                vlc_object_destroy( p_sys->p_timeout );
+            }
+            msg_Dbg( p_demux, "spawned timeout thread" );
+            vlc_object_attach( p_sys->p_timeout, p_demux );
+        }
+    }
+    return VLC_SUCCESS;
+}
+
+
+/*****************************************************************************
  * Demux:
  *****************************************************************************/
 static int Demux( demux_t *p_demux )
@@ -837,7 +915,7 @@
     TaskToken      task;
 
     vlc_bool_t      b_send_pcr = VLC_TRUE;
-    mtime_t         i_pcr = 0;
+    int64_t         i_pcr = 0;
     int             i;
 
     /* Check if we need to send the server a Keep-A-Live signal */
@@ -879,6 +957,9 @@
         }
     }
 
+#if 0
+    /* Disabled because it's simply not reliable enough */
+
     /* When a On Demand QT stream ends, the last frame keeps going with the same PCR/PTS value */
     /* This tests for that, so we can later decide to end this session */
     if( i_pcr > 0 && p_sys->i_pcr == p_sys->i_pcr_previous )
@@ -900,8 +981,9 @@
         msg_Dbg( p_demux, "suspect EOF due to end of VoD session" );
         return 0;
     }
+#endif
 
-    /* First warm we want to read data */
+    /* First warn we want to read data */
     p_sys->event = 0;
     for( i = 0; i < p_sys->i_track; i++ )
     {
@@ -963,7 +1045,6 @@
                 msg_Err( p_demux, "TCP rollover failed, aborting" );
                 return 0;
             }
-            var_SetBool( p_demux, "rtsp-tcp", VLC_TRUE );
         }
         else if( p_sys->i_no_data_ti > 34 )
         {
@@ -971,11 +1052,11 @@
             return 0;
         }
     }
-    else if( !p_sys->b_multicast && p_sys->b_no_data&& p_sys->i_no_data_ti > 34 )
+    else if( !p_sys->b_multicast && p_sys->b_no_data && p_sys->i_no_data_ti > 34 )
     {
         /* EOF ? */
         msg_Warn( p_demux, "no data received in 10s, eof ?" );
-	return 0;
+        return 0;
     }
 
     return p_demux->b_error ? 0 : 1;
@@ -1012,33 +1093,31 @@
             }
             else
             {
-                *pf = 0;
+                *pf = 0.0;
             }
             return VLC_SUCCESS;
 
         case DEMUX_SET_POSITION:
-        {
             float time;
 
             f = (double)va_arg( args, double );
-            time = f * (double)p_sys->i_length / 1000000.0;   /* in second */
-
+            
             if( p_sys->rtsp && p_sys->i_length > 0 )
             {
+                time = f * (double)p_sys->i_length / 1000000.0;   /* in second */
                 if( !p_sys->rtsp->playMediaSession( *p_sys->ms, time ) )
                 {
                     msg_Err( p_demux, "PLAY failed %s",
                         p_sys->env->getResultMsg() );
                     return VLC_EGENERIC;
                 }
-                p_sys->i_start = (mtime_t)(f * (double)p_sys->i_length);
+                p_sys->i_start = (int64_t)(f * (double)p_sys->i_length);
                 p_sys->i_pcr_start = 0;
                 p_sys->i_pcr       = 0;
 
                 return VLC_SUCCESS;
             }
             return VLC_SUCCESS;
-        }
 
         /* Special for access_demux */
         case DEMUX_CAN_PAUSE:
@@ -1111,103 +1190,59 @@
 static int RollOverTcp( demux_t *p_demux )
 {
     demux_sys_t *p_sys = p_demux->p_sys;
-    MediaSubsessionIterator *iter;
+    MediaSubsessionIterator *iter = 0;
     MediaSubsession *sub;
-    char *psz_url;
-    char *psz_options;
-    char *psz_user;
-    char *psz_pwd;
-    uint8_t *p_sdp;
     int i_tk;
+    int i_return;
 
+    var_SetBool( p_demux, "rtsp-tcp", VLC_TRUE );
+    
     /* We close the old RTSP session */
     p_sys->rtsp->teardownMediaSession( *p_sys->ms );
 
     Medium::close( p_sys->ms );
-    Medium::close( p_sys->rtsp );
+    RTSPClient::close( p_sys->rtsp );
 
     p_sys->ms = NULL;
     p_sys->rtsp = NULL;
 
     /* Reopen rtsp client */
-    if( ( p_sys->rtsp = RTSPClient::createNew(*p_sys->env, 1/*verbose*/,
-          "VLC media player" ) ) == NULL )
+    if( ( i_return = Connect( p_demux ) ) != VLC_SUCCESS )
     {
-        msg_Err( p_demux, "RTSPClient::createNew failed (%s)",
-                 p_sys->env->getResultMsg() );
-        return VLC_EGENERIC;
+        msg_Err( p_demux, "Failed to connect with rtsp://%s", p_sys->psz_path );
+        goto error;
     }
-
-    asprintf( &psz_url, "rtsp://%s", p_sys->psz_path );
-
-    if( ( psz_options = p_sys->rtsp->sendOptionsCmd( psz_url ) ) )
-        delete [] psz_options;
-
-    psz_user = var_CreateGetString( p_demux, "rtsp-user" );
-    psz_pwd  = var_CreateGetString( p_demux, "rtsp-pwd" );
-
-    if ((*psz_user) && (*psz_pwd))
-        p_sdp = (uint8_t*)p_sys->rtsp->describeWithPassword( psz_url,
-                            psz_user, psz_pwd);
-    else
-        p_sdp = (uint8_t*)p_sys->rtsp->describeURL( psz_url,
-                            NULL, var_CreateGetBool( p_demux, "rtsp-kasenna" ) );
-
-    free( psz_url );
-    free( psz_user );
-    free( psz_pwd );
-
-    if( p_sdp == NULL )
+    
+    if( p_sys->p_sdp == NULL )
     {
-        msg_Err( p_demux, "describeURL failed (%s)",
-                 p_sys->env->getResultMsg() );
-        return VLC_EGENERIC;
+        msg_Err( p_demux, "Failed to retrieve the RTSP Session Description" );
+        goto error;
     }
 
-    /* malloc-ated copy */
-    p_sys->p_sdp = strdup( (char*)p_sdp );
-    delete[] p_sdp;
-
+    /* Create the session from the SDP */
     if( !( p_sys->ms = MediaSession::createNew( *p_sys->env, p_sys->p_sdp ) ) )
     {
-        msg_Err( p_demux, "MediaSession::createNew failed" );
-        return VLC_EGENERIC;
+        msg_Err( p_demux, "Could not create the RTSP Session: %s",
+            p_sys->env->getResultMsg() );
+        goto error;
     }
 
-    /* Initialise each media subsession */
-    iter = new MediaSubsessionIterator( *p_sys->ms );
-    while( ( sub = iter->next() ) != NULL )
+    if( ( i_return = SessionsSetup( p_demux ) ) != VLC_SUCCESS )
     {
-        Boolean bInit;
-
-        if( !strcmp( sub->codecName(), "X-ASF-PF" ) )
-            bInit = sub->initiate( 4 ); /* Constant ? */
-        else
-            bInit = sub->initiate();
-
-        if( !bInit )
-        {
-            msg_Warn( p_demux, "RTP subsession '%s/%s' failed (%s)",
-                      sub->mediumName(), sub->codecName(),
-                      p_sys->env->getResultMsg() );
-            continue;
-        }
-        msg_Dbg( p_demux, "RTP subsession '%s/%s'", sub->mediumName(),
-                 sub->codecName() );
-
-        /* Issue the SETUP */
-        p_sys->rtsp->setupMediaSubsession( *sub, False, True /* tcp */ );
+        msg_Err( p_demux, "Nothing to play for rtsp://%s", p_sys->psz_path );
+        goto error;
     }
 
-    /* The PLAY */
-    if( !p_sys->rtsp->playMediaSession( *p_sys->ms ) )
-    {
-        msg_Err( p_demux, "PLAY failed %s", p_sys->env->getResultMsg() );
-        return VLC_EGENERIC;
-    }
+    /* Retrieve the duration if possible */
+    p_sys->i_length = (int64_t)( p_sys->ms->playEndTime() * 1000000.0 );
+    if( p_sys->i_length < 0 )
+        p_sys->i_length = -1;
+
+    if( ( i_return = Play( p_demux ) ) != VLC_SUCCESS )
+        goto error;
 
     /* Update all tracks */
-    iter->reset();
+    iter = new MediaSubsessionIterator( *p_sys->ms );
     i_tk = 0;
     while( ( sub = iter->next() ) != NULL )
     {
@@ -1218,7 +1253,7 @@
         if( i_tk >= p_sys->i_track )
         {
             msg_Err( p_demux, "WTF !" );
-            break;
+            goto error;
         }
 
         tk = p_sys->track[i_tk];
@@ -1236,10 +1271,13 @@
 
         i_tk++;
     }
-
     delete iter;
 
     return VLC_SUCCESS;
+
+error:
+    if( iter ) delete iter;
+    return VLC_EGENERIC;
 }
 
 
@@ -1255,7 +1293,7 @@
     demux_sys_t    *p_sys = p_demux->p_sys;
     block_t        *p_block;
 
-    mtime_t i_pts = (uint64_t)pts.tv_sec * UI64C(1000000) +
+    int64_t i_pts = (uint64_t)pts.tv_sec * UI64C(1000000) +
         (uint64_t)pts.tv_usec;
 
     /* XXX Beurk beurk beurk Avoid having negative value XXX */
@@ -1340,7 +1378,7 @@
         if( tk->rtpSource->curPacketMarkerBit() )
             p_block->i_flags |= BLOCK_FLAG_END_OF_FRAME;
     }
-    else if( tk->fmt.i_codec == VLC_FOURCC('H','2','6','4') )
+    else if( tk->fmt.i_codec == VLC_FOURCC('h','2','6','4') )
     {
         if( (tk->p_buffer[0] & 0x1f) >= 24 )
             msg_Warn( p_demux, "unsupported NAL type for H264" );
@@ -1366,8 +1404,6 @@
         memcpy( p_block->p_buffer, tk->p_buffer, i_size );
     }
 
-    //p_block->i_rate = p_input->stream.control.i_rate;
-
     if( i_pts != tk->i_pts && !tk->b_muxed )
     {
         p_block->i_dts = ( tk->fmt.i_cat == VIDEO_ES ) ? 0 : i_pts;
@@ -1387,7 +1423,7 @@
         es_out_Send( p_demux->out, tk->p_es, p_block );
     }
 
-    /* warm that's ok */
+    /* warn that's ok */
     p_sys->event = 0xff;
 
     /* we have read data */
@@ -1512,6 +1548,7 @@
                                           unsigned int& configSize )
 {
     char *dup, *psz;
+    int i, i_records = 1;
 
     if( configSize )
     configSize = 0;
@@ -1521,22 +1558,27 @@
 
     psz = dup = strdup( configStr );
 
-    unsigned char *cfg = new unsigned char[5 * strlen(psz)];
-    for( ;; )
+    /* Count the number of comma's */
+    for( psz = dup; *psz != '\0'; ++psz )
     {
-        char *p = strchr( psz, ',' );
-        if( p )
-            *p++ = '\0';
+        if( *psz == ',')
+        {
+            ++i_records;
+            *psz = '\0';
+        }
+    }
 
+    unsigned char *cfg = new unsigned char[5 * strlen(dup)];
+    psz = dup;
+    for( i = 0; i < i_records; i++ )
+    {
         cfg[configSize++] = 0x00;
         cfg[configSize++] = 0x00;
         cfg[configSize++] = 0x00;
         cfg[configSize++] = 0x01;
-        configSize += b64_decode( (char*)&cfg[configSize], psz );
 
-        if( p == NULL )
-            break;
-        psz = p;
+        configSize += b64_decode( (char*)&cfg[configSize], psz );
+        psz += strlen(psz)+1;
     }
 
     if( dup ) free( dup );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/Makefile.in	2006-09-18 06:30:45.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/Makefile.in	2006-09-24 13:12:33.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/mkv.cpp vlc_0.8.6-svn20060925.debian/modules/demux/mkv.cpp
--- vlc_0.8.6-svn20060918.debian/modules/demux/mkv.cpp	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/mkv.cpp	2006-09-22 11:14:29.000000000 -0400
@@ -2,7 +2,7 @@
  * mkv.cpp : matroska demuxer
  *****************************************************************************
  * Copyright (C) 2003-2004 the VideoLAN team
- * $Id: mkv.cpp 16588 2006-09-10 17:09:03Z sam $
+ * $Id: mkv.cpp 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Steve Lhomme <steve.lhomme@free.fr>
@@ -1997,7 +1997,7 @@
                 if ( f_mandatory )
                     p_block->i_dts = p_block->i_pts;
                 else
-                    p_block->i_dts = min( i_pts, tk->i_last_dts + (tk->i_default_duration >> 10));
+                    p_block->i_dts = min( i_pts, tk->i_last_dts + (mtime_t)(tk->i_default_duration >> 10));
                 p_sys->i_pts = p_block->i_dts;
             }
         }
@@ -2200,17 +2200,17 @@
             {
                 tracks[i_track]->fmt.i_codec = VLC_FOURCC( 'D', 'I', 'V', '3' );
             }
-            else if( !strcmp( tracks[i_track]->psz_codec, "V_MPEG4/ISO/AVC" ) )
+            else if( !strncmp( tracks[i_track]->psz_codec, "V_MPEG4/ISO", 11 ) )
             {
-                tracks[i_track]->fmt.i_codec = VLC_FOURCC( 'a', 'v', 'c', '1' );
+                /* A MPEG 4 codec, SP, ASP, AP or AVC */
+                if( !strcmp( tracks[i_track]->psz_codec, "V_MPEG4/ISO/AVC" ) )
+                    tracks[i_track]->fmt.i_codec = VLC_FOURCC( 'a', 'v', 'c', '1' );
+                else
+                    tracks[i_track]->fmt.i_codec = VLC_FOURCC( 'm', 'p', '4', 'v' );
                 tracks[i_track]->fmt.i_extra = tracks[i_track]->i_extra_data;
                 tracks[i_track]->fmt.p_extra = malloc( tracks[i_track]->i_extra_data );
                 memcpy( tracks[i_track]->fmt.p_extra,tracks[i_track]->p_extra_data, tracks[i_track]->i_extra_data );
             }
-            else
-            {
-                tracks[i_track]->fmt.i_codec = VLC_FOURCC( 'm', 'p', '4', 'v' );
-            }
         }
         else if( !strcmp( tracks[i_track]->psz_codec, "V_QUICKTIME" ) )
         {
@@ -4923,8 +4923,6 @@
  *****************************************************************************/
 void matroska_segment_c::InformationCreate( )
 {
-    size_t      i_track;
-
     sys.meta = vlc_meta_New();
 
     if( psz_title )
@@ -4935,6 +4933,7 @@
     {
         vlc_meta_Add( sys.meta, VLC_META_DATE, psz_date_utc );
     }
+#if 0
     if( psz_segment_filename )
     {
         vlc_meta_Add( sys.meta, _("Segment filename"), psz_segment_filename );
@@ -4948,7 +4947,7 @@
         vlc_meta_Add( sys.meta, _("Writing application"), psz_writing_application );
     }
 
-    for( i_track = 0; i_track < tracks.size(); i_track++ )
+    for( size_t i_track = 0; i_track < tracks.size(); i_track++ )
     {
         mkv_track_t *tk = tracks[i_track];
         vlc_meta_t *mtk = vlc_meta_New();
@@ -4978,6 +4977,7 @@
             vlc_meta_Add( sys.meta, VLC_META_URL, tk->psz_codec_download_url );
         }
     }
+#endif
 
     if( i_tags_position >= 0 )
     {
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/mp4/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/mp4/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/mp4/Makefile.in	2006-09-18 06:30:46.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/mp4/Makefile.in	2006-09-24 13:12:34.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/mp4/mp4.c vlc_0.8.6-svn20060925.debian/modules/demux/mp4/mp4.c
--- vlc_0.8.6-svn20060918.debian/modules/demux/mp4/mp4.c	2006-09-18 06:28:16.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/mp4/mp4.c	2006-09-22 11:14:28.000000000 -0400
@@ -2,7 +2,7 @@
  * mp4.c : MP4 file input module for vlc
  *****************************************************************************
  * Copyright (C) 2001-2004 the VideoLAN team
- * $Id: mp4.c 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: mp4.c 16773 2006-09-21 18:46:25Z hartman $
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
  * This program is free software; you can redistribute it and/or modify
@@ -29,6 +29,7 @@
 #include <vlc/input.h>
 #include <vlc_playlist.h>
 #include <vlc_md5.h>
+#include "charset.h"
 #include "iso_lang.h"
 #include "vlc_meta.h"
 
@@ -1469,6 +1470,10 @@
             p_track->fmt.video.i_aspect =
                 VOUT_ASPECT_FACTOR * p_track->i_width / p_track->i_height;
 
+        /* Support for cropping (eg. in H263 files) */
+        p_track->fmt.video.i_visible_width = p_track->fmt.video.i_width;
+        p_track->fmt.video.i_visible_height = p_track->fmt.video.i_height;
+
         /* Frame rate */
         p_track->fmt.video.i_frame_rate = p_track->i_timescale;
         p_track->fmt.video.i_frame_rate_base = 1;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/mpeg/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/mpeg/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/mpeg/Makefile.in	2006-09-18 06:30:46.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/mpeg/Makefile.in	2006-09-24 13:12:36.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/playlist/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/playlist/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/playlist/Makefile.in	2006-09-18 06:30:47.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/playlist/Makefile.in	2006-09-24 13:12:37.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/ps.c vlc_0.8.6-svn20060925.debian/modules/demux/ps.c
--- vlc_0.8.6-svn20060918.debian/modules/demux/ps.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/ps.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ps.c: Program Stream demux module for VLC.
  *****************************************************************************
  * Copyright (C) 2004 the VideoLAN team
- * $Id: ps.c 16544 2006-09-07 23:05:11Z hartman $
+ * $Id: ps.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
@@ -124,6 +124,7 @@
     p_sys->i_scr      = -1;
     p_sys->i_length   = -1;
     p_sys->i_current_pts = (mtime_t) 0;
+    p_sys->i_time_track = -1;
     
     p_sys->b_lost_sync = VLC_FALSE;
     p_sys->b_have_pack = VLC_FALSE;
@@ -441,7 +442,7 @@
 
         case DEMUX_GET_TIME:
             pi64 = (int64_t*)va_arg( args, int64_t * );
-            if( p_sys->i_current_pts > 0 )
+            if( p_sys->i_time_track >= 0 && p_sys->i_current_pts > 0 )
             {
                 *pi64 = p_sys->i_current_pts - p_sys->tk[p_sys->i_time_track].i_first_pts;
                 return VLC_SUCCESS;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/subtitle.c vlc_0.8.6-svn20060925.debian/modules/demux/subtitle.c
--- vlc_0.8.6-svn20060918.debian/modules/demux/subtitle.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/subtitle.c	2006-09-22 11:14:29.000000000 -0400
@@ -2,7 +2,7 @@
  * subtitle.c: Demux for subtitle text files.
  *****************************************************************************
  * Copyright (C) 1999-2004 the VideoLAN team
- * $Id: subtitle.c 14790 2006-03-18 02:06:16Z xtophe $
+ * $Id: subtitle.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Derk-Jan Hartman <hartman at videolan dot org>
@@ -171,13 +171,14 @@
  *****************************************************************************/
 static int Open ( vlc_object_t *p_this )
 {
-    demux_t     *p_demux = (demux_t*)p_this;
-    demux_sys_t *p_sys;
-    es_format_t fmt;
-    float f_fps;
-    char *psz_type;
+    demux_t        *p_demux = (demux_t*)p_this;
+    demux_sys_t    *p_sys;
+    es_format_t    fmt;
+    input_thread_t *p_input;
+    float          f_fps;
+    char           *psz_type;
     int  (*pf_read)( demux_t *, subtitle_t* );
-    int i, i_max;
+    int            i, i_max;
 
     if( strcmp( p_demux->psz_demux, "subtitle" ) )
     {
@@ -188,11 +189,12 @@
     p_demux->pf_demux = Demux;
     p_demux->pf_control = Control;
     p_demux->p_sys = p_sys = malloc( sizeof( demux_sys_t ) );
-    p_sys->psz_header = NULL;
-    p_sys->i_subtitle = 0;
-    p_sys->i_subtitles= 0;
-    p_sys->subtitle   = NULL;
-
+    p_sys->psz_header         = NULL;
+    p_sys->i_subtitle         = 0;
+    p_sys->i_subtitles        = 0;
+    p_sys->subtitle           = NULL;
+    p_sys->i_microsecperframe = 0;
+    p_sys->i_original_mspf    = 0;
 
     /* Get the FPS */
     f_fps = var_CreateGetFloat( p_demux, "sub-fps" );
@@ -200,19 +202,15 @@
     {
         p_sys->i_microsecperframe = (int64_t)( (float)1000000 / f_fps );
     }
-    else
-    {
-        p_sys->i_microsecperframe = 0;
-    }
 
-    f_fps = var_CreateGetFloat( p_demux, "sub-original-fps" );
-    if( f_fps >= 1.0 )
+    p_input = (input_thread_t *)vlc_object_find( p_demux, VLC_OBJECT_INPUT, FIND_PARENT );
+    if( p_input )
     {
-        p_sys->i_original_mspf = (int64_t)( (float)1000000 / f_fps );
-    }
-    else
-    {
-        p_sys->i_original_mspf = 0;
+        f_fps = var_GetFloat( p_input, "sub-original-fps" );
+        if( f_fps >= 1.0 )
+            p_sys->i_original_mspf = (int64_t)( (float)1000000 / f_fps );
+
+        vlc_object_release( p_input );
     }
 
     /* Get or probe the type */
@@ -711,6 +709,7 @@
     p_subtitle->i_stop  = 0;
     p_subtitle->psz_text = NULL;
 
+next:
     for( ;; )
     {
         if( ( s = TextGetLine( txt ) ) == NULL )
@@ -727,6 +726,15 @@
             break;
         }
     }
+    if( i_start == 1 && i_stop == 1 )
+    {
+        /* We found a possible setting of the framerate "{1}{1}23.976" */
+        float tmp = us_strtod( buffer_text, NULL );
+        if( tmp > 0.0 && !var_GetFloat( p_demux, "sub-fps" ) > 0.0 )
+            p_sys->i_microsecperframe = (int64_t)( (float)1000000 / tmp );
+        goto next;
+    }
+
     /* replace | by \n */
     for( i = 0; i < strlen( buffer_text ); i++ )
     {
diff -uNr vlc_0.8.6-svn20060918.debian/modules/demux/util/Makefile.in vlc_0.8.6-svn20060925.debian/modules/demux/util/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/demux/util/Makefile.in	2006-09-18 06:30:47.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/demux/util/Makefile.in	2006-09-24 13:12:37.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/beos/InterfaceWindow.cpp vlc_0.8.6-svn20060925.debian/modules/gui/beos/InterfaceWindow.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/beos/InterfaceWindow.cpp	2006-09-18 06:28:21.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/beos/InterfaceWindow.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * InterfaceWindow.cpp: beos interface
  *****************************************************************************
  * Copyright (C) 1999, 2000, 2001 the VideoLAN team
- * $Id: InterfaceWindow.cpp 13905 2006-01-12 23:10:04Z dionoea $
+ * $Id: InterfaceWindow.cpp 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Jean-Marc Dressler <polux@via.ecp.fr>
  *          Samuel Hocevar <sam@zoy.org>
@@ -319,8 +319,10 @@
 
     /* Add the Show menu */
     fShowMenu = new BMenu( _("Window") );
+#if 0
     ADD_ELLIPSIS( _("Playlist") );
     fShowMenu->AddItem( new BMenuItem( psz_tmp, new BMessage( OPEN_PLAYLIST ), 'P') );
+#endif
     ADD_ELLIPSIS( _("Messages") );
     fShowMenu->AddItem( new BMenuItem( psz_tmp, new BMessage( OPEN_MESSAGES ), 'M' ) );
     ADD_ELLIPSIS( _("Preferences") );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/beos/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/beos/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/beos/Makefile.in	2006-09-18 06:30:47.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/beos/Makefile.in	2006-09-24 13:12:39.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/AppleRemote.h vlc_0.8.6-svn20060925.debian/modules/gui/macosx/AppleRemote.h
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/AppleRemote.h	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/AppleRemote.h	2006-09-21 11:50:22.000000000 -0400
@@ -1,10 +1,55 @@
-//
-//  AppleRemote.h
-//  AppleRemote
-//
-//  Created by Martin Kahr on 11.03.06.
-//  Copyright 2006 martinkahr.com. All rights reserved.
-//
+/*****************************************************************************
+ * AppleRemote.h
+ * AppleRemote
+ * $Id: AppleRemote.h 16767 2006-09-21 14:32:45Z hartman $
+ *
+ * Created by Martin Kahr on 11.03.06 under a MIT-style license. 
+ * Copyright (c) 2006 martinkahr.com. All rights reserved.
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a 
+ * copy of this software and associated documentation files (the "Software"),
+ * to deal in the Software without restriction, including without limitation
+ * the rights to use, copy, modify, merge, publish, distribute, sublicense,
+ * and/or sell copies of the Software, and to permit persons to whom the
+ * Software is furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included
+ * in all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL 
+ * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+ * THE SOFTWARE.
+ *
+ *****************************************************************************
+ *
+ * Note that changes made by any members or contributors of the VideoLAN team
+ * (i.e. changes that were checked in into one of VideoLAN's source code
+ * repositories are licensed under the GNU General Public License version 2,
+ * or (at your option) any later version. 
+ * Thus, the following statements apply to our changes:
+ *
+ * Copyright (C) 2006 the VideoLAN team
+ * Authors: Eric Petit <titer@m0k.org>
+ *          Felix Khne <fkuehne at videolan dot org>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston MA 02110-1301, USA.
+ *****************************************************************************/
 
 #import <Cocoa/Cocoa.h>
 #import <mach/mach.h>
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/AppleRemote.m vlc_0.8.6-svn20060925.debian/modules/gui/macosx/AppleRemote.m
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/AppleRemote.m	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/AppleRemote.m	2006-09-21 11:50:22.000000000 -0400
@@ -1,10 +1,55 @@
-//
-//  AppleRemote.m
-//  AppleRemote
-//
-//  Created by Martin Kahr on 11.03.06.
-//  Copyright 2006 martinkahr.com. All rights reserved.
-//
+/*****************************************************************************
+ * AppleRemote.m
+ * AppleRemote
+ * $Id: AppleRemote.m 16767 2006-09-21 14:32:45Z hartman $
+ *
+ * Created by Martin Kahr on 11.03.06 under a MIT-style license. 
+ * Copyright (c) 2006 martinkahr.com. All rights reserved.
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a 
+ * copy of this software and associated documentation files (the "Software"),
+ * to deal in the Software without restriction, including without limitation
+ * the rights to use, copy, modify, merge, publish, distribute, sublicense,
+ * and/or sell copies of the Software, and to permit persons to whom the
+ * Software is furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included
+ * in all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL 
+ * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+ * THE SOFTWARE.
+ *
+ *****************************************************************************
+ *
+ * Note that changes made by any members or contributors of the VideoLAN team
+ * (i.e. changes that were checked in to one of VideoLAN's source code
+ * repositories are licensed under the GNU General Public License version 2,
+ * or (at your option) any later version. 
+ * Thus, the following statements apply to our changes:
+ *
+ * Copyright (C) 2006 the VideoLAN team
+ * Authors: Eric Petit <titer@m0k.org>
+ *          Felix Khne <fkuehne at videolan dot org>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston MA 02110-1301, USA.
+ *****************************************************************************/
 
 #import "AppleRemote.h"
 
@@ -13,8 +58,11 @@
 
 @implementation AppleRemote
 
-- (id) init {	
-	if ( self == [super init] ) {
+- (id) init
+{	
+    self = [super init];
+
+    if ( self == [super init] ) {
 		openInExclusiveMode = YES;
 		queue = NULL;
 		hidDeviceInterface = NULL;
@@ -152,7 +200,7 @@
 
 + (AppleRemote*) sharedRemote {	
 	@synchronized(self) {
-        if( sharedInstance == nil ) {
+        if (sharedInstance == nil) {
             sharedInstance = [[self alloc] init];
         }
     }
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/controls.m vlc_0.8.6-svn20060925.debian/modules/gui/macosx/controls.m
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/controls.m	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/controls.m	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * controls.m: MacOS X interface module
  *****************************************************************************
  * Copyright (C) 2002-2005 the VideoLAN team
- * $Id: controls.m 15491 2006-04-30 21:09:16Z bigben $
+ * $Id: controls.m 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Jon Lech Johansen <jon-vl@nanocrew.net>
  *          Christophe Massiot <massiot@via.ecp.fr>
@@ -161,10 +161,12 @@
     if( val.b_bool )
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Random On" ) );
+        config_PutInt( p_playlist, "random", 1 );
     }
     else
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Random Off" ) );
+        config_PutInt( p_playlist, "random", 0 );
     }
 
     p_intf->p_sys->b_playmode_update = VLC_TRUE;
@@ -193,12 +195,14 @@
     if( val.b_bool )
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Repeat One" ) );
+        config_PutInt( p_playlist, "repeat", 1 );
     }
     else
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Repeat Off" ) );
+        config_PutInt( p_playlist, "repeat", 0 );
     }
-
+    
     p_intf->p_sys->b_playmode_update = VLC_TRUE;
     p_intf->p_sys->b_intf_update = VLC_TRUE;
     vlc_object_release( p_playlist );
@@ -225,10 +229,12 @@
     if( val.b_bool )
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Repeat All" ) );
+        config_PutInt( p_playlist, "loop", 1 );
     }
     else
     {
         vout_OSDMessage( p_intf, DEFAULT_CHAN, _( "Repeat Off" ) );
+        config_PutInt( p_playlist, "loop", 0 );
     }
 
     p_intf->p_sys->b_playmode_update = VLC_TRUE;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/intf.m vlc_0.8.6-svn20060925.debian/modules/gui/macosx/intf.m
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/intf.m	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/intf.m	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * intf.m: MacOS X interface module
  *****************************************************************************
  * Copyright (C) 2002-2006 the VideoLAN team
- * $Id: intf.m 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: intf.m 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Jon Lech Johansen <jon-vl@nanocrew.net>
  *          Christophe Massiot <massiot@via.ecp.fr>
@@ -725,6 +725,21 @@
         case kRemoteButtonVolume_Minus:
             [o_controls volumeDown: self];
             break;
+        case kRemoteButtonRight:
+            [o_controls next: self];
+            break;
+        case kRemoteButtonLeft:
+            [o_controls prev: self];
+            break;
+        case kRemoteButtonRight_Hold:
+            [o_controls forward: self];
+            break;
+        case kRemoteButtonLeft_Hold:
+            [o_controls backward: self];
+            break;
+        case kRemoteButtonMenu:
+            [o_controls windowAction: self];
+            break;
 
         default:
             /* Add here whatever you want other buttons to do */
@@ -1388,6 +1403,7 @@
         [o_btn_play setToolTip: _NS("Pause")];
         [o_mi_play setTitle: _NS("Pause")];
         [o_dmi_play setTitle: _NS("Pause")];
+        [o_vmi_play setTitle: _NS("Pause")];
     }
     else
     {
@@ -1396,6 +1412,7 @@
         [o_btn_play setToolTip: _NS("Play")];
         [o_mi_play setTitle: _NS("Play")];
         [o_dmi_play setTitle: _NS("Play")];
+        [o_vmi_play setTitle: _NS("Play")];
     }
 }
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/macosx/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/Makefile.in	2006-09-18 06:30:48.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/Makefile.in	2006-09-24 13:12:41.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/macosx/vout.m vlc_0.8.6-svn20060925.debian/modules/gui/macosx/vout.m
--- vlc_0.8.6-svn20060918.debian/modules/gui/macosx/vout.m	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/macosx/vout.m	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * vout.m: MacOS X video output module
  *****************************************************************************
  * Copyright (C) 2001-2006 the VideoLAN team
- * $Id: vout.m 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: vout.m 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Colin Delacroix <colin@zoy.org>
  *          Florian G. Pflug <fgp@phlo.org>
@@ -479,124 +479,79 @@
             msg_Dbg( p_vout, "received NSRightMouseDown (generic method) or Ctrl clic" );
             [NSMenu popUpContextMenu: [[VLCMain sharedInstance] getVoutMenu] withEvent: o_event forView: [[[VLCMain sharedInstance] getControls] getVoutView]];
         }
-        else
-            [super mouseDown: o_event];
     }
+
+    [super mouseDown: o_event];
 }
 
 - (void)otherMouseDown:(NSEvent *)o_event
 {
     vlc_value_t val;
 
-    if( p_vout )
+    if( p_vout && [o_event type] == NSOtherMouseDown )
     {
-        switch( [o_event type] )
-        {
-            case NSOtherMouseDown:
-            {
-                var_Get( p_vout, "mouse-button-down", &val );
-                val.i_int |= 2;
-                var_Set( p_vout, "mouse-button-down", val );
-            }
-            break;
-
-            default:
-                [super mouseDown: o_event];
-            break;
-        }
+        var_Get( p_vout, "mouse-button-down", &val );
+        val.i_int |= 2;
+        var_Set( p_vout, "mouse-button-down", val );
     }
+
+    [super mouseDown: o_event];
 }
 
 - (void)rightMouseDown:(NSEvent *)o_event
 {
-    if( p_vout )
+    if( p_vout && [o_event type] == NSRightMouseDown )
     {
-        switch( [o_event type] )
-        {
-            case NSRightMouseDown:
-            {
-                msg_Dbg( p_vout, "received NSRightMouseDown (specific method)" );
-                [NSMenu popUpContextMenu: [[VLCMain sharedInstance] getVoutMenu] withEvent: o_event forView: [[[VLCMain sharedInstance] getControls] getVoutView]];
-            }
-            break;
-
-            default:
-                [super mouseDown: o_event];
-            break;
-        }
+        msg_Dbg( p_vout, "received NSRightMouseDown (specific method)" );
+        [NSMenu popUpContextMenu: [[VLCMain sharedInstance] getVoutMenu] withEvent: o_event forView: [[[VLCMain sharedInstance] getControls] getVoutView]];
     }
+
+    [super mouseDown: o_event];
 }
 
 - (void)mouseUp:(NSEvent *)o_event
 {
     vlc_value_t val;
 
-    if( p_vout )
+    if( p_vout && [o_event type] == NSLeftMouseUp )
     {
-        switch( [o_event type] )
-        {
-            case NSLeftMouseUp:
-            {
-                vlc_value_t b_val;
-                b_val.b_bool = VLC_TRUE;
-                var_Set( p_vout, "mouse-clicked", b_val );
-
-                var_Get( p_vout, "mouse-button-down", &val );
-                val.i_int &= ~1;
-                var_Set( p_vout, "mouse-button-down", val );
-            }
-            break;
+        vlc_value_t b_val;
+        b_val.b_bool = VLC_TRUE;
+        var_Set( p_vout, "mouse-clicked", b_val );
 
-            default:
-                [super mouseUp: o_event];
-            break;
-        }
+        var_Get( p_vout, "mouse-button-down", &val );
+        val.i_int &= ~1;
+        var_Set( p_vout, "mouse-button-down", val );
     }
+
+    [super mouseUp: o_event];
 }
 
 - (void)otherMouseUp:(NSEvent *)o_event
 {
     vlc_value_t val;
 
-    if( p_vout )
+    if( p_vout && [o_event type] == NSOtherMouseUp )
     {
-        switch( [o_event type] )
-        {
-            case NSOtherMouseUp:
-            {
-                var_Get( p_vout, "mouse-button-down", &val );
-                val.i_int &= ~2;
-                var_Set( p_vout, "mouse-button-down", val );
-            }
-            break;
-
-            default:
-                [super mouseUp: o_event];
-            break;
-        }
+        var_Get( p_vout, "mouse-button-down", &val );
+        val.i_int &= ~2;
+        var_Set( p_vout, "mouse-button-down", val );
     }
+
+    [super mouseUp: o_event];
 }
 
 - (void)rightMouseUp:(NSEvent *)o_event
 {
-    if( p_vout )
+    if( p_vout && [o_event type] == NSRightMouseUp )
     {
-        switch( [o_event type] )
-        {
-            case NSRightMouseUp:
-            {
-                /* FIXME: this isn't the appropriate place, but we can't receive
-                 * NSRightMouseDown some how */
-                msg_Dbg( p_vout, "received NSRightMouseUp" ); 
-                [NSMenu popUpContextMenu: [[VLCMain sharedInstance] getVoutMenu] withEvent: o_event forView: [[[VLCMain sharedInstance] getControls] getVoutView]];
-            }
-            break;
-
-            default:
-                [super mouseUp: o_event];
-            break;
-        }
+        /* FIXME: this isn't the appropriate place, but we can't receive
+         * NSRightMouseDown some how */
+        msg_Dbg( p_vout, "received NSRightMouseUp" ); 
+        [NSMenu popUpContextMenu: [[VLCMain sharedInstance] getVoutMenu] withEvent: o_event forView: [[[VLCMain sharedInstance] getControls] getVoutView]];
     }
+
+    [super mouseUp: o_event];
 }
 
 - (void)mouseDragged:(NSEvent *)o_event
@@ -655,6 +610,7 @@
             var_Set( p_vout, "mouse-moved", val );
         }
     }
+
     [super mouseMoved: o_event];
 }
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/Makefile.in	2006-09-18 06:30:47.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/Makefile.in	2006-09-24 13:12:38.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/pda/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/pda/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/pda/Makefile.in	2006-09-18 06:30:48.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/pda/Makefile.in	2006-09-24 13:12:42.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/qnx/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/qnx/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/qnx/Makefile.in	2006-09-18 06:30:49.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/qnx/Makefile.in	2006-09-24 13:12:43.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_image.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_image.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_image.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_image.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_image.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_image.cpp 14118 2006-02-01 18:06:48Z courmisch $
+ * $Id: ctrl_image.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -100,17 +100,20 @@
         if( m_resizeMethod == kScale )
         {
             // Use scaling method
-            if( width != m_pImage->getWidth() ||
-                height != m_pImage->getHeight() )
+            if( width > 0 && height > 0 )
             {
-                OSFactory *pOsFactory = OSFactory::instance( getIntf() );
-                // Rescale the image with the actual size of the control
-                ScaledBitmap bmp( getIntf(), m_rBitmap, width, height );
-                SKINS_DELETE( m_pImage );
-                m_pImage = pOsFactory->createOSGraphics( width, height );
-                m_pImage->drawBitmap( bmp, 0, 0 );
+                if( width != m_pImage->getWidth() ||
+                    height != m_pImage->getHeight() )
+                {
+                    OSFactory *pOsFactory = OSFactory::instance( getIntf() );
+                    // Rescale the image with the actual size of the control
+                    ScaledBitmap bmp( getIntf(), m_rBitmap, width, height );
+                    SKINS_DELETE( m_pImage );
+                    m_pImage = pOsFactory->createOSGraphics( width, height );
+                    m_pImage->drawBitmap( bmp, 0, 0 );
+                }
+                rImage.drawGraphics( *m_pImage, 0, 0, xDest, yDest );
             }
-            rImage.drawGraphics( *m_pImage, 0, 0, xDest, yDest );
         }
         else
         {
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_move.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_move.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_move.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_move.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_move.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_move.cpp 14118 2006-02-01 18:06:48Z courmisch $
+ * $Id: ctrl_move.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -86,6 +86,12 @@
 }
 
 
+void CtrlMove::onResize()
+{
+    m_rCtrl.onResize();
+}
+
+
 void CtrlMove::handleEvent( EvtGeneric &rEvent )
 {
     m_pEvt = &rEvent;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_move.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_move.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_move.hpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_move.hpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_move.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_move.hpp 14187 2006-02-07 16:37:40Z courmisch $
+ * $Id: ctrl_move.hpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -58,7 +58,10 @@
         /// Get the position of the decorated control in the layout, if any
         virtual const Position *getPosition() const;
 
-          /// Get the type of control (custom RTTI)
+        /// Method called when the control is resized
+        virtual void onResize();
+
+        /// Get the type of control (custom RTTI)
         virtual string getType() const { return m_rCtrl.getType(); }
 
     private:
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_resize.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_resize.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_resize.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_resize.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_resize.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_resize.cpp 16454 2006-08-31 19:54:36Z hartman $
+ * $Id: ctrl_resize.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -95,6 +95,12 @@
 }
 
 
+void CtrlResize::onResize()
+{
+    m_rCtrl.onResize();
+}
+
+
 void CtrlResize::handleEvent( EvtGeneric &rEvent )
 {
     m_pEvt = &rEvent;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_resize.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_resize.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_resize.hpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_resize.hpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_resize.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_resize.hpp 16454 2006-08-31 19:54:36Z hartman $
+ * $Id: ctrl_resize.hpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -59,6 +59,9 @@
         /// Get the position of the decorated control in the layout, if any
         virtual const Position *getPosition() const;
 
+        /// Method called when the control is resized
+        virtual void onResize();
+
         /// Get the type of control (custom RTTI)
         virtual string getType() const { return m_rCtrl.getType(); }
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_slider.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_slider.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_slider.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_slider.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_slider.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_slider.cpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: ctrl_slider.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -27,6 +27,7 @@
 #include "../events/evt_mouse.hpp"
 #include "../events/evt_scroll.hpp"
 #include "../src/generic_bitmap.hpp"
+#include "../src/scaled_bitmap.hpp"
 #include "../src/top_window.hpp"
 #include "../src/os_factory.hpp"
 #include "../src/os_graphics.hpp"
@@ -315,18 +316,18 @@
     CtrlGeneric( pIntf, rHelp, pVisible ), m_pCursor( NULL ),
     m_rVariable( rVariable ), m_thickness( thickness ), m_rCurve( rCurve ),
     m_width( rCurve.getWidth() ), m_height( rCurve.getHeight() ),
-    m_pImgSeq( NULL ), m_nbHoriz( nbHoriz ), m_nbVert( nbVert ),
+    m_pImgSeq( pBackground ), m_nbHoriz( nbHoriz ), m_nbVert( nbVert ),
     m_padHoriz( padHoriz ), m_padVert( padVert ), m_bgWidth( 0 ),
     m_bgHeight( 0 ), m_position( 0 )
 {
     if( pBackground )
     {
         // Build the background image sequence
-        OSFactory *pOsFactory = OSFactory::instance( getIntf() );
-        m_pImgSeq = pOsFactory->createOSGraphics( pBackground->getWidth(),
-                                                  pBackground->getHeight() );
-        m_pImgSeq->drawBitmap( *pBackground, 0, 0 );
-
+        // Note: we suppose that the last padding is not included in the
+        // given image
+        // TODO: we should probably change this assumption, as it would make
+        // the code a bit simpler and it would be more natural for the skins
+        // designers
         m_bgWidth = (pBackground->getWidth() + m_padHoriz) / nbHoriz;
         m_bgHeight = (pBackground->getHeight() + m_padVert) / nbVert;
 
@@ -342,7 +343,6 @@
 CtrlSliderBg::~CtrlSliderBg()
 {
     m_rVariable.delObserver( this );
-    delete m_pImgSeq;
 }
 
 
@@ -361,12 +361,25 @@
 {
     if( m_pImgSeq )
     {
-        // Locate the right image in the background bitmap
-        int x = m_bgWidth * ( m_position % m_nbHoriz );
-        int y = m_bgHeight * ( m_position / m_nbHoriz );
-        // Draw the background image
-        rImage.drawGraphics( *m_pImgSeq, x, y, xDest, yDest,
-                             m_bgWidth - m_padHoriz, m_bgHeight - m_padVert );
+        if( m_bgWidth > 0 && m_bgHeight > 0 )
+        {
+            // Compute the resize factors
+            float factorX, factorY;
+            getResizeFactors( factorX, factorY );
+
+            // Rescale the image with the actual size of the control
+            ScaledBitmap bmp( getIntf(), *m_pImgSeq,
+                 m_bgWidth * m_nbHoriz - (int)(m_padHoriz * factorX),
+                 m_bgHeight * m_nbVert - (int)(m_padVert * factorY) );
+
+            // Locate the right image in the background bitmap
+            int x = m_bgWidth * ( m_position % m_nbHoriz );
+            int y = m_bgHeight * ( m_position / m_nbHoriz );
+            // Draw the background image
+            rImage.drawBitmap( bmp, x, y, xDest, yDest,
+                               m_bgWidth - (int)(m_padHoriz * factorX),
+                               m_bgHeight - (int)(m_padVert * factorY) );
+        }
     }
 }
 
@@ -420,6 +433,24 @@
 }
 
 
+void CtrlSliderBg::onResize()
+{
+    if( m_pImgSeq )
+    {
+        // Compute only the new size of an elementary image.
+        // The actual resizing is done in the draw() method for now...
+
+        // Compute the resize factors
+        float factorX, factorY;
+        getResizeFactors( factorX, factorY );
+
+        // Size of one elementary background image (padding included)
+        m_bgWidth = (int)((m_pImgSeq->getWidth() + m_padHoriz) * factorX / m_nbHoriz);
+        m_bgHeight = (int)((m_pImgSeq->getHeight() + m_padVert) * factorY / m_nbVert);
+    }
+}
+
+
 void CtrlSliderBg::associateCursor( CtrlSliderCursor &rCursor )
 {
     m_pCursor = &rCursor;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_slider.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_slider.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_slider.hpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_slider.hpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_slider.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_slider.hpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: ctrl_slider.hpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -128,6 +128,9 @@
         /// Handle an event
         virtual void handleEvent( EvtGeneric &rEvent );
 
+        /// Method called when the control is resized
+        virtual void onResize();
+
         /// Get the type of control (custom RTTI)
         virtual string getType() const { return "slider_bg"; }
 
@@ -146,7 +149,7 @@
         /// Initial size of the control
         int m_width, m_height;
         /// Background image sequence (optional)
-        OSGraphics *m_pImgSeq;
+        GenericBitmap *m_pImgSeq;
         /// Number of images in the background bitmap
         int m_nbHoriz, m_nbVert;
         /// Number of pixels between two images
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_text.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_text.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_text.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_text.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_text.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_text.cpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: ctrl_text.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -242,7 +242,7 @@
     m_pImgDouble = m_rFont.drawString( doubleStringWithSep, m_color );
 
     // Update the current image used, as if the control size had changed
-    onChangePosition();
+    onPositionChange();
 
     if( m_alignment == kRight && getPosition() &&
         getPosition()->getWidth() < m_pImg->getWidth() )
@@ -281,7 +281,7 @@
 }
 
 
-void CtrlText::onChangePosition()
+void CtrlText::onPositionChange()
 {
     if( m_pImg && getPosition() )
     {
@@ -303,6 +303,12 @@
 }
 
 
+void CtrlText::onResize()
+{
+    onPositionChange();
+}
+
+
 void CtrlText::CmdToManual::execute()
 {
     EvtMouse *pEvtMouse = (EvtMouse*)m_pParent->m_pEvt;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_text.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_text.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/controls/ctrl_text.hpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/controls/ctrl_text.hpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * ctrl_text.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: ctrl_text.hpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: ctrl_text.hpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -131,7 +131,9 @@
         void adjust( int &position );
 
         /// Update the behaviour of the text whenever the control size changes
-        virtual void onChangePosition();
+        virtual void onPositionChange();
+        /// Update the behaviour of the text whenever the control size changes
+        virtual void onResize();
 };
 
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/skins2/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/Makefile.in	2006-09-18 06:30:52.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/Makefile.in	2006-09-24 13:12:51.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder.cpp	2006-09-18 06:28:23.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * builder.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: builder.cpp 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: builder.cpp 16778 2006-09-21 23:56:47Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -430,7 +430,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        pBmpUp->getWidth(),
-                                       pBmpUp->getHeight(), *pLayout );
+                                       pBmpUp->getHeight(), *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pButton, pos, rData.m_layer );
 
@@ -505,7 +506,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        pBmpUp1->getWidth(),
-                                       pBmpUp1->getHeight(), *pLayout );
+                                       pBmpUp1->getHeight(), *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pCheckbox, pos, rData.m_layer );
 
@@ -551,9 +553,10 @@
 
     // Compute the position of the control
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
-                                       rData.m_xPos,
-                                       rData.m_yPos, pBmp->getWidth(),
-                                       pBmp->getHeight(), *pLayout );
+                                       rData.m_xPos, rData.m_yPos,
+                                       pBmp->getWidth(), pBmp->getHeight(),
+                                       *pLayout, rData.m_xKeepRatio,
+                                       rData.m_yKeepRatio );
 
     // XXX: test to be changed! XXX
     if( rData.m_actionId == "move" )
@@ -660,8 +663,8 @@
     // Compute the position of the control
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
-                                       rData.m_width, height,
-                                       *pLayout );
+                                       rData.m_width, height, *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pText, pos, rData.m_layer );
 
@@ -708,10 +711,12 @@
 
     // XXX: resizing is not supported
     // Compute the position of the control
-    const Position pos =
-        makePosition( rData.m_leftTop, rData.m_rightBottom, rData.m_xPos,
-                      rData.m_yPos, pSeq->getWidth(),
-                      pSeq->getHeight() / rData.m_nbImages, *pLayout );
+    const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
+                                       rData.m_xPos, rData.m_yPos,
+                                       pSeq->getWidth(),
+                                       pSeq->getHeight() / rData.m_nbImages,
+                                       *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pRadial, pos, rData.m_layer );
 
@@ -772,7 +777,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        pCurve->getWidth(), pCurve->getHeight(),
-                                       *pLayout );
+                                       *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pBackground, pos, rData.m_layer );
 
@@ -852,7 +858,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        rData.m_width, rData.m_height,
-                                       *pLayout );
+                                       *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pList, pos, rData.m_layer );
 
@@ -916,7 +923,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        rData.m_width, rData.m_height,
-                                       *pLayout );
+                                       *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pTree, pos, rData.m_layer );
 
@@ -945,7 +953,8 @@
     const Position pos = makePosition( rData.m_leftTop, rData.m_rightBottom,
                                        rData.m_xPos, rData.m_yPos,
                                        rData.m_width, rData.m_height,
-                                       *pLayout );
+                                       *pLayout,
+                                       rData.m_xKeepRatio, rData.m_yKeepRatio );
 
     pLayout->addControl( pVideo, pos, rData.m_layer );
 
@@ -956,7 +965,8 @@
 const Position Builder::makePosition( const string &rLeftTop,
                                       const string &rRightBottom,
                                       int xPos, int yPos, int width,
-                                      int height, const Box &rBox ) const
+                                      int height, const Box &rBox,
+                                      bool xKeepRatio, bool yKeepRatio ) const
 {
     int left = 0, top = 0, right = 0, bottom = 0;
     Position::Ref_t refLeftTop = Position::kLeftTop;
@@ -1017,8 +1027,23 @@
         refRightBottom = Position::kRightBottom;
     }
 
+    // In "keep ratio" mode, overwrite the previously computed values with the
+    // actual ones
+    // XXX: this coupling between makePosition and the Position class should
+    // be reduced...
+    if( xKeepRatio )
+    {
+        left = xPos;
+        right = xPos + width;
+    }
+    if( yKeepRatio )
+    {
+        top = yPos;
+        bottom = yPos + height;
+    }
+
     return Position( left, top, right, bottom, rBox, refLeftTop,
-                     refRightBottom );
+                     refRightBottom, xKeepRatio, yKeepRatio );
 }
 
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder_data.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder_data.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder_data.hpp	2006-09-18 06:28:23.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder_data.hpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * builder_data.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: builder_data.hpp 16454 2006-08-31 19:54:36Z hartman $
+ * $Id: builder_data.hpp 16778 2006-09-21 23:56:47Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teuliere <ipkiss@via.ecp.fr>
@@ -203,14 +203,16 @@
     /// Type definition
     struct Button
     {
-        Button( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, const string & visible, const string & upId, const string & downId, const string & overId, const string & actionId, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_visible( visible ), m_upId( upId ), m_downId( downId ), m_overId( overId ), m_actionId( actionId ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Button( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & visible, const string & upId, const string & downId, const string & overId, const string & actionId, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_visible( visible ), m_upId( upId ), m_downId( downId ), m_overId( overId ), m_actionId( actionId ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
         int m_yPos;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_visible;
         string m_upId;
         string m_downId;
@@ -228,14 +230,16 @@
     /// Type definition
     struct Checkbox
     {
-        Checkbox( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, const string & visible, const string & up1Id, const string & down1Id, const string & over1Id, const string & up2Id, const string & down2Id, const string & over2Id, const string & state, const string & action1, const string & action2, const string & tooltip1, const string & tooltip2, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_visible( visible ), m_up1Id( up1Id ), m_down1Id( down1Id ), m_over1Id( over1Id ), m_up2Id( up2Id ), m_down2Id( down2Id ), m_over2Id( over2Id ), m_state( state ), m_action1( action1 ), m_action2( action2 ), m_tooltip1( tooltip1 ), m_tooltip2( tooltip2 ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Checkbox( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & visible, const string & up1Id, const string & down1Id, const string & over1Id, const string & up2Id, const string & down2Id, const string & over2Id, const string & state, const string & action1, const string & action2, const string & tooltip1, const string & tooltip2, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_visible( visible ), m_up1Id( up1Id ), m_down1Id( down1Id ), m_over1Id( over1Id ), m_up2Id( up2Id ), m_down2Id( down2Id ), m_over2Id( over2Id ), m_state( state ), m_action1( action1 ), m_action2( action2 ), m_tooltip1( tooltip1 ), m_tooltip2( tooltip2 ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
         int m_yPos;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_visible;
         string m_up1Id;
         string m_down1Id;
@@ -259,14 +263,16 @@
     /// Type definition
     struct Image
     {
-        Image( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, const string & visible, const string & bmpId, const string & actionId, const string & action2Id, const string & resize, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_visible( visible ), m_bmpId( bmpId ), m_actionId( actionId ), m_action2Id( action2Id ), m_resize( resize ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Image( const string & id, int xPos, int yPos, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & visible, const string & bmpId, const string & actionId, const string & action2Id, const string & resize, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_visible( visible ), m_bmpId( bmpId ), m_actionId( actionId ), m_action2Id( action2Id ), m_resize( resize ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
         int m_yPos;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_visible;
         string m_bmpId;
         string m_actionId;
@@ -295,8 +301,8 @@
     /// Type definition
     struct Text
     {
-        Text( const string & id, int xPos, int yPos, const string & visible, const string & fontId, const string & text, int width, const string & leftTop, const string & rightBottom, uint32_t color, const string & scrolling, const string & alignment, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_fontId( fontId ), m_text( text ), m_width( width ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_color( color ), m_scrolling( scrolling ), m_alignment( alignment ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Text( const string & id, int xPos, int yPos, const string & visible, const string & fontId, const string & text, int width, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, uint32_t color, const string & scrolling, const string & alignment, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_fontId( fontId ), m_text( text ), m_width( width ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_color( color ), m_scrolling( scrolling ), m_alignment( alignment ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
@@ -307,6 +313,8 @@
         int m_width;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         uint32_t m_color;
         string m_scrolling;
         string m_alignment;
@@ -321,8 +329,8 @@
     /// Type definition
     struct RadialSlider
     {
-        RadialSlider( const string & id, const string & visible, int xPos, int yPos, const string & leftTop, const string & rightBottom, const string & sequence, int nbImages, float minAngle, float maxAngle, const string & value, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_visible( visible ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_sequence( sequence ), m_nbImages( nbImages ), m_minAngle( minAngle ), m_maxAngle( maxAngle ), m_value( value ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        RadialSlider( const string & id, const string & visible, int xPos, int yPos, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & sequence, int nbImages, float minAngle, float maxAngle, const string & value, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_visible( visible ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_sequence( sequence ), m_nbImages( nbImages ), m_minAngle( minAngle ), m_maxAngle( maxAngle ), m_value( value ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         string m_visible;
@@ -330,6 +338,8 @@
         int m_yPos;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_sequence;
         int m_nbImages;
         float m_minAngle;
@@ -347,8 +357,8 @@
     /// Type definition
     struct Slider
     {
-        Slider( const string & id, const string & visible, int xPos, int yPos, const string & leftTop, const string & rightBottom, const string & upId, const string & downId, const string & overId, const string & points, int thickness, const string & value, const string & imageId, int nbHoriz, int nbVert, int padHoriz, int padVert, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_visible( visible ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_upId( upId ), m_downId( downId ), m_overId( overId ), m_points( points ), m_thickness( thickness ), m_value( value ), m_imageId( imageId ), m_nbHoriz( nbHoriz ), m_nbVert( nbVert ), m_padHoriz( padHoriz ), m_padVert( padVert ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Slider( const string & id, const string & visible, int xPos, int yPos, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & upId, const string & downId, const string & overId, const string & points, int thickness, const string & value, const string & imageId, int nbHoriz, int nbVert, int padHoriz, int padVert, const string & tooltip, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_visible( visible ), m_xPos( xPos ), m_yPos( yPos ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_upId( upId ), m_downId( downId ), m_overId( overId ), m_points( points ), m_thickness( thickness ), m_value( value ), m_imageId( imageId ), m_nbHoriz( nbHoriz ), m_nbVert( nbVert ), m_padHoriz( padHoriz ), m_padVert( padVert ), m_tooltip( tooltip ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         string m_visible;
@@ -356,6 +366,8 @@
         int m_yPos;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_upId;
         string m_downId;
         string m_overId;
@@ -379,8 +391,8 @@
     /// Type definition
     struct List
     {
-        List( const string & id, int xPos, int yPos, const string & visible, int width, int height, const string & leftTop, const string & rightBottom, const string & fontId, const string & var, const string & bgImageId, const string & fgColor, const string & playColor, const string & bgColor1, const string & bgColor2, const string & selColor, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_fontId( fontId ), m_var( var ), m_bgImageId( bgImageId ), m_fgColor( fgColor ), m_playColor( playColor ), m_bgColor1( bgColor1 ), m_bgColor2( bgColor2 ), m_selColor( selColor ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        List( const string & id, int xPos, int yPos, const string & visible, int width, int height, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & fontId, const string & var, const string & bgImageId, const string & fgColor, const string & playColor, const string & bgColor1, const string & bgColor2, const string & selColor, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_fontId( fontId ), m_var( var ), m_bgImageId( bgImageId ), m_fgColor( fgColor ), m_playColor( playColor ), m_bgColor1( bgColor1 ), m_bgColor2( bgColor2 ), m_selColor( selColor ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
@@ -390,6 +402,8 @@
         int m_height;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_fontId;
         string m_var;
         string m_bgImageId;
@@ -409,8 +423,8 @@
     /// Type definition
     struct Tree
     {
-        Tree( const string & id, int xPos, int yPos, const string & visible, const string & flat, int width, int height, const string & leftTop, const string & rightBottom, const string & fontId, const string & var, const string & bgImageId, const string & itemImageId, const string & openImageId, const string & closedImageId, const string & fgColor, const string & playColor, const string & bgColor1, const string & bgColor2, const string & selColor, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_flat( flat ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_fontId( fontId ), m_var( var ), m_bgImageId( bgImageId ), m_itemImageId( itemImageId ), m_openImageId( openImageId ), m_closedImageId( closedImageId ), m_fgColor( fgColor ), m_playColor( playColor ), m_bgColor1( bgColor1 ), m_bgColor2( bgColor2 ), m_selColor( selColor ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Tree( const string & id, int xPos, int yPos, const string & visible, const string & flat, int width, int height, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & fontId, const string & var, const string & bgImageId, const string & itemImageId, const string & openImageId, const string & closedImageId, const string & fgColor, const string & playColor, const string & bgColor1, const string & bgColor2, const string & selColor, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_visible( visible ), m_flat( flat ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_fontId( fontId ), m_var( var ), m_bgImageId( bgImageId ), m_itemImageId( itemImageId ), m_openImageId( openImageId ), m_closedImageId( closedImageId ), m_fgColor( fgColor ), m_playColor( playColor ), m_bgColor1( bgColor1 ), m_bgColor2( bgColor2 ), m_selColor( selColor ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
@@ -421,6 +435,8 @@
         int m_height;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_fontId;
         string m_var;
         string m_bgImageId;
@@ -443,8 +459,8 @@
     /// Type definition
     struct Video
     {
-        Video( const string & id, int xPos, int yPos, int width, int height, const string & leftTop, const string & rightBottom, const string & visible, bool autoResize, const string & help, int layer, const string & windowId, const string & layoutId ):
-m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_visible( visible ), m_autoResize( autoResize ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
+        Video( const string & id, int xPos, int yPos, int width, int height, const string & leftTop, const string & rightBottom, bool xKeepRatio, bool yKeepRatio, const string & visible, bool autoResize, const string & help, int layer, const string & windowId, const string & layoutId ):
+m_id( id ), m_xPos( xPos ), m_yPos( yPos ), m_width( width ), m_height( height ), m_leftTop( leftTop ), m_rightBottom( rightBottom ), m_xKeepRatio( xKeepRatio ), m_yKeepRatio( yKeepRatio ), m_visible( visible ), m_autoResize( autoResize ), m_help( help ), m_layer( layer ), m_windowId( windowId ), m_layoutId( layoutId ) {}
 
         string m_id;
         int m_xPos;
@@ -453,6 +469,8 @@
         int m_height;
         string m_leftTop;
         string m_rightBottom;
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
         string m_visible;
         bool m_autoResize;
         string m_help;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/builder.hpp	2006-09-18 06:28:23.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/builder.hpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * builder.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: builder.hpp 15249 2006-04-17 15:18:05Z asmax $
+ * $Id: builder.hpp 16778 2006-09-21 23:56:47Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -90,7 +90,8 @@
         const Position makePosition( const string &rLeftTop,
                                      const string &rRightBottom,
                                      int xPos, int yPos, int width, int height,
-                                     const Box &rBox ) const;
+                                     const Box &rBox, bool xKeepRatio = false,
+                                     bool yKeepRatio = false ) const;
 
         // Build the full path of a file
         string getFilePath( const string &fileName ) const;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/interpreter.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/interpreter.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/interpreter.cpp	2006-09-18 06:28:23.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/interpreter.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * interpreter.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: interpreter.cpp 16460 2006-08-31 22:01:13Z hartman $
+ * $Id: interpreter.cpp 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -95,8 +95,11 @@
     m_commandMap["playlist.setRepeat(false)"] =
         CmdGenericPtr( new CmdPlaylistRepeat( getIntf(), false ) );
     VarTree &rVarTree = VlcProc::instance( getIntf() )->getPlaytreeVar();
+    m_commandMap["playlist.del()"] =
+        CmdGenericPtr( new CmdPlaytreeDel( getIntf(), rVarTree ) );
     m_commandMap["playtree.del()"] =
         CmdGenericPtr( new CmdPlaytreeDel( getIntf(), rVarTree ) );
+    REGISTER_CMD( "playlist.sort()", CmdPlaytreeSort )
     REGISTER_CMD( "playtree.sort()", CmdPlaytreeSort )
     REGISTER_CMD( "vlc.fullscreen()", CmdFullscreen )
     REGISTER_CMD( "vlc.play()", CmdPlay )
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/skin_parser.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/skin_parser.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/parser/skin_parser.cpp	2006-09-18 06:28:23.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/parser/skin_parser.cpp	2006-09-25 07:47:38.000000000 -0400
@@ -2,7 +2,7 @@
  * skin_parser.cpp
  *****************************************************************************
  * Copyright (C) 2004 the VideoLAN team
- * $Id: skin_parser.cpp 16454 2006-08-31 19:54:36Z hartman $
+ * $Id: skin_parser.cpp 16844 2006-09-25 11:47:35Z sam $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *
@@ -181,6 +181,8 @@
         CheckDefault( "y", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "down", "none" );
         CheckDefault( "over", "none" );
         CheckDefault( "action", "none" );
@@ -189,7 +191,9 @@
 
         const BuilderData::Button button( uniqueId( attr["id"] ),
                 atoi( attr["x"] ) + m_xOffset, atoi( attr["y"] ) + m_yOffset,
-                attr["lefttop"], attr["rightbottom"], attr["visible"],
+                attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ), attr["visible"],
                 attr["up"], attr["down"], attr["over"], attr["action"],
                 attr["tooltiptext"], attr["help"],
                 m_curLayer, m_curWindowId, m_curLayoutId );
@@ -208,6 +212,8 @@
         CheckDefault( "y", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "down1", "none" );
         CheckDefault( "over1", "none" );
         CheckDefault( "down2", "none" );
@@ -220,7 +226,9 @@
 
         const BuilderData::Checkbox checkbox( uniqueId( attr["id"] ),
                 atoi( attr["x"] ) + m_xOffset, atoi( attr["y"] ) + m_yOffset,
-                attr["lefttop"], attr["rightbottom"], attr["visible"],
+                attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ), attr["visible"],
                 attr["up1"], attr["down1"], attr["over1"],
                 attr["up2"], attr["down2"], attr["over2"], attr["state"],
                 attr["action1"], attr["action2"], attr["tooltiptext1"],
@@ -261,6 +269,8 @@
         CheckDefault( "y", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "action", "none" );
         CheckDefault( "action2", "none" );
         CheckDefault( "resize", "mosaic" );
@@ -268,7 +278,9 @@
 
         const BuilderData::Image imageData( uniqueId( attr["id"] ),
                 atoi( attr["x"] ) + m_xOffset, atoi( attr["y"] ) + m_yOffset,
-                attr["lefttop"], attr["rightbottom"], attr["visible"],
+                attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ), attr["visible"],
                 attr["image"], attr["action"], attr["action2"], attr["resize"],
                 attr["help"], m_curLayer, m_curWindowId, m_curLayoutId );
         m_curLayer++;
@@ -305,6 +317,8 @@
         CheckDefault( "height", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "bgimage", "none" );
         CheckDefault( "fgcolor", "#000000" );
         CheckDefault( "playcolor", "#FF0000" );
@@ -314,16 +328,24 @@
         CheckDefault( "help", "" );
 
         m_curListId = uniqueId( attr["id"] );
-        const BuilderData::List listData( m_curListId, atoi( attr["x"] ) +
+        const BuilderData::Tree treeData( m_curListId, atoi( attr["x"] ) +
                 m_xOffset, atoi( attr["y"] ) + m_yOffset, attr["visible"],
+                attr["flat"],
                 atoi( attr["width"]), atoi( attr["height"] ),
-                attr["lefttop"], attr["rightbottom"], attr["font"],
-                "playlist", attr["bgimage"], attr["fgcolor"],
-                attr["playcolor"], attr["bgcolor1"], attr["bgcolor2"],
+                attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ),
+                attr["font"], "playtree",
+                attr["bgimage"], attr["itemimage"],
+                attr["openimage"], attr["closedimage"],
+                attr["fgcolor"],
+                attr["playcolor"],
+                attr["bgcolor1"],
+                attr["bgcolor2"],
                 attr["selcolor"], attr["help"],
                 m_curLayer, m_curWindowId, m_curLayoutId );
         m_curLayer++;
-        m_pData->m_listList.push_back( listData );
+        m_pData->m_listTree.push_back( treeData );
     }
 
     else if( rName == "Playtree" )
@@ -338,6 +360,8 @@
         CheckDefault( "height", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "bgimage", "none" );
         CheckDefault( "itemimage", "none" );
         CheckDefault( "openimage", "none" );
@@ -355,6 +379,8 @@
                 attr["flat"],
                 atoi( attr["width"]), atoi( attr["height"] ),
                 attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ),
                 attr["font"], "playtree",
                 attr["bgimage"], attr["itemimage"],
                 attr["openimage"], attr["closedimage"],
@@ -376,6 +402,8 @@
         CheckDefault( "y", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "minangle", "0" );
         CheckDefault( "maxangle", "360" );
         CheckDefault( "value", "none" );
@@ -385,7 +413,9 @@
         const BuilderData::RadialSlider radial( uniqueId( attr["id"] ),
                 attr["visible"],
                 atoi( attr["x"] ) + m_xOffset, atoi( attr["y"] ) + m_yOffset,
-                attr["lefttop"], attr["rightbottom"], attr["sequence"],
+                attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ), attr["sequence"],
                 atoi( attr["nbImages"] ), atof( attr["minAngle"] ) * M_PI /180,
                 atof( attr["maxAngle"] ) * M_PI / 180, attr["value"],
                 attr["tooltiptext"], attr["help"], m_curLayer, m_curWindowId,
@@ -406,6 +436,8 @@
         CheckDefault( "height", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "down", "none" );
         CheckDefault( "over", "none" );
         CheckDefault( "thickness", "10" );
@@ -427,7 +459,8 @@
         const BuilderData::Slider slider( uniqueId( attr["id"] ),
                 attr["visible"], atoi( attr["x"] ) + m_xOffset,
                 atoi( attr["y"] ) + m_yOffset, attr["lefttop"],
-                attr["rightbottom"], attr["up"], attr["down"],
+                attr["rightbottom"], convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ), attr["up"], attr["down"],
                 attr["over"], attr["points"], atoi( attr["thickness"] ),
                 newValue, "none", 0, 0, 0, 0, attr["tooltiptext"],
                 attr["help"], m_curLayer, m_curWindowId, m_curLayoutId );
@@ -467,6 +500,8 @@
         CheckDefault( "width", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "help", "" );
 
         const BuilderData::Text textData( uniqueId( attr["id"] ),
@@ -474,6 +509,8 @@
                 attr["visible"], attr["font"],
                 attr["text"], atoi( attr["width"] ),
                 attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ),
                 convertColor( attr["color"] ),
                 attr["scrolling"], attr["alignment"],
                 attr["help"], m_curLayer, m_curWindowId, m_curLayoutId );
@@ -520,6 +557,8 @@
         CheckDefault( "height", "0" );
         CheckDefault( "lefttop", "lefttop" );
         CheckDefault( "rightbottom", "lefttop" );
+        CheckDefault( "xkeepratio", "false" );
+        CheckDefault( "ykeepratio", "false" );
         CheckDefault( "autoresize", "false" );
         CheckDefault( "help", "" );
 
@@ -527,6 +566,8 @@
                 atoi( attr["x"] ) + m_xOffset, atoi( attr["y"] ) + m_yOffset,
                 atoi( attr["width"] ), atoi( attr["height" ]),
                 attr["lefttop"], attr["rightbottom"],
+                convertBoolean( attr["xkeepratio"] ),
+                convertBoolean( attr["ykeepratio"] ),
                 attr["visible"], convertBoolean( attr["autoresize"] ),
                 attr["help"], m_curLayer, m_curWindowId, m_curLayoutId );
         m_curLayer++;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/scaled_bitmap.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/scaled_bitmap.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/scaled_bitmap.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/scaled_bitmap.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * scaled_bitmap.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: scaled_bitmap.cpp 14118 2006-02-01 18:06:48Z courmisch $
+ * $Id: scaled_bitmap.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -45,10 +45,10 @@
         // Decision variables for Bresenham algorithm
         int incX1 = 2 * (srcWidth-1);
         int incX2 = incX1 - 2 * (width-1);
-        int dX = incX1 - (width-1);
 
         for( int y = 0; y < height; y++ )
         {
+            int dX = incX1 - (width-1);
             uint32_t yOffset = ((y * srcHeight) / height) * srcWidth;
             pSrcData = ((uint32_t*)rBitmap.getData()) + yOffset;
 
@@ -74,14 +74,18 @@
         // Decision variables for Bresenham algorithm
         int incX1 = 2 * (width-1);
         int incX2 = incX1 - 2 * (srcWidth-1);
-        int dX = incX1 - (srcWidth-1);
 
         for( int y = 0; y < height; y++ )
         {
+            int dX = incX1 - (srcWidth-1);
             uint32_t yOffset = ((y * srcHeight) / height) * srcWidth;
             pSrcData = ((uint32_t*)rBitmap.getData()) + yOffset;
 
-            for( int x = 0; x < width; x++ )
+            if (width == 1)
+            {
+                *(pDestData++) = *pSrcData;
+            }
+            else for( int x = 0; x < width; x++ )
             {
                 *(pDestData++) = *(pSrcData++);
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/skin_main.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/skin_main.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/skin_main.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/skin_main.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * skin_main.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: skin_main.cpp 16441 2006-08-30 21:36:35Z hartman $
+ * $Id: skin_main.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -365,16 +365,20 @@
         return VLC_EGENERIC;
     }
 
-    AsyncQueue *pQueue = AsyncQueue::instance( pIntf );
-    if( newVal.b_bool )
+    // Check that we found the correct interface (same check as for the demux)
+    if( var_Type( pIntf, "skin-to-load" ) == VLC_VAR_STRING )
     {
-        CmdAddInTray *pCmd = new CmdAddInTray( pIntf );
-        pQueue->push( CmdGenericPtr( pCmd ) );
-    }
-    else
-    {
-        CmdRemoveFromTray *pCmd = new CmdRemoveFromTray( pIntf );
-        pQueue->push( CmdGenericPtr( pCmd ) );
+        AsyncQueue *pQueue = AsyncQueue::instance( pIntf );
+        if( newVal.b_bool )
+        {
+            CmdAddInTray *pCmd = new CmdAddInTray( pIntf );
+            pQueue->push( CmdGenericPtr( pCmd ) );
+        }
+        else
+        {
+            CmdRemoveFromTray *pCmd = new CmdRemoveFromTray( pIntf );
+            pQueue->push( CmdGenericPtr( pCmd ) );
+        }
     }
 
     vlc_object_release( pIntf );
@@ -395,16 +399,20 @@
         return VLC_EGENERIC;
     }
 
-    AsyncQueue *pQueue = AsyncQueue::instance( pIntf );
-    if( newVal.b_bool )
+    // Check that we found the correct interface (same check as for the demux)
+    if( var_Type( pIntf, "skin-to-load" ) == VLC_VAR_STRING )
     {
-        CmdAddInTaskBar *pCmd = new CmdAddInTaskBar( pIntf );
-        pQueue->push( CmdGenericPtr( pCmd ) );
-    }
-    else
-    {
-        CmdRemoveFromTaskBar *pCmd = new CmdRemoveFromTaskBar( pIntf );
-        pQueue->push( CmdGenericPtr( pCmd ) );
+        AsyncQueue *pQueue = AsyncQueue::instance( pIntf );
+        if( newVal.b_bool )
+        {
+            CmdAddInTaskBar *pCmd = new CmdAddInTaskBar( pIntf );
+            pQueue->push( CmdGenericPtr( pCmd ) );
+        }
+        else
+        {
+            CmdRemoveFromTaskBar *pCmd = new CmdRemoveFromTaskBar( pIntf );
+            pQueue->push( CmdGenericPtr( pCmd ) );
+        }
     }
 
     vlc_object_release( pIntf );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/top_window.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/top_window.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/src/top_window.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/src/top_window.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * top_window.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: top_window.cpp 16441 2006-08-30 21:36:35Z hartman $
+ * $Id: top_window.cpp 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -439,9 +439,18 @@
     // Check that the control is the active one
     if( m_pLastHitControl && m_pLastHitControl == &rCtrl )
     {
-        // Set the tooltip text variable
-        VarManager *pVarManager = VarManager::instance( getIntf() );
-        pVarManager->getTooltipText().set( rCtrl.getTooltipText() );
+        if( rCtrl.getTooltipText().size() )
+        {
+            // Set the tooltip text variable
+            VarManager *pVarManager = VarManager::instance( getIntf() );
+            pVarManager->getTooltipText().set( rCtrl.getTooltipText() );
+            m_rWindowManager.showTooltip();
+        }
+        else
+        {
+            // Nothing to display, so hide the tooltip
+            m_rWindowManager.hideTooltip();
+        }
     }
 }
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/utils/position.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/utils/position.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/utils/position.cpp	2006-09-18 06:28:21.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/utils/position.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * position.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: position.cpp 14118 2006-02-01 18:06:48Z courmisch $
+ * $Id: position.cpp 16778 2006-09-21 23:56:47Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -35,83 +35,186 @@
 
 
 Position::Position( int left, int top, int right, int bottom, const Box &rBox,
-                    Ref_t refLeftTop, Ref_t refRightBottom ):
+                    Ref_t refLeftTop, Ref_t refRightBottom, bool xKeepRatio,
+                    bool yKeepRatio ):
     m_left( left ), m_top( top ), m_right( right ), m_bottom( bottom ),
     m_rBox( rBox ), m_refLeftTop( refLeftTop ),
-    m_refRighBottom( refRightBottom )
+    m_refRighBottom( refRightBottom ), m_xKeepRatio( xKeepRatio ),
+    m_yKeepRatio( yKeepRatio )
 {
+    // Here is how the resizing algorithm works:
+    //
+    //  - if we "keep the ratio" (xkeepratio="true" in the XML), the relative
+    //    position of the control in the layout (i.e. the given rBox) is
+    //    saved, and will be kept constant. The size of the control will not
+    //    be changed, only its position may vary. To do that, we consider the
+    //    part of the layout to the left of the control (for an horizontal
+    //    resizing) and the part of the layout to the right of the control,
+    //    and we make sure that the ratio between their widths is constant.
+    //
+    //  - if we don't keep the ratio, the resizing algorithm is completely
+    //    different. We consider that the top left hand corner of the control
+    //    ("lefttop" attribute in the XML) is linked to one of the 4 corners
+    //    of the layouts ("lefttop", "leftbottom", "righttop" and
+    //    "rightbottom" values for the attribute). Same thing for the bottom
+    //    right hand corner ("rightbottom" attribute). When resizing occurs,
+    //    the linked corners will move together, and this will drive the
+    //    moving/resizing of the control.
+
+    // Initialize the horizontal ratio
+    if( m_xKeepRatio )
+    {
+        // First compute the width of the box minus the width of the control
+        int freeSpace = m_rBox.getWidth() - (m_right - m_left);
+        // Instead of computing left/right, we compute left/(left+right),
+        // which is more convenient in my opinion.
+        if( freeSpace != 0 )
+        {
+            m_xRatio = (double)m_left / (double)freeSpace;
+        }
+        else
+        {
+            // If the control has the same size as the box, we can't compute
+            // the ratio in the same way (otherwise we would divide by zero).
+            // So we consider that the intent was to keep the control centered
+            // (if you are unhappy with this, go and fix your skin :))
+            m_xRatio = 0.5;
+        }
+    }
+
+    // Initial the vertical ratio
+    if( m_yKeepRatio )
+    {
+        // First compute the width of the box minus the width of the control
+        int freeSpace = m_rBox.getHeight() - (m_bottom - m_top);
+        // Instead of computing left/right, we compute left/(left+right),
+        // which is more convenient in my opinion.
+        if( freeSpace != 0 )
+        {
+            m_yRatio = (double)m_top / (double)freeSpace;
+        }
+        else
+        {
+            // If the control has the same size as the box, we can't compute
+            // the ratio in the same way (otherwise we would divide by zero).
+            // So we consider that the intent was to keep the control centered
+            // (if you are unhappy with this, go and fix your skin :))
+            m_yRatio = 0.5;
+        }
+    }
+
 }
 
 
 int Position::getLeft() const
 {
-    switch( m_refLeftTop )
+    if( m_xKeepRatio )
     {
-        case kLeftTop:
-        case kLeftBottom:
-            return m_left;
-            break;
-        case kRightTop:
-        case kRightBottom:
-            return m_rBox.getWidth() + m_left - 1;
-            break;
+        // Ratio mode
+        // First compute the width of the box minus the width of the control
+        int freeSpace = m_rBox.getWidth() - (m_right - m_left);
+        return (int)(m_xRatio * freeSpace);
+    }
+    else
+    {
+        switch( m_refLeftTop )
+        {
+            case kLeftTop:
+            case kLeftBottom:
+                return m_left;
+                break;
+            case kRightTop:
+            case kRightBottom:
+                return m_rBox.getWidth() + m_left - 1;
+                break;
+        }
+        // Avoid a warning
+        return 0;
     }
-    // Avoid a warning
-    return 0;
 }
 
 
 int Position::getTop() const
 {
-    switch( m_refLeftTop )
+    if( m_yKeepRatio )
+    {
+        // Ratio mode
+        // First compute the height of the box minus the height of the control
+        int freeSpace = m_rBox.getHeight() - (m_bottom - m_top);
+        return (int)(m_yRatio * freeSpace);
+    }
+    else
     {
-        case kLeftTop:
-        case kRightTop:
-            return m_top;
-            break;
-        case kRightBottom:
-        case kLeftBottom:
-            return m_rBox.getHeight() + m_top - 1;
-            break;
+        switch( m_refLeftTop )
+        {
+            case kLeftTop:
+            case kRightTop:
+                return m_top;
+                break;
+            case kRightBottom:
+            case kLeftBottom:
+                return m_rBox.getHeight() + m_top - 1;
+                break;
+        }
+        // Avoid a warning
+        return 0;
     }
-    // Avoid a warning
-    return 0;
 }
 
 
 int Position::getRight() const
 {
-    switch( m_refRighBottom )
+    if( m_xKeepRatio )
     {
-        case kLeftTop:
-        case kLeftBottom:
-            return m_right;
-            break;
-        case kRightTop:
-        case kRightBottom:
-            return m_rBox.getWidth() + m_right - 1;
-            break;
+        // Ratio mode
+        // The width of the control being constant, we can use the result of
+        // getLeft() (this will avoid rounding issues).
+        return getLeft() + m_right - m_left;
+    }
+    else
+    {
+        switch( m_refRighBottom )
+        {
+            case kLeftTop:
+            case kLeftBottom:
+                return m_right;
+                break;
+            case kRightTop:
+            case kRightBottom:
+                return m_rBox.getWidth() + m_right - 1;
+                break;
+        }
+        // Avoid a warning
+        return 0;
     }
-    // Avoid a warning
-    return 0;
 }
 
 
 int Position::getBottom() const
 {
-    switch( m_refRighBottom )
+    if( m_yKeepRatio )
+    {
+        // Ratio mode
+        // The height of the control being constant, we can use the result of
+        // getTop() (this will avoid rounding issues).
+        return getTop() + m_bottom - m_top;
+    }
+    else
     {
-        case kLeftTop:
-        case kRightTop:
-            return m_bottom;
-            break;
-        case kLeftBottom:
-        case kRightBottom:
-            return m_rBox.getHeight() + m_bottom - 1;
-            break;
+        switch( m_refRighBottom )
+        {
+            case kLeftTop:
+            case kRightTop:
+                return m_bottom;
+                break;
+            case kLeftBottom:
+            case kRightBottom:
+                return m_rBox.getHeight() + m_bottom - 1;
+                break;
+        }
+        // Avoid a warning
+        return 0;
     }
-    // Avoid a warning
-    return 0;
 }
 
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/utils/position.hpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/utils/position.hpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/utils/position.hpp	2006-09-18 06:28:21.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/utils/position.hpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * position.hpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: position.hpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: position.hpp 16778 2006-09-21 23:56:47Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -82,8 +82,8 @@
 
         /// Create a new position relative to the given box
         Position( int left, int top, int right, int bottom, const Box &rBox,
-                  Ref_t refLeftTop = kLeftTop,
-                  Ref_t refRightBottom = kLeftTop );
+                  Ref_t refLeftTop, Ref_t refRightBottom,
+                  bool xKeepRatio, bool yKeepRatio );
 
         ~Position() {}
 
@@ -108,6 +108,13 @@
         const Box &m_rBox;
         Ref_t m_refLeftTop;
         Ref_t m_refRighBottom;
+        /// "Keep ratio" mode
+        bool m_xKeepRatio;
+        bool m_yKeepRatio;
+        /// Initial width ratio (usually between 0 and 1)
+        double m_xRatio;
+        /// Initial height ratio (usually between 0 and 1)
+        double m_yRatio;
 };
 
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/skins2/win32/win32_dragdrop.cpp vlc_0.8.6-svn20060925.debian/modules/gui/skins2/win32/win32_dragdrop.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/skins2/win32/win32_dragdrop.cpp	2006-09-18 06:28:22.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/skins2/win32/win32_dragdrop.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * win32_dragdrop.cpp
  *****************************************************************************
  * Copyright (C) 2003 the VideoLAN team
- * $Id: win32_dragdrop.cpp 14118 2006-02-01 18:06:48Z courmisch $
+ * $Id: win32_dragdrop.cpp 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Cyril Deguet     <asmax@via.ecp.fr>
  *          Olivier Teulire <ipkiss@via.ecp.fr>
@@ -158,7 +158,7 @@
         DragQueryFile( HDrop, i, psz_fileName, nameLength );
 
         // Add the file
-        CmdAddItem cmd( getIntf(), psz_fileName, m_playOnDrop );
+        CmdAddItem cmd( getIntf(), sFromLocale( psz_fileName ), m_playOnDrop );
         cmd.execute();
 
         delete[] psz_fileName;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wince/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/wince/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/wince/Makefile.in	2006-09-18 06:30:52.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wince/Makefile.in	2006-09-24 13:12:53.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/bookmarks.cpp vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/bookmarks.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/bookmarks.cpp	2006-09-18 06:28:18.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/bookmarks.cpp	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * bookmarks.cpp : wxWindows plugin for vlc
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: bookmarks.cpp 15370 2006-04-26 23:20:48Z xtophe $
+ * $Id: bookmarks.cpp 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *
@@ -166,13 +166,13 @@
     wxButton *button_extract =
         new wxButton( panel, ButtonExtract_Event, wxU(_("Extract")) );
 
-#define ADD_TEXT "Adds a bookmark at the current position in the stream"
-#define REMOVE_TEXT "Removes the selected bookmarks"
-#define CLEAR_TEXT "Removes all the bookmarks for that stream"
-#define EDIT_TEXT "Edit the properties of a bookmark"
-#define EXTRACT_TEXT "If you select two or more bookmarks, this will " \
+#define ADD_TEXT N_("Adds a bookmark at the current position in the stream")
+#define REMOVE_TEXT N_("Removes the selected bookmarks")
+#define CLEAR_TEXT N_("Removes all the bookmarks for that stream")
+#define EDIT_TEXT N_("Edit the properties of a bookmark")
+#define EXTRACT_TEXT N_("If you select two or more bookmarks, this will " \
                "launch the streaming/transcoding wizard to allow you to " \
-              "stream or save the part of the stream between these bookmarks"
+              "stream or save the part of the stream between these bookmarks")
     button_add->SetToolTip(  wxU(_( ADD_TEXT ) ) );
     button_del->SetToolTip(  wxU(_( REMOVE_TEXT ) ) );
     button_clear->SetToolTip(  wxU(_( CLEAR_TEXT ) ) );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/fileinfo.cpp vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/fileinfo.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/fileinfo.cpp	2006-09-18 06:28:18.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/fileinfo.cpp	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * fileinfo.cpp : wxWindows plugin for vlc
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: fileinfo.cpp 15044 2006-04-02 07:58:36Z zorglub $
+ * $Id: fileinfo.cpp 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Sigmund Augdal Helberg <dnumgis@videolan.org>
  *
@@ -90,7 +90,7 @@
     panel_sizer->Add( notebook, 1, wxEXPAND | wxALL, 5 );
 #endif
 
-    panel_sizer->Add( new wxButton( panel, wxID_CLOSE ) ,
+    panel_sizer->Add( new wxButton( panel, wxID_CLOSE, wxU(_("&Close")) ) ,
                       0, wxALL|wxALIGN_RIGHT, 5 );
 
     panel_sizer->Layout();
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/preferences.cpp vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/preferences.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/preferences.cpp	2006-09-18 06:28:18.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/preferences.cpp	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * preferences.cpp : wxWindows plugin for vlc
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: preferences.cpp 15370 2006-04-26 23:20:48Z xtophe $
+ * $Id: preferences.cpp 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Gildas Bazin <gbazin@netcourrier.com>
  *
@@ -410,7 +410,7 @@
                         i_image = 6; break;
                 }
                 current_item = AppendItem( root_item,
-                                           wxU( config_data->psz_name ),
+                                           wxU( _(config_data->psz_name) ),
                                            i_image, -1, config_data );
 
                 break;
@@ -483,7 +483,7 @@
                 #else
                 i_image = -1;
                 #endif
-                AppendItem( current_item, wxU( config_data->psz_name ),
+                AppendItem( current_item, wxU( _(config_data->psz_name) ),
                             i_image, -1, config_data );
                 break;
             }
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/preferences_widgets.cpp vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/preferences_widgets.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/dialogs/preferences_widgets.cpp	2006-09-18 06:28:18.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/dialogs/preferences_widgets.cpp	2006-09-24 13:09:01.000000000 -0400
@@ -2,7 +2,7 @@
  * preferences_widgets.cpp : wxWindows plugin for vlc
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: preferences_widgets.cpp 16441 2006-08-30 21:36:35Z hartman $
+ * $Id: preferences_widgets.cpp 16798 2006-09-22 23:56:12Z xtophe $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *          Sigmund Augdal Helberg <dnumgis@videolan.org>
@@ -709,7 +709,7 @@
 #if defined( __WXMSW__ )
                              wxOPEN
 #else
-                             wxOPEN | wxSAVE
+                             wxOPEN
 #endif
                            );
         if( dialog.ShowModal() == wxID_OK )
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/Makefile.in vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/Makefile.in	2006-09-18 06:30:53.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/Makefile.in	2006-09-24 13:12:56.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/menus.cpp vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/menus.cpp
--- vlc_0.8.6-svn20060918.debian/modules/gui/wxwidgets/menus.cpp	2006-09-18 06:28:21.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/gui/wxwidgets/menus.cpp	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * menus.cpp : wxWidgets plugin for vlc
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: menus.cpp 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: menus.cpp 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *
@@ -174,6 +174,7 @@
                                                  FIND_PARENT );
     if( p_dec_obj != NULL )
     {
+        vlc_object_t *p_object = p_dec_obj;
         PUSH_VAR( "ffmpeg-pp-q" );
         vlc_object_release( p_dec_obj );
     }
diff -uNr vlc_0.8.6-svn20060918.debian/modules/Makefile.in vlc_0.8.6-svn20060925.debian/modules/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/Makefile.in	2006-09-18 06:30:32.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/Makefile.in	2006-09-24 13:11:59.000000000 -0400
@@ -115,12 +115,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -152,9 +153,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -246,7 +244,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/dummy/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/dummy/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/dummy/Makefile.in	2006-09-18 06:30:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/dummy/Makefile.in	2006-09-24 13:13:01.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/gnutls.c vlc_0.8.6-svn20060925.debian/modules/misc/gnutls.c
--- vlc_0.8.6-svn20060918.debian/modules/misc/gnutls.c	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/gnutls.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * gnutls.c
  *****************************************************************************
  * Copyright (C) 2004-2006 Rmi Denis-Courmont
- * $Id: gnutls.c 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: gnutls.c 16775 2006-09-21 20:35:23Z hartman $
  *
  * Authors: Rmi Denis-Courmont <rem # videolan.org>
  *
@@ -21,17 +21,12 @@
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston MA 02110-1301, USA.
  *****************************************************************************/
 
-/*
- * TODO:
- * - fix FIXMEs
- */
-
-
 /*****************************************************************************
  * Preamble
  *****************************************************************************/
 #include <stdlib.h>
 #include <errno.h>
+#include <time.h>
 #include <vlc/vlc.h>
 
 #include <sys/types.h>
@@ -305,56 +300,128 @@
     return 0;
 }
 
+
+typedef struct
+{
+    int flag;
+    const char *msg;
+} error_msg_t;
+
+static const error_msg_t cert_errors[] =
+{
+    { GNUTLS_CERT_INVALID,
+        "Certificate could not be verified" },
+    { GNUTLS_CERT_REVOKED,
+        "Certificate was revoked" },
+    { GNUTLS_CERT_SIGNER_NOT_FOUND,
+        "Certificate's signer was not found" },
+    { GNUTLS_CERT_SIGNER_NOT_CA,
+        "Certificate's signer is not a CA" },
+    { GNUTLS_CERT_INSECURE_ALGORITHM,
+        "Insecure certificate signature algorithm" },
+    { 0, NULL }
+};
+
+
 static int
-gnutls_HandshakeAndValidate( tls_session_t *p_session )
+gnutls_HandshakeAndValidate( tls_session_t *session )
 {
-    int val;
+    int val = gnutls_ContinueHandshake( session );
+    if( val )
+        return val;
 
-    val = gnutls_ContinueHandshake( p_session );
-    if( val == 0 )
-    {
-        unsigned status;
-        tls_session_sys_t *p_sys;
+    tls_session_sys_t *p_sys = (tls_session_sys_t *)(session->p_sys);
 
-        p_sys = (tls_session_sys_t *)(p_session->p_sys);
-        /* certificates chain verification */
-        val = gnutls_certificate_verify_peers2( p_sys->session, &status );
+    /* certificates chain verification */
+    unsigned status;
+    val = gnutls_certificate_verify_peers2( p_sys->session, &status );
 
-        if( val )
+    if( val )
+    {
+        msg_Err( session, "Certificate verification failed: %s",
+                 gnutls_strerror( val ) );
+        goto error;
+    }
+
+    if( status )
+    {
+        const error_msg_t *e;
+        msg_Err( session, "TLS session: access denied" );
+        for( e = cert_errors; e->flag; e++ )
         {
-            msg_Err( p_session, "TLS certificate verification failed: %s",
-                     gnutls_strerror( val ) );
-            p_session->pf_close( p_session );
-            return -1;
+            if( status & e->flag )
+            {
+                msg_Err( session, e->msg );
+                status &= ~e->flag;
+            }
         }
 
         if( status )
-        {
-            msg_Warn( p_session, "TLS session: access denied" );
-            if( status & GNUTLS_CERT_INVALID )
-                msg_Dbg( p_session, "certificate could not be verified" );
-            if( status & GNUTLS_CERT_REVOKED )
-                msg_Dbg( p_session, "certificate was revoked" );
-            if( status & GNUTLS_CERT_SIGNER_NOT_FOUND )
-                msg_Dbg( p_session, "certificate's signer was not found" );
-            if( status & GNUTLS_CERT_SIGNER_NOT_CA )
-                msg_Dbg( p_session, "certificate's signer is not a CA" );
-            p_session->pf_close( p_session );
-            return -1;
-        }
+            msg_Err( session,
+                     "unknown certificate error (you found a bug in VLC)" );
+
+        goto error;
+    }
+
+    /* certificate (host)name verification */
+    const gnutls_datum *data = gnutls_certificate_get_peers( p_sys->session,
+                                                             &(size_t){ 0 } );
+    if( data == NULL )
+    {
+        msg_Err( session, "Peer certificate not available" );
+        goto error;
+    }
+
+    gnutls_x509_crt cert;
+    val = gnutls_x509_crt_init( &cert );
+    if( val )
+    {
+        msg_Err( session, "x509 fatal error: %s", gnutls_strerror( val ) );
+        goto error;
+    }
 
-        msg_Dbg( p_session, "TLS certificate verified" );
-        if( ( p_sys->psz_hostname != NULL )
-         && gnutls_VerifyHostname( (vlc_object_t *)p_session, p_sys->session,
-                                   p_sys->psz_hostname ) )
+    val = gnutls_x509_crt_import( cert, data, GNUTLS_X509_FMT_DER );
+    if( val )
+    {
+        msg_Err( session, "Certificate import error: %s",
+                 gnutls_strerror( val ) );
+        gnutls_x509_crt_deinit( cert );
+        goto crt_error;
+    }
+
+    if( p_sys->psz_hostname != NULL )
+    {
+        if ( !gnutls_x509_crt_check_hostname( cert, p_sys->psz_hostname ) )
         {
-            p_session->pf_close( p_session );
-            return -1;
+            msg_Err( session, "Certificate does not match \"%s\"",
+                     p_sys->psz_hostname );
+            goto crt_error;
         }
-        return 0;
+    }
+    else
+        msg_Warn( session, "Certificate and hostname were not verified" );
+
+    if( gnutls_x509_crt_get_expiration_time( cert ) < time( NULL ) )
+    {
+        msg_Err( session, "Certificate expired" );
+        goto crt_error;
     }
 
-    return val;
+    if( gnutls_x509_crt_get_activation_time( cert ) > time ( NULL ) )
+    {
+        msg_Err( session, "Certificate not yet valid" );
+        goto crt_error;
+    }
+
+    gnutls_x509_crt_deinit( cert );
+    msg_Dbg( session, "TLS/x509 certificate verified" );
+    return 0;
+
+crt_error:
+    gnutls_x509_crt_deinit( cert );
+error:
+    session->pf_close( session );
+    return -1;
 }
 
 /**
@@ -1009,7 +1076,6 @@
     /* No certificate validation by default */
     p_sys->pf_handshake2 = gnutls_ContinueHandshake;
 
-    /* FIXME: check for errors */
     vlc_mutex_init( p_server, &p_sys->cache_lock );
 
     /* Sets server's credentials */
@@ -1069,10 +1135,16 @@
 }
 
 
+#ifdef LIBVLC_USE_PTHREAD
+GCRY_THREAD_OPTION_PTHREAD_IMPL;
+# define gcry_threads_vlc gcry_threads_pthread
+#else
 /**
  * gcrypt thread option VLC implementation
  */
-vlc_object_t *__p_gcry_data;
+
+# define NEED_THREAD_CONTEXT 1
+static vlc_object_t *__p_gcry_data;
 
 static int gcry_vlc_mutex_init( void **p_sys )
 {
@@ -1119,6 +1191,7 @@
     gcry_vlc_mutex_lock,
     gcry_vlc_mutex_unlock
 };
+#endif
 
 
 /*****************************************************************************
@@ -1141,9 +1214,9 @@
 
     if( count.i_int == 0)
     {
-        const char *psz_version;
-
+#ifdef NEED_THREAD_CONTEXT
         __p_gcry_data = VLC_OBJECT( p_this->p_vlc );
+#endif
 
         gcry_control (GCRYCTL_SET_THREAD_CBS, &gcry_threads_vlc);
         if( gnutls_global_init( ) )
@@ -1152,11 +1225,8 @@
             vlc_mutex_unlock( lock.p_address );
             return VLC_EGENERIC;
         }
-        /*
-         * FIXME: in fact, we currently depends on 1.0.17, but it breaks on
-         * Debian which as a patched 1.0.16 (which we can use).
-         */
-        psz_version = gnutls_check_version( "1.0.16" );
+
+        const char *psz_version = gnutls_check_version( "1.2.9" );
         if( psz_version == NULL )
         {
             gnutls_global_deinit( );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/Makefile.in	2006-09-18 06:30:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/Makefile.in	2006-09-24 13:13:00.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/memcpy/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/memcpy/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/memcpy/Makefile.in	2006-09-18 06:30:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/memcpy/Makefile.in	2006-09-24 13:13:02.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/network/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/network/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/network/Makefile.in	2006-09-18 06:30:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/network/Makefile.in	2006-09-24 13:13:03.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/playlist/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/playlist/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/playlist/Makefile.in	2006-09-18 06:30:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/playlist/Makefile.in	2006-09-24 13:13:04.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/playlist/xspf.c vlc_0.8.6-svn20060925.debian/modules/misc/playlist/xspf.c
--- vlc_0.8.6-svn20060918.debian/modules/misc/playlist/xspf.c	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/playlist/xspf.c	2006-09-22 11:14:31.000000000 -0400
@@ -23,8 +23,10 @@
 #include <stdio.h>
 #include <vlc/vlc.h>
 #include <vlc/intf.h>
+
 #include "vlc_meta.h"
 #include "vlc_strings.h"
+#include "charset.h"
 #include "xspf.h"
 #include "charset.h"
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/rtsp.c vlc_0.8.6-svn20060925.debian/modules/misc/rtsp.c
--- vlc_0.8.6-svn20060918.debian/modules/misc/rtsp.c	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/rtsp.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * rtsp.c: rtsp VoD server module
  *****************************************************************************
  * Copyright (C) 2003-2006 the VideoLAN team
- * $Id: rtsp.c 16442 2006-08-30 22:15:52Z hartman $
+ * $Id: rtsp.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
@@ -1193,9 +1193,9 @@
         sizeof( "i=*\r\n" ) + strlen( p_media->psz_session_description ) +
         sizeof( "u=*\r\n" ) + strlen( p_media->psz_session_url ) +
         sizeof( "e=*\r\n" ) + strlen( p_media->psz_session_email ) +
+        sizeof( "c=IN IP4 0.0.0.0\r\n" ) + 20 + 10 +
         sizeof( "t=0 0\r\n" ) + /* FIXME */
         sizeof( "a=tool:"PACKAGE_STRING"\r\n" ) +
-        sizeof( "c=IN IP4 0.0.0.0\r\n" ) + 20 + 10 +
         sizeof( "a=range:npt=0-1000000000.000\r\n" );
 
     psz_control = (ipv == '6') ? p_media->psz_rtsp_control_v6
@@ -1231,11 +1231,10 @@
     if( *p_media->psz_session_email )
         p += sprintf( p, "e=%s\r\n", p_media->psz_session_email );
 
+    p += sprintf( p, "c=IN IP%c %s\r\n", ipv, ipv == '6' ? "::" : "0.0.0.0" );
     p += sprintf( p, "t=0 0\r\n" ); /* FIXME */
     p += sprintf( p, "a=tool:"PACKAGE_STRING"\r\n" );
 
-    p += sprintf( p, "c=IN IP%c %s\r\n", ipv, ipv == '6' ? "::" : "0.0.0.0" );
-
     if( p_media->i_length > 0 )
     {
         lldiv_t d = lldiv( p_media->i_length / 1000, 1000 );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/testsuite/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/testsuite/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/testsuite/Makefile.in	2006-09-18 06:30:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/testsuite/Makefile.in	2006-09-24 13:13:05.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/misc/xml/Makefile.in vlc_0.8.6-svn20060925.debian/modules/misc/xml/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/misc/xml/Makefile.in	2006-09-18 06:30:57.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/misc/xml/Makefile.in	2006-09-24 13:13:06.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/mux/Makefile.in vlc_0.8.6-svn20060925.debian/modules/mux/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/mux/Makefile.in	2006-09-18 06:30:57.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/mux/Makefile.in	2006-09-24 13:13:08.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/mux/mp4.c vlc_0.8.6-svn20060925.debian/modules/mux/mp4.c
--- vlc_0.8.6-svn20060918.debian/modules/mux/mp4.c	2006-09-18 06:28:27.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/mux/mp4.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * mp4.c: mp4/mov muxer
  *****************************************************************************
  * Copyright (C) 2001, 2002, 2003, 2006 the VideoLAN team
- * $Id: mp4.c 15006 2006-03-31 16:39:23Z zorglub $
+ * $Id: mp4.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Gildas Bazin <gbazin at videolan dot org>
@@ -118,6 +118,7 @@
     struct
     {
         int     i_profile;
+        int     i_profile_compat;
         int     i_level;
 
         int     i_sps;
@@ -440,7 +441,8 @@
     p_stream->i_dts_start   = 0;
     p_stream->i_duration    = 0;
     p_stream->avc.i_profile = 77;
-    p_stream->avc.i_level   = 51;
+    p_stream->avc.i_profile_compat = 64;
+    p_stream->avc.i_level   = 30;
     p_stream->avc.i_sps     = 0;
     p_stream->avc.sps       = NULL;
     p_stream->avc.i_pps     = 0;
@@ -721,6 +723,7 @@
             memcpy( tk->avc.sps, &last[4], i_size );
 
             tk->avc.i_profile = tk->avc.sps[1];
+            tk->avc.i_profile = tk->avc.sps[2];
             tk->avc.i_level   = tk->avc.sps[3];
         }
         else if( (last[4]&0x1f) == 8 && tk->avc.i_pps <= 0 )   /* PPS */
@@ -930,7 +933,7 @@
     avcC = box_new( "avcC" );
     bo_add_8( avcC, 1 );      /* configuration version */
     bo_add_8( avcC, p_stream->avc.i_profile );
-    bo_add_8( avcC, p_stream->avc.i_profile );     /* profile compatible ??? */
+    bo_add_8( avcC, p_stream->avc.i_profile_compat );
     bo_add_8( avcC, p_stream->avc.i_level );       /* level, 5.1 */
     bo_add_8( avcC, 0xff );   /* 0b11111100 | lengthsize = 0x11 */
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/mux/mpeg/Makefile.in vlc_0.8.6-svn20060925.debian/modules/mux/mpeg/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/mux/mpeg/Makefile.in	2006-09-18 06:30:57.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/mux/mpeg/Makefile.in	2006-09-24 13:13:08.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/mux/rtp/Makefile.in vlc_0.8.6-svn20060925.debian/modules/mux/rtp/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/mux/rtp/Makefile.in	2006-09-18 06:30:57.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/mux/rtp/Makefile.in	2006-09-24 13:13:09.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/packetizer/h264.c vlc_0.8.6-svn20060925.debian/modules/packetizer/h264.c
--- vlc_0.8.6-svn20060918.debian/modules/packetizer/h264.c	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/packetizer/h264.c	2006-09-22 11:14:31.000000000 -0400
@@ -2,7 +2,7 @@
  * h264.c: h264/avc video packetizer
  *****************************************************************************
  * Copyright (C) 2001, 2002, 2006 the VideoLAN team
- * $Id: h264.c 14918 2006-03-25 12:54:27Z fkuehne $
+ * $Id: h264.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Eric Petit <titer@videolan.org>
@@ -84,6 +84,7 @@
     int i_nal_ref_idc;
     int i_idr_pic_id;
     int i_frame_num;
+    int i_frame_type;
 };
 
 enum
@@ -121,6 +122,8 @@
 
 /*****************************************************************************
  * Open: probe the packetizer and return score
+ * When opening after demux, the packetizer is only loaded AFTER the decoder
+ * That means that what you set in fmt_out is ignored by the decoder in this special case
  *****************************************************************************/
 static int Open( vlc_object_t *p_this )
 {
@@ -131,6 +134,7 @@
         p_dec->fmt_in.i_codec != VLC_FOURCC( 'H', '2', '6', '4') &&
         p_dec->fmt_in.i_codec != VLC_FOURCC( 'V', 'S', 'S', 'H') &&
         p_dec->fmt_in.i_codec != VLC_FOURCC( 'v', 's', 's', 'h') &&
+        p_dec->fmt_in.i_codec != VLC_FOURCC( 'D', 'A', 'V', 'C') &&
         ( p_dec->fmt_in.i_codec != VLC_FOURCC( 'a', 'v', 'c', '1') ||
           p_dec->fmt_in.i_extra < 7 ) )
     {
@@ -161,16 +165,18 @@
     p_sys->i_nal_ref_idc = -1;
     p_sys->i_idr_pic_id = -1;
     p_sys->i_frame_num = -1;
+    p_sys->i_frame_type = 0;
 
     /* Setup properties */
     es_format_Copy( &p_dec->fmt_out, &p_dec->fmt_in );
     p_dec->fmt_out.i_codec = VLC_FOURCC( 'h', '2', '6', '4' );
-    /* FIXME: FFMPEG isn't happy at all if you leave this */
-    if( p_dec->fmt_out.i_extra ) free( p_dec->fmt_out.p_extra );
-    p_dec->fmt_out.i_extra = 0; p_dec->fmt_out.p_extra = 0;
 
     if( p_dec->fmt_in.i_codec == VLC_FOURCC( 'a', 'v', 'c', '1' ) )
     {
+        /* This type of stream is produced by mp4 and matroska
+         * when we want to store it in another streamformat, you need to convert
+         * The fmt_in.p_extra should ALWAYS contain the avcC
+         * The fmt_out.p_extra should contain all the SPS and PPS with 4 byte startcodes */
         uint8_t *p = &((uint8_t*)p_dec->fmt_in.p_extra)[4];
         int i_sps, i_pps;
         int i;
@@ -180,7 +186,6 @@
 
         /* Read SPS */
         i_sps = (*p++)&0x1f;
-
         for( i = 0; i < i_sps; i++ )
         {
             int i_length = GetWBE( p );
@@ -206,11 +211,25 @@
         msg_Dbg( p_dec, "avcC length size=%d, sps=%d, pps=%d",
                  p_sys->i_avcC_length_size, i_sps, i_pps );
 
+        /* FIXME: FFMPEG isn't happy at all if you leave this */
+        if( p_dec->fmt_out.i_extra ) free( p_dec->fmt_out.p_extra );
+        p_dec->fmt_out.i_extra = 0; p_dec->fmt_out.p_extra = NULL;
+        
+        /* Set the new extradata */
+        p_dec->fmt_out.i_extra = p_sys->p_pps->i_buffer + p_sys->p_sps->i_buffer;
+        p_dec->fmt_out.p_extra = (uint8_t*)malloc( p_dec->fmt_out.i_extra );
+        memcpy( p_dec->fmt_out.p_extra, p_sys->p_sps->p_buffer, p_sys->p_sps->i_buffer);
+        memcpy( p_dec->fmt_out.p_extra+p_sys->p_sps->i_buffer, p_sys->p_pps->p_buffer, p_sys->p_pps->i_buffer);
+
         /* Set callback */
         p_dec->pf_packetize = PacketizeAVC1;
     }
     else
     {
+        /* This type of stream contains data with 3 of 4 byte startcodes 
+         * The fmt_in.p_extra MAY contain SPS/PPS with 4 byte startcodes
+         * The fmt_out.p_extra should be the same */
+         
         /* Set callback */
         p_dec->pf_packetize = Packetize;
 
@@ -251,6 +270,8 @@
 
 /****************************************************************************
  * Packetize: the whole thing
+ * Search for the startcodes 3 or more bytes
+ * Feed ParseNALBlock ALWAYS with 4 byte startcode prepended NALs
  ****************************************************************************/
 static block_t *Packetize( decoder_t *p_dec, block_t **pp_block )
 {
@@ -266,6 +287,7 @@
         switch( p_sys->i_state )
         {
             case STATE_NOSYNC:
+                /* Skip until 3 byte startcode 0 0 1 */
                 if( block_FindStartcodeFromOffset( &p_sys->bytestream,
                       &p_sys->i_offset, p_sys->startcode+1, 3 ) == VLC_SUCCESS)
                 {
@@ -274,6 +296,7 @@
 
                 if( p_sys->i_offset )
                 {
+                    /* skip the data */
                     block_SkipBytes( &p_sys->bytestream, p_sys->i_offset );
                     p_sys->i_offset = 0;
                     block_BytestreamFlush( &p_sys->bytestream );
@@ -288,7 +311,7 @@
                 p_sys->i_offset = 1; /* To find next startcode */
 
             case STATE_NEXT_SYNC:
-                /* Find the next startcode */
+                /* Find the next 3 byte startcode 0 0 1*/
                 if( block_FindStartcodeFromOffset( &p_sys->bytestream,
                       &p_sys->i_offset, p_sys->startcode+1, 3 ) != VLC_SUCCESS)
                 {
@@ -297,14 +320,17 @@
                 }
 
                 /* Get the new fragment and set the pts/dts */
-                p_pic = block_New( p_dec, p_sys->i_offset );
+                p_pic = block_New( p_dec, p_sys->i_offset +1 );
                 p_pic->i_pts = p_sys->bytestream.p_block->i_pts;
                 p_pic->i_dts = p_sys->bytestream.p_block->i_dts;
+                /* Force 4 byte startcode 0 0 0 1 */
+                p_pic->p_buffer[0] = 0;
 
-                block_GetBytes( &p_sys->bytestream, p_pic->p_buffer,
-                                p_pic->i_buffer );
+                block_GetBytes( &p_sys->bytestream, &p_pic->p_buffer[1],
+                                p_pic->i_buffer-1 );
 
-                if( !p_pic->p_buffer[p_pic->i_buffer-1] ) p_pic->i_buffer--;
+                /* Remove trailing 0 bytes */
+                while( p_pic->i_buffer && (!p_pic->p_buffer[p_pic->i_buffer-1] ) ) p_pic->i_buffer--;
                 p_sys->i_offset = 0;
 
                 /* Parse the NAL */
@@ -329,7 +355,9 @@
 }
 
 /****************************************************************************
- * PacketizeAVC1: the whole thing
+ * PacketizeAVC1: Takes VCL blocks of data and creates annexe B type NAL stream
+ * Will always use 4 byte 0 0 0 1 startcodes
+ * Will prepend a SPS and PPS before each keyframe
  ****************************************************************************/
 static block_t *PacketizeAVC1( decoder_t *p_dec, block_t **pp_block )
 {
@@ -343,22 +371,6 @@
     p_block = *pp_block;
     *pp_block = NULL;
 
-#if 0
-    if( //(p_block->i_flags & BLOCK_FLAG_TYPE_I) &&
-        p_sys->p_sps && p_sys->p_pps )
-    {
-        block_t *p_pic;
-        block_t *p_sps = block_Duplicate( p_sys->p_sps );
-        block_t *p_pps = block_Duplicate( p_sys->p_pps );
-        p_sps->i_dts = p_pps->i_dts = p_block->i_dts;
-        p_sps->i_pts = p_pps->i_pts = p_block->i_pts;
-        p_pic = ParseNALBlock( p_dec, p_sps );
-        if( p_pic ) block_ChainAppend( &p_ret, p_pic );
-        p_pic = ParseNALBlock( p_dec, p_pps );
-        if( p_pic ) block_ChainAppend( &p_ret, p_pic );
-    }
-#endif
-
     for( p = p_block->p_buffer; p < &p_block->p_buffer[p_block->i_buffer]; )
     {
         block_t *p_pic;
@@ -394,15 +406,16 @@
 {
     block_t *p_nal;
 
-    p_nal = block_New( p_dec, 3 + i_size );
+    p_nal = block_New( p_dec, 4 + i_size );
 
     /* Add start code */
     p_nal->p_buffer[0] = 0x00;
     p_nal->p_buffer[1] = 0x00;
-    p_nal->p_buffer[2] = 0x01;
+    p_nal->p_buffer[2] = 0x00;
+    p_nal->p_buffer[3] = 0x01;
 
     /* Copy nalu */
-    memcpy( &p_nal->p_buffer[3], p, i_size );
+    memcpy( &p_nal->p_buffer[4], p, i_size );
 
     return p_nal;
 }
@@ -451,21 +464,39 @@
 }
 
 
+/*****************************************************************************
+ * ParseNALBlock: parses annexB type NALs
+ * All p_frag blocks are required to start with 0 0 0 1 4-byte startcode 
+ *****************************************************************************/
 static block_t *ParseNALBlock( decoder_t *p_dec, block_t *p_frag )
 {
     decoder_sys_t *p_sys = p_dec->p_sys;
     block_t *p_pic = NULL;
 
-    const int i_nal_ref_idc = (p_frag->p_buffer[3] >> 5)&0x03;
-    const int i_nal_type = p_frag->p_buffer[3]&0x1f;
+    const int i_nal_ref_idc = (p_frag->p_buffer[4] >> 5)&0x03;
+    const int i_nal_type = p_frag->p_buffer[4]&0x1f;
 
 #define OUTPUT \
-    do {                                                \
-        p_pic = block_ChainGather( p_sys->p_frame );    \
-        p_pic->i_length = 0;    /* FIXME */             \
-                                                        \
-        p_sys->p_frame = NULL;                          \
-        p_sys->b_slice = VLC_FALSE;                     \
+    do {                                                      \
+        p_pic = block_ChainGather( p_sys->p_frame );          \
+        p_pic->i_length = 0;    /* FIXME */                   \
+        p_pic->i_flags |= p_sys->i_frame_type;                \
+                                                              \
+        p_sys->i_frame_type = 0;                              \
+        p_sys->p_frame = NULL;                                \
+        p_sys->b_slice = VLC_FALSE;                           \
+                                                              \
+        if( ( p_pic->i_flags & BLOCK_FLAG_TYPE_I ) &&         \
+              p_sys->p_sps && p_sys->p_pps )                  \
+        {                                                     \
+            block_t *p_sps = block_Duplicate( p_sys->p_sps ); \
+            block_t *p_pps = block_Duplicate( p_sys->p_pps ); \
+            p_sps->i_dts = p_pps->i_dts = p_pic->i_dts;       \
+            p_sps->i_pts = p_pps->i_pts = p_pic->i_pts;       \
+            block_ChainAppend( &p_sps, p_pps );               \
+            block_ChainAppend( &p_sps, p_pic );               \
+            p_pic = block_ChainGather( p_sps );               \
+        }                                                     \
     } while(0)
 
 
@@ -488,13 +519,13 @@
     else if( i_nal_type >= NAL_SLICE && i_nal_type <= NAL_SLICE_IDR )
     {
         uint8_t *dec;
-        int i_dec, i_first_mb, i_slice_type, i_frame_num, i_pic_flags = 0;
+        int i_dec, i_first_mb, i_slice_type, i_frame_num;
         vlc_bool_t b_pic = VLC_FALSE;
         bs_t s;
 
         /* do not convert the whole frame */
-        nal_get_decoded( &dec, &i_dec, &p_frag->p_buffer[4],
-                         __MIN( p_frag->i_buffer - 4, 60 ) );
+        nal_get_decoded( &dec, &i_dec, &p_frag->p_buffer[5],
+                         __MIN( p_frag->i_buffer - 5, 60 ) );
         bs_init( &s, dec, i_dec );
 
         /* first_mb_in_slice */
@@ -503,21 +534,21 @@
         /* slice_type */
         switch( (i_slice_type = bs_read_ue( &s )) )
         {
-            case 0: case 5:
-                i_pic_flags = BLOCK_FLAG_TYPE_P;
-                break;
-            case 1: case 6:
-                i_pic_flags = BLOCK_FLAG_TYPE_B;
-                break;
-            case 2: case 7:
-                i_pic_flags = BLOCK_FLAG_TYPE_I;
-                break;
-            case 3: case 8: /* SP */
-                i_pic_flags = BLOCK_FLAG_TYPE_P;
-                break;
-            case 4: case 9:
-                i_pic_flags = BLOCK_FLAG_TYPE_I;
-                break;
+        case 0: case 5:
+            p_sys->i_frame_type = BLOCK_FLAG_TYPE_P;
+            break;
+        case 1: case 6:
+            p_sys->i_frame_type = BLOCK_FLAG_TYPE_B;
+            break;
+        case 2: case 7:
+            p_sys->i_frame_type = BLOCK_FLAG_TYPE_I;
+            break;
+        case 3: case 8: /* SP */
+            p_sys->i_frame_type = BLOCK_FLAG_TYPE_P;
+            break;
+        case 4: case 9:
+            p_sys->i_frame_type = BLOCK_FLAG_TYPE_I;
+            break;
         }
 
         /* pic_parameter_set_id */
@@ -573,8 +604,8 @@
 
         p_sys->b_sps = VLC_TRUE;
 
-        nal_get_decoded( &dec, &i_dec, &p_frag->p_buffer[4],
-                         p_frag->i_buffer - 4 );
+        nal_get_decoded( &dec, &i_dec, &p_frag->p_buffer[5],
+                         p_frag->i_buffer - 5 );
 
         bs_init( &s, dec, i_dec );
         /* Skip profile(8), constraint_set012, reserver(5), level(8) */
@@ -679,13 +710,19 @@
 
         free( dec );
 
-
         if( p_sys->b_slice ) OUTPUT;
+
+        /* We have a new SPS */
+        if( p_sys->p_sps ) block_Release( p_sys->p_sps );
+        p_sys->p_sps = p_frag;
+
+        /* Do not append the SPS because we will insert it on keyframes */
+        return p_pic;
     }
     else if( i_nal_type == NAL_PPS )
     {
         bs_t s;
-        bs_init( &s, &p_frag->p_buffer[4], p_frag->i_buffer - 4 );
+        bs_init( &s, &p_frag->p_buffer[5], p_frag->i_buffer - 5 );
 
         if( !p_sys->b_pps ) msg_Dbg( p_dec, "found NAL_PPS" );
         p_sys->b_pps = VLC_TRUE;
@@ -693,6 +730,13 @@
         /* TODO */
 
         if( p_sys->b_slice ) OUTPUT;
+
+        /* We have a new PPS */
+        if( p_sys->p_pps ) block_Release( p_sys->p_pps );
+        p_sys->p_pps = p_frag;
+
+        /* Do not append the PPS because we will insert it on keyframes */
+        return p_pic;
     }
     else if( i_nal_type == NAL_AU_DELIMITER ||
              i_nal_type == NAL_SEI ||
diff -uNr vlc_0.8.6-svn20060918.debian/modules/packetizer/Makefile.in vlc_0.8.6-svn20060925.debian/modules/packetizer/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/packetizer/Makefile.in	2006-09-18 06:30:58.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/packetizer/Makefile.in	2006-09-24 13:13:10.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/services_discovery/Makefile.in vlc_0.8.6-svn20060925.debian/modules/services_discovery/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/services_discovery/Makefile.in	2006-09-18 06:30:58.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/services_discovery/Makefile.in	2006-09-24 13:13:11.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/services_discovery/upnp_intel.cpp vlc_0.8.6-svn20060925.debian/modules/services_discovery/upnp_intel.cpp
--- vlc_0.8.6-svn20060918.debian/modules/services_discovery/upnp_intel.cpp	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/services_discovery/upnp_intel.cpp	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * Upnp_intell.cpp :  UPnP discovery module (Intel SDK)
  *****************************************************************************
  * Copyright (C) 2004-2006 the VideoLAN team
- * $Id: upnp_intel.cpp 14727 2006-03-11 23:19:59Z dionoea $
+ * $Id: upnp_intel.cpp 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Rmi Denis-Courmont <rem # videolan.org> (original plugin)
  *          Christian Henz <henz # c-lab.de>
@@ -411,7 +411,9 @@
     if ( !textNode ) return 0;
 
     const char* resultString = ixmlNode_getNodeValue( textNode );
-    char* resultXML = convert_xml_special_chars( resultString );
+    char* resultXML = strdup( resultString );
+    
+    resolve_xml_special_chars( resultXML );
 
     IXML_Document* browseDoc = ixmlParseBuffer( resultXML );
 
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/bridge.c vlc_0.8.6-svn20060925.debian/modules/stream_out/bridge.c
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/bridge.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/bridge.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * bridge.c: bridge stream output module
  *****************************************************************************
  * Copyright (C) 2005 the VideoLAN team
- * $Id: bridge.c 15000 2006-03-31 15:30:32Z zorglub $
+ * $Id: bridge.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *
@@ -40,7 +40,7 @@
 
 #define DELAY_TEXT N_("Delay")
 #define DELAY_LONGTEXT N_("Pictures coming from the picture video outputs " \
-        "will be delayed accord to thi value (in milliseconds, should be "\
+        "will be delayed according to this value (in milliseconds, should be "\
         ">= 100 ms). For high values, you will need to raise caching values." )
 
 #define ID_OFFSET_TEXT N_("ID Offset")
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/Makefile.in vlc_0.8.6-svn20060925.debian/modules/stream_out/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/Makefile.in	2006-09-18 06:30:59.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/Makefile.in	2006-09-24 13:13:13.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/mosaic_bridge.c vlc_0.8.6-svn20060925.debian/modules/stream_out/mosaic_bridge.c
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/mosaic_bridge.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/mosaic_bridge.c	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * mosaic_bridge.c:
  *****************************************************************************
  * Copyright (C) 2004-2005 the VideoLAN team
- * $Id: mosaic_bridge.c 14912 2006-03-25 10:57:34Z zorglub $
+ * $Id: mosaic_bridge.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Antoine Cellerier <dionoea@videolan.org>
  *          Christophe Massiot <massiot@via.ecp.fr>
@@ -431,7 +431,10 @@
 
         if ( p_sys->i_height || p_sys->i_width )
         {
-            video_format_t fmt_out = {0}, fmt_in = {0};
+            video_format_t fmt_out, fmt_in;
+
+            memset( &fmt_in, 0, sizeof(video_format_t) );
+            memset( &fmt_out, 0, sizeof(video_format_t) );
             fmt_in = p_sys->p_decoder->fmt_out.video;
 
             fmt_out.i_chroma = VLC_FOURCC('Y','U','V','A');
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/rtp.c vlc_0.8.6-svn20060925.debian/modules/stream_out/rtp.c
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/rtp.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/rtp.c	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * rtp.c: rtp stream output module
  *****************************************************************************
  * Copyright (C) 2003-2004 the VideoLAN team
- * $Id: rtp.c 16610 2006-09-11 08:27:37Z sam $
+ * $Id: rtp.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *
@@ -524,17 +524,11 @@
         }
 
         /* create the SDP for a muxed stream (only once) */
-        /* FIXME  http://www.faqs.org/rfcs/rfc2327.html
-           All text fields should be UTF-8 encoded. Use global a:charset to announce this.
+        /* FIXME  http://www.faqs.org/rfcs/rfc4566.html
            o= - should be local username (no spaces allowed)
-           o= time should be hashed with some other value to garantue uniqueness
-           o= we need IP6 support?
+           o= time should be hashed with some other value to garantee uniqueness
            o= don't use the localhost address. use fully qualified domain name or IP4 address
-           p= international phone number (pass via vars?)
-           c= IP6 support
-           a= recvonly (missing)
-           a= type:broadcast (missing)
-           a= charset: (normally charset should be UTF-8, this can be used to override s= and i=)
+	   a= source-filter: we need our source address
            a= x-plgroup: (missing)
            RTP packets need to get the correct src IP address  */
         if( net_AddressIsMulticast( (vlc_object_t *)p_stream, p_sys->psz_destination ) )
@@ -555,9 +549,11 @@
                   "i=%s\r\n"
                   "u=%s\r\n"
                   "e=%s\r\n"
+                  "c=IN IP%c %s%s\r\n"
                   "t=0 0\r\n" /* permanent stream */ /* when scheduled from vlm, we should set this info correctly */
                   "a=tool:"PACKAGE_STRING"\r\n"
-                  "c=IN IP%c %s%s\r\n"
+                  "a=recvonly\r\n"
+                  "a=type:broadcast\r\n"
                   "m=video %d RTP/AVP %d\r\n"
                   "a=rtpmap:%d %s\r\n",
                   p_sys->i_sdp_id, p_sys->i_sdp_version,
@@ -937,6 +933,68 @@
     s[2*i_data] = '\0';
 }
 
+static const char basis_64[] =
+    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
+
+int ap_base64encode_len(int len)
+{
+    return ((len + 2) / 3 * 4) + 1;
+}
+
+int ap_base64encode_binary(char *encoded,
+                                       const unsigned char *string, int len)
+{
+    int i;
+    char *p;
+
+    p = encoded;
+    for (i = 0; i < len - 2; i += 3) {
+        *p++ = basis_64[(string[i] >> 2) & 0x3F];
+        *p++ = basis_64[((string[i] & 0x3) << 4) |
+                        ((int) (string[i + 1] & 0xF0) >> 4)];
+        *p++ = basis_64[((string[i + 1] & 0xF) << 2) |
+                        ((int) (string[i + 2] & 0xC0) >> 6)];
+        *p++ = basis_64[string[i + 2] & 0x3F];
+    }
+    if (i < len) {
+        *p++ = basis_64[(string[i] >> 2) & 0x3F];
+        if (i == (len - 1)) {
+            *p++ = basis_64[((string[i] & 0x3) << 4)];
+            *p++ = '=';
+        }
+        else {
+            *p++ = basis_64[((string[i] & 0x3) << 4) |
+                            ((int) (string[i + 1] & 0xF0) >> 4)];
+            *p++ = basis_64[((string[i + 1] & 0xF) << 2)];
+        }
+        *p++ = '=';
+    }
+
+    *p++ = '\0';
+    return p - encoded;
+}
+
+int ap_base64encode(char *encoded, const char *string, int len)
+{
+    return ap_base64encode_binary(encoded, (const unsigned char *) string, len);
+}
+
+char *b64_encode(char *buf, int len)
+{
+    int elen;
+    char *out;
+
+    if(len == 0)
+        len = strlen(buf);
+
+    elen = ap_base64encode_len(len);
+    out = (char *) malloc(sizeof(char) * (elen + 1));
+
+    ap_base64encode(out, buf, len);
+
+    return out;
+}
+
 static sout_stream_id_t *Add( sout_stream_t *p_stream, es_format_t *p_fmt )
 {
     sout_instance_t   *p_sout = p_stream->p_sout;
@@ -1092,7 +1150,60 @@
             id->i_clock_rate = 90000;
             id->psz_rtpmap = strdup( "H264/90000" );
             id->pf_packetize = rtp_packetize_h264;
-            id->psz_fmtp = strdup( "packetization-mode=1" );
+            if( p_fmt->i_extra > 0 )
+            {
+                uint8_t *p_buffer = p_fmt->p_extra;
+                int     i_buffer = p_fmt->i_extra;
+                char    *p_64_sps;
+                char    *p_64_pps;
+                char    hexa[6];
+                
+                while( i_buffer > 4 && 
+                    p_buffer[0] == 0 && p_buffer[1] == 0 &&
+                    p_buffer[2] == 0 && p_buffer[3] == 1 )
+                {
+                    const int i_nal_type = p_buffer[4]&0x1f;
+                    int i_offset    = 1;
+                    int i_size      = 0;
+                    int i_startcode = 0;
+                    int i_encoded   = 0;
+                    
+                    msg_Dbg( p_stream, "we found a startcode for NAL with TYPE:%d", i_nal_type );
+                    
+                    for( i_offset = 1; i_offset+3 < i_buffer ; i_offset++)
+                    {
+                        if( p_buffer[i_offset] == 0 && p_buffer[i_offset+1] == 0 && p_buffer[i_offset+2] == 0 && p_buffer[i_offset+3] == 1 )
+                        {
+                            /* we found another startcode */
+                            i_startcode = i_offset;
+                            break;
+                        } 
+                    }
+                    i_size = i_startcode ? i_startcode : i_buffer;
+                    if( i_nal_type == 7 )
+                    {
+                        p_64_sps = (char *)malloc( ap_base64encode_len( i_size - 4) );
+                        i_encoded = ap_base64encode_binary( p_64_sps, &p_buffer[4], i_size - 4 );
+                        p_64_sps[i_encoded] = '\0';
+                        sprintf_hexa( hexa, &p_buffer[5], 3 );
+                        hexa[6] = '\0'; 
+                    }
+                    if( i_nal_type == 8 )
+                    {
+                        p_64_pps = (char *)malloc( ap_base64encode_len( i_size - 4) );
+                        i_encoded = ap_base64encode_binary( p_64_pps, &p_buffer[4], i_size - 4 );
+                        p_64_pps[i_encoded] = '\0';
+                    }
+                    i_buffer -= i_size;
+                    p_buffer += i_size;
+                }
+                /* FIXME: All this is a bit unsafe */
+                asprintf( &id->psz_fmtp, "packetization-mode=1;profile-level-id=%s;sprop-parameter-sets=%s,%s;", hexa, p_64_sps, p_64_pps );
+                free( p_64_sps );
+                free( p_64_pps );
+            }
+            else
+                id->psz_fmtp = strdup( "packetization-mode=1" );
             break;
 
         case VLC_FOURCC( 'm', 'p', '4', 'v' ):
@@ -2370,37 +2481,36 @@
     int     i_count = ( in->i_buffer + i_max - 1 ) / i_max;
     uint8_t *p_data = in->p_buffer;
     int     i_data  = in->i_buffer;
-    int     i;
+    block_t *out;
+    int     i_nal_type;
+    int     i_payload;
 
-    if( i_data <= i_max )
+    while( i_data > 5 &&
+           ( p_data[0] != 0x00 || p_data[1] != 0x00 || p_data[2] != 0x01 || /* startcode */
+            (p_data[3]&0x1f) < 1 || (p_data[3]&0x1f) > 23 ) ) /* naltype should be between 1 and 23 */
     {
-        /* NAL */
-        int           i_payload;
-        block_t *out;
-        uint8_t *p = p_data;
-        int      i_rest = in->i_buffer;
-
-        while( i_rest > 4 &&
-               ( p[0] != 0x00 || p[1] != 0x00 || p[2] != 0x01 ) )
-        {
-            p++;
-            i_rest--;
-        }
+        p_data++;
+        i_data--;
+    }
 
-        if (i_rest < 4)
-            return VLC_SUCCESS;
- 
-        p+=3;
-        i_rest-=3;
+    if( i_data < 5 )
+        return VLC_SUCCESS;
 
-        i_payload = __MIN( i_max, i_rest );
+    p_data+=3;
+    i_data-=3;
+    i_nal_type = p_data[0]&0x1f;
+    
+    if( i_data <= i_max ) /* The whole pack will fit in one rtp payload */
+    {
+        /* single NAL */
+        i_payload = __MIN( i_max, i_data );
         out = block_New( p_stream, 12 + i_payload );
 
         /* rtp common header */
         rtp_packetize_common( id, out, 1,
                               in->i_pts > 0 ? in->i_pts : in->i_dts );
 
-        memcpy( &out->p_buffer[12], p, i_payload );
+        memcpy( &out->p_buffer[12], p_data, i_payload );
 
         out->i_buffer   = 12 + i_payload;
         out->i_dts    = in->i_dts;
@@ -2413,40 +2523,24 @@
     else
     {
         /* FU-A */
-        int           i_payload;
-        block_t *out;
-        uint8_t *p = p_data;
-        int      i_rest = in->i_buffer;
-        int start=1, end=0, first=0, nalh=-1;
+        uint8_t     nalh; /* The nalheader byte */
+        int i=0, start=1, end=0, first=0;
  
-        while( i_rest > 4 &&
-               ( p[0] != 0x00 || p[1] != 0x00 || p[2] != 0x01 ) )
-        {
-            p++;
-            i_rest--;
-        }
-
-        if (i_rest < 4)
-            return VLC_SUCCESS;
-
-        p+=3;
-        i_rest-=3;
-
-        nalh = *p;
-        p++;
-        i_rest--;
+        nalh = *p_data;
+        p_data++;
+        i_data--;
 
         i_max   = id->i_mtu - 14;
-        i_count = ( i_rest + i_max - 1 ) / i_max;
+        i_count = ( i_data + i_max - 1 ) / i_max;
 
         /*msg_Dbg( p_stream, "nal-out fragmented %02x %d", nalh, i_rest);*/
 
-        i=0;
-        while (end==0){
-                i_payload = __MIN( i_max, i_rest );
-                out = block_New( p_stream, 14 + i_payload );
+        while( end == 0 )
+        {
+            i_payload = __MIN( i_max, i_data );
+            out = block_New( p_stream, 14 + i_payload );
 
-            if (i_rest==i_payload)
+            if( i_data == i_payload )
                 end = 1;
 
             /* rtp common header */
@@ -2458,22 +2552,22 @@
             /* FU header */
             out->p_buffer[13] = (start<<7)|(end<<6)|(nalh&0x1f);
 
-            memcpy( &out->p_buffer[14], p+first, i_payload );
+            memcpy( &out->p_buffer[14], p_data+first, i_payload );
  
             out->i_buffer   = 14 + i_payload;
 
             // not sure what of these should be used and what it does :)
-            out->i_dts    = in->i_dts + i * in->i_length / i_count;
-            out->i_length = in->i_length / i_count;
-            //out->i_dts    = in->i_dts;
-            //out->i_length = in->i_length;
+            out->i_pts    = in->i_pts;
+            out->i_dts    = in->i_dts;
+            //out->i_dts    = in->i_dts + i * in->i_length / i_count;
+            //out->i_length = in->i_length / i_count;
 
             rtp_packetize_send( id, out );
 
             /*msg_Dbg( p_stream, "nal-out fragmented: frag %d %d %02x %02x %d", start,end,
             out->p_buffer[12], out->p_buffer[13], i_payload );*/
 
-            i_rest -= i_payload;
+            i_data -= i_payload;
             first += i_payload;
             i++;
             start=0;
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/switcher.c vlc_0.8.6-svn20060925.debian/modules/stream_out/switcher.c
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/switcher.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/switcher.c	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * switcher.c: MPEG2 video switcher module
  *****************************************************************************
  * Copyright (C) 2004 the VideoLAN team
- * $Id: switcher.c 14820 2006-03-19 01:27:21Z xtophe $
+ * $Id: switcher.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *
@@ -51,7 +51,6 @@
 #define SOUT_CFG_PREFIX "sout-switcher-"
 #define MAX_PICTURES 10
 #define MAX_AUDIO 30
-#define AVCODEC_MAX_VIDEO_FRAME_SIZE (3*1024*1024)
 #define MAX_THRESHOLD 99999999
 
 /*****************************************************************************
@@ -651,7 +650,7 @@
 {
     sout_stream_sys_t *p_sys = p_stream->p_sys;
     char psz_buffer[10];
-    int i_len = net_ReadNonBlock( p_stream, p_sys->i_fd, NULL, psz_buffer,
+    int i_len = net_ReadNonBlock( p_stream, p_sys->i_fd, NULL, (char *)&psz_buffer[0],
                                   sizeof( psz_buffer ), 0 );
 
     if ( i_len > 0 )
@@ -779,7 +778,7 @@
             return 0;
         }
 
-        id->p_buffer_out = malloc( AVCODEC_MAX_VIDEO_FRAME_SIZE );
+        id->p_buffer_out = malloc( id->ff_enc_c->width * id->ff_enc_c->height * 3 );
         id->p_frame = avcodec_alloc_frame();
         id->p_frame->linesize[0] = p_sys->p_pictures[p_sys->i_cmd-1].p[0].i_pitch;
         id->p_frame->linesize[1] = p_sys->p_pictures[p_sys->i_cmd-1].p[1].i_pitch;
@@ -833,7 +832,7 @@
     }
 
     i_out = avcodec_encode_video( id->ff_enc_c, id->p_buffer_out,
-                                  AVCODEC_MAX_VIDEO_FRAME_SIZE,
+                                  id->ff_enc_c->width * id->ff_enc_c->height * 3,
                                   id->p_frame );
 
     if ( i_out <= 0 )
@@ -847,7 +846,7 @@
         int mb_height = (id->ff_enc_c->height + 15) / 16;
         int h_chroma_shift, v_chroma_shift;
         int i;
-        
+
         avcodec_get_chroma_sub_sample( id->ff_enc_c->pix_fmt, &h_chroma_shift,
                                        &v_chroma_shift );
 
@@ -859,7 +858,7 @@
                                     id->ff_enc_c->coded_frame->mb_type,
                                     (mb_width + 1) * mb_height
                                       * sizeof(id->p_frame->mb_type[0]));
-        
+
         for ( i = 0; i < 2; i++ )
         {
             int stride = ((16 * mb_width )
@@ -942,4 +941,3 @@
 
     return p_out;
 }
-
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/transcode.c vlc_0.8.6-svn20060925.debian/modules/stream_out/transcode.c
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/transcode.c	2006-09-18 06:28:17.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/transcode.c	2006-09-22 11:14:30.000000000 -0400
@@ -2,7 +2,7 @@
  * transcode.c: transcoding stream output module
  *****************************************************************************
  * Copyright (C) 2003-2004 the VideoLAN team
- * $Id: transcode.c 16601 2006-09-10 20:21:46Z zorglub $
+ * $Id: transcode.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
@@ -503,8 +503,8 @@
 
     if( p_sys->i_acodec )
     {
-        if( (strncmp( (char *)&p_sys->i_acodec, "mp3", 3) == 0) &&
-                            (p_sys->i_channels > 2) )
+        if( p_sys->i_acodec == VLC_FOURCC('m','p','3',0) &&
+            p_sys->i_channels > 2 )
         {
             msg_Warn( p_stream, "%d channels invalid for mp3, forcing to 2",
                       p_sys->i_channels );
@@ -623,28 +623,20 @@
     p_sys->i_canvas_height = val.i_int;
     
     var_Get( p_stream, SOUT_CFG_PREFIX "canvas-aspect", &val );
-    if ( val.psz_string )
+    p_sys->i_canvas_aspect = 0;
+    if( val.psz_string && *val.psz_string )
     {
         char *psz_parser = strchr( val.psz_string, ':' );
-
         if( psz_parser )
         {
             *psz_parser++ = '\0';
-            p_sys->i_canvas_aspect = atoi( val.psz_string ) * VOUT_ASPECT_FACTOR
-                / atoi( psz_parser );
-        }
-        else
-        {
-            msg_Warn( p_stream, "bad aspect ratio %s", val.psz_string );
-            p_sys->i_canvas_aspect = 0;
+            p_sys->i_canvas_aspect = atoi( val.psz_string ) *
+                VOUT_ASPECT_FACTOR / atoi( psz_parser );
         }
+        else msg_Warn( p_stream, "bad aspect ratio %s", val.psz_string );
 
-        free( val.psz_string );
-    }
-    else
-    {
-        p_sys->i_canvas_aspect = 0;
     }
+    if( val.psz_string ) free( val.psz_string );
 
     var_Get( p_stream, SOUT_CFG_PREFIX "threads", &val );
     p_sys->i_threads = val.i_int;
@@ -1295,7 +1287,7 @@
     {
         msg_Err( p_stream, "cannot find encoder (%s)", p_sys->psz_aenc );
         module_Unneed( id->p_decoder, id->p_decoder->p_module );
-        id->p_decoder->p_module = 0;
+        id->p_decoder->p_module = NULL;
         return VLC_EGENERIC;
     }
     id->p_encoder->fmt_in.audio.i_format = id->p_encoder->fmt_in.i_codec;
@@ -1344,11 +1336,11 @@
 
     if( fmt_last.audio.i_channels != id->p_encoder->fmt_in.audio.i_channels )
     {
-        msg_Err( p_stream, "no audio filter found for mixing from"
-                 " %i to %i channels", fmt_last.audio.i_channels,
-                 id->p_encoder->fmt_in.audio.i_channels );
-#if 0
-        /* FIXME : this might work, but only if the encoder is restarted */
+#if 1
+        module_Unneed( id->p_encoder, id->p_encoder->p_module );
+        id->p_encoder->p_module = NULL;
+
+        /* This might work, but only if the encoder is restarted */
         id->p_encoder->fmt_in.audio.i_channels = fmt_last.audio.i_channels;
         id->p_encoder->fmt_out.audio.i_channels = fmt_last.audio.i_channels;
 
@@ -1358,7 +1350,30 @@
         id->p_encoder->fmt_out.audio.i_physical_channels =
             id->p_encoder->fmt_out.audio.i_original_channels =
                 fmt_last.audio.i_physical_channels;
+
+        msg_Dbg( p_stream, "number of audio channels for mixing changed, "
+                 "trying to reopen the encoder for mixing %i to %i channels",
+                 fmt_last.audio.i_channels,
+                 id->p_encoder->fmt_in.audio.i_channels );
+
+        /* reload encoder */
+        id->p_encoder->p_cfg = p_stream->p_sys->p_audio_cfg;
+        id->p_encoder->p_module =
+            module_Need( id->p_encoder, "encoder", p_sys->psz_aenc, VLC_TRUE );
+        if( !id->p_encoder->p_module )
+        {
+            msg_Err( p_stream, "cannot find encoder (%s)", p_sys->psz_aenc );
+            transcode_audio_close( p_stream, id );
+            return VLC_EGENERIC;
+        }
+        id->p_encoder->fmt_in.audio.i_format = id->p_encoder->fmt_in.i_codec;
+        id->p_encoder->fmt_in.audio.i_bitspersample =
+            audio_BitsPerSample( id->p_encoder->fmt_in.i_codec );
 #else
+        msg_Err( p_stream, "no audio filter found for mixing from"
+                 " %i to %i channels", fmt_last.audio.i_channels,
+                 id->p_encoder->fmt_in.audio.i_channels );
+
         transcode_audio_close( p_stream, id );
         return VLC_EGENERIC;
 #endif
@@ -1394,12 +1409,12 @@
     /* Close decoder */
     if( id->p_decoder->p_module )
         module_Unneed( id->p_decoder, id->p_decoder->p_module );
-    id->p_decoder->p_module = 0;
+    id->p_decoder->p_module = NULL;
 
     /* Close encoder */
     if( id->p_encoder->p_module )
         module_Unneed( id->p_encoder, id->p_encoder->p_module );
-    id->p_encoder->p_module = 0;
+    id->p_encoder->p_module = NULL;
 
     /* Close filters */
     for( i = 0; i < id->i_filter; i++ )
@@ -2222,7 +2237,8 @@
         /* Check if we have a subpicture to overlay */
         if( p_sys->p_spu )
         {
-            p_subpic = spu_SortSubpictures( p_sys->p_spu, p_pic->date );
+            p_subpic = spu_SortSubpictures( p_sys->p_spu, p_pic->date,
+                       VLC_FALSE /* Fixme: check if stream is paused */ );
             /* TODO: get another pic */
         }
 
@@ -2797,7 +2813,7 @@
     /* Check if we have a subpicture to send */
     if( p_sys->p_spu && in->i_dts > 0)
     {
-        p_subpic = spu_SortSubpictures( p_sys->p_spu, in->i_dts );
+        p_subpic = spu_SortSubpictures( p_sys->p_spu, in->i_dts, VLC_FALSE );
     }
     else
     {
diff -uNr vlc_0.8.6-svn20060918.debian/modules/stream_out/transrate/Makefile.in vlc_0.8.6-svn20060925.debian/modules/stream_out/transrate/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/stream_out/transrate/Makefile.in	2006-09-18 06:30:59.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/stream_out/transrate/Makefile.in	2006-09-24 13:13:14.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_chroma/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_chroma/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_chroma/Makefile.in	2006-09-18 06:31:00.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_chroma/Makefile.in	2006-09-24 13:13:16.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_filter/logo.c vlc_0.8.6-svn20060925.debian/modules/video_filter/logo.c
--- vlc_0.8.6-svn20060918.debian/modules/video_filter/logo.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_filter/logo.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * logo.c : logo video plugin for vlc
  *****************************************************************************
  * Copyright (C) 2003-2006 the VideoLAN team
- * $Id: logo.c 15002 2006-03-31 16:12:31Z fkuehne $
+ * $Id: logo.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *          Simon Latapie <garf@videolan.org>
@@ -707,7 +707,6 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys;
-    vlc_object_t *p_input;
     logo_list_t *p_logo_list;
 
     /* Allocate structure */
@@ -726,43 +725,32 @@
     }
 
     /* Hook used for callback variables */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_PARENT );
-    if( !p_input )
-    {
-        free( p_sys );
-        free( p_logo_list );
-        return VLC_ENOOBJ;
-    }
-
     p_logo_list->psz_filename =
-        var_CreateGetString( p_input->p_libvlc , "logo-file" );
+        var_CreateGetString( p_filter->p_libvlc , "logo-file" );
     if( !p_logo_list->psz_filename || !*p_logo_list->psz_filename )
     {
         msg_Err( p_this, "logo file not specified" );
-        vlc_object_release( p_input );
-        //if( p_sys->psz_filename ) free( p_sys->psz_filename );
         free( p_sys );
         free( p_logo_list );
         return VLC_EGENERIC;
     }
 
-    p_sys->posx = var_CreateGetInteger( p_input->p_libvlc , "logo-x" );
-    p_sys->posy = var_CreateGetInteger( p_input->p_libvlc , "logo-y" );
-    p_sys->pos = var_CreateGetInteger( p_input->p_libvlc , "logo-position" );
+    p_sys->posx = var_CreateGetInteger( p_filter->p_libvlc , "logo-x" );
+    p_sys->posy = var_CreateGetInteger( p_filter->p_libvlc , "logo-y" );
+    p_sys->pos = var_CreateGetInteger( p_filter->p_libvlc , "logo-position" );
     p_logo_list->i_alpha = __MAX( __MIN( var_CreateGetInteger(
-                           p_input->p_libvlc, "logo-transparency"), 255 ), 0 );
+                           p_filter->p_libvlc, "logo-transparency"), 255 ), 0 );
     p_logo_list->i_delay =
-                    var_CreateGetInteger( p_input->p_libvlc , "logo-delay" );
+                    var_CreateGetInteger( p_filter->p_libvlc , "logo-delay" );
     p_logo_list->i_repeat =
-                    var_CreateGetInteger( p_input->p_libvlc , "logo-repeat" );
+                    var_CreateGetInteger( p_filter->p_libvlc , "logo-repeat" );
 
-    var_AddCallback( p_input->p_libvlc, "logo-file", LogoCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "logo-x", LogoCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "logo-y", LogoCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "logo-position", LogoCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "logo-transparency", LogoCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "logo-repeat", LogoCallback, p_sys );
-    vlc_object_release( p_input );
+    var_AddCallback( p_filter->p_libvlc, "logo-file", LogoCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "logo-x", LogoCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "logo-y", LogoCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "logo-position", LogoCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "logo-transparency", LogoCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "logo-repeat", LogoCallback, p_sys );
 
     vlc_mutex_init( p_filter, &p_logo_list->lock );
     vlc_mutex_lock( &p_logo_list->lock );
@@ -787,7 +775,6 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys = p_filter->p_sys;
-    vlc_object_t *p_input;
 
     vlc_mutex_destroy( &p_sys->p_logo_list->lock );
     FreeLogoList( p_sys->p_logo_list );
@@ -795,17 +782,13 @@
     free( p_sys );
 
     /* Delete the logo variables from INPUT */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_PARENT );
-    if( !p_input ) return;
-
-    var_Destroy( p_input->p_libvlc , "logo-file" );
-    var_Destroy( p_input->p_libvlc , "logo-x" );
-    var_Destroy( p_input->p_libvlc , "logo-y" );
-    var_Destroy( p_input->p_libvlc , "logo-delay" );
-    var_Destroy( p_input->p_libvlc , "logo-repeat" );
-    var_Destroy( p_input->p_libvlc , "logo-position" );
-    var_Destroy( p_input->p_libvlc , "logo-transparency" );
-    vlc_object_release( p_input );
+    var_Destroy( p_filter->p_libvlc , "logo-file" );
+    var_Destroy( p_filter->p_libvlc , "logo-x" );
+    var_Destroy( p_filter->p_libvlc , "logo-y" );
+    var_Destroy( p_filter->p_libvlc , "logo-delay" );
+    var_Destroy( p_filter->p_libvlc , "logo-repeat" );
+    var_Destroy( p_filter->p_libvlc , "logo-position" );
+    var_Destroy( p_filter->p_libvlc , "logo-transparency" );
 }
 
 /*****************************************************************************
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_filter/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_filter/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_filter/Makefile.in	2006-09-18 06:31:02.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_filter/Makefile.in	2006-09-24 13:13:19.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_filter/marq.c vlc_0.8.6-svn20060925.debian/modules/video_filter/marq.c
--- vlc_0.8.6-svn20060918.debian/modules/video_filter/marq.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_filter/marq.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * marq.c : marquee display video plugin for vlc
  *****************************************************************************
  * Copyright (C) 2003-2005 the VideoLAN team
- * $Id: marq.c 15002 2006-03-31 16:12:31Z fkuehne $
+ * $Id: marq.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Mark Moriarty
  *
@@ -149,7 +149,6 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys;
-    vlc_object_t *p_input;
 
     /* Allocate structure */
     p_sys = p_filter->p_sys = malloc( sizeof( filter_sys_t ) );
@@ -159,36 +158,26 @@
         return VLC_ENOMEM;
     }
 
-    /* Hook used for callback variables */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_ANYWHERE );
-    if( !p_input )
-    {
-        return VLC_ENOOBJ;
-    }
-
     p_sys->p_style = malloc( sizeof( text_style_t ) );
     memcpy( p_sys->p_style, &default_text_style, sizeof( text_style_t ) );
 
-    p_sys->i_xoff = var_CreateGetInteger( p_input->p_libvlc , "marq-x" );
-    p_sys->i_yoff = var_CreateGetInteger( p_input->p_libvlc , "marq-y" );
-    p_sys->i_timeout = var_CreateGetInteger( p_input->p_libvlc , "marq-timeout" );
-    p_sys->i_pos = var_CreateGetInteger( p_input->p_libvlc , "marq-position" );
-    p_sys->psz_marquee =  var_CreateGetString( p_input->p_libvlc, "marq-marquee" );
-    p_sys->p_style->i_font_alpha = 255 - var_CreateGetInteger( p_input->p_libvlc , "marq-opacity" );
-    p_sys->p_style->i_font_color = var_CreateGetInteger( p_input->p_libvlc , "marq-color" );
-    p_sys->p_style->i_font_size  = var_CreateGetInteger( p_input->p_libvlc , "marq-size" );
-
-    var_AddCallback( p_input->p_libvlc, "marq-x", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-y", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-marquee", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-timeout", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-position", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-color", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-opacity", MarqueeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "marq-size", MarqueeCallback, p_sys );
-
-    vlc_object_release( p_input );
-
+    p_sys->i_xoff = var_CreateGetInteger( p_filter->p_libvlc , "marq-x" );
+    p_sys->i_yoff = var_CreateGetInteger( p_filter->p_libvlc , "marq-y" );
+    p_sys->i_timeout = var_CreateGetInteger( p_filter->p_libvlc , "marq-timeout" );
+    p_sys->i_pos = var_CreateGetInteger( p_filter->p_libvlc , "marq-position" );
+    p_sys->psz_marquee =  var_CreateGetString( p_filter->p_libvlc, "marq-marquee" );
+    p_sys->p_style->i_font_alpha = 255 - var_CreateGetInteger( p_filter->p_libvlc , "marq-opacity" );
+    p_sys->p_style->i_font_color = var_CreateGetInteger( p_filter->p_libvlc , "marq-color" );
+    p_sys->p_style->i_font_size  = var_CreateGetInteger( p_filter->p_libvlc , "marq-size" );
+
+    var_AddCallback( p_filter->p_libvlc, "marq-x", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-y", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-marquee", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-timeout", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-position", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-color", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-opacity", MarqueeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "marq-size", MarqueeCallback, p_sys );
 
     /* Misc init */
     p_filter->pf_sub_filter = Filter;
@@ -204,37 +193,29 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys = p_filter->p_sys;
-    vlc_object_t *p_input;
 
     if( p_sys->p_style ) free( p_sys->p_style );
     if( p_sys->psz_marquee ) free( p_sys->psz_marquee );
     free( p_sys );
 
     /* Delete the marquee variables */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_ANYWHERE );
-    if( !p_input )
-    {
-        return;
-    }
-    var_DelCallback( p_input->p_libvlc, "marq-x", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-y", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-marquee", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-timeout", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-position", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-color", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-opacity", MarqueeCallback, p_sys );
-    var_DelCallback( p_input->p_libvlc, "marq-size", MarqueeCallback, p_sys );
-
-    var_Destroy( p_input->p_libvlc , "marq-marquee" );
-    var_Destroy( p_input->p_libvlc , "marq-x" );
-    var_Destroy( p_input->p_libvlc , "marq-y" );
-    var_Destroy( p_input->p_libvlc , "marq-timeout" );
-    var_Destroy( p_input->p_libvlc , "marq-position" );
-    var_Destroy( p_input->p_libvlc , "marq-color");
-    var_Destroy( p_input->p_libvlc , "marq-opacity");
-    var_Destroy( p_input->p_libvlc , "marq-size");
-
-    vlc_object_release( p_input );
+    var_DelCallback( p_filter->p_libvlc, "marq-x", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-y", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-marquee", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-timeout", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-position", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-color", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-opacity", MarqueeCallback, p_sys );
+    var_DelCallback( p_filter->p_libvlc, "marq-size", MarqueeCallback, p_sys );
+
+    var_Destroy( p_filter->p_libvlc , "marq-marquee" );
+    var_Destroy( p_filter->p_libvlc , "marq-x" );
+    var_Destroy( p_filter->p_libvlc , "marq-y" );
+    var_Destroy( p_filter->p_libvlc , "marq-timeout" );
+    var_Destroy( p_filter->p_libvlc , "marq-position" );
+    var_Destroy( p_filter->p_libvlc , "marq-color");
+    var_Destroy( p_filter->p_libvlc , "marq-opacity");
+    var_Destroy( p_filter->p_libvlc , "marq-size");
 }
 
 /****************************************************************************
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_filter/swscale/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_filter/swscale/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_filter/swscale/Makefile.in	2006-09-18 06:31:02.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_filter/swscale/Makefile.in	2006-09-24 13:13:20.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_filter/time.c vlc_0.8.6-svn20060925.debian/modules/video_filter/time.c
--- vlc_0.8.6-svn20060918.debian/modules/video_filter/time.c	2006-09-18 06:28:28.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_filter/time.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * time.c : time display video plugin for vlc
  *****************************************************************************
  * Copyright (C) 2003-2005 the VideoLAN team
- * $Id: time.c 15002 2006-03-31 16:12:31Z fkuehne $
+ * $Id: time.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Sigmund Augdal Helberg <dnumgis@videolan.org>
  *
@@ -132,7 +132,6 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys;
-    vlc_object_t *p_input;
 
     /* Allocate structure */
     p_sys = p_filter->p_sys = malloc( sizeof( filter_sys_t ) );
@@ -141,34 +140,27 @@
         msg_Err( p_filter, "out of memory" );
         return VLC_ENOMEM;
     }
-    /* Hook used for callback variables */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_ANYWHERE );
-    if( !p_input )
-    {
-        return VLC_ENOOBJ;
-    }
 
     p_sys->p_style = malloc( sizeof( text_style_t ) );
     memcpy( p_sys->p_style, &default_text_style, sizeof( text_style_t ) );
 
-    p_sys->i_xoff = var_CreateGetInteger( p_input->p_libvlc , "time-x" );
-    p_sys->i_yoff = var_CreateGetInteger( p_input->p_libvlc , "time-y" );
-    p_sys->psz_format = var_CreateGetString( p_input->p_libvlc, "time-format" );
-    p_sys->i_pos = var_CreateGetInteger( p_input->p_libvlc , "time-position" );
+    /* Hook used for callback variables */
+    p_sys->i_xoff = var_CreateGetInteger( p_filter->p_libvlc , "time-x" );
+    p_sys->i_yoff = var_CreateGetInteger( p_filter->p_libvlc , "time-y" );
+    p_sys->psz_format = var_CreateGetString( p_filter->p_libvlc, "time-format" );
+    p_sys->i_pos = var_CreateGetInteger( p_filter->p_libvlc , "time-position" );
     
-    p_sys->p_style->i_font_alpha = 255 - var_CreateGetInteger( p_input->p_libvlc , "time-opacity" );
-    p_sys->p_style->i_font_color = var_CreateGetInteger( p_input->p_libvlc , "time-color" );
-    p_sys->p_style->i_font_size = var_CreateGetInteger( p_input->p_libvlc , "time-size" );
+    p_sys->p_style->i_font_alpha = 255 - var_CreateGetInteger( p_filter->p_libvlc , "time-opacity" );
+    p_sys->p_style->i_font_color = var_CreateGetInteger( p_filter->p_libvlc , "time-color" );
+    p_sys->p_style->i_font_size = var_CreateGetInteger( p_filter->p_libvlc , "time-size" );
    
-    var_AddCallback( p_input->p_libvlc, "time-x", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-y", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-format", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-position", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-color", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-opacity", TimeCallback, p_sys );
-    var_AddCallback( p_input->p_libvlc, "time-size", TimeCallback, p_sys );
-
-    vlc_object_release( p_input );
+    var_AddCallback( p_filter->p_libvlc, "time-x", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-y", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-format", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-position", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-color", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-opacity", TimeCallback, p_sys );
+    var_AddCallback( p_filter->p_libvlc, "time-size", TimeCallback, p_sys );
 
     /* Misc init */
     p_filter->pf_sub_filter = Filter;
@@ -183,26 +175,19 @@
 {
     filter_t *p_filter = (filter_t *)p_this;
     filter_sys_t *p_sys = p_filter->p_sys;
-    vlc_object_t *p_input;
 
     if( p_sys->p_style ) free( p_sys->p_style );
     if( p_sys->psz_format ) free( p_sys->psz_format );
     free( p_sys );
+
     /* Delete the time variables */
-    p_input = vlc_object_find( p_this, VLC_OBJECT_INPUT, FIND_ANYWHERE );
-    if( !p_input )
-    {
-        return;
-    }
-    var_Destroy( p_input->p_libvlc , "time-format" );
-    var_Destroy( p_input->p_libvlc , "time-x" );
-    var_Destroy( p_input->p_libvlc , "time-y" );
-    var_Destroy( p_input->p_libvlc , "time-position" );
-    var_Destroy( p_input->p_libvlc , "time-color");
-    var_Destroy( p_input->p_libvlc , "time-opacity");
-    var_Destroy( p_input->p_libvlc , "time-size");
-   
-    vlc_object_release( p_input );
+    var_Destroy( p_filter->p_libvlc , "time-format" );
+    var_Destroy( p_filter->p_libvlc , "time-x" );
+    var_Destroy( p_filter->p_libvlc , "time-y" );
+    var_Destroy( p_filter->p_libvlc , "time-position" );
+    var_Destroy( p_filter->p_libvlc , "time-color");
+    var_Destroy( p_filter->p_libvlc , "time-opacity");
+    var_Destroy( p_filter->p_libvlc , "time-size");
 }
 
 static char *FormatTime(char *tformat )
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_output/directx/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_output/directx/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_output/directx/Makefile.in	2006-09-18 06:31:03.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_output/directx/Makefile.in	2006-09-24 13:13:23.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_output/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_output/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_output/Makefile.in	2006-09-18 06:31:03.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_output/Makefile.in	2006-09-24 13:13:22.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_output/qte/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_output/qte/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_output/qte/Makefile.in	2006-09-18 06:31:03.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_output/qte/Makefile.in	2006-09-24 13:13:24.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_output/x11/Makefile.in vlc_0.8.6-svn20060925.debian/modules/video_output/x11/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/video_output/x11/Makefile.in	2006-09-18 06:31:04.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_output/x11/Makefile.in	2006-09-24 13:13:25.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/video_output/x11/xcommon.c vlc_0.8.6-svn20060925.debian/modules/video_output/x11/xcommon.c
--- vlc_0.8.6-svn20060918.debian/modules/video_output/x11/xcommon.c	2006-09-18 06:28:25.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/video_output/x11/xcommon.c	2006-09-21 11:50:22.000000000 -0400
@@ -2,7 +2,7 @@
  * xcommon.c: Functions common to the X11 and XVideo plugins
  *****************************************************************************
  * Copyright (C) 1998-2006 the VideoLAN team
- * $Id: xcommon.c 15526 2006-05-02 19:21:23Z bigben $
+ * $Id: xcommon.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Vincent Seguin <seguin@via.ecp.fr>
  *          Sam Hocevar <sam@zoy.org>
@@ -2346,7 +2346,8 @@
     vlc_bool_t b_arg;
     unsigned int i_width, i_height;
     unsigned int *pi_width, *pi_height;
-
+    Drawable d;
+    
     switch( i_query )
     {
         case VOUT_GET_SIZE:
@@ -2392,10 +2393,17 @@
 
        case VOUT_REPARENT:
             vlc_mutex_lock( &p_vout->p_sys->lock );
+	    d = va_arg( args, Drawable );
+	    if ( !d ) 
             XReparentWindow( p_vout->p_sys->p_display,
                              p_vout->p_sys->original_window.base_window,
                              DefaultRootWindow( p_vout->p_sys->p_display ),
                              0, 0 );
+	    else
+            XReparentWindow( p_vout->p_sys->p_display,
+                             p_vout->p_sys->original_window.base_window,
+			     d,
+		   	     0, 0); 
             XSync( p_vout->p_sys->p_display, False );
             p_vout->p_sys->original_window.owner_window = 0;
             vlc_mutex_unlock( &p_vout->p_sys->lock );
diff -uNr vlc_0.8.6-svn20060918.debian/modules/visualization/galaktos/Makefile.in vlc_0.8.6-svn20060925.debian/modules/visualization/galaktos/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/visualization/galaktos/Makefile.in	2006-09-18 06:31:05.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/visualization/galaktos/Makefile.in	2006-09-24 13:13:27.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/visualization/Makefile.in vlc_0.8.6-svn20060925.debian/modules/visualization/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/visualization/Makefile.in	2006-09-18 06:31:04.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/visualization/Makefile.in	2006-09-24 13:13:25.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/modules/visualization/visual/Makefile.in vlc_0.8.6-svn20060925.debian/modules/visualization/visual/Makefile.in
--- vlc_0.8.6-svn20060918.debian/modules/visualization/visual/Makefile.in	2006-09-18 06:31:05.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/modules/visualization/visual/Makefile.in	2006-09-24 13:13:28.000000000 -0400
@@ -118,12 +118,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -155,9 +156,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -249,7 +247,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/mozilla/Makefile.in vlc_0.8.6-svn20060925.debian/mozilla/Makefile.in
--- vlc_0.8.6-svn20060918.debian/mozilla/Makefile.in	2006-09-18 06:31:06.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/mozilla/Makefile.in	2006-09-24 13:13:29.000000000 -0400
@@ -121,12 +121,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -158,9 +159,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -252,7 +250,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/po/ca.po vlc_0.8.6-svn20060925.debian/po/ca.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/cs.po vlc_0.8.6-svn20060925.debian/po/cs.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/da.po vlc_0.8.6-svn20060925.debian/po/da.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/de.po vlc_0.8.6-svn20060925.debian/po/de.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/en_GB.po vlc_0.8.6-svn20060925.debian/po/en_GB.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/es.po vlc_0.8.6-svn20060925.debian/po/es.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/fr.po vlc_0.8.6-svn20060925.debian/po/fr.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/gl.po vlc_0.8.6-svn20060925.debian/po/gl.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/he.po vlc_0.8.6-svn20060925.debian/po/he.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/hi.po vlc_0.8.6-svn20060925.debian/po/hi.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/hu.po vlc_0.8.6-svn20060925.debian/po/hu.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/it.po vlc_0.8.6-svn20060925.debian/po/it.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/ja.po vlc_0.8.6-svn20060925.debian/po/ja.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/ka.po vlc_0.8.6-svn20060925.debian/po/ka.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/ko.po vlc_0.8.6-svn20060925.debian/po/ko.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/nl.po vlc_0.8.6-svn20060925.debian/po/nl.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/oc.po vlc_0.8.6-svn20060925.debian/po/oc.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/POTFILES.in vlc_0.8.6-svn20060925.debian/po/POTFILES.in
diff -uNr vlc_0.8.6-svn20060918.debian/po/pt_BR.po vlc_0.8.6-svn20060925.debian/po/pt_BR.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/ro.po vlc_0.8.6-svn20060925.debian/po/ro.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/ru.po vlc_0.8.6-svn20060925.debian/po/ru.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/sv.po vlc_0.8.6-svn20060925.debian/po/sv.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/tr.po vlc_0.8.6-svn20060925.debian/po/tr.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/vlc.pot vlc_0.8.6-svn20060925.debian/po/vlc.pot
diff -uNr vlc_0.8.6-svn20060918.debian/po/zh_CN.po vlc_0.8.6-svn20060925.debian/po/zh_CN.po
diff -uNr vlc_0.8.6-svn20060918.debian/po/zh_TW.po vlc_0.8.6-svn20060925.debian/po/zh_TW.po
diff -uNr vlc_0.8.6-svn20060918.debian/share/http/index.html vlc_0.8.6-svn20060925.debian/share/http/index.html
--- vlc_0.8.6-svn20060918.debian/share/http/index.html	2006-09-18 06:28:00.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/share/http/index.html	2006-09-21 11:50:20.000000000 -0400
@@ -4,7 +4,7 @@
 <  index.html: VLC media player web interface
 < - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - >
 <  Copyright (C) 2005-2006 the VideoLAN team
-<  $Id: index.html 14907 2006-03-24 14:17:28Z dionoea $
+<  $Id: index.html 16767 2006-09-21 14:32:45Z hartman $
 < 
 <  Authors: Antoine Cellerier <dionoea -at- videolan -dot- org>
 < 
@@ -38,6 +38,7 @@
   <!-- in case people had scripts that sent commands to the default
        index.html page -->
   <vlc id="control" param1="stop,pause,previous,next,add,sout,play,delete,empty,seek,fullscreen,keep,volume,sort,move" />
+  <vlc id="set" param1="sout" param2="string" />
 
 </head>
 
diff -uNr vlc_0.8.6-svn20060918.debian/share/Makefile.am vlc_0.8.6-svn20060925.debian/share/Makefile.am
diff -uNr vlc_0.8.6-svn20060918.debian/share/Makefile.in vlc_0.8.6-svn20060925.debian/share/Makefile.in
--- vlc_0.8.6-svn20060918.debian/share/Makefile.in	2006-09-18 06:31:06.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/share/Makefile.in	2006-09-24 13:13:29.000000000 -0400
@@ -116,12 +116,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -153,9 +154,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -247,7 +245,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
@@ -802,9 +799,11 @@
 
 skins2/default.vlt: $(skins2_default_vlt_FILES)
 
-skins2/%.vlt:
+skins2/default.vlt:
 	mkdir -p skins2
-	tar cvvzf $@ --exclude .svn -C $(srcdir)/skins2 $*/
+	tar cvvzf skins2/default.vlt --exclude .svn -C $(srcdir)/skins2 default/
+
+.PHONY: $(nobase_pkgdata_DATA)
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
diff -uNr vlc_0.8.6-svn20060918.debian/share/skins2/skin.dtd vlc_0.8.6-svn20060925.debian/share/skins2/skin.dtd
--- vlc_0.8.6-svn20060918.debian/share/skins2/skin.dtd	2006-09-18 06:28:01.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/share/skins2/skin.dtd	2006-09-22 11:14:27.000000000 -0400
@@ -114,6 +114,8 @@
         y           CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         image       CDATA   #REQUIRED
         action      CDATA   "none"
         action2     CDATA   "none"
@@ -128,6 +130,8 @@
         y           CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         up          CDATA   #REQUIRED
         down        CDATA   "none"
         over        CDATA   "none"
@@ -143,6 +147,8 @@
         y            CDATA   "0"
         lefttop      CDATA   "lefttop"
         rightbottom  CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         up1          CDATA   #REQUIRED
         down1        CDATA   "none"
         over1        CDATA   "none"
@@ -164,6 +170,8 @@
         y           CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         up          CDATA   #REQUIRED
         down        CDATA   "none"
         over        CDATA   "none"
@@ -191,6 +199,8 @@
         y           CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         sequence    CDATA   #REQUIRED
         nbimages    CDATA   #REQUIRED
         minangle    CDATA   "0"
@@ -208,6 +218,8 @@
         width       CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         text        CDATA   ""
         font        CDATA   #REQUIRED
         color       CDATA   "#000000"
@@ -225,6 +237,8 @@
         height      CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         font        CDATA   #REQUIRED
         bgimage     CDATA   "none"
         fgcolor     CDATA   "#000000"
@@ -244,6 +258,8 @@
         height      CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         font        CDATA   #REQUIRED
         bgimage     CDATA   "none"
         itemimage   CDATA   "none"
@@ -267,6 +283,8 @@
         height      CDATA   "0"
         lefttop     CDATA   "lefttop"
         rightbottom CDATA   "lefttop"
+        xkeepratio  CDATA   "false"
+        ykeepratio  CDATA   "false"
         autoresize  CDATA   "true"
         help        CDATA   ""
     >
diff -uNr vlc_0.8.6-svn20060918.debian/src/control/audio.c vlc_0.8.6-svn20060925.debian/src/control/audio.c
--- vlc_0.8.6-svn20060918.debian/src/control/audio.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/control/audio.c	2006-09-21 11:50:20.000000000 -0400
@@ -2,7 +2,7 @@
  * libvlc_audio.c: New libvlc audio control API
  *****************************************************************************
  * Copyright (C) 2006 the VideoLAN team
- * $Id: audio.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: audio.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Filippo Carone <filippo@carone.org>
  *
@@ -31,59 +31,49 @@
  * libvlc_audio_get_mute : Get the volume state, true if muted
  *****************************************************************************/
 void libvlc_audio_toggle_mute( libvlc_instance_t *p_instance,
-                               libvlc_exception_t *p_exception )
+                               libvlc_exception_t *p_e )
 {
     aout_VolumeMute( p_instance->p_vlc, NULL );
 }
 
 vlc_bool_t libvlc_audio_get_mute( libvlc_instance_t *p_instance,
-                                  libvlc_exception_t *p_exception )
+                                  libvlc_exception_t *p_e )
 {
     /*
      * If the volume level is 0, then the channel is muted
      */
     audio_volume_t i_volume;
 
-    i_volume = libvlc_audio_get_volume(p_instance, p_exception);
+    i_volume = libvlc_audio_get_volume(p_instance, p_e);
     if ( i_volume == 0 )
         return VLC_TRUE;
-
     return VLC_FALSE;
 }
 
 void libvlc_audio_set_mute( libvlc_instance_t *p_instance, vlc_bool_t status,
-                            libvlc_exception_t *p_exception )
+                            libvlc_exception_t *p_e )
 {
     if ( status )
     {
-        /*
-         * Check if the volume is already muted
-         */
-        if (! libvlc_audio_get_volume( p_instance, p_exception ) )
+        /* Check if the volume is already muted */
+        if (! libvlc_audio_get_volume( p_instance, p_e ) )
         {
             return;
         }
-        
         aout_VolumeMute( p_instance->p_vlc, NULL );
-        return;
-        
     }
     else
     {
-        /*
-         * the aout_VolumeMute is a toggle function, so this is enough.
-         */
+        /* the aout_VolumeMute is a toggle function, so this is enough. */
         aout_VolumeMute( p_instance->p_vlc, NULL );
-        return;
     }
 }
 
-
 /*****************************************************************************
  * libvlc_audio_get_volume : Get the current volume (range 0-200 %)
  *****************************************************************************/
 int libvlc_audio_get_volume( libvlc_instance_t *p_instance,
-                             libvlc_exception_t *p_exception )
+                             libvlc_exception_t *p_e )
 {
     audio_volume_t i_volume;
 
@@ -97,7 +87,7 @@
  * libvlc_audio_set_volume : Set the current volume
  *****************************************************************************/
 void libvlc_audio_set_volume( libvlc_instance_t *p_instance, int i_volume,
-                              libvlc_exception_t *p_exception )
+                              libvlc_exception_t *p_e )
 {
     if( i_volume >= 0 && i_volume <= 200 )
     {
@@ -106,7 +96,7 @@
     }
     else
     {
-        libvlc_exception_raise( p_exception, "Volume out of range" );
+        libvlc_exception_raise( p_e, "Volume out of range" );
     }
 }
 
diff -uNr vlc_0.8.6-svn20060918.debian/src/control/core.c vlc_0.8.6-svn20060925.debian/src/control/core.c
--- vlc_0.8.6-svn20060918.debian/src/control/core.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/control/core.c	2006-09-21 11:50:20.000000000 -0400
@@ -2,7 +2,7 @@
  * core.c: Core libvlc new API functions : initialization, exceptions handling
  *****************************************************************************
  * Copyright (C) 2005 the VideoLAN team
- * $Id: core.c 14706 2006-03-10 17:21:33Z courmisch $
+ * $Id: core.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Clent Stenac <zorglub@videolan.org>
  *
@@ -61,6 +61,17 @@
                                     char *psz_format, ... )
 {
     va_list args;
+
+    /* does caller care about exceptions ? */
+    if( p_exception == NULL ) return;
+
+    /* remove previous exception if it wasn't cleared */
+    if( p_exception->b_raised && p_exception->psz_message )
+    {
+        free(p_exception->psz_message);
+        p_exception->psz_message = NULL;
+    }
+
     va_start( args, psz_format );
     vasprintf( &p_exception->psz_message, psz_format, args );
     va_end( args );
@@ -70,7 +81,7 @@
 }
 
 libvlc_instance_t * libvlc_new( int argc, char **argv,
-                                libvlc_exception_t *p_exception )
+                                libvlc_exception_t *p_e )
 {
     int i_vlc_id;
     libvlc_instance_t *p_new;
@@ -79,21 +90,14 @@
     i_vlc_id = VLC_Create();
     p_vlc = (vlc_t* ) vlc_current_object( i_vlc_id );
 
-    if( !p_vlc )
-    {
-        libvlc_exception_raise( p_exception, "VLC initialization failed" );
-        return NULL;
-    }
+    if( !p_vlc ) RAISENULL( "VLC initialization failed" );
+
     p_new = (libvlc_instance_t *)malloc( sizeof( libvlc_instance_t ) );
+    if( !p_new ) RAISENULL( "Out of memory" );
 
     /** \todo Look for interface settings. If we don't have any, add -I dummy */
     /* Because we probably don't want a GUI by default */
 
-    if( !p_new )
-    {
-        libvlc_exception_raise( p_exception, "Out of memory" );
-        return NULL;
-    }
 
     VLC_Init( i_vlc_id, argc, argv );
 
@@ -102,13 +106,9 @@
                                 VLC_OBJECT_PLAYLIST, FIND_CHILD );
     p_new->p_vlm = NULL;
 
-    if( !p_new->p_playlist )
-    {
-        libvlc_exception_raise( p_exception, "Playlist creation failed" );
-        return NULL;
-    }
+    if( !p_new->p_playlist ) RAISENULL( "Playlist creation failed" );
+    
     p_new->i_vlc_id = i_vlc_id;
-
     return p_new;
 }
 
@@ -120,3 +120,9 @@
     VLC_CleanUp( p_instance->i_vlc_id );
     VLC_Destroy( p_instance->i_vlc_id );
 }
+
+int libvlc_get_vlc_id( libvlc_instance_t *p_instance )
+{
+    return p_instance->i_vlc_id;
+}
+
diff -uNr vlc_0.8.6-svn20060918.debian/src/control/input.c vlc_0.8.6-svn20060925.debian/src/control/input.c
--- vlc_0.8.6-svn20060918.debian/src/control/input.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/control/input.c	2006-09-21 11:50:20.000000000 -0400
@@ -2,7 +2,7 @@
  * input.c: Libvlc new API input management functions
  *****************************************************************************
  * Copyright (C) 2005 the VideoLAN team
- * $Id: input.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: input.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Clment Stenac <zorglub@videolan.org>
  *
@@ -29,8 +29,7 @@
 
 void libvlc_input_free( libvlc_input_t *p_input )
 {
-    if( p_input )
-        free( p_input );
+    if( p_input ) free( p_input );
 }
 
 /*
@@ -42,20 +41,12 @@
 {
     input_thread_t *p_input_thread;
 
-    if( !p_input )
-    {
-        libvlc_exception_raise( p_e, "Input is NULL" );
-        return NULL;
-    }
+    if( !p_input ) RAISENULL( "Input is NULL" );
 
     p_input_thread = (input_thread_t*)vlc_object_get(
-                                 p_input->p_instance->p_vlc,
-                                 p_input->i_input_id );
-    if( !p_input_thread )
-    {
-        libvlc_exception_raise( p_e, "Input does not exist" );
-        return NULL;
-    }
+                                                    p_input->p_instance->p_vlc,
+                                                    p_input->i_input_id );
+    if( !p_input_thread ) RAISENULL( "Input does not exist" );
 
     return p_input_thread;
 }
@@ -66,15 +57,13 @@
  * Getters for stream information
  **************************************************************************/
 vlc_int64_t libvlc_input_get_length( libvlc_input_t *p_input,
-                             libvlc_exception_t *p_exception )
+                             libvlc_exception_t *p_e )
 {
     input_thread_t *p_input_thread;
     vlc_value_t val;
 
-    p_input_thread = libvlc_get_input_thread ( p_input, p_exception);
-
-    if ( libvlc_exception_raised( p_exception ) )
-        return -1.0;
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e);
+    if( libvlc_exception_raised( p_e ) )  return -1.0;
        
     var_Get( p_input_thread, "length", &val );
     vlc_object_release( p_input_thread );
@@ -83,33 +72,55 @@
 }
 
 vlc_int64_t libvlc_input_get_time( libvlc_input_t *p_input,
-                           libvlc_exception_t *p_exception )
+                                   libvlc_exception_t *p_e )
 {
     input_thread_t *p_input_thread;
     vlc_value_t val;
 
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e );
+    if( libvlc_exception_raised( p_e ) )  return -1.0;
 
-    p_input_thread = libvlc_get_input_thread ( p_input, p_exception);
+    var_Get( p_input_thread , "time", &val );
+    vlc_object_release( p_input_thread );
+    return val.i_time / 1000;
+}
 
-    if ( libvlc_exception_raised( p_exception ) )
-        return -1.0;
+void libvlc_input_set_time( libvlc_input_t *p_input, vlc_int64_t time,
+                            libvlc_exception_t *p_e )
+{
+    input_thread_t *p_input_thread;
+    vlc_value_t value;
 
-    var_Get( p_input_thread , "time", &val );
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e );
+    if( libvlc_exception_raised( p_e ) )  return;
+    
+    value.i_time = time;
+    var_Set( p_input_thread, "time", value );
     vlc_object_release( p_input_thread );
+}
 
-    return val.i_time / 1000;
+void libvlc_input_set_position( libvlc_input_t *p_input, float position,
+                                libvlc_exception_t *p_e ) 
+{
+    input_thread_t *p_input_thread;
+    vlc_value_t val;
+    val.f_float = position;
+    
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e);
+    if ( libvlc_exception_raised( p_e ) ) return;
+
+    var_Set( p_input_thread, "position", val );
+    vlc_object_release( p_input_thread );
 }
 
 float libvlc_input_get_position( libvlc_input_t *p_input,
-                                 libvlc_exception_t *p_exception )
+                                 libvlc_exception_t *p_e )
 {
     input_thread_t *p_input_thread;
     vlc_value_t val;
 
-    p_input_thread = libvlc_get_input_thread ( p_input, p_exception);
-
-    if ( libvlc_exception_raised( p_exception ) )
-        return -1.0;
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e);
+    if ( libvlc_exception_raised( p_e ) )  return -1.0;
 
     var_Get( p_input_thread, "position", &val );
     vlc_object_release( p_input_thread );
@@ -118,17 +129,19 @@
 }
 
 float libvlc_input_get_fps( libvlc_input_t *p_input,
-                            libvlc_exception_t *p_exception) 
+                            libvlc_exception_t *p_e) 
 {
     double f_fps;
     input_thread_t *p_input_thread;
 
-    p_input_thread = libvlc_get_input_thread ( p_input, p_exception);
+    p_input_thread = libvlc_get_input_thread ( p_input, p_e );
+    if ( libvlc_exception_raised( p_e ) )  return 0.0;
 
-    if( demux2_Control( p_input_thread->input.p_demux, DEMUX_GET_FPS, &f_fps ) || f_fps < 0.1 ) 
+    if( demux2_Control( p_input_thread->input.p_demux, DEMUX_GET_FPS, &f_fps )
+        || f_fps < 0.1 ) 
     {
         vlc_object_release( p_input_thread );
-        return 0;
+        return 0.0;
     }
     else
     {
@@ -138,21 +151,17 @@
 }
 
 vlc_bool_t libvlc_input_will_play( libvlc_input_t *p_input,
-                                   libvlc_exception_t *p_exception) 
+                                   libvlc_exception_t *p_e) 
 {
-    input_thread_t *p_input_thread;
-
-    p_input_thread = libvlc_get_input_thread ( p_input, p_exception);
-
-    if ( libvlc_exception_raised( p_exception ) )
-        return VLC_FALSE;
+    input_thread_t *p_input_thread =
+                            libvlc_get_input_thread ( p_input, p_e);
+    if ( libvlc_exception_raised( p_e ) ) return VLC_FALSE;
 
     if ( !p_input_thread->b_die && !p_input_thread->b_dead ) 
     {
         vlc_object_release( p_input_thread );
         return VLC_TRUE;
     }
-    
     vlc_object_release( p_input_thread );
     return VLC_FALSE;
 }
diff -uNr vlc_0.8.6-svn20060918.debian/src/control/playlist.c vlc_0.8.6-svn20060925.debian/src/control/playlist.c
--- vlc_0.8.6-svn20060918.debian/src/control/playlist.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/control/playlist.c	2006-09-21 11:50:20.000000000 -0400
@@ -2,7 +2,7 @@
  * playlist.c: libvlc new API playlist handling functions
  *****************************************************************************
  * Copyright (C) 2005 the VideoLAN team
- * $Id: playlist.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: playlist.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Clment Stenac <zorglub@videolan.org>
  *
@@ -26,17 +26,16 @@
 
 #include <vlc/intf.h>
 
+#include <assert.h>
+
 void libvlc_playlist_play( libvlc_instance_t *p_instance, int i_id,
                            int i_options, char **ppsz_options,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     ///\todo Handle additionnal options
 
-    if( p_instance->p_playlist->i_size == 0 )
-    {
-        libvlc_exception_raise( p_exception, "Empty playlist" );
-        return;
-    }
+    if( p_instance->p_playlist->i_size == 0 ) RAISEVOID( "Empty playlist" );
     if( i_id > 0 )
     {
         /* Always use the current view when using libvlc */
@@ -52,7 +51,7 @@
                                     p_instance->p_playlist->status.i_view );
         if( !p_view )
         {
-             libvlc_exception_raise( p_exception,
+             libvlc_exception_raise( p_e,
                                      "Unable to find current playlist view ");
              return;
         }
@@ -61,7 +60,7 @@
 
         if( !p_item )
         {
-            libvlc_exception_raise( p_exception, "Unable to find item " );
+            libvlc_exception_raise( p_e, "Unable to find item " );
             return;
         }
         playlist_LockControl( p_instance->p_playlist, PLAYLIST_VIEWPLAY,
@@ -75,103 +74,94 @@
 }
 
 void libvlc_playlist_pause( libvlc_instance_t *p_instance,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     if( playlist_Pause( p_instance->p_playlist ) != VLC_SUCCESS )
-    {
-        libvlc_exception_raise( p_exception, "Empty playlist" );
-    }
+        RAISEVOID( "Empty playlist" );
 }
 
 
 void libvlc_playlist_stop( libvlc_instance_t *p_instance,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     if( playlist_Stop( p_instance->p_playlist ) != VLC_SUCCESS )
-    {
-        libvlc_exception_raise( p_exception, "Empty playlist" );
-    }
+        RAISEVOID( "Empty playlist" );
 }
 
 void libvlc_playlist_clear( libvlc_instance_t *p_instance,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     playlist_Clear( p_instance->p_playlist );
 }
 
 void libvlc_playlist_next( libvlc_instance_t *p_instance,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     if( playlist_Next( p_instance->p_playlist ) != VLC_SUCCESS )
-    {
-        libvlc_exception_raise( p_exception, "Empty playlist" );
-    }
+        RAISEVOID( "Empty playlist" );
 }
 
 void libvlc_playlist_prev( libvlc_instance_t *p_instance,
-                           libvlc_exception_t *p_exception )
+                           libvlc_exception_t *p_e )
 {
     if( playlist_Prev( p_instance->p_playlist ) != VLC_SUCCESS )
-    {
-        libvlc_exception_raise( p_exception, "Empty playlist" );
-    }
+        RAISEVOID( "Empty playlist" );
 }
 
 int libvlc_playlist_add( libvlc_instance_t *p_instance, const char *psz_uri,
-                         const char *psz_name, libvlc_exception_t *p_exception )
+                         const char *psz_name, libvlc_exception_t *p_e )
 {
     return libvlc_playlist_add_extended( p_instance, psz_uri, psz_name,
-                                         0, NULL, p_exception );
+                                         0, NULL, p_e );
 }
 
 int libvlc_playlist_add_extended( libvlc_instance_t *p_instance,
                                   const char *psz_uri, const char *psz_name,
                                   int i_options, const char **ppsz_options,
-                                  libvlc_exception_t *p_exception )
+                                  libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     return playlist_AddExt( p_instance->p_playlist, psz_uri, psz_name,
                             PLAYLIST_INSERT, PLAYLIST_END, -1, ppsz_options,
                             i_options );
 }
 
 int libvlc_playlist_delete_item( libvlc_instance_t *p_instance, int i_id,
-                                 libvlc_exception_t *p_exception )
+                                 libvlc_exception_t *p_e )
 {
+    assert( p_instance->p_playlist );
     return playlist_Delete( p_instance->p_playlist, i_id );
 }
 
 
 int libvlc_playlist_isplaying( libvlc_instance_t *p_instance,
-                               libvlc_exception_t *p_exception )
+                               libvlc_exception_t *p_e )
 {
-    if( !p_instance->p_playlist )
-    {
-        libvlc_exception_raise( p_exception, "No playlist" );
-        return 0;
-    }
+    assert( p_instance->p_playlist );
     return playlist_IsPlaying( p_instance->p_playlist );
 }
 
 int libvlc_playlist_items_count( libvlc_instance_t *p_instance,
-                                 libvlc_exception_t *p_exception )
+                                 libvlc_exception_t *p_e )
 {
-    if( !p_instance->p_playlist )
-    {
-        libvlc_exception_raise( p_exception, "No playlist" );
-        return 0;
-    }
+    assert( p_instance->p_playlist );
     return p_instance->p_playlist->i_size;
 }
 
 libvlc_input_t * libvlc_playlist_get_input( libvlc_instance_t *p_instance,
-                                            libvlc_exception_t *p_exception )
+                                            libvlc_exception_t *p_e )
 {
     libvlc_input_t *p_input;
+    assert( p_instance->p_playlist );
 
     vlc_mutex_lock( &p_instance->p_playlist->object_lock );
     if( p_instance->p_playlist->p_input == NULL )
     {
-        libvlc_exception_raise( p_exception, "No active input" );
+        libvlc_exception_raise( p_e, "No active input" );
         vlc_mutex_unlock( &p_instance->p_playlist->object_lock );
         return NULL;
     }
diff -uNr vlc_0.8.6-svn20060918.debian/src/control/video.c vlc_0.8.6-svn20060925.debian/src/control/video.c
--- vlc_0.8.6-svn20060918.debian/src/control/video.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/control/video.c	2006-09-21 11:50:20.000000000 -0400
@@ -1,10 +1,12 @@
 /*****************************************************************************
- * video.c: ibvlc new API video functions
+ * video.c: libvlc new API video functions
  *****************************************************************************
  * Copyright (C) 2005 the VideoLAN team
+ *
  * $Id: core.c 14187 2006-02-07 16:37:40Z courmisch $
  *
  * Authors: Clment Stenac <zorglub@videolan.org>
+ *          Filippo Carone <littlejohn@videolan.org>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -27,6 +29,10 @@
 #include <vlc/vout.h>
 #include <vlc/intf.h>
 
+/*
+ * Remember to release the returned vout_thread_t since it is locked at
+ * the end of this function.
+ */
 static vout_thread_t *GetVout( libvlc_input_t *p_input,
                                libvlc_exception_t *p_exception )
 {
@@ -208,3 +214,35 @@
     
     return VLC_TRUE;
 }
+
+
+int libvlc_video_reparent( libvlc_input_t *p_input, libvlc_drawable_t d,
+                           libvlc_exception_t *p_e )
+{
+    vout_thread_t *p_vout = GetVout( p_input, p_e );
+    vout_Control( p_vout , VOUT_REPARENT, d);
+    vlc_object_release( p_vout );
+    
+    return 0;
+    
+}
+
+void libvlc_video_resize( libvlc_input_t *p_input, int width, int height, libvlc_exception_t *p_e )
+{
+    vout_thread_t *p_vout = GetVout( p_input, p_e );
+    vout_Control( p_vout, VOUT_SET_SIZE, width, height );
+    vlc_object_release( p_vout );
+}
+
+
+int libvlc_video_destroy( libvlc_input_t *p_input,
+                          libvlc_exception_t *p_e )
+{
+    vout_thread_t *p_vout = GetVout( p_input, p_e );
+    vlc_object_detach( p_vout ); 
+    vlc_object_release( p_vout );
+    vout_Destroy( p_vout );
+    
+    return 0;
+    
+}
diff -uNr vlc_0.8.6-svn20060918.debian/src/input/decoder.c vlc_0.8.6-svn20060925.debian/src/input/decoder.c
--- vlc_0.8.6-svn20060918.debian/src/input/decoder.c	2006-09-18 06:27:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/input/decoder.c	2006-09-21 11:50:44.000000000 -0400
@@ -2,7 +2,7 @@
  * decoder.c: Functions for the management of decoders
  *****************************************************************************
  * Copyright (C) 1999-2004 the VideoLAN team
- * $Id: decoder.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: decoder.c 16771 2006-09-21 15:52:00Z sam $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
@@ -586,13 +586,13 @@
             if( p_dec->p_owner->p_sout->i_out_pace_nocontrol > 0 &&
                 p_dec->p_owner->p_input->b_out_pace_control )
             {
-                msg_Dbg( p_dec, "switching to synch mode" );
+                msg_Dbg( p_dec, "switching to sync mode" );
                 p_dec->p_owner->p_input->b_out_pace_control = VLC_FALSE;
             }
             else if( p_dec->p_owner->p_sout->i_out_pace_nocontrol <= 0 &&
                      !p_dec->p_owner->p_input->b_out_pace_control )
             {
-                msg_Dbg( p_dec, "switching to asynch mode" );
+                msg_Dbg( p_dec, "switching to async mode" );
                 p_dec->p_owner->p_input->b_out_pace_control = VLC_TRUE;
             }
         }
@@ -933,10 +933,21 @@
         if( !p_dec->fmt_out.video.i_visible_width ||
             !p_dec->fmt_out.video.i_visible_height )
         {
-            p_dec->fmt_out.video.i_visible_width =
-                p_dec->fmt_out.video.i_width;
-            p_dec->fmt_out.video.i_visible_height =
-                p_dec->fmt_out.video.i_height;
+            if( p_dec->fmt_in.video.i_visible_width &&
+                p_dec->fmt_in.video.i_visible_height )
+            {
+                p_dec->fmt_out.video.i_visible_width =
+                    p_dec->fmt_in.video.i_visible_width;
+                p_dec->fmt_out.video.i_visible_height =
+                    p_dec->fmt_in.video.i_visible_height;
+            }
+            else
+            {
+                p_dec->fmt_out.video.i_visible_width =
+                    p_dec->fmt_out.video.i_width;
+                p_dec->fmt_out.video.i_visible_height =
+                    p_dec->fmt_out.video.i_height;
+            }
         }
 
         if( p_dec->fmt_out.video.i_visible_height == 1088 &&
diff -uNr vlc_0.8.6-svn20060918.debian/src/input/input.c vlc_0.8.6-svn20060925.debian/src/input/input.c
--- vlc_0.8.6-svn20060918.debian/src/input/input.c	2006-09-18 06:27:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/input/input.c	2006-09-21 11:50:44.000000000 -0400
@@ -2,7 +2,7 @@
  * input.c: input thread
  *****************************************************************************
  * Copyright (C) 1998-2004 the VideoLAN team
- * $Id: input.c 16460 2006-08-31 22:01:13Z hartman $
+ * $Id: input.c 16771 2006-09-21 15:52:00Z sam $
  *
  * Authors: Christophe Massiot <massiot@via.ecp.fr>
  *          Laurent Aimar <fenrir@via.ecp.fr>
@@ -323,7 +323,7 @@
 
     /* Allocate descriptor */
     p_input = Create( p_parent, p_item, NULL, VLC_TRUE );
-    p_input->i_flags |= OBJECT_FLAGS_NODBG;
+    p_input->i_flags |= OBJECT_FLAGS_QUIET;
     p_input->i_flags |= OBJECT_FLAGS_NOINTERACT;
 
     /* Now we can attach our new input */
@@ -449,7 +449,7 @@
         p_input->b_eof = VLC_TRUE;
     }
 
-    /* Wait we are asked to die */
+    /* Wait until we are asked to die */
     if( !p_input->b_die )
     {
         Error( p_input );
@@ -481,7 +481,7 @@
 
     if( !p_input->b_eof && !p_input->b_error && p_input->input.b_eof )
     {
-        /* We have finish to demux data but not to play them */
+        /* We have finished demuxing data but not playing it */
         while( !p_input->b_die )
         {
             if( input_EsOutDecodersEmpty( p_input->p_es_out ) )
@@ -491,6 +491,7 @@
 
             msleep( INPUT_IDLE_SLEEP );
         }
+
         /* We have finished */
         p_input->b_eof = VLC_TRUE;
     }
@@ -997,7 +998,7 @@
             }
 
             msg_Dbg( p_input, "starting in %s mode",
-                     p_input->b_out_pace_control ? "asynch" : "synch" );
+                     p_input->b_out_pace_control ? "async" : "sync" );
         }
     }
 
@@ -1295,7 +1296,7 @@
             }
             if( f_pos < 0.0 ) f_pos = 0.0;
             if( f_pos > 1.0 ) f_pos = 1.0;
-            /* Reset the decoders states and clock synch (before calling the demuxer */
+            /* Reset the decoders states and clock sync (before calling the demuxer */
             es_out_Control( p_input->p_es_out, ES_OUT_RESET_PCR );
             input_EsOutDiscontinuity( p_input->p_es_out, VLC_FALSE );
             if( demux2_Control( p_input->input.p_demux, DEMUX_SET_POSITION,
@@ -1333,7 +1334,7 @@
             }
             if( i_time < 0 ) i_time = 0;
 
-            /* Reset the decoders states and clock synch (before calling the demuxer */
+            /* Reset the decoders states and clock sync (before calling the demuxer */
             es_out_Control( p_input->p_es_out, ES_OUT_RESET_PCR );
             input_EsOutDiscontinuity( p_input->p_es_out, VLC_FALSE );
 
diff -uNr vlc_0.8.6-svn20060918.debian/src/Makefile.in vlc_0.8.6-svn20060925.debian/src/Makefile.in
--- vlc_0.8.6-svn20060918.debian/src/Makefile.in	2006-09-18 06:31:07.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/Makefile.in	2006-09-24 13:13:36.000000000 -0400
@@ -126,12 +126,13 @@
 FILE_LIBVLC_DLL = @FILE_LIBVLC_DLL@
 FREETYPE_CONFIG = @FREETYPE_CONFIG@
 FRIBIDI_CONFIG = @FRIBIDI_CONFIG@
-GCJ_OPTS = @GCJ_OPTS@
 GENCAT = @GENCAT@
 GLIBC21 = @GLIBC21@
 GMSGFMT = @GMSGFMT@
 GNOMEVFS_CFLAGS = @GNOMEVFS_CFLAGS@
 GNOMEVFS_LIBS = @GNOMEVFS_LIBS@
+GNUTLS_CFLAGS = @GNUTLS_CFLAGS@
+GNUTLS_LIBS = @GNUTLS_LIBS@
 GREP = @GREP@
 GTK2_CFLAGS = @GTK2_CFLAGS@
 GTK2_LIBS = @GTK2_LIBS@
@@ -163,9 +164,6 @@
 INTL_LIBTOOL_SUFFIX_PREFIX = @INTL_LIBTOOL_SUFFIX_PREFIX@
 JAVA = @JAVA@
 JAVAC = @JAVAC@
-JAVA_CC = @JAVA_CC@
-JAVA_CC_FLAGS = @JAVA_CC_FLAGS@
-JAVA_CC_OPTS = @JAVA_CC_OPTS@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBCDDB_CFLAGS = @LIBCDDB_CFLAGS@
@@ -257,7 +255,6 @@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_JAVA_CC = @ac_ct_JAVA_CC@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
diff -uNr vlc_0.8.6-svn20060918.debian/src/misc/image.c vlc_0.8.6-svn20060925.debian/src/misc/image.c
--- vlc_0.8.6-svn20060918.debian/src/misc/image.c	2006-09-18 06:27:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/misc/image.c	2006-09-21 11:50:20.000000000 -0400
@@ -2,7 +2,7 @@
  * image.c : wrapper for image reading/writing facilities
  *****************************************************************************
  * Copyright (C) 2004 the VideoLAN team
- * $Id: image.c 15019 2006-04-01 00:25:58Z dionoea $
+ * $Id: image.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Author: Gildas Bazin <gbazin@videolan.org>
  *
@@ -97,6 +97,7 @@
     if( p_image->p_filter ) DeleteFilter( p_image->p_filter );
 
     free( p_image );
+    p_image = NULL;
 }
 
 /**
@@ -408,7 +409,7 @@
     {
         /* We need to restart a new filter */
         DeleteFilter( p_image->p_filter );
-        p_image->p_filter = 0;
+        p_image->p_filter = NULL;
     }
 
     /* Start a filter */
@@ -654,6 +655,7 @@
     es_format_Clean( &p_dec->fmt_out );
 
     vlc_object_destroy( p_dec );
+    p_dec = NULL;
 }
 
 static encoder_t *CreateEncoder( vlc_object_t *p_this, video_format_t *fmt_in,
@@ -736,6 +738,7 @@
     es_format_Clean( &p_enc->fmt_out );
 
     vlc_object_destroy( p_enc );
+    p_enc = NULL;
 }
 
 static filter_t *CreateFilter( vlc_object_t *p_this, es_format_t *p_fmt_in,
@@ -756,8 +759,8 @@
     p_filter->fmt_out = *p_fmt_in;
     p_filter->fmt_out.i_codec = p_fmt_out->i_chroma;
     p_filter->fmt_out.video = *p_fmt_out;
-    p_filter->p_module = module_Need( p_filter, "video filter2", psz_module,
-                                      0 );
+    p_filter->p_module = module_Need( p_filter, "video filter2",
+                                      psz_module, 0 );
 
     if( !p_filter->p_module )
     {
@@ -779,4 +782,5 @@
     es_format_Clean( &p_filter->fmt_out );
 
     vlc_object_destroy( p_filter );
+    p_filter = NULL;
 }
diff -uNr vlc_0.8.6-svn20060918.debian/src/misc/messages.c vlc_0.8.6-svn20060925.debian/src/misc/messages.c
--- vlc_0.8.6-svn20060918.debian/src/misc/messages.c	2006-09-18 06:27:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/misc/messages.c	2006-09-21 11:50:20.000000000 -0400
@@ -4,7 +4,7 @@
  * modules, especially intf modules. See config.h for output configuration.
  *****************************************************************************
  * Copyright (C) 1998-2005 the VideoLAN team
- * $Id: messages.c 14811 2006-03-18 17:52:31Z zorglub $
+ * $Id: messages.c 16767 2006-09-21 14:32:45Z hartman $
  *
  * Authors: Vincent Seguin <seguin@via.ecp.fr>
  *          Samuel Hocevar <sam@zoy.org>
@@ -312,8 +312,7 @@
     int i;
 
     if( p_this == NULL || p_this->i_flags & OBJECT_FLAGS_QUIET ||
-        (p_this->i_flags & OBJECT_FLAGS_NODBG &&
-         i_type == VLC_MSG_DBG ) )
+        (p_this->i_flags & OBJECT_FLAGS_NODBG && i_type == VLC_MSG_DBG) )
     {
         return;
     }
diff -uNr vlc_0.8.6-svn20060918.debian/src/misc/unicode.c vlc_0.8.6-svn20060925.debian/src/misc/unicode.c
--- vlc_0.8.6-svn20060918.debian/src/misc/unicode.c	2006-09-18 06:27:56.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/misc/unicode.c	2006-09-22 11:14:27.000000000 -0400
@@ -2,7 +2,7 @@
  * unicode.c: Unicode <-> locale functions
  *****************************************************************************
  * Copyright (C) 2005-2006 the VideoLAN team
- * $Id: unicode.c 16707 2006-09-17 20:55:39Z thresh $
+ * $Id: unicode.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Rmi Denis-Courmont <rem # videolan.org>
  *
@@ -585,6 +585,8 @@
 {
     unsigned char *ptr, c;
 
+    assert (str != NULL);
+
     ptr = (unsigned char *)str;
     while( (c = *ptr) != '\0' )
     {
diff -uNr vlc_0.8.6-svn20060918.debian/src/misc/version.c vlc_0.8.6-svn20060925.debian/src/misc/version.c
--- vlc_0.8.6-svn20060918.debian/src/misc/version.c	2006-09-18 06:32:39.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/misc/version.c	2006-09-25 07:49:17.000000000 -0400
@@ -3,5 +3,5 @@
  * WHETHER THEY ARE BUILT BY OTHERS OR DURING DEVELOPMENT OR FOR THE
  * OFFICIAL VLC STABLE RELEASES.
  */
-const char psz_vlc_changeset[] = "16726";
+const char psz_vlc_changeset[] = "16844";
 
diff -uNr vlc_0.8.6-svn20060918.debian/src/network/httpd.c vlc_0.8.6-svn20060925.debian/src/network/httpd.c
--- vlc_0.8.6-svn20060918.debian/src/network/httpd.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/network/httpd.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * httpd.c
  *****************************************************************************
  * Copyright (C) 2004-2006 the VideoLAN team
- * $Id: httpd.c 16439 2006-08-30 19:33:55Z hartman $
+ * $Id: httpd.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Laurent Aimar <fenrir@via.ecp.fr>
  *          Rmi Denis-Courmont <rem # videolan.org>
@@ -622,6 +622,7 @@
                                    httpd_message_t *query )
 {
     httpd_redirect_t *rdir = (httpd_redirect_t*)p_sys;
+    char *p_body;
 
     if( answer == NULL || query == NULL )
     {
@@ -633,7 +634,7 @@
     answer->i_status = 301;
     answer->psz_status = strdup( "Moved Permanently" );
 
-    answer->i_body = asprintf( (char **)&answer->p_body,
+    answer->i_body = asprintf( &p_body,
         "<?xml version=\"1.0\" encoding=\"ascii\" ?>\n"
         "<!DOCTYPE html PUBLIC \"-//W3C//DTD  XHTML 1.0 Strict//EN\" "
         "\"http://www.w3.org/TR/xhtml10/DTD/xhtml10strict.dtd\">\n"
@@ -649,6 +650,7 @@
         "<hr />\n"
         "</body>\n"
         "</html>\n", rdir->psz_dst );
+    answer->p_body = (unsigned char *)p_body;
 
     /* XXX check if it's ok or we need to set an absolute url */
     httpd_MsgAdd( answer, "Location",  "%s", rdir->psz_dst );
diff -uNr vlc_0.8.6-svn20060918.debian/src/network/rootwrap.c vlc_0.8.6-svn20060925.debian/src/network/rootwrap.c
--- vlc_0.8.6-svn20060918.debian/src/network/rootwrap.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/network/rootwrap.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * rootwrap.c
  *****************************************************************************
  * Copyright  2005 Rmi Denis-Courmont
- * $Id: rootwrap.c 15025 2006-04-01 11:27:40Z fkuehne $
+ * $Id: rootwrap.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Author: Rmi Denis-Courmont <rem # videolan.org>
  *
@@ -52,6 +52,11 @@
 #include <netinet/in.h>
 #include <pthread.h>
 
+#if defined (AF_INET6) && !defined (IPV6_V6ONLY)
+# warning Uho, your IPv6 support is broken and has been disabled. Fix your C library.
+# undef AF_INET6
+#endif
+
 /*#ifndef HAVE_CLEARENV
 extern char **environ;
 
diff -uNr vlc_0.8.6-svn20060918.debian/src/osd/osd_parser.c vlc_0.8.6-svn20060925.debian/src/osd/osd_parser.c
--- vlc_0.8.6-svn20060918.debian/src/osd/osd_parser.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/osd/osd_parser.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * osd_parser.c - The OSD Menu  parser core code.
  *****************************************************************************
  * Copyright (C) 2005 M2X
- * $Id: osd_parser.c 15025 2006-04-01 11:27:40Z fkuehne $
+ * $Id: osd_parser.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * Authors: Jean-Paul Saman <jpsaman #_at_# m2x dot nl>
  *
@@ -62,7 +62,10 @@
 {
     picture_t *p_pic = NULL;
     image_handler_t *p_image;
-    video_format_t fmt_in = {0}, fmt_out = {0};
+    video_format_t fmt_in, fmt_out;
+
+    memset( &fmt_in, 0, sizeof(video_format_t) );
+    memset( &fmt_out, 0, sizeof(video_format_t) );
 
     fmt_out.i_chroma = VLC_FOURCC('Y','U','V','A');
     p_image = image_HandlerCreate( p_this );
diff -uNr vlc_0.8.6-svn20060918.debian/src/stream_output/sap.c vlc_0.8.6-svn20060925.debian/src/stream_output/sap.c
--- vlc_0.8.6-svn20060918.debian/src/stream_output/sap.c	2006-09-18 06:27:59.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/stream_output/sap.c	2006-09-22 11:14:27.000000000 -0400
@@ -2,7 +2,7 @@
  * sap.c : SAP announce handler
  *****************************************************************************
  * Copyright (C) 2002-2005 the VideoLAN team
- * $Id: sap.c 16434 2006-08-30 15:18:13Z hartman $
+ * $Id: sap.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Clment Stenac <zorglub@videolan.org>
  *          Rmi Denis-Courmont <rem # videolan.org>
@@ -619,17 +619,20 @@
                             "v=0\r\n"
                             "o=- "I64Fd" %d IN IP%c %s\r\n"
                             "s=%s\r\n"
-                            "t=0 0\r\n"
                             "c=IN IP%c %s/%d\r\n"
-                            "m=video %d %s %d\r\n"
+                            "t=0 0\r\n"
                             "a=tool:"PACKAGE_STRING"\r\n"
-                            "a=type:broadcast\r\n"
+                            "a=recvonly\r\n"
+                            "a=type:broadcast\n"
+                            "a=source-filter: incl IN IP%c * %s\r\n"
+                            "m=video %d %s %d\r\n"
                             "%s%s%s",
                             i_sdp_id, i_sdp_version,
                             ipv, p_addr->psz_machine,
                             psz_name, ipv, psz_uri,
                             /* FIXME: 1 is IPv4 default TTL, not that of IPv6 */
                             p_session->i_ttl ?: (config_GetInt( p_sap, "ttl" ) ?: 1),
+                            ipv, psz_uri,
                             p_session->i_port, 
                             p_session->b_rtp ? "RTP/AVP" : "udp",
                             p_session->i_payload,
diff -uNr vlc_0.8.6-svn20060918.debian/src/test/url.c vlc_0.8.6-svn20060925.debian/src/test/url.c
--- vlc_0.8.6-svn20060918.debian/src/test/url.c	2006-09-18 06:27:54.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/test/url.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * url.c: Test for url encoding/decoding stuff
  *****************************************************************************
  * Copyright (C) 2006 Rmi Denis-Courmont
- * $Id: url.c 15178 2006-04-11 16:18:39Z courmisch $
+ * $Id: url.c 16773 2006-09-21 18:46:25Z hartman $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -25,21 +25,36 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-void test_decode (const char *in, const char *out)
+typedef char * (*conv_t) (const char *);
+
+static void test (conv_t f, const char *in, const char *out)
 {
     char *res;
 
     printf ("\"%s\" -> \"%s\" ?\n", in, out);
-    res = decode_URI_duplicate (in);
+    res = f (in);
     if (res == NULL)
         exit (1);
 
     if (strcmp (res, out))
+    {
+        printf (" ERROR: got \"%s\"\n", res);
         exit (2);
+    }
 
     free (res);
 }
 
+static inline void test_decode (const char *in, const char *out)
+{
+    test (decode_URI_duplicate, in, out);
+}
+
+static inline void test_b64 (const char *in, const char *out)
+{
+    test (vlc_b64_encode, in, out);
+}
+
 int main (void)
 {
     (void)setvbuf (stdout, NULL, _IONBF, 0);
@@ -64,5 +79,12 @@
     test_decode ("T%E9l%E9vision", "T?l?vision");
     test_decode ("%C1%94%C3%a9l%c3%A9vision", "??lvision"); /* overlong */
 
+    /* Base 64 tests */
+    test_b64 ("", "");
+    test_b64 ("d", "ZA==");
+    test_b64 ("ab", "YWI=");
+    test_b64 ("abc", "YWJj");
+    test_b64 ("abcd", "YWJjZA==");
+
     return 0;
 }
diff -uNr vlc_0.8.6-svn20060918.debian/src/video_output/video_output.c vlc_0.8.6-svn20060925.debian/src/video_output/video_output.c
--- vlc_0.8.6-svn20060918.debian/src/video_output/video_output.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/video_output/video_output.c	2006-09-22 11:14:26.000000000 -0400
@@ -6,7 +6,7 @@
  * thread, and destroy a previously oppened video output thread.
  *****************************************************************************
  * Copyright (C) 2000-2004 the VideoLAN team
- * $Id: video_output.c 16457 2006-08-31 20:51:12Z hartman $
+ * $Id: video_output.c 16775 2006-09-21 20:35:23Z hartman $
  *
  * Authors: Vincent Seguin <seguin@via.ecp.fr>
  *          Gildas Bazin <gbazin@videolan.org>
@@ -701,6 +701,8 @@
 
     subpicture_t *  p_subpic = NULL;                   /* subpicture pointer */
 
+    input_thread_t *p_input = NULL ;           /* Parent input, if it exists */
+
     vlc_value_t     val;
     vlc_bool_t      b_drop_late;
 
@@ -895,7 +897,11 @@
          */
         if( display_date > 0 )
         {
-            p_subpic = spu_SortSubpictures( p_vout->p_spu, display_date );
+            if( !p_input )
+                p_input = vlc_object_find( p_vout, VLC_OBJECT_INPUT,
+                                           FIND_PARENT );
+            p_subpic = spu_SortSubpictures( p_vout->p_spu, display_date,
+            p_input ? var_GetBool( p_input, "state" ) == PAUSE_S : VLC_FALSE );
         }
 
         /*
@@ -1044,6 +1050,11 @@
         }
     }
 
+    if( p_input )
+    {
+        vlc_object_release( p_input );
+    }
+
     /*
      * Error loop - wait until the thread destruction is requested
      */
diff -uNr vlc_0.8.6-svn20060918.debian/src/video_output/vout_intf.c vlc_0.8.6-svn20060925.debian/src/video_output/vout_intf.c
--- vlc_0.8.6-svn20060918.debian/src/video_output/vout_intf.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/video_output/vout_intf.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * vout_intf.c : video output interface
  *****************************************************************************
  * Copyright (C) 2000-2006 the VideoLAN team
- * $Id: vout_intf.c 16647 2006-09-14 14:58:57Z hartman $
+ * $Id: vout_intf.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Gildas Bazin <gbazin@videolan.org>
  *
@@ -445,7 +445,7 @@
     picture_t *p_pif;
     vlc_value_t val, format;
     DIR *path;
-    
+
     int i_ret;
 
     var_Get( p_vout, "snapshot-path", &val );
diff -uNr vlc_0.8.6-svn20060918.debian/src/video_output/vout_subpictures.c vlc_0.8.6-svn20060925.debian/src/video_output/vout_subpictures.c
--- vlc_0.8.6-svn20060918.debian/src/video_output/vout_subpictures.c	2006-09-18 06:27:55.000000000 -0400
+++ vlc_0.8.6-svn20060925.debian/src/video_output/vout_subpictures.c	2006-09-22 11:14:26.000000000 -0400
@@ -2,7 +2,7 @@
  * vout_subpictures.c : subpicture management functions
  *****************************************************************************
  * Copyright (C) 2000-2005 the VideoLAN team
- * $Id: vout_subpictures.c 15203 2006-04-13 14:47:20Z hartman $
+ * $Id: vout_subpictures.c 16774 2006-09-21 19:29:10Z hartman $
  *
  * Authors: Vincent Seguin <seguin@via.ecp.fr>
  *          Samuel Hocevar <sam@zoy.org>
@@ -401,6 +401,7 @@
     memset( p_subpic, 0, sizeof(subpicture_t) );
     p_subpic->i_status   = RESERVED_SUBPICTURE;
     p_subpic->b_absolute = VLC_TRUE;
+    p_subpic->b_pausable = VLC_FALSE;
     p_subpic->b_fade     = VLC_FALSE;
     p_subpic->i_alpha    = 0xFF;
     p_subpic->p_region   = 0;
@@ -412,7 +413,7 @@
     p_subpic->pf_create_region = __spu_CreateRegion;
     p_subpic->pf_make_region = __spu_MakeRegion;
     p_subpic->pf_destroy_region = __spu_DestroyRegion;
-    
+
     return p_subpic;
 }
 
@@ -823,7 +824,8 @@
  * to be removed if a newer one is available), which makes it a lot
  * more difficult to guess if a subpicture has to be rendered or not.
  *****************************************************************************/
-subpicture_t *spu_SortSubpictures( spu_t *p_spu, mtime_t display_date )
+subpicture_t *spu_SortSubpictures( spu_t *p_spu, mtime_t display_date,
+                                   vlc_bool_t b_paused )
 {
     int i_index, i_channel;
     subpicture_t *p_subpic = NULL;
@@ -869,7 +871,9 @@
             if( display_date > p_spu->p_subpicture[i_index].i_stop &&
                 ( !p_spu->p_subpicture[i_index].b_ephemer ||
                   p_spu->p_subpicture[i_index].i_stop >
-                  p_spu->p_subpicture[i_index].i_start ) )
+                  p_spu->p_subpicture[i_index].i_start ) &&
+                !( p_spu->p_subpicture[i_index].b_pausable &&
+                   b_paused ) )
             {
                 /* Too late, destroy the subpic */
                 spu_DestroySubpicture( p_spu, &p_spu->p_subpicture[i_index] );
diff -uNr vlc_0.8.6-svn20060918.debian/THANKS vlc_0.8.6-svn20060925.debian/THANKS
