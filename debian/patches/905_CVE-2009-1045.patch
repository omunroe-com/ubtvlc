#
# Description: Denial of service via long input argument.
# Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=522170
# Patch: http://git.videolan.org/?p=vlc.git;a=commitdiff;h=abc867adb981772703c5d33711736f531a4551b4
#
diff -Nur vlc-0.9.4/src/input/input.c vlc-0.9.4.new/src/input/input.c
--- vlc-0.9.4/src/input/input.c	2008-09-18 21:09:26.000000000 -0400
+++ vlc-0.9.4.new/src/input/input.c	2009-06-28 12:13:01.000000000 -0400
@@ -2063,8 +2063,6 @@
                             const char *psz_forced_demux )
 {
     const bool b_master = in == &p_input->p->input;
-
-    char psz_dup[strlen (psz_mrl) + 1];
     const char *psz_access;
     const char *psz_demux;
     char *psz_path;
@@ -2073,11 +2071,14 @@
     vlc_value_t val;
     double f_fps;
 
-    strcpy( psz_dup, psz_mrl );
-
     if( !in ) return VLC_EGENERIC;
     if( !p_input ) return VLC_EGENERIC;
 
+    char *psz_dup = strdup( psz_mrl );
+
+    if( psz_dup == NULL )
+        goto error;
+
     /* Split uri */
     input_SplitMRL( &psz_access, &psz_demux, &psz_path, psz_dup );
 
@@ -2328,6 +2329,8 @@
         }
     }
 
+    free( psz_dup );
+
     /* get attachment
      * FIXME improve for b_preparsing: move it after GET_META and check psz_arturl */
     if( 1 || !p_input->b_preparsing )
@@ -2367,6 +2370,7 @@
 
     if( in->p_access )
         access_Delete( in->p_access );
+    free( psz_dup );
 
     return VLC_EGENERIC;
 }
